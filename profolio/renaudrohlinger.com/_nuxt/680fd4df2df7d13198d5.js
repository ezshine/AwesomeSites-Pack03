/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{155:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AddEquation})),__webpack_require__.d(__webpack_exports__,"b",(function(){return AlwaysDepth})),__webpack_require__.d(__webpack_exports__,"c",(function(){return AmbientLight})),__webpack_require__.d(__webpack_exports__,"d",(function(){return AnimationClip})),__webpack_require__.d(__webpack_exports__,"e",(function(){return AnimationMixer})),__webpack_require__.d(__webpack_exports__,"f",(function(){return BackSide})),__webpack_require__.d(__webpack_exports__,"g",(function(){return Bone})),__webpack_require__.d(__webpack_exports__,"h",(function(){return BufferAttribute})),__webpack_require__.d(__webpack_exports__,"i",(function(){return BufferGeometry})),__webpack_require__.d(__webpack_exports__,"j",(function(){return BufferGeometryUtils})),__webpack_require__.d(__webpack_exports__,"k",(function(){return ClampToEdgeWrapping})),__webpack_require__.d(__webpack_exports__,"l",(function(){return Clock})),__webpack_require__.d(__webpack_exports__,"m",(function(){return Color})),__webpack_require__.d(__webpack_exports__,"n",(function(){return DRACOLoader})),__webpack_require__.d(__webpack_exports__,"o",(function(){return DefaultLoadingManager})),__webpack_require__.d(__webpack_exports__,"p",(function(){return DirectionalLight})),__webpack_require__.d(__webpack_exports__,"q",(function(){return DstAlphaFactor})),__webpack_require__.d(__webpack_exports__,"r",(function(){return DstColorFactor})),__webpack_require__.d(__webpack_exports__,"s",(function(){return EdgesGeometry})),__webpack_require__.d(__webpack_exports__,"t",(function(){return EqualDepth})),__webpack_require__.d(__webpack_exports__,"u",(function(){return FileLoader})),__webpack_require__.d(__webpack_exports__,"v",(function(){return FrontSide})),__webpack_require__.d(__webpack_exports__,"w",(function(){return GLTFLoader})),__webpack_require__.d(__webpack_exports__,"x",(function(){return GreaterEqualDepth})),__webpack_require__.d(__webpack_exports__,"y",(function(){return Group})),__webpack_require__.d(__webpack_exports__,"z",(function(){return HemisphereLight})),__webpack_require__.d(__webpack_exports__,"A",(function(){return Interpolant})),__webpack_require__.d(__webpack_exports__,"B",(function(){return InterpolateDiscrete})),__webpack_require__.d(__webpack_exports__,"C",(function(){return InterpolateLinear})),__webpack_require__.d(__webpack_exports__,"D",(function(){return LessDepth})),__webpack_require__.d(__webpack_exports__,"E",(function(){return LessEqualDepth})),__webpack_require__.d(__webpack_exports__,"F",(function(){return LineBasicMaterial})),__webpack_require__.d(__webpack_exports__,"G",(function(){return LineSegments})),__webpack_require__.d(__webpack_exports__,"H",(function(){return LinearFilter})),__webpack_require__.d(__webpack_exports__,"I",(function(){return LinearMipMapLinearFilter})),__webpack_require__.d(__webpack_exports__,"J",(function(){return LinearMipMapNearestFilter})),__webpack_require__.d(__webpack_exports__,"K",(function(){return LoaderUtils})),__webpack_require__.d(__webpack_exports__,"L",(function(){return LoopOnce})),__webpack_require__.d(__webpack_exports__,"M",(function(){return Material})),__webpack_require__.d(__webpack_exports__,"N",(function(){return Matrix3})),__webpack_require__.d(__webpack_exports__,"O",(function(){return Matrix4})),__webpack_require__.d(__webpack_exports__,"P",(function(){return Mesh})),__webpack_require__.d(__webpack_exports__,"Q",(function(){return MeshBasicMaterial})),__webpack_require__.d(__webpack_exports__,"R",(function(){return MeshStandardMaterial})),__webpack_require__.d(__webpack_exports__,"S",(function(){return MirroredRepeatWrapping})),__webpack_require__.d(__webpack_exports__,"T",(function(){return NearestFilter})),__webpack_require__.d(__webpack_exports__,"U",(function(){return NearestMipMapLinearFilter})),__webpack_require__.d(__webpack_exports__,"V",(function(){return NearestMipMapNearestFilter})),__webpack_require__.d(__webpack_exports__,"W",(function(){return NeverDepth})),__webpack_require__.d(__webpack_exports__,"X",(function(){return NotEqualDepth})),__webpack_require__.d(__webpack_exports__,"Y",(function(){return Object3D})),__webpack_require__.d(__webpack_exports__,"Z",(function(){return OneFactor})),__webpack_require__.d(__webpack_exports__,"ab",(function(){return OneMinusDstAlphaFactor})),__webpack_require__.d(__webpack_exports__,"bb",(function(){return OneMinusDstColorFactor})),__webpack_require__.d(__webpack_exports__,"cb",(function(){return OneMinusSrcAlphaFactor})),__webpack_require__.d(__webpack_exports__,"db",(function(){return OneMinusSrcColorFactor})),__webpack_require__.d(__webpack_exports__,"eb",(function(){return OutlineEffect})),__webpack_require__.d(__webpack_exports__,"fb",(function(){return PerspectiveCamera})),__webpack_require__.d(__webpack_exports__,"gb",(function(){return PointLight})),__webpack_require__.d(__webpack_exports__,"hb",(function(){return PropertyBinding})),__webpack_require__.d(__webpack_exports__,"ib",(function(){return QuaternionKeyframeTrack})),__webpack_require__.d(__webpack_exports__,"jb",(function(){return RGBAFormat})),__webpack_require__.d(__webpack_exports__,"kb",(function(){return RGBFormat})),__webpack_require__.d(__webpack_exports__,"lb",(function(){return RepeatWrapping})),__webpack_require__.d(__webpack_exports__,"mb",(function(){return ReverseSubtractEquation})),__webpack_require__.d(__webpack_exports__,"nb",(function(){return Scene})),__webpack_require__.d(__webpack_exports__,"ob",(function(){return ShaderMaterial})),__webpack_require__.d(__webpack_exports__,"pb",(function(){return Skeleton})),__webpack_require__.d(__webpack_exports__,"qb",(function(){return SkinnedMesh})),__webpack_require__.d(__webpack_exports__,"rb",(function(){return SphereGeometry})),__webpack_require__.d(__webpack_exports__,"sb",(function(){return SrcAlphaFactor})),__webpack_require__.d(__webpack_exports__,"tb",(function(){return SrcAlphaSaturateFactor})),__webpack_require__.d(__webpack_exports__,"ub",(function(){return SrcColorFactor})),__webpack_require__.d(__webpack_exports__,"vb",(function(){return SubtractEquation})),__webpack_require__.d(__webpack_exports__,"wb",(function(){return Texture})),__webpack_require__.d(__webpack_exports__,"xb",(function(){return TextureLoader})),__webpack_require__.d(__webpack_exports__,"yb",(function(){return UniformsUtils})),__webpack_require__.d(__webpack_exports__,"zb",(function(){return Vector2})),__webpack_require__.d(__webpack_exports__,"Ab",(function(){return Vector3})),__webpack_require__.d(__webpack_exports__,"Bb",(function(){return Vector4})),__webpack_require__.d(__webpack_exports__,"Cb",(function(){return VectorKeyframeTrack})),__webpack_require__.d(__webpack_exports__,"Db",(function(){return WebGLRenderer})),__webpack_require__.d(__webpack_exports__,"Eb",(function(){return WireframeGeometry})),__webpack_require__.d(__webpack_exports__,"Fb",(function(){return ZeroFactor})),console.warn("[ThreeFull]: I am glad to annonce since Three release his examples files under JSM folder, this repository should be avoided. The first goal of this repository was to provided an alternative solution during this migration. From now, please consider to use Three.module.js instead even if i maintain this repository for my personal usage. Thanks for all ! Itee..."),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){var t=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(e),r=1;r<arguments.length;r++){var source=t[r];if(null!=source)for(var n in source)Object.prototype.hasOwnProperty.call(source,n)&&(output[n]=source[n])}return output});var AnimationUtils={arraySlice:function(e,t,r){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(object){return ArrayBuffer.isView(object)&&!(object instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),i=0;i!==t;++i)r[i]=i;return r.sort((function(i,t){return e[i]-e[t]})),r},sortedArray:function(e,t,r){for(var n=e.length,o=new e.constructor(n),i=0,l=0;l!==n;++i)for(var c=r[i]*t,h=0;h!==t;++h)o[l++]=e[c+h];return o},flattenJSON:function(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var l=o[n];if(void 0!==l)if(Array.isArray(l))do{void 0!==(l=o[n])&&(t.push(o.time),r.push.apply(r,l)),o=e[i++]}while(void 0!==o);else if(void 0!==l.toArray)do{void 0!==(l=o[n])&&(t.push(o.time),l.toArray(r,r.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(l=o[n])&&(t.push(o.time),r.push(l)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,r,n,o){o=o||30;var l=e.clone();l.name=t;for(var c=[],i=0;i<l.tracks.length;++i){for(var track=l.tracks[i],h=track.getValueSize(),d=[],f=[],m=0;m<track.times.length;++m){var v=track.times[m]*o;if(!(v<r||v>=n)){d.push(track.times[m]);for(var y=0;y<h;++y)f.push(track.values[m*h+y])}}0!==d.length&&(track.times=AnimationUtils.convertArray(d,track.times.constructor),track.values=AnimationUtils.convertArray(f,track.values.constructor),c.push(track))}l.tracks=c;var x=1/0;for(i=0;i<l.tracks.length;++i)x>l.tracks[i].times[0]&&(x=l.tracks[i].times[0]);for(i=0;i<l.tracks.length;++i)l.tracks[i].shift(-1*x);return l.resetDuration(),l}},REVISION="113",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,FrontFaceDirectionCW=0,FrontFaceDirectionCCW=1,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoColors=0,FaceColors=1,VertexColors=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,ACESFilmicToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042;function Interpolant(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function CubicInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function DiscreteInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function KeyframeTrack(e,t,r,n){if(void 0===e)throw new Error("KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function BooleanKeyframeTrack(e,t,r){KeyframeTrack.call(this,e,t,r)}function ColorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function NumberKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],o=t[r-1];e:{t:{var l;r:{i:if(!(e<n)){for(var c=r+2;;){if(void 0===n){if(e<o)break i;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,o)}if(r===c)break;if(o=n,e<(n=t[++r]))break t}l=t.length;break r}if(e>=o)break e;var h=t[1];e<h&&(r=2,o=h);for(c=r-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===c)break;if(n=o,e>=(o=t[--r-1]))break t}l=r,r=0}for(;r<l;){var d=r+l>>>1;e<t[d]?l=d:r=d+1}if(n=t[r],void 0===(o=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,o,e)}this._cachedIndex=r,this.intervalChanged_(r,o,n)}return this.interpolate_(r,o,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n,i=0;i!==n;++i)t[i]=r[o+i];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,r){var n=this.parameterPositions,o=e-2,l=e+1,c=n[o],h=n[l];if(void 0===c)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:o=e,c=2*t-r;break;case WrapAroundEnding:c=t+n[o=n.length-2]-n[o+1];break;default:o=e,c=r}if(void 0===h)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:l=e,h=2*r-t;break;case WrapAroundEnding:l=1,h=r+n[1]-n[0];break;default:l=e-1,h=t}var d=.5*(r-t),f=this.valueSize;this._weightPrev=d/(t-c),this._weightNext=d/(h-r),this._offsetPrev=o*f,this._offsetNext=l*f},interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=e*c,d=h-c,f=this._offsetPrev,m=this._offsetNext,v=this._weightPrev,y=this._weightNext,p=(r-t)/(n-t),x=p*p,_=x*p,M=-v*_+2*v*x-v*p,w=(1+v)*_+(-1.5-2*v)*x+(-.5+v)*p+1,S=(-1-y)*_+(1.5+y)*x+.5*p,A=y*_-y*x,i=0;i!==c;++i)o[i]=M*l[f+i]+w*l[d+i]+S*l[h+i]+A*l[m+i];return o}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=e*c,d=h-c,f=(r-t)/(n-t),m=1-f,i=0;i!==c;++i)o[i]=l[d+i]*m+l[h+i]*f;return o}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(KeyframeTrack,{toJSON:function(track){var e,t=track.constructor;if(void 0!==t.toJSON)e=t.toJSON(track);else{e={name:track.name,times:AnimationUtils.convertArray(track.times,Array),values:AnimationUtils.convertArray(track.values,Array)};var r=track.getInterpolation();r!==track.DefaultInterpolation&&(e.interpolation=r)}return e.type=track.ValueTypeName,e}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,o=0,l=n-1;o!==n&&r[o]<e;)++o;for(;-1!==l&&r[l]>t;)--l;if(++l,0!==o||l!==n){o>=l&&(o=(l=Math.max(l,1))-1);var c=this.getValueSize();this.times=AnimationUtils.arraySlice(r,o,l),this.values=AnimationUtils.arraySlice(this.values,o*c,l*c)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,o=r.length;0===o&&(console.error("KeyframeTrack: Track is empty.",this),e=!1);for(var l=null,i=0;i!==o;i++){var c=r[i];if("number"==typeof c&&isNaN(c)){console.error("KeyframeTrack: Time is not a valid number.",this,i,c),e=!1;break}if(null!==l&&l>c){console.error("KeyframeTrack: Out of order keys.",this,i,c,l),e=!1;break}l=c}if(void 0!==n&&AnimationUtils.isTypedArray(n)){i=0;for(var h=n.length;i!==h;++i){var d=n[i];if(isNaN(d)){console.error("KeyframeTrack: Value is not a valid number.",this,i,d),e=!1;break}}}return e},optimize:function(){for(var e=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===InterpolateSmooth,o=1,l=e.length-1,i=1;i<l;++i){var c=!1,time=e[i];if(time!==e[i+1]&&(1!==i||time!==time[0]))if(n)c=!0;else for(var h=i*r,d=h-r,f=h+r,m=0;m!==r;++m){var v=t[h+m];if(v!==t[d+m]||v!==t[f+m]){c=!0;break}}if(c){if(i!==o){e[o]=e[i];var y=i*r,x=o*r;for(m=0;m!==r;++m)t[x+m]=t[y+m]}++o}}if(l>0){e[o]=e[l];for(y=l*r,x=o*r,m=0;m!==r;++m)t[x+m]=t[y+m];++o}return o!==e.length?(this.times=AnimationUtils.arraySlice(e,0,o),this.values=AnimationUtils.arraySlice(t,0,o*r)):(this.times=e,this.values=t),this},clone:function(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),track=new(0,this.constructor)(this.name,e,t);return track.createInterpolant=this.createInterpolant,track}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"});for(var _lut=[],i=0;i<256;i++)_lut[i]=(i<16?"0":"")+i.toString(16);var MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&n]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,o){return n+(e-t)*(o-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(q,a,b,e,t){var r=Math.cos,n=Math.sin,o=r(b/2),l=n(b/2),c=r((a+e)/2),h=n((a+e)/2),d=r((a-e)/2),f=n((a-e)/2),m=r((e-a)/2),v=n((e-a)/2);"XYX"===t?q.set(o*h,l*d,l*f,o*c):"YZY"===t?q.set(l*f,o*h,l*d,o*c):"ZXZ"===t?q.set(l*d,l*f,o*h,o*c):"XZX"===t?q.set(o*h,l*v,l*m,o*c):"YXY"===t?q.set(l*m,o*h,l*v,o*c):"ZYZ"===t?q.set(l*v,l*m,o*h,o*c):console.warn("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Quaternion(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function QuaternionLinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function QuaternionKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function StringKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function VectorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function AnimationClip(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var t=getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var r=[],n=[];AnimationUtils.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Quaternion,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,o,l,c){var h=r[n+0],d=r[n+1],f=r[n+2],m=r[n+3],v=o[l+0],y=o[l+1],x=o[l+2],_=o[l+3];if(m!==_||h!==v||d!==y||f!==x){var s=1-c,M=h*v+d*y+f*x+m*_,w=M>=0?1:-1,S=1-M*M;if(S>Number.EPSILON){var A=Math.sqrt(S),T=Math.atan2(A,M*w);s=Math.sin(s*T)/A,c=Math.sin(c*T)/A}var L=c*w;if(h=h*s+v*L,d=d*s+y*L,f=f*s+x*L,m=m*s+_*L,s===1-c){var C=1/Math.sqrt(h*h+d*d+f*f+m*m);h*=C,d*=C,f*=C,m*=C}}e[t]=h,e[t+1]=d,e[t+2]=f,e[t+3]=m}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,o=e._z,l=e.order,c=Math.cos,h=Math.sin,d=c(r/2),f=c(n/2),m=c(o/2),v=h(r/2),y=h(n/2),x=h(o/2);return"XYZ"===l?(this._x=v*f*m+d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m-v*y*x):"YXZ"===l?(this._x=v*f*m+d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m+v*y*x):"ZXY"===l?(this._x=v*f*m-d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m-v*y*x):"ZYX"===l?(this._x=v*f*m-d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m+v*y*x):"YZX"===l?(this._x=v*f*m+d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m-v*y*x):"XZY"===l&&(this._x=v*f*m-d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m+v*y*x),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var s,t=e.elements,r=t[0],n=t[4],o=t[8],l=t[1],c=t[5],h=t[9],d=t[2],f=t[6],m=t[10],v=r+c+m;return v>0?(s=.5/Math.sqrt(v+1),this._w=.25/s,this._x=(f-h)*s,this._y=(o-d)*s,this._z=(l-n)*s):r>c&&r>m?(s=2*Math.sqrt(1+r-c-m),this._w=(f-h)/s,this._x=.25*s,this._y=(n+l)/s,this._z=(o+d)/s):c>m?(s=2*Math.sqrt(1+c-r-m),this._w=(o-d)/s,this._x=(n+l)/s,this._y=.25*s,this._z=(h+f)/s):(s=2*Math.sqrt(1+m-r-c),this._w=(l-n)/s,this._x=(o+d)/s,this._y=(h+f)/s,this._z=.25*s),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(q){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(q),-1,1)))},rotateTowards:function(q,e){var t=this.angleTo(q);if(0===t)return this;var r=Math.min(1,e/t);return this.slerp(q,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(q,p){return void 0!==p?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(q,p)):this.multiplyQuaternions(this,q)},premultiply:function(q){return this.multiplyQuaternions(q,this)},multiplyQuaternions:function(a,b){var e=a._x,t=a._y,r=a._z,n=a._w,o=b._x,l=b._y,c=b._z,h=b._w;return this._x=e*h+n*o+t*c-r*l,this._y=t*h+n*l+r*o-e*c,this._z=r*h+n*c+e*l-t*o,this._w=n*h-e*o-t*l-r*c,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,o=this._z,l=this._w,c=l*e._w+r*e._x+n*e._y+o*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=l,this._x=r,this._y=n,this._z=o,this;var h=1-c*c;if(h<=Number.EPSILON){var s=1-t;return this._w=s*l+t*this._w,this._x=s*r+t*this._x,this._y=s*n+t*this._y,this._z=s*o+t*this._z,this.normalize(),this._onChangeCallback(),this}var d=Math.sqrt(h),f=Math.atan2(d,c),m=Math.sin((1-t)*f)/d,v=Math.sin(t*f)/d;return this._w=l*m+this._w*v,this._x=r*m+this._x*v,this._y=n*m+this._y*v,this._z=o*m+this._z*v,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=e*c,d=(r-t)/(n-t),f=h+c;h!==f;h+=4)Quaternion.slerpFlat(o,0,l,h-c,l,h,d);return o}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(parseKeyframeTrack(r[i]).scale(n));return new AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,o=r.length;i!==o;++i)t.push(KeyframeTrack.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var o=t.length,l=[],i=0;i<o;i++){var c=[],h=[];c.push((i+o-1)%o,i,(i+1)%o),h.push(0,1,0);var d=AnimationUtils.getKeyframeOrder(c);c=AnimationUtils.sortedArray(c,1,d),h=AnimationUtils.sortedArray(h,1,d),n||0!==c[0]||(c.push(o),h.push(h[0])),l.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[i].name+"]",c,h).scale(1/r))}return new AnimationClip(e,-1,l)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},pattern=/^([\w-]*?)([\d]+)$/,i=0,o=e.length;i<o;i++){var l=e[i],c=l.name.match(pattern);if(c&&c.length>1){var h=n[f=c[1]];h||(n[f]=h=[]),h.push(l)}}var d=[];for(var f in n)d.push(AnimationClip.CreateFromMorphTargetSequence(f,n[f],t,r));return d},parseAnimation:function(e,t){if(!e)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,o){if(0!==r.length){var l=[],c=[];AnimationUtils.flattenJSON(r,l,c,n),0!==l.length&&o.push(new e(t,l,c))}},n=[],o=e.name||"default",l=e.length||-1,c=e.fps||30,h=e.hierarchy||[],d=0;d<h.length;d++){var f=h[d].keys;if(f&&0!==f.length)if(f[0].morphTargets){for(var m={},v=0;v<f.length;v++)if(f[v].morphTargets)for(var y=0;y<f[v].morphTargets.length;y++)m[f[v].morphTargets[y]]=-1;for(var x in m){var _=[],M=[];for(y=0;y!==f[v].morphTargets.length;++y){var w=f[v];_.push(w.time),M.push(w.morphTarget===x?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+x+"]",_,M))}l=m.length*(c||1)}else{var S=".bones["+t[d].name+"]";r(VectorKeyframeTrack,S+".position",f,"pos",n),r(QuaternionKeyframeTrack,S+".quaternion",f,"rot",n),r(VectorKeyframeTrack,S+".scale",f,"scl",n)}}return 0===n.length?null:new AnimationClip(o,l,n)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=0,i=0,t=this.tracks.length;i!==t;++i){var track=this.tracks[i];e=Math.max(e,track.times[track.times.length-1])}return this.duration=e,this},trim:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){for(var e=!0,i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e},optimize:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){for(var e=[],i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new AnimationClip(this.name,this.duration,e)}});var _vector=new Vector3,_quaternion=new Quaternion;function Vector3(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(e,s){return this.x+=e.x*s,this.y+=e.y*s,this.z+=e.z*s,this},sub:function(e,t){return void 0!==t?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(_quaternion.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*n,this.y=o[1]*t+o[4]*r+o[7]*n,this.z=o[2]*t+o[5]*r+o[8]*n,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements,l=1/(o[3]*t+o[7]*r+o[11]*n+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*n+o[12])*l,this.y=(o[1]*t+o[5]*r+o[9]*n+o[13])*l,this.z=(o[2]*t+o[6]*r+o[10]*n+o[14])*l,this},applyQuaternion:function(q){var e=this.x,t=this.y,r=this.z,n=q.x,o=q.y,l=q.z,c=q.w,h=c*e+o*r-l*t,d=c*t+l*e-n*r,f=c*r+n*t-o*e,m=-n*e-o*t-l*r;return this.x=h*c+m*-n+d*-l-f*-o,this.y=d*c+m*-o+f*-n-h*-l,this.z=f*c+m*-l+h*-o-d*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n,this.y=o[1]*t+o[5]*r+o[9]*n,this.z=o[2]*t+o[6]*r+o[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(a,b){var e=a.x,t=a.y,r=a.z,n=b.x,o=b.y,l=b.z;return this.x=t*l-r*o,this.y=r*n-e*l,this.z=e*o-t*n,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)},projectOnPlane:function(e){return _vector.copy(this).projectOnVector(e),this.sub(_vector)},reflect:function(e){return this.sub(_vector.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(MathUtils.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var AnimationClipCreator=function(){};function Vector4(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Vector2(e,t){this.x=e||0,this.y=t||0}AnimationClipCreator.CreateRotationAnimation=function(e,t){return new AnimationClip(null,e,[new NumberKeyframeTrack(".rotation["+(t=t||"x")+"]",[0,e],[0,360])])},AnimationClipCreator.CreateScaleAxisAnimation=function(e,t){return new AnimationClip(null,e,[new NumberKeyframeTrack(".scale["+(t=t||"x")+"]",[0,e],[0,1])])},AnimationClipCreator.CreateShakeAnimation=function(e,t){for(var r=[],n=[],o=new Vector3,i=0;i<10*e;i++)r.push(i/10),o.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(n,n.length);return new AnimationClip(null,e,[new VectorKeyframeTrack(".position",r,n)])},AnimationClipCreator.CreatePulsationAnimation=function(e,t){for(var r=[],n=[],o=new Vector3,i=0;i<10*e;i++){r.push(i/10);var l=Math.random()*t;o.set(l,l,l).toArray(n,n.length)}return new AnimationClip(null,e,[new VectorKeyframeTrack(".scale",r,n)])},AnimationClipCreator.CreateVisibilityAnimation=function(e){return new AnimationClip(null,e,[new BooleanKeyframeTrack(".visible",[0,e/2,e],[!0,!1,!0])])},AnimationClipCreator.CreateMaterialColorAnimation=function(e,t){for(var r=[],n=[],o=e/t.length,i=0;i<=t.length;i++)r.push(i*o),n.push(t[i%t.length]);return new AnimationClip(null,e,[new ColorKeyframeTrack(".material[0].color",r,n)])},Object.defineProperties(Vector4.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(e,s){return this.x+=e.x*s,this.y+=e.y*s,this.z+=e.z*s,this.w+=e.w*s,this},sub:function(e,t){return void 0!==t?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,o=this.w,l=e.elements;return this.x=l[0]*t+l[4]*r+l[8]*n+l[12]*o,this.y=l[1]*t+l[5]*r+l[9]*n+l[13]*o,this.z=l[2]*t+l[6]*r+l[10]*n+l[14]*o,this.w=l[3]*t+l[7]*r+l[11]*n+l[15]*o,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=q.x/s,this.y=q.y/s,this.z=q.z/s),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,o,l=e.elements,c=l[0],h=l[4],d=l[8],f=l[1],m=l[5],v=l[9],y=l[2],x=l[6],_=l[10];if(Math.abs(h-f)<.01&&Math.abs(d-y)<.01&&Math.abs(v-x)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+y)<.1&&Math.abs(v+x)<.1&&Math.abs(c+m+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var M=(c+1)/2,w=(m+1)/2,S=(_+1)/2,A=(h+f)/4,T=(d+y)/4,L=(v+x)/4;return M>w&&M>S?M<.01?(r=0,n=.707106781,o=.707106781):(n=A/(r=Math.sqrt(M)),o=T/r):w>S?w<.01?(r=.707106781,n=0,o=.707106781):(r=A/(n=Math.sqrt(w)),o=L/n):S<.01?(r=.707106781,n=.707106781,o=0):(r=T/(o=Math.sqrt(S)),n=L/o),this.set(r,n,o,t),this}var s=Math.sqrt((x-v)*(x-v)+(d-y)*(d-y)+(f-h)*(f-h));return Math.abs(s)<.001&&(s=1),this.x=(x-v)/s,this.y=(d-y)/s,this.z=(f-h)/s,this.w=Math.acos((c+m+_-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(s){return this.x+=s,this.y+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(e,s){return this.x+=e.x*s,this.y+=e.y*s,this},sub:function(e,t){return void 0!==t?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(s){return this.x-=s,this.y-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),s=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*s+e.x,this.y=n*s+o*r+e.y,this}});var _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function Color(e,g,b){return void 0===g&&void 0===b?this.set(e):this.setRGB(e,g,b)}function hue2rgb(p,q,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?p+6*(q-p)*e:e<.5?q:e<2/3?p+6*(q-p)*(2/3-e):p}function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,g,b){return this.r=e,this.g=g,this.b=b,this},setHSL:function(e,s,t){if(e=MathUtils.euclideanModulo(e,1),s=MathUtils.clamp(s,0,1),t=MathUtils.clamp(t,0,1),0===s)this.r=this.g=this.b=t;else{var p=t<=.5?t*(1+s):t+s-t*s,q=2*t-p;this.r=hue2rgb(q,p,e+1/3),this.g=hue2rgb(q,p,e),this.b=hue2rgb(q,p,e-1/3)}return this},setStyle:function(style){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("Color: Alpha component of "+style+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){var r,n=t[1],o=t[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var l=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(l,s,c)}}}else if(t=/^\#([A-Fa-f0-9]+)$/.exec(style)){var h=t[1],d=h.length;if(3===d)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return style&&style.length>0?this.setColorName(style):this},setColorName:function(style){var e=_colorKeywords[style];return void 0!==e?this.setHex(e):console.warn("Color: Unknown color "+style),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this},copyLinearToSRGB:function(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,g=this.g,b=this.b,o=Math.max(n,g,b),l=Math.min(n,g,b),c=(l+o)/2;if(l===o)t=0,r=0;else{var h=o-l;switch(r=c<=.5?h/(o+l):h/(2-o-l),o){case n:t=(g-b)/h+(g<b?6:0);break;case g:t=(b-n)/h+2;break;case b:t=(n-g)/h+4}t/=6}return e.h=t,e.s=r,e.l=c,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,s,t){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=s,_hslA.l+=t,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var r=MathUtils.lerp(_hslA.h,_hslB.h,t),s=MathUtils.lerp(_hslA.s,_hslB.s,t),n=MathUtils.lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,s,n),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Color.NAMES=_colorKeywords;var _vector$1=new Vector3;function BufferAttribute(e,t,r){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(e,t,r){BufferAttribute.call(this,new Int8Array(e),t,r)}function Uint8BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8Array(e),t,r)}function Uint8ClampedBufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8ClampedArray(e),t,r)}function Int16BufferAttribute(e,t,r){BufferAttribute.call(this,new Int16Array(e),t,r)}function Uint16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}function Int32BufferAttribute(e,t,r){BufferAttribute.call(this,new Int32Array(e),t,r)}function Uint32BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint32Array(e),t,r)}function Float32BufferAttribute(e,t,r){BufferAttribute.call(this,new Float32Array(e),t,r)}function Float64BufferAttribute(e,t,r){BufferAttribute.call(this,new Float64Array(e),t,r)}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(source){return this.name=source.name,this.array=new source.array.constructor(source.array),this.itemSize=source.itemSize,this.count=source.count,this.normalized=source.normalized,this.usage=source.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",i),o=new Color),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Vector2),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new Vector3),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new Vector4),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},applyMatrix3:function(e){for(var i=0,t=this.count;i<t;i++)_vector$1.x=this.getX(i),_vector$1.y=this.getY(i),_vector$1.z=this.getZ(i),_vector$1.applyMatrix3(e),this.setXYZ(i,_vector$1.x,_vector$1.y,_vector$1.z);return this},applyMatrix4:function(e){for(var i=0,t=this.count;i<t;i++)_vector$1.x=this.getX(i),_vector$1.y=this.getY(i),_vector$1.z=this.getZ(i),_vector$1.applyMatrix4(e),this.setXYZ(i,_vector$1.x,_vector$1.y,_vector$1.z);return this},applyNormalMatrix:function(e){for(var i=0,t=this.count;i<t;i++)_vector$1.x=this.getX(i),_vector$1.y=this.getY(i),_vector$1.z=this.getZ(i),_vector$1.applyNormalMatrix(e),this.setXYZ(i,_vector$1.x,_vector$1.y,_vector$1.z);return this},transformDirection:function(e){for(var i=0,t=this.count;i<t;i++)_vector$1.x=this.getX(i),_vector$1.y=this.getY(i),_vector$1.z=this.getZ(i),_vector$1.transformDirection(e),this.setXYZ(i,_vector$1.x,_vector$1.y,_vector$1.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=o,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;var _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$2=new Vector3,_box=new Box3,_v0=new Vector3,_v1=new Vector3,_v2=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}function satForAxes(e,t,r,n,o){var i,l;for(i=0,l=e.length-3;i<=l;i+=3){_testAxis.fromArray(e,i);var c=o.x*Math.abs(_testAxis.x)+o.y*Math.abs(_testAxis.y)+o.z*Math.abs(_testAxis.z),h=t.dot(_testAxis),d=r.dot(_testAxis),f=n.dot(_testAxis);if(Math.max(-Math.max(h,d,f),Math.min(h,d,f))>c)return!1}return!0}function EventDispatcher(){}Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,o=-1/0,l=-1/0,c=-1/0,i=0,h=e.length;i<h;i+=3){var d=e[i],f=e[i+1],m=e[i+2];d<t&&(t=d),f<r&&(r=f),m<n&&(n=m),d>o&&(o=d),f>l&&(l=f),m>c&&(c=m)}return this.min.set(t,r,n),this.max.set(o,l,c),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,o=-1/0,l=-1/0,c=-1/0,i=0,h=e.count;i<h;i++){var d=e.getX(i),f=e.getY(i),m=e.getZ(i);d<t&&(t=d),f<r&&(r=f),m<n&&(n=m),d>o&&(o=d),f>l&&(l=f),m>c&&(c=m)}return this.min.set(t,r,n),this.max.set(o,l,c),this},setFromPoints:function(e){this.makeEmpty();for(var i=0,t=e.length;i<t;i++)this.expandByPoint(e[i]);return this},setFromCenterAndSize:function(e,t){var r=_vector$2.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(object){return this.makeEmpty(),this.expandByObject(object)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(object){object.updateWorldMatrix(!1,!1);var e=object.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),_box.copy(e.boundingBox),_box.applyMatrix4(object.matrixWorld),this.expandByPoint(_box.min),this.expandByPoint(_box.max));for(var t=object.children,i=0,r=t.length;i<r;i++)this.expandByObject(t[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,_vector$2),_vector$2.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(e.a,_center),_v1.subVectors(e.b,_center),_v2.subVectors(e.c,_center),_f0.subVectors(_v1,_v0),_f1.subVectors(_v2,_v1),_f2.subVectors(_v0,_v2);var t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(t,_v0,_v1,_v2,_extents)&&(!!satForAxes(t=[1,0,0,0,1,0,0,0,1],_v0,_v1,_v2,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes(t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0,_v1,_v2,_extents)))},clampPoint:function(e,t){return void 0===t&&(console.warn("Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return _vector$2.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(_vector$2).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}}}});var _box$1=new Box3;function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;void 0!==t?r.copy(t):_box$1.setFromPoints(e).getCenter(r);for(var n=0,i=0,o=e.length;i<o;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,o=e.faces,i=0;i<o.length;i++){var l=o[i];l.materialIndex!==n&&(n=l.materialIndex,void 0!==t&&(t.count=3*i-t.start,r.push(t)),t={start:3*i,materialIndex:n})}void 0!==t&&(t.count=3*i-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,o=e.faceVertexUvs,l=o[0]&&o[0].length>0,c=o[1]&&o[1].length>0,h=e.morphTargets,d=h.length;if(d>0){t=[];for(var i=0;i<d;i++)t[i]={name:h[i].name,data:[]};this.morphTargets.position=t}var f,m=e.morphNormals,v=m.length;if(v>0){f=[];for(i=0;i<v;i++)f[i]={name:m[i].name,data:[]};this.morphTargets.normal=f}var y=e.skinIndices,x=e.skinWeights,_=y.length===n.length,M=x.length===n.length;n.length>0&&0===r.length&&console.error("DirectGeometry: Faceless geometries are not supported.");for(i=0;i<r.length;i++){var w=r[i];this.vertices.push(n[w.a],n[w.b],n[w.c]);var S=w.vertexNormals;if(3===S.length)this.normals.push(S[0],S[1],S[2]);else{var A=w.normal;this.normals.push(A,A,A)}var T,L=w.vertexColors;if(3===L.length)this.colors.push(L[0],L[1],L[2]);else{var C=w.color;this.colors.push(C,C,C)}if(!0===l)void 0!==(T=o[0][i])?this.uvs.push(T[0],T[1],T[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",i),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===c)void 0!==(T=o[1][i])?this.uvs2.push(T[0],T[1],T[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i),this.uvs2.push(new Vector2,new Vector2,new Vector2));for(var N=0;N<d;N++){var P=h[N].vertices;t[N].data.push(P[w.a],P[w.b],P[w.c])}for(N=0;N<v;N++){var F=m[N].vertexNormals[i];f[N].data.push(F.a,F.b,F.c)}_&&this.skinIndices.push(y[w.a],y[w.b],y[w.c]),M&&this.skinWeights.push(x[w.a],x[w.b],x[w.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var _v1$1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3;function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,r,n,o,l,c,h,d,f,m,v,y,x,_,M){var w=this.elements;return w[0]=e,w[4]=t,w[8]=r,w[12]=n,w[1]=o,w[5]=l,w[9]=c,w[13]=h,w[2]=d,w[6]=f,w[10]=m,w[14]=v,w[3]=y,w[7]=x,w[11]=_,w[15]=M,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,n=1/_v1$1.setFromMatrixColumn(e,0).length(),o=1/_v1$1.setFromMatrixColumn(e,1).length(),l=1/_v1$1.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*l,t[9]=r[9]*l,t[10]=r[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),b=Math.sin(r),l=Math.cos(n),c=Math.sin(n),h=Math.cos(o),d=Math.sin(o);if("XYZ"===e.order){var f=a*h,m=a*d,v=b*h,y=b*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=m+v*c,t[5]=f-y*c,t[9]=-b*l,t[2]=y-f*c,t[6]=v+m*c,t[10]=a*l}else if("YXZ"===e.order){var x=l*h,_=l*d,M=c*h,w=c*d;t[0]=x+w*b,t[4]=M*b-_,t[8]=a*c,t[1]=a*d,t[5]=a*h,t[9]=-b,t[2]=_*b-M,t[6]=w+x*b,t[10]=a*l}else if("ZXY"===e.order){x=l*h,_=l*d,M=c*h,w=c*d;t[0]=x-w*b,t[4]=-a*d,t[8]=M+_*b,t[1]=_+M*b,t[5]=a*h,t[9]=w-x*b,t[2]=-a*c,t[6]=b,t[10]=a*l}else if("ZYX"===e.order){f=a*h,m=a*d,v=b*h,y=b*d;t[0]=l*h,t[4]=v*c-m,t[8]=f*c+y,t[1]=l*d,t[5]=y*c+f,t[9]=m*c-v,t[2]=-c,t[6]=b*l,t[10]=a*l}else if("YZX"===e.order){var S=a*l,A=a*c,T=b*l,L=b*c;t[0]=l*h,t[4]=L-S*d,t[8]=T*d+A,t[1]=d,t[5]=a*h,t[9]=-b*h,t[2]=-c*h,t[6]=A*d+T,t[10]=S-L*d}else if("XZY"===e.order){S=a*l,A=a*c,T=b*l,L=b*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=S*d+L,t[5]=a*h,t[9]=A*d-T,t[2]=T*d-A,t[6]=b*h,t[10]=L*d+S}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(q){return this.compose(_zero,q,_one)},lookAt:function(e,t,r){var n=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),n[0]=_x.x,n[4]=_y.x,n[8]=_z.x,n[1]=_x.y,n[5]=_y.y,n[9]=_z.y,n[2]=_x.z,n[6]=_y.z,n[10]=_z.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(a,b){var e=a.elements,t=b.elements,r=this.elements,n=e[0],o=e[4],l=e[8],c=e[12],h=e[1],d=e[5],f=e[9],m=e[13],v=e[2],y=e[6],x=e[10],_=e[14],M=e[3],w=e[7],S=e[11],A=e[15],T=t[0],L=t[4],C=t[8],N=t[12],P=t[1],F=t[5],E=t[9],R=t[13],D=t[2],O=t[6],I=t[10],B=t[14],U=t[3],k=t[7],V=t[11],G=t[15];return r[0]=n*T+o*P+l*D+c*U,r[4]=n*L+o*F+l*O+c*k,r[8]=n*C+o*E+l*I+c*V,r[12]=n*N+o*R+l*B+c*G,r[1]=h*T+d*P+f*D+m*U,r[5]=h*L+d*F+f*O+m*k,r[9]=h*C+d*E+f*I+m*V,r[13]=h*N+d*R+f*B+m*G,r[2]=v*T+y*P+x*D+_*U,r[6]=v*L+y*F+x*O+_*k,r[10]=v*C+y*E+x*I+_*V,r[14]=v*N+y*R+x*B+_*G,r[3]=M*T+w*P+S*D+A*U,r[7]=M*L+w*F+S*O+A*k,r[11]=M*C+w*E+S*I+A*V,r[15]=M*N+w*R+S*B+A*G,this},multiplyScalar:function(s){var e=this.elements;return e[0]*=s,e[4]*=s,e[8]*=s,e[12]*=s,e[1]*=s,e[5]*=s,e[9]*=s,e[13]*=s,e[2]*=s,e[6]*=s,e[10]*=s,e[14]*=s,e[3]*=s,e[7]*=s,e[11]*=s,e[15]*=s,this},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],o=e[12],l=e[1],c=e[5],h=e[9],d=e[13],f=e[2],m=e[6],v=e[10],y=e[14];return e[3]*(+o*h*m-n*d*m-o*c*v+r*d*v+n*c*y-r*h*y)+e[7]*(+t*h*y-t*d*v+o*l*v-n*l*y+n*d*f-o*h*f)+e[11]*(+t*d*m-t*c*y-o*l*m+r*l*y+o*c*f-r*d*f)+e[15]*(-n*c*f-t*h*m+t*c*v+n*l*m-r*l*v+r*h*f)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,o=n[0],l=n[1],c=n[2],h=n[3],d=n[4],f=n[5],m=n[6],v=n[7],y=n[8],x=n[9],_=n[10],M=n[11],w=n[12],S=n[13],A=n[14],T=n[15],L=x*A*v-S*_*v+S*m*M-f*A*M-x*m*T+f*_*T,C=w*_*v-y*A*v-w*m*M+d*A*M+y*m*T-d*_*T,N=y*S*v-w*x*v+w*f*M-d*S*M-y*f*T+d*x*T,P=w*x*m-y*S*m-w*f*_+d*S*_+y*f*A-d*x*A,F=o*L+l*C+c*N+h*P;if(0===F){var E="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(E);return console.warn(E),this.identity()}var R=1/F;return r[0]=L*R,r[1]=(S*_*h-x*A*h-S*c*M+l*A*M+x*c*T-l*_*T)*R,r[2]=(f*A*h-S*m*h+S*c*v-l*A*v-f*c*T+l*m*T)*R,r[3]=(x*m*h-f*_*h-x*c*v+l*_*v+f*c*M-l*m*M)*R,r[4]=C*R,r[5]=(y*A*h-w*_*h+w*c*M-o*A*M-y*c*T+o*_*T)*R,r[6]=(w*m*h-d*A*h-w*c*v+o*A*v+d*c*T-o*m*T)*R,r[7]=(d*_*h-y*m*h+y*c*v-o*_*v-d*c*M+o*m*M)*R,r[8]=N*R,r[9]=(w*x*h-y*S*h-w*l*M+o*S*M+y*l*T-o*x*T)*R,r[10]=(d*S*h-w*f*h+w*l*v-o*S*v-d*l*T+o*f*T)*R,r[11]=(y*f*h-d*x*h-y*l*v+o*x*v+d*l*M-o*f*M)*R,r[12]=P*R,r[13]=(y*S*c-w*x*c+w*l*_-o*S*_-y*l*A+o*x*A)*R,r[14]=(w*f*c-d*S*c-w*l*m+o*S*m+d*l*A-o*f*A)*R,r[15]=(d*x*c-y*f*c+y*l*m-o*x*m-d*l*_+o*f*_)*R,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,o=e.z;return t[0]*=r,t[4]*=n,t[8]*=o,t[1]*=r,t[5]*=n,t[9]*=o,t[2]*=r,t[6]*=n,t[10]*=o,t[3]*=r,t[7]*=n,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),s=Math.sin(t),n=1-r,o=e.x,l=e.y,c=e.z,h=n*o,d=n*l;return this.set(h*o+r,h*l-s*c,h*c+s*l,0,h*l+s*c,d*l+r,d*c-s*o,0,h*c-s*l,d*c+s*o,n*c*c+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,o=t._x,l=t._y,c=t._z,h=t._w,d=o+o,f=l+l,m=c+c,v=o*d,y=o*f,x=o*m,_=l*f,M=l*m,w=c*m,S=h*d,A=h*f,T=h*m,L=r.x,C=r.y,N=r.z;return n[0]=(1-(_+w))*L,n[1]=(y+T)*L,n[2]=(x-A)*L,n[3]=0,n[4]=(y-T)*C,n[5]=(1-(v+w))*C,n[6]=(M+S)*C,n[7]=0,n[8]=(x+A)*N,n[9]=(M-S)*N,n[10]=(1-(v+_))*N,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,r){var n=this.elements,o=_v1$1.set(n[0],n[1],n[2]).length(),l=_v1$1.set(n[4],n[5],n[6]).length(),c=_v1$1.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),e.x=n[12],e.y=n[13],e.z=n[14],_m1.copy(this);var h=1/o,d=1/l,f=1/c;return _m1.elements[0]*=h,_m1.elements[1]*=h,_m1.elements[2]*=h,_m1.elements[4]*=d,_m1.elements[5]*=d,_m1.elements[6]*=d,_m1.elements[8]*=f,_m1.elements[9]*=f,_m1.elements[10]*=f,t.setFromRotationMatrix(_m1),r.x=o,r.y=l,r.z=c,this},makePerspective:function(e,t,r,n,o,l){void 0===l&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var c=this.elements,h=2*o/(t-e),d=2*o/(r-n),a=(t+e)/(t-e),b=(r+n)/(r-n),f=-(l+o)/(l-o),m=-2*l*o/(l-o);return c[0]=h,c[4]=0,c[8]=a,c[12]=0,c[1]=0,c[5]=d,c[9]=b,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this},makeOrthographic:function(e,t,r,n,o,l){var c=this.elements,h=1/(t-e),d=1/(r-n),p=1/(l-o),f=(t+e)*h,m=(r+n)*d,v=(l+o)*p;return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=-2*p,c[14]=-v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var _matrix=new Matrix4,_quaternion$1=new Quaternion;function Euler(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Euler.DefaultOrder}function Layers(){this.mask=1}function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=MathUtils.clamp,o=e.elements,l=o[0],c=o[4],h=o[8],d=o[1],f=o[5],m=o[9],v=o[2],y=o[6],x=o[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-m,x),this._z=Math.atan2(-c,l)):(this._x=Math.atan2(y,f),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(h,x),this._z=Math.atan2(d,f)):(this._y=Math.atan2(-v,l),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-v,x),this._z=Math.atan2(-c,f)):(this._y=0,this._z=Math.atan2(d,l))):"ZYX"===t?(this._y=Math.asin(-n(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(y,x),this._z=Math.atan2(d,l)):(this._x=0,this._z=Math.atan2(-c,f))):"YZX"===t?(this._z=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-m,f),this._y=Math.atan2(-v,l)):(this._x=0,this._y=Math.atan2(h,x))):"XZY"===t?(this._z=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(y,f),this._y=Math.atan2(h,l)):(this._x=Math.atan2(-m,x),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(q,e,t){return _matrix.makeRotationFromQuaternion(q),this.setFromRotationMatrix(_matrix,e,t)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,r,n,o,l,c,h,d){var f=this.elements;return f[0]=e,f[1]=n,f[2]=c,f[3]=t,f[4]=o,f[5]=h,f[6]=r,f[7]=l,f[8]=d,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(a,b){var e=a.elements,t=b.elements,r=this.elements,n=e[0],o=e[3],l=e[6],c=e[1],h=e[4],d=e[7],f=e[2],m=e[5],v=e[8],y=t[0],x=t[3],_=t[6],M=t[1],w=t[4],S=t[7],A=t[2],T=t[5],L=t[8];return r[0]=n*y+o*M+l*A,r[3]=n*x+o*w+l*T,r[6]=n*_+o*S+l*L,r[1]=c*y+h*M+d*A,r[4]=c*x+h*w+d*T,r[7]=c*_+h*S+d*L,r[2]=f*y+m*M+v*A,r[5]=f*x+m*w+v*T,r[8]=f*_+m*S+v*L,this},multiplyScalar:function(s){var e=this.elements;return e[0]*=s,e[3]*=s,e[6]*=s,e[1]*=s,e[4]*=s,e[7]*=s,e[2]*=s,e[5]*=s,e[8]*=s,this},determinant:function(){var e=this.elements,a=e[0],b=e[1],t=e[2],r=e[3],n=e[4],o=e[5],g=e[6],l=e[7],i=e[8];return a*n*i-a*o*l-b*r*i+b*o*g+t*r*l-t*n*g},getInverse:function(e,t){e&&e.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,o=r[0],l=r[1],c=r[2],h=r[3],d=r[4],f=r[5],m=r[6],v=r[7],y=r[8],x=y*d-f*v,_=f*m-y*h,M=v*h-d*m,w=o*x+l*_+c*M;if(0===w){var S="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var A=1/w;return n[0]=x*A,n[1]=(c*v-y*l)*A,n[2]=(f*l-c*d)*A,n[3]=_*A,n[4]=(y*o-c*m)*A,n[5]=(c*h-f*o)*A,n[6]=M*A,n[7]=(l*m-v*o)*A,n[8]=(d*o-l*h)*A,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,o,l,c){var h=Math.cos(o),s=Math.sin(o);this.set(r*h,r*s,-r*(h*l+s*c)+l+e,-n*s,n*h,-n*(-s*l+h*c)+c+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),s=Math.sin(e),r=this.elements,n=r[0],o=r[3],l=r[6],c=r[1],h=r[4],d=r[7];return r[0]=t*n+s*c,r[3]=t*o+s*h,r[6]=t*l+s*d,r[1]=-s*n+t*c,r[4]=-s*o+t*h,r[7]=-s*l+t*d,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var _object3DId=0,_v1$2=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position=new Vector3,_scale=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,r=new Quaternion,n=new Vector3(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function arrayMin(e){if(0===e.length)return 1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]<t&&(t=e[i]);return t}function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(q){return this.quaternion.premultiply(q),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){return _v1$2.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$2.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);var n=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),n&&(_m1$1.extractRotation(n.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.inverse()))},add:function(object){var e=arguments;if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(e[i]);return this}return object===this?(console.error("Object3D.add: object can't be added as a child of itself.",object),this):(object&&object.isObject3D?(null!==object.parent&&object.parent.remove(object),object.parent=this,this.children.push(object),object.dispatchEvent(_addedEvent)):console.error("Object3D.add: object not an instance of Object3D.",object),this)},remove:function(object){var e=arguments;if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.remove(e[i]);return this}var t=this.children.indexOf(object);return-1!==t&&(object.parent=null,this.children.splice(t,1),object.dispatchEvent(_removedEvent)),this},attach:function(object){return this.updateWorldMatrix(!0,!1),_m1$1.getInverse(this.matrixWorld),null!==object.parent&&(object.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(object.parent.matrixWorld)),object.applyMatrix4(_m1$1),object.updateWorldMatrix(!1,!1),this.add(object),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var object=this.children[i].getObjectByProperty(e,t);if(void 0!==object)return object}},getWorldPosition:function(e){return void 0===e&&(console.warn("Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,e,_scale),e},getWorldScale:function(e){return void 0===e&&(console.warn("Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,_quaternion$2,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,o=n.length;i<o;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(meta){var e=void 0===meta||"string"==typeof meta,output={};e&&(meta={geometries:{},materials:{},textures:{},images:{},shapes:{}},output.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var object={};function t(e,element){return void 0===e[element.uuid]&&(e[element.uuid]=element.toJSON(meta)),element.uuid}if(object.uuid=this.uuid,object.type=this.type,""!==this.name&&(object.name=this.name),!0===this.castShadow&&(object.castShadow=!0),!0===this.receiveShadow&&(object.receiveShadow=!0),!1===this.visible&&(object.visible=!1),!1===this.frustumCulled&&(object.frustumCulled=!1),0!==this.renderOrder&&(object.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(object.userData=this.userData),object.layers=this.layers.mask,object.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(object.matrixAutoUpdate=!1),this.isInstancedMesh&&(object.type="InstancedMesh",object.count=this.count,object.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){object.geometry=t(meta.geometries,this.geometry);var r=this.geometry.parameters;if(void 0!==r&&void 0!==r.shapes){var n=r.shapes;if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++){var l=n[i];t(meta.shapes,l)}else t(meta.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(i=0,o=this.material.length;i<o;i++)c.push(t(meta.materials,this.material[i]));object.material=c}else object.material=t(meta.materials,this.material);if(this.children.length>0){object.children=[];for(i=0;i<this.children.length;i++)object.children.push(this.children[i].toJSON(meta).object)}if(e){var h=v(meta.geometries),d=v(meta.materials),f=v(meta.textures),m=v(meta.images);n=v(meta.shapes);h.length>0&&(output.geometries=h),d.length>0&&(output.materials=d),f.length>0&&(output.textures=f),m.length>0&&(output.images=m),n.length>0&&(output.shapes=n)}return output.object=object,output;function v(e){var t=[];for(var r in e){var data=e[r];delete data.metadata,t.push(data)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(source,e){if(void 0===e&&(e=!0),this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.layers.mask=source.layers.mask,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,this.userData=JSON.parse(JSON.stringify(source.userData)),!0===e)for(var i=0;i<source.children.length;i++){var t=source.children[i];this.add(t.clone())}return this}});var _bufferGeometryId=1,_m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$3=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new Matrix3).getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}var o=this.attributes.tangent;return void 0!==o&&(o.transformDirection(e),o.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return _m1$2.makeRotationX(e),this.applyMatrix4(_m1$2),this},rotateY:function(e){return _m1$2.makeRotationY(e),this.applyMatrix4(_m1$2),this},rotateZ:function(e){return _m1$2.makeRotationZ(e),this.applyMatrix4(_m1$2),this},translate:function(e,t,r){return _m1$2.makeTranslation(e,t,r),this.applyMatrix4(_m1$2),this},scale:function(e,t,r){return _m1$2.makeScale(e,t,r),this.applyMatrix4(_m1$2),this},lookAt:function(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(object){var e=object.geometry;if(object.isPoints||object.isLine){var t=new Float32BufferAttribute(3*e.vertices.length,3),r=new Float32BufferAttribute(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var n=new Float32BufferAttribute(e.lineDistances.length,1);this.setAttribute("lineDistance",n.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else object.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(object){var e,t=object.geometry;if(object.isMesh){var r=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}return!0===t.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(object.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.setAttribute("normal",new BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.setAttribute("color",new BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var o=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new BufferAttribute(o,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var l=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new BufferAttribute(l,2).copyVector2sArray(e.uvs2))}for(var c in this.groups=e.groups,e.morphTargets){for(var h=[],d=e.morphTargets[c],i=0,f=d.length;i<f;i++){var m=d[i],v=new Float32BufferAttribute(3*m.data.length,3);v.name=m.name,h.push(v.copyVector3sArray(m.data))}this.morphAttributes[c]=h}if(e.skinIndices.length>0){var y=new Float32BufferAttribute(4*e.skinIndices.length,4);this.setAttribute("skinIndex",y.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var x=new Float32BufferAttribute(4*e.skinWeights.length,4);this.setAttribute("skinWeight",x.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var n=t[i];_box$2.setFromBufferAttribute(n),this.morphTargetsRelative?(_vector$3.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$3),_vector$3.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$3)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(var i=0,n=t.length;i<n;i++){var o=t[i];_boxMorphTargets.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$3.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$3),_vector$3.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$3)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(r);var l=0;for(i=0,n=e.count;i<n;i++)_vector$3.fromBufferAttribute(e,i),l=Math.max(l,r.distanceToSquared(_vector$3));if(t)for(i=0,n=t.length;i<n;i++){o=t[i];for(var c=this.morphTargetsRelative,h=0,d=o.count;h<d;h++)_vector$3.fromBufferAttribute(o,h),c&&(_offset.fromBufferAttribute(e,h),_vector$3.add(_offset)),l=Math.max(l,r.distanceToSquared(_vector$3))}this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new BufferAttribute(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,o=n.length;i<o;i++)n[i]=0;var l,c,h,d=t.normal.array,f=new Vector3,m=new Vector3,v=new Vector3,y=new Vector3,x=new Vector3;if(e){var _=e.array;for(i=0,o=e.count;i<o;i+=3)l=3*_[i+0],c=3*_[i+1],h=3*_[i+2],f.fromArray(r,l),m.fromArray(r,c),v.fromArray(r,h),y.subVectors(v,m),x.subVectors(f,m),y.cross(x),d[l]+=y.x,d[l+1]+=y.y,d[l+2]+=y.z,d[c]+=y.x,d[c+1]+=y.y,d[c+2]+=y.z,d[h]+=y.x,d[h+1]+=y.y,d[h+2]+=y.z}else for(i=0,o=r.length;i<o;i+=9)f.fromArray(r,i),m.fromArray(r,i+3),v.fromArray(r,i+6),y.subVectors(v,m),x.subVectors(f,m),y.cross(x),d[i]=y.x,d[i+1]=y.y,d[i+2]=y.z,d[i+3]=y.x,d[i+4]=y.y,d[i+5]=y.z,d[i+6]=y.x,d[i+7]=y.y,d[i+8]=y.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var o=r[n].array,l=e.attributes[n],c=l.array,h=l.itemSize*t,d=Math.min(c.length,o.length-h),i=0,f=h;i<d;i++,f++)o[f]=c[i];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,i=0,t=e.count;i<t;i++)_vector$3.x=e.getX(i),_vector$3.y=e.getY(i),_vector$3.z=e.getZ(i),_vector$3.normalize(),e.setXYZ(i,_vector$3.x,_vector$3.y,_vector$3.z)},toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,o=new r.constructor(t.length*n),l=0,c=0,i=0,h=t.length;i<h;i++){l=t[i]*n;for(var d=0;d<n;d++)o[c++]=r[l++]}return new BufferAttribute(o,n)}if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new BufferGeometry,r=this.index.array,n=this.attributes;for(var o in n){var l=e(n[o],r);t.setAttribute(o,l)}var c=this.morphAttributes;for(o in c){for(var h=[],d=c[o],i=0,f=d.length;i<f;i++){l=e(d[i],r);h.push(l)}t.morphAttributes[o]=h}t.morphTargetsRelative=this.morphTargetsRelative;for(var m=this.groups,v=(i=0,m.length);i<v;i++){var y=m[i];t.addGroup(y.start,y.count,y.materialIndex)}return t},toJSON:function(){var data={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),Object.keys(this.userData).length>0&&(data.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var t in e)void 0!==e[t]&&(data[t]=e[t]);return data}data.data={attributes:{}};var r=this.index;null!==r&&(data.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var n=this.attributes;for(var t in n){var o=(m=n[t]).toJSON();""!==m.name&&(o.name=m.name),data.data.attributes[t]=o}var l={},c=!1;for(var t in this.morphAttributes){for(var h=this.morphAttributes[t],d=[],i=0,f=h.length;i<f;i++){var m;o=(m=h[i]).toJSON();""!==m.name&&(o.name=m.name),d.push(o)}d.length>0&&(l[t]=d,c=!0)}c&&(data.data.morphAttributes=l,data.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(data.data.groups=JSON.parse(JSON.stringify(v)));var y=this.boundingSphere;return null!==y&&(data.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),data},clone:function(){return(new BufferGeometry).copy(this)},copy:function(source){var e,i,t;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=source.name;var r=source.index;null!==r&&this.setIndex(r.clone());var n=source.attributes;for(e in n){var o=n[e];this.setAttribute(e,o.clone())}var l=source.morphAttributes;for(e in l){var c=[],h=l[e];for(i=0,t=h.length;i<t;i++)c.push(h[i].clone());this.morphAttributes[e]=c}this.morphTargetsRelative=source.morphTargetsRelative;var d=source.groups;for(i=0,t=d.length;i<t;i++){var f=d[i];this.addGroup(f.start,f.count,f.materialIndex)}var m=source.boundingBox;null!==m&&(this.boundingBox=m.clone());var v=source.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=source.drawRange.start,this.drawRange.count=source.drawRange.count,this.userData=source.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _vector$4=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal=new Vector3;function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3(0,0,-1)}Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,_vector$4)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=_vector$4.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$4.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$4.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,n){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var o,l,c,h,d=.5*e.distanceTo(t),f=-this.direction.dot(_segDir),m=_diff.dot(this.direction),v=-_diff.dot(_segDir),y=_diff.lengthSq(),x=Math.abs(1-f*f);if(x>0)if(l=f*m-v,h=d*x,(o=f*v-m)>=0)if(l>=-h)if(l<=h){var _=1/x;c=(o*=_)*(o+f*(l*=_)+2*m)+l*(f*o+l+2*v)+y}else l=d,c=-(o=Math.max(0,-(f*l+m)))*o+l*(l+2*v)+y;else l=-d,c=-(o=Math.max(0,-(f*l+m)))*o+l*(l+2*v)+y;else l<=-h?c=-(o=Math.max(0,-(-f*d+m)))*o+(l=o>0?-d:Math.min(Math.max(-d,-v),d))*(l+2*v)+y:l<=h?(o=0,c=(l=Math.min(Math.max(-d,-v),d))*(l+2*v)+y):c=-(o=Math.max(0,-(f*d+m)))*o+(l=o>0?d:Math.min(Math.max(-d,-v),d))*(l+2*v)+y;else l=f>0?-d:d,c=-(o=Math.max(0,-(f*l+m)))*o+l*(l+2*v)+y;return r&&r.copy(this.direction).multiplyScalar(o).add(this.origin),n&&n.copy(_segDir).multiplyScalar(l).add(_segCenter),c},intersectSphere:function(e,t){_vector$4.subVectors(e.center,this.origin);var r=_vector$4.dot(this.direction),n=_vector$4.dot(_vector$4)-r*r,o=e.radius*e.radius;if(n>o)return null;var l=Math.sqrt(o-n),c=r-l,h=r+l;return c<0&&h<0?null:c<0?this.at(h,t):this.at(c,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,o,l,c,h,d=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,v=this.origin;return d>=0?(r=(e.min.x-v.x)*d,n=(e.max.x-v.x)*d):(r=(e.max.x-v.x)*d,n=(e.min.x-v.x)*d),f>=0?(o=(e.min.y-v.y)*f,l=(e.max.y-v.y)*f):(o=(e.max.y-v.y)*f,l=(e.min.y-v.y)*f),r>l||o>n?null:((o>r||r!=r)&&(r=o),(l<n||n!=n)&&(n=l),m>=0?(c=(e.min.z-v.z)*m,h=(e.max.z-v.z)*m):(c=(e.max.z-v.z)*m,h=(e.min.z-v.z)*m),r>h||c>n?null:((c>r||r!=r)&&(r=c),(h<n||n!=n)&&(n=h),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,_vector$4)},intersectTriangle:function(a,b,e,t,r){_edge1.subVectors(b,a),_edge2.subVectors(e,a),_normal.crossVectors(_edge1,_edge2);var n,o=this.direction.dot(_normal);if(o>0){if(t)return null;n=1}else{if(!(o<0))return null;n=-1,o=-o}_diff.subVectors(this.origin,a);var l=n*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(l<0)return null;var c=n*this.direction.dot(_edge1.cross(_diff));if(c<0)return null;if(l+c>o)return null;var h=-n*_diff.dot(_normal);return h<0?null:this.at(h/o,r)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn(this.type+": '"+t+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===FlatShading;else console.warn("Material: '"+t+"' parameter is undefined.")}},toJSON:function(meta){var e=void 0===meta||"string"==typeof meta;e&&(meta={textures:{},images:{}});var data={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function t(e){var t=[];for(var r in e){var data=e[r];delete data.metadata,t.push(data)}return t}if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),this.color&&this.color.isColor&&(data.color=this.color.getHex()),void 0!==this.roughness&&(data.roughness=this.roughness),void 0!==this.metalness&&(data.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(data.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(data.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(data.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(data.specular=this.specular.getHex()),void 0!==this.shininess&&(data.shininess=this.shininess),void 0!==this.clearcoat&&(data.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(data.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(data.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(meta).uuid,data.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(data.map=this.map.toJSON(meta).uuid),this.matcap&&this.matcap.isTexture&&(data.matcap=this.matcap.toJSON(meta).uuid),this.alphaMap&&this.alphaMap.isTexture&&(data.alphaMap=this.alphaMap.toJSON(meta).uuid),this.lightMap&&this.lightMap.isTexture&&(data.lightMap=this.lightMap.toJSON(meta).uuid),this.aoMap&&this.aoMap.isTexture&&(data.aoMap=this.aoMap.toJSON(meta).uuid,data.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(data.bumpMap=this.bumpMap.toJSON(meta).uuid,data.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(data.normalMap=this.normalMap.toJSON(meta).uuid,data.normalMapType=this.normalMapType,data.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(data.displacementMap=this.displacementMap.toJSON(meta).uuid,data.displacementScale=this.displacementScale,data.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(data.roughnessMap=this.roughnessMap.toJSON(meta).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(data.metalnessMap=this.metalnessMap.toJSON(meta).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(data.emissiveMap=this.emissiveMap.toJSON(meta).uuid),this.specularMap&&this.specularMap.isTexture&&(data.specularMap=this.specularMap.toJSON(meta).uuid),this.envMap&&this.envMap.isTexture&&(data.envMap=this.envMap.toJSON(meta).uuid,data.reflectivity=this.reflectivity,data.refractionRatio=this.refractionRatio,void 0!==this.combine&&(data.combine=this.combine),void 0!==this.envMapIntensity&&(data.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(data.gradientMap=this.gradientMap.toJSON(meta).uuid),void 0!==this.size&&(data.size=this.size),void 0!==this.sizeAttenuation&&(data.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(data.blending=this.blending),!0===this.flatShading&&(data.flatShading=this.flatShading),this.side!==FrontSide&&(data.side=this.side),this.vertexColors!==NoColors&&(data.vertexColors=this.vertexColors),this.opacity<1&&(data.opacity=this.opacity),!0===this.transparent&&(data.transparent=this.transparent),data.depthFunc=this.depthFunc,data.depthTest=this.depthTest,data.depthWrite=this.depthWrite,data.stencilWrite=this.stencilWrite,data.stencilWriteMask=this.stencilWriteMask,data.stencilFunc=this.stencilFunc,data.stencilRef=this.stencilRef,data.stencilFuncMask=this.stencilFuncMask,data.stencilFail=this.stencilFail,data.stencilZFail=this.stencilZFail,data.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(data.rotation=this.rotation),!0===this.polygonOffset&&(data.polygonOffset=!0),0!==this.polygonOffsetFactor&&(data.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(data.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(data.linewidth=this.linewidth),void 0!==this.dashSize&&(data.dashSize=this.dashSize),void 0!==this.gapSize&&(data.gapSize=this.gapSize),void 0!==this.scale&&(data.scale=this.scale),!0===this.dithering&&(data.dithering=!0),this.alphaTest>0&&(data.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(data.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(data.wireframe=this.wireframe),this.wireframeLinewidth>1&&(data.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(data.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(data.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(data.morphTargets=!0),!0===this.morphNormals&&(data.morphNormals=!0),!0===this.skinning&&(data.skinning=!0),!1===this.visible&&(data.visible=!1),!1===this.toneMapped&&(data.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),e){var r=t(meta.textures),n=t(meta.images);r.length>0&&(data.textures=r),n.length>0&&(data.images=n)}return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.name=source.name,this.fog=source.fog,this.blending=source.blending,this.side=source.side,this.flatShading=source.flatShading,this.vertexTangents=source.vertexTangents,this.vertexColors=source.vertexColors,this.opacity=source.opacity,this.transparent=source.transparent,this.blendSrc=source.blendSrc,this.blendDst=source.blendDst,this.blendEquation=source.blendEquation,this.blendSrcAlpha=source.blendSrcAlpha,this.blendDstAlpha=source.blendDstAlpha,this.blendEquationAlpha=source.blendEquationAlpha,this.depthFunc=source.depthFunc,this.depthTest=source.depthTest,this.depthWrite=source.depthWrite,this.stencilWriteMask=source.stencilWriteMask,this.stencilFunc=source.stencilFunc,this.stencilRef=source.stencilRef,this.stencilFuncMask=source.stencilFuncMask,this.stencilFail=source.stencilFail,this.stencilZFail=source.stencilZFail,this.stencilZPass=source.stencilZPass,this.stencilWrite=source.stencilWrite;var e=source.clippingPlanes,t=null;if(null!==e){var r=e.length;t=new Array(r);for(var i=0;i!==r;++i)t[i]=e[i].clone()}return this.clippingPlanes=t,this.clipIntersection=source.clipIntersection,this.clipShadows=source.clipShadows,this.shadowSide=source.shadowSide,this.colorWrite=source.colorWrite,this.precision=source.precision,this.polygonOffset=source.polygonOffset,this.polygonOffsetFactor=source.polygonOffsetFactor,this.polygonOffsetUnits=source.polygonOffsetUnits,this.dithering=source.dithering,this.alphaTest=source.alphaTest,this.premultipliedAlpha=source.premultipliedAlpha,this.visible=source.visible,this.toneMapped=source.toneMapped,this.userData=JSON.parse(JSON.stringify(source.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.linewidth=source.linewidth,this.linecap=source.linecap,this.linejoin=source.linejoin,this};var _start=new Vector3,_end=new Vector3,_inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere;function Line(e,t,r){1===r&&console.error("Line: parameter LinePieces no longer supported. Use LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],i=1,n=t.count;i<n;i++)_start.fromBufferAttribute(t,i-1),_end.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;(r=e.lineDistances)[0]=0;for(i=1,n=o.length;i<n;i++)r[i]=r[i-1],r[i]+=o[i-1].distanceTo(o[i])}return this},raycast:function(e,t){var r=e.linePrecision,n=this.geometry,o=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),_sphere.copy(n.boundingSphere),_sphere.applyMatrix4(o),_sphere.radius+=r,!1!==e.ray.intersectsSphere(_sphere)){_inverseMatrix.getInverse(o),_ray.copy(e.ray).applyMatrix4(_inverseMatrix);var l=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=new Vector3,d=new Vector3,f=new Vector3,m=new Vector3,v=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var y=n.index,x=n.attributes.position.array;if(null!==y)for(var _=y.array,i=0,M=_.length-1;i<M;i+=v){var a=_[i],b=_[i+1];if(h.fromArray(x,3*a),d.fromArray(x,3*b),!(_ray.distanceSqToSegment(h,d,m,f)>c))m.applyMatrix4(this.matrixWorld),(A=e.ray.origin.distanceTo(m))<e.near||A>e.far||t.push({distance:A,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(i=0,M=x.length/3-1;i<M;i+=v){if(h.fromArray(x,3*i),d.fromArray(x,3*i+3),!(_ray.distanceSqToSegment(h,d,m,f)>c))m.applyMatrix4(this.matrixWorld),(A=e.ray.origin.distanceTo(m))<e.near||A>e.far||t.push({distance:A,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){var w=n.vertices,S=w.length;for(i=0;i<S-1;i+=v){var A;if(!(_ray.distanceSqToSegment(w[i],w[i+1],m,f)>c))m.applyMatrix4(this.matrixWorld),(A=e.ray.origin.distanceTo(m))<e.near||A>e.far||t.push({distance:A,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;function Plane(e,t){this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Plane.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(a,b,e){var t=_vector1.subVectors(e,b).cross(_vector2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(t,a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(line,e){void 0===e&&(console.warn("Plane: .intersectLine() target is now required"),e=new Vector3);var t=line.delta(_vector1),r=this.normal.dot(t);if(0===r)return 0===this.distanceToPoint(line.start)?e.copy(line.start):void 0;var n=-(line.start.dot(this.normal)+this.constant)/r;return n<0||n>1?void 0:e.copy(t).multiplyScalar(n).add(line.start)},intersectsLine:function(line){var e=this.distanceToPoint(line.start),t=this.distanceToPoint(line.end);return e<0&&t>0||t<0&&e>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||_normalMatrix.getNormalMatrix(e),n=this.coplanarPoint(_vector1).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(o),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var _v0$1=new Vector3,_v1$3=new Vector3,_v2$1=new Vector3,_v3=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;function Triangle(a,b,e){this.a=void 0!==a?a:new Vector3,this.b=void 0!==b?b:new Vector3,this.c=void 0!==e?e:new Vector3}function Face3(a,b,e,t,r,n){this.a=a,this.b=b,this.c=e,this.normal=t&&t.isVector3?t:new Vector3,this.vertexNormals=Array.isArray(t)?t:[],this.color=r&&r.isColor?r:new Color,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==n?n:0}function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Object.assign(Triangle,{getNormal:function(a,b,e,t){void 0===t&&(console.warn("Triangle: .getNormal() target is now required"),t=new Vector3),t.subVectors(e,b),_v0$1.subVectors(a,b),t.cross(_v0$1);var r=t.lengthSq();return r>0?t.multiplyScalar(1/Math.sqrt(r)):t.set(0,0,0)},getBarycoord:function(e,a,b,t,r){_v0$1.subVectors(t,a),_v1$3.subVectors(b,a),_v2$1.subVectors(e,a);var n=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),l=_v0$1.dot(_v2$1),c=_v1$3.dot(_v1$3),h=_v1$3.dot(_v2$1),d=n*c-o*o;if(void 0===r&&(console.warn("Triangle: .getBarycoord() target is now required"),r=new Vector3),0===d)return r.set(-2,-1,-1);var f=1/d,u=(c*l-o*h)*f,m=(n*h-o*l)*f;return r.set(1-u-m,m,u)},containsPoint:function(e,a,b,t){return Triangle.getBarycoord(e,a,b,t,_v3),_v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1},getUV:function(e,t,r,n,o,l,c,h){return this.getBarycoord(e,t,r,n,_v3),h.set(0,0),h.addScaledVector(o,_v3.x),h.addScaledVector(l,_v3.y),h.addScaledVector(c,_v3.z),h},isFrontFacing:function(a,b,e,t){return _v0$1.subVectors(e,b),_v1$3.subVectors(a,b),_v0$1.cross(_v1$3).dot(t)<0}}),Object.assign(Triangle.prototype,{set:function(a,b,e){return this.a.copy(a),this.b.copy(b),this.c.copy(e),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()},getMidpoint:function(e){return void 0===e&&(console.warn("Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,o){return Triangle.getUV(e,this.a,this.b,this.c,t,r,n,o)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(p,e){void 0===e&&(console.warn("Triangle: .closestPointToPoint() target is now required"),e=new Vector3);var t,r,a=this.a,b=this.b,n=this.c;_vab.subVectors(b,a),_vac.subVectors(n,a),_vap.subVectors(p,a);var o=_vab.dot(_vap),l=_vac.dot(_vap);if(o<=0&&l<=0)return e.copy(a);_vbp.subVectors(p,b);var c=_vab.dot(_vbp),h=_vac.dot(_vbp);if(c>=0&&h<=c)return e.copy(b);var d=o*h-c*l;if(d<=0&&o>=0&&c<=0)return t=o/(o-c),e.copy(a).addScaledVector(_vab,t);_vcp.subVectors(p,n);var f=_vab.dot(_vcp),m=_vac.dot(_vcp);if(m>=0&&f<=m)return e.copy(n);var v=f*l-o*m;if(v<=0&&l>=0&&m<=0)return r=l/(l-m),e.copy(a).addScaledVector(_vac,r);var y=c*m-f*h;if(y<=0&&h-c>=0&&f-m>=0)return _vbc.subVectors(n,b),r=(h-c)/(h-c+(f-m)),e.copy(b).addScaledVector(_vbc,r);var x=1/(y+v+d);return t=v*x,r=d*x,e.copy(a).addScaledVector(_vab,t).addScaledVector(_vac,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.a=source.a,this.b=source.b,this.c=source.c,this.normal.copy(source.normal),this.color.copy(source.color),this.materialIndex=source.materialIndex;for(var i=0,e=source.vertexNormals.length;i<e;i++)this.vertexNormals[i]=source.vertexNormals[i].clone();for(i=0,e=source.vertexColors.length;i<e;i++)this.vertexColors[i]=source.vertexColors[i].clone();return this}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this};var _inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial,this.updateMorphTargets()}function checkIntersection(object,e,t,r,n,o,l,c){if(null===(e.side===BackSide?r.intersectTriangle(l,o,n,!0,c):r.intersectTriangle(n,o,l,e.side!==DoubleSide,c)))return null;_intersectionPointWorld.copy(c),_intersectionPointWorld.applyMatrix4(object.matrixWorld);var h=t.ray.origin.distanceTo(_intersectionPointWorld);return h<t.near||h>t.far?null:{distance:h,point:_intersectionPointWorld.clone(),object:object}}function checkBufferGeometryIntersection(object,e,t,r,n,o,l,c,h,a,b,d){_vA.fromBufferAttribute(n,a),_vB.fromBufferAttribute(n,b),_vC.fromBufferAttribute(n,d);var f=object.morphTargetInfluences;if(e.morphTargets&&o&&f){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(var i=0,m=o.length;i<m;i++){var v=f[i],y=o[i];0!==v&&(_tempA.fromBufferAttribute(y,a),_tempB.fromBufferAttribute(y,b),_tempC.fromBufferAttribute(y,d),l?(_morphA.addScaledVector(_tempA,v),_morphB.addScaledVector(_tempB,v),_morphC.addScaledVector(_tempC,v)):(_morphA.addScaledVector(_tempA.sub(_vA),v),_morphB.addScaledVector(_tempB.sub(_vB),v),_morphC.addScaledVector(_tempC.sub(_vC),v)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}var x=checkIntersection(object,e,t,r,_vA,_vB,_vC,_intersectionPoint);if(x){c&&(_uvA.fromBufferAttribute(c,a),_uvB.fromBufferAttribute(c,b),_uvC.fromBufferAttribute(c,d),x.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),h&&(_uvA.fromBufferAttribute(h,a),_uvB.fromBufferAttribute(h,b),_uvC.fromBufferAttribute(h,d),x.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2));var _=new Face3(a,b,d);Triangle.getNormal(_vA,_vB,_vC,_.normal),x.face=_}return x}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(source){return Object3D.prototype.copy.call(this,source),void 0!==source.morphTargetInfluences&&(this.morphTargetInfluences=source.morphTargetInfluences.slice()),void 0!==source.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},source.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var o=n.morphAttributes,l=Object.keys(o);if(l.length>0){var c=o[l[0]];if(void 0!==c)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=c.length;e<t;e++)r=c[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var h=n.morphTargets;void 0!==h&&h.length>0&&console.error("Mesh.updateMorphTargets() no longer supports Geometry. Use BufferGeometry instead.")}},raycast:function(e,t){var r,n=this.geometry,o=this.material,l=this.matrixWorld;if(void 0!==o&&(null===n.boundingSphere&&n.computeBoundingSphere(),_sphere$1.copy(n.boundingSphere),_sphere$1.applyMatrix4(l),!1!==e.ray.intersectsSphere(_sphere$1)&&(_inverseMatrix$1.getInverse(l),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1),null===n.boundingBox||!1!==_ray$1.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,b,c,i,h,d,f,m,v,y=n.index,x=n.attributes.position,_=n.morphAttributes.position,M=n.morphTargetsRelative,w=n.attributes.uv,S=n.attributes.uv2,A=n.groups,T=n.drawRange;if(null!==y)if(Array.isArray(o))for(i=0,d=A.length;i<d;i++)for(v=o[(m=A[i]).materialIndex],h=Math.max(m.start,T.start),f=Math.min(m.start+m.count,T.start+T.count);h<f;h+=3)a=y.getX(h),b=y.getX(h+1),c=y.getX(h+2),(r=checkBufferGeometryIntersection(this,v,e,_ray$1,x,_,M,w,S,a,b,c))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=m.materialIndex,t.push(r));else for(i=Math.max(0,T.start),d=Math.min(y.count,T.start+T.count);i<d;i+=3)a=y.getX(i),b=y.getX(i+1),c=y.getX(i+2),(r=checkBufferGeometryIntersection(this,o,e,_ray$1,x,_,M,w,S,a,b,c))&&(r.faceIndex=Math.floor(i/3),t.push(r));else if(void 0!==x)if(Array.isArray(o))for(i=0,d=A.length;i<d;i++)for(v=o[(m=A[i]).materialIndex],h=Math.max(m.start,T.start),f=Math.min(m.start+m.count,T.start+T.count);h<f;h+=3)(r=checkBufferGeometryIntersection(this,v,e,_ray$1,x,_,M,w,S,a=h,b=h+1,c=h+2))&&(r.faceIndex=Math.floor(h/3),r.face.materialIndex=m.materialIndex,t.push(r));else for(i=Math.max(0,T.start),d=Math.min(x.count,T.start+T.count);i<d;i+=3)(r=checkBufferGeometryIntersection(this,o,e,_ray$1,x,_,M,w,S,a=i,b=i+1,c=i+2))&&(r.faceIndex=Math.floor(i/3),t.push(r))}else if(n.isGeometry){var L,C,N,P,F=Array.isArray(o),E=n.vertices,R=n.faces,D=n.faceVertexUvs[0];D.length>0&&(P=D);for(var O=0,I=R.length;O<I;O++){var B=R[O],U=F?o[B.materialIndex]:o;if(void 0!==U&&(L=E[B.a],C=E[B.b],N=E[B.c],r=checkIntersection(this,U,e,_ray$1,L,C,N,_intersectionPoint))){if(P&&P[O]){var k=P[O];_uvA.copy(k[0]),_uvB.copy(k[1]),_uvC.copy(k[2]),r.uv=Triangle.getUV(_intersectionPoint,L,C,N,_uvA,_uvB,_uvC,new Vector2)}r.face=B,r.faceIndex=O,t.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _geometryId=0,_m1$3=new Matrix4,_obj$1=new Object3D,_offset$1=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function SphereGeometry(e,t,r,n,o,l,c){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:o,thetaStart:l,thetaLength:c},this.fromBufferGeometry(new SphereBufferGeometry(e,t,r,n,o,l,c)),this.mergeVertices()}function SphereBufferGeometry(e,t,r,n,o,l,c){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:o,thetaStart:l,thetaLength:c},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,l=void 0!==l?l:0,c=void 0!==c?c:Math.PI;var h,d,f=Math.min(l+c,Math.PI),m=0,v=[],y=new Vector3,x=new Vector3,_=[],M=[],w=[],S=[];for(d=0;d<=r;d++){var A=[],T=d/r,L=0;for(0==d&&0==l?L=.5/t:d==r&&f==Math.PI&&(L=-.5/t),h=0;h<=t;h++){var u=h/t;y.x=-e*Math.cos(n+u*o)*Math.sin(l+T*c),y.y=e*Math.cos(l+T*c),y.z=e*Math.sin(n+u*o)*Math.sin(l+T*c),M.push(y.x,y.y,y.z),x.copy(y).normalize(),w.push(x.x,x.y,x.z),S.push(u+L,1-T),A.push(m++)}v.push(A)}for(d=0;d<r;d++)for(h=0;h<t;h++){var a=v[d][h+1],b=v[d][h],C=v[d+1][h],N=v[d+1][h+1];(0!==d||l>0)&&_.push(a,b,N),(d!==r-1||f<Math.PI)&&_.push(b,C,N)}this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(e){for(var t=(new Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,l=n.vertexNormals.length;o<l;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return _m1$3.makeRotationX(e),this.applyMatrix4(_m1$3),this},rotateY:function(e){return _m1$3.makeRotationY(e),this.applyMatrix4(_m1$3),this},rotateZ:function(e){return _m1$3.makeRotationZ(e),this.applyMatrix4(_m1$3),this},translate:function(e,t,r){return _m1$3.makeTranslation(e,t,r),this.applyMatrix4(_m1$3),this},scale:function(e,t,r){return _m1$3.makeScale(e,t,r),this.applyMatrix4(_m1$3),this},lookAt:function(e){return _obj$1.lookAt(e),_obj$1.updateMatrix(),this.applyMatrix4(_obj$1.matrix),this},fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes;if(void 0===n.position)return console.error("Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var o=n.position.array,l=void 0!==n.normal?n.normal.array:void 0,c=void 0!==n.color?n.color.array:void 0,h=void 0!==n.uv?n.uv.array:void 0,d=void 0!==n.uv2?n.uv2.array:void 0;void 0!==d&&(this.faceVertexUvs[1]=[]);for(var i=0;i<o.length;i+=3)t.vertices.push((new Vector3).fromArray(o,i)),void 0!==c&&t.colors.push((new Color).fromArray(c,i));function f(a,b,e,r){var n=void 0===c?[]:[t.colors[a].clone(),t.colors[b].clone(),t.colors[e].clone()],o=new Face3(a,b,e,void 0===l?[]:[(new Vector3).fromArray(l,3*a),(new Vector3).fromArray(l,3*b),(new Vector3).fromArray(l,3*e)],n,r);t.faces.push(o),void 0!==h&&t.faceVertexUvs[0].push([(new Vector2).fromArray(h,2*a),(new Vector2).fromArray(h,2*b),(new Vector2).fromArray(h,2*e)]),void 0!==d&&t.faceVertexUvs[1].push([(new Vector2).fromArray(d,2*a),(new Vector2).fromArray(d,2*b),(new Vector2).fromArray(d,2*e)])}var m=e.groups;if(m.length>0)for(i=0;i<m.length;i++)for(var v=m[i],y=v.start,x=y,_=y+v.count;x<_;x+=3)void 0!==r?f(r[x],r[x+1],r[x+2],v.materialIndex):f(x,x+1,x+2,v.materialIndex);else if(void 0!==r)for(i=0;i<r.length;i+=3)f(r[i],r[i+1],r[i+2]);else for(i=0;i<o.length/3;i+=3)f(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,s=0===t?1:1/t,r=new Matrix4;return r.set(s,0,0,-s*e.x,0,s,0,-s*e.y,0,0,s,-s*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,r=0,n=this.faces.length;r<n;r++){var o=this.faces[r],l=this.vertices[o.a],c=this.vertices[o.b],h=this.vertices[o.c];e.subVectors(h,c),t.subVectors(l,c),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,o,l,c;for(void 0===e&&(e=!0),c=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)c[t]=new Vector3;if(e){var h,d,f,m=new Vector3,v=new Vector3;for(n=0,o=this.faces.length;n<o;n++)l=this.faces[n],h=this.vertices[l.a],d=this.vertices[l.b],f=this.vertices[l.c],m.subVectors(f,d),v.subVectors(h,d),m.cross(v),c[l.a].add(m),c[l.b].add(m),c[l.c].add(m)}else for(this.computeFaceNormals(),n=0,o=this.faces.length;n<o;n++)c[(l=this.faces[n]).a].add(l.normal),c[l.b].add(l.normal),c[l.c].add(l.normal);for(t=0,r=this.vertices.length;t<r;t++)c[t].normalize();for(n=0,o=this.faces.length;n<o;n++){var y=(l=this.faces[n]).vertexNormals;3===y.length?(y[0].copy(c[l.a]),y[1].copy(c[l.b]),y[2].copy(c[l.c])):(y[0]=c[l.a].clone(),y[1]=c[l.b].clone(),y[2]=c[l.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var i,e,t,r,n;for(t=0,r=this.faces.length;t<r;t++)for((n=this.faces[t]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),i=0,e=n.vertexNormals.length;i<e;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone();var o=new Geometry;for(o.faces=this.faces,i=0,e=this.morphTargets.length;i<e;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];var l=this.morphNormals[i].faceNormals,c=this.morphNormals[i].vertexNormals;for(t=0,r=this.faces.length;t<r;t++)h=new Vector3,d={a:new Vector3,b:new Vector3,c:new Vector3},l.push(h),c.push(d)}var h,d,f=this.morphNormals[i];for(o.vertices=this.morphTargets[i].vertices,o.computeFaceNormals(),o.computeVertexNormals(),t=0,r=this.faces.length;t<r;t++)n=this.faces[t],h=f.faceNormals[t],d=f.vertexNormals[t],h.copy(n.normal),d.a.copy(n.vertexNormals[0]),d.b.copy(n.vertexNormals[1]),d.c.copy(n.vertexNormals[2])}for(t=0,r=this.faces.length;t<r;t++)(n=this.faces[t]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,o=this.vertices.length,l=this.vertices,c=e.vertices,h=this.faces,d=e.faces,f=this.colors,m=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new Matrix3).getNormalMatrix(t));for(var i=0,v=c.length;i<v;i++){var y=c[i].clone();void 0!==t&&y.applyMatrix4(t),l.push(y)}for(i=0,v=m.length;i<v;i++)f.push(m[i].clone());for(i=0,v=d.length;i<v;i++){var x,_,M,w=d[i],S=w.vertexNormals,A=w.vertexColors;(x=new Face3(w.a+o,w.b+o,w.c+o)).normal.copy(w.normal),void 0!==n&&x.normal.applyMatrix3(n).normalize();for(var T=0,L=S.length;T<L;T++)_=S[T].clone(),void 0!==n&&_.applyMatrix3(n).normalize(),x.vertexNormals.push(_);x.color.copy(w.color);for(T=0,L=A.length;T<L;T++)M=A[T],x.vertexColors.push(M.clone());x.materialIndex=w.materialIndex+r,h.push(x)}for(i=0,v=e.faceVertexUvs.length;i<v;i++){var C=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(T=0,L=C.length;T<L;T++){for(var N=C[T],P=[],F=0,E=N.length;F<E;F++)P.push(N[F].clone());this.faceVertexUvs[i].push(P)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,l,c,h={},d=[],f=[],m=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===h[t=Math.round(e.x*m)+"_"+Math.round(e.y*m)+"_"+Math.round(e.z*m)]?(h[t]=i,d.push(this.vertices[i]),f[i]=d.length-1):f[i]=f[h[t]];var v=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=f[n.a],n.b=f[n.b],n.c=f[n.c],o=[n.a,n.b,n.c];for(var y=0;y<3;y++)if(o[y]===o[(y+1)%3]){v.push(i);break}}for(i=v.length-1;i>=0;i--){var x=v[i];for(this.faces.splice(x,1),l=0,c=this.faceVertexUvs.length;l<c;l++)this.faceVertexUvs[l].splice(x,1)}var _=this.vertices.length-d.length;return this.vertices=d,_},setFromPoints:function(e){this.vertices=[];for(var i=0,t=e.length;i<t;i++){var r=e[i];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(a,b){return a.materialIndex-b.materialIndex}));var r,n,o=this.faceVertexUvs[0],l=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),l&&l.length===t&&(n=[]);for(i=0;i<t;i++){var c=e[i]._id;r&&r.push(o[c]),n&&n.push(l[c])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var data={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var t in e)void 0!==e[t]&&(data[t]=e[t]);return data}for(var r=[],i=0;i<this.vertices.length;i++){var n=this.vertices[i];r.push(n.x,n.y,n.z)}var o=[],l=[],c={},h=[],d={},f=[],m={};for(i=0;i<this.faces.length;i++){var v=this.faces[i],y=void 0!==this.faceVertexUvs[0][i],x=v.normal.length()>0,_=v.vertexNormals.length>0,M=1!==v.color.r||1!==v.color.g||1!==v.color.b,w=v.vertexColors.length>0,S=0;if(S=C(S,0,0),S=C(S,1,!0),S=C(S,2,!1),S=C(S,3,y),S=C(S,4,x),S=C(S,5,_),S=C(S,6,M),S=C(S,7,w),o.push(S),o.push(v.a,v.b,v.c),o.push(v.materialIndex),y){var A=this.faceVertexUvs[0][i];o.push(F(A[0]),F(A[1]),F(A[2]))}if(x&&o.push(N(v.normal)),_){var T=v.vertexNormals;o.push(N(T[0]),N(T[1]),N(T[2]))}if(M&&o.push(P(v.color)),w){var L=v.vertexColors;o.push(P(L[0]),P(L[1]),P(L[2]))}}function C(e,t,r){return r?e|1<<t:e&~(1<<t)}function N(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]||(c[t]=l.length/3,l.push(e.x,e.y,e.z)),c[t]}function P(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==d[t]||(d[t]=h.length,h.push(e.getHex())),d[t]}function F(e){var t=e.x.toString()+e.y.toString();return void 0!==m[t]||(m[t]=f.length/2,f.push(e.x,e.y)),m[t]}return data.data={},data.data.vertices=r,data.data.normals=l,h.length>0&&(data.data.colors=h),f.length>0&&(data.data.uvs=[f]),data.data.faces=o,data},clone:function(){return(new Geometry).copy(this)},copy:function(source){var i,e,t,r,n,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=source.name;var l=source.vertices;for(i=0,e=l.length;i<e;i++)this.vertices.push(l[i].clone());var c=source.colors;for(i=0,e=c.length;i<e;i++)this.colors.push(c[i].clone());var h=source.faces;for(i=0,e=h.length;i<e;i++)this.faces.push(h[i].clone());for(i=0,e=source.faceVertexUvs.length;i<e;i++){var d=source.faceVertexUvs[i];for(void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]),t=0,r=d.length;t<r;t++){var f=d[t],m=[];for(n=0,o=f.length;n<o;n++){var v=f[n];m.push(v.clone())}this.faceVertexUvs[i].push(m)}}var y=source.morphTargets;for(i=0,e=y.length;i<e;i++){var x={};if(x.name=y[i].name,void 0!==y[i].vertices)for(x.vertices=[],t=0,r=y[i].vertices.length;t<r;t++)x.vertices.push(y[i].vertices[t].clone());if(void 0!==y[i].normals)for(x.normals=[],t=0,r=y[i].normals.length;t<r;t++)x.normals.push(y[i].normals[t].clone());this.morphTargets.push(x)}var _=source.morphNormals;for(i=0,e=_.length;i<e;i++){var M={};if(void 0!==_[i].vertexNormals)for(M.vertexNormals=[],t=0,r=_[i].vertexNormals.length;t<r;t++){var w=_[i].vertexNormals[t],S={};S.a=w.a.clone(),S.b=w.b.clone(),S.c=w.c.clone(),M.vertexNormals.push(S)}if(void 0!==_[i].faceNormals)for(M.faceNormals=[],t=0,r=_[i].faceNormals.length;t<r;t++)M.faceNormals.push(_[i].faceNormals[t].clone());this.morphNormals.push(M)}var A=source.skinWeights;for(i=0,e=A.length;i<e;i++)this.skinWeights.push(A[i].clone());var T=source.skinIndices;for(i=0,e=T.length;i<e;i++)this.skinIndices.push(T[i].clone());var L=source.lineDistances;for(i=0,e=L.length;i<e;i++)this.lineDistances.push(L[i]);var C=source.boundingBox;null!==C&&(this.boundingBox=C.clone());var N=source.boundingSphere;return null!==N&&(this.boundingSphere=N.clone()),this.elementsNeedUpdate=source.elementsNeedUpdate,this.verticesNeedUpdate=source.verticesNeedUpdate,this.uvsNeedUpdate=source.uvsNeedUpdate,this.normalsNeedUpdate=source.normalsNeedUpdate,this.colorsNeedUpdate=source.colorsNeedUpdate,this.lineDistancesNeedUpdate=source.lineDistancesNeedUpdate,this.groupsNeedUpdate=source.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;var CCDIKSolver=function(){function e(e,t){this.mesh=e,this.iks=t||[],this._valid()}var q,t,r,n,o,l,c,h,d,f;function m(e,t){Object3D.call(this),this.root=e,this.iks=t||[],this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereBufferGeometry(.25,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}return e.prototype={constructor:e,update:(q=new Quaternion,t=new Vector3,r=new Vector3,n=new Vector3,o=new Vector3,l=new Vector3,c=new Quaternion,h=new Vector3,d=new Vector3,f=new Vector3,function(){for(var e=this.mesh.skeleton.bones,m=this.iks,v=Math,i=0,y=m.length;i<y;i++){var x=m[i],_=e[x.effector],M=e[x.target];t.setFromMatrixPosition(M.matrixWorld);for(var w=x.links,S=void 0!==x.iteration?x.iteration:1,A=0;A<S;A++){for(var T=!1,L=0,C=w.length;L<C;L++){var link=e[w[L].index];if(!1===w[L].enabled)break;var N=w[L].limitation,P=w[L].rotationMin,F=w[L].rotationMax;link.matrixWorld.decompose(l,c,h),c.inverse(),n.setFromMatrixPosition(_.matrixWorld),o.subVectors(n,l),o.applyQuaternion(c),o.normalize(),r.subVectors(t,l),r.applyQuaternion(c),r.normalize();var E=r.dot(o);if(E>1?E=1:E<-1&&(E=-1),!((E=v.acos(E))<1e-5)){if(void 0!==x.minAngle&&E<x.minAngle&&(E=x.minAngle),void 0!==x.maxAngle&&E>x.maxAngle&&(E=x.maxAngle),d.crossVectors(o,r),d.normalize(),q.setFromAxisAngle(d,E),link.quaternion.multiply(q),void 0!==N){var R=link.quaternion.w;R>1&&(R=1);var D=v.sqrt(1-R*R);link.quaternion.set(N.x*D,N.y*D,N.z*D,R)}void 0!==P&&link.rotation.setFromVector3(link.rotation.toVector3(f).max(P)),void 0!==F&&link.rotation.setFromVector3(link.rotation.toVector3(f).min(F)),link.updateMatrixWorld(!0),T=!0}}if(!T)break}}return this}),createHelper:function(){return new m(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){for(var e=this.iks,t=this.mesh.skeleton.bones,i=0,r=e.length;i<r;i++){var n,o,l=e[i],c=t[l.effector],h=l.links;n=c;for(var d=0,f=h.length;d<f;d++)o=t[h[d].index],n.parent!==o&&console.warn("CCDIKSolver: bone "+n.name+" is not the child of bone "+o.name),n=o}}},m.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:m,updateMatrixWorld:function(){var e=new Matrix4,t=new Vector3;function r(e,r){return t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(r)}function n(e,t,n,o){var l=r(n,o);e[3*t+0]=l.x,e[3*t+1]=l.y,e[3*t+2]=l.z}return function(t){var o=this.root;if(this.visible){var l=0,c=this.iks,h=o.skeleton.bones;e.getInverse(o.matrixWorld);for(var i=0,d=c.length;i<d;i++){var f=c[i],m=h[f.target],v=h[f.effector],y=this.children[l++],x=this.children[l++];y.position.copy(r(m,e)),x.position.copy(r(v,e));for(var _=0,M=f.links.length;_<M;_++){var w=h[f.links[_].index];this.children[l++].position.copy(r(w,e))}var line=this.children[l++],S=line.geometry.attributes.position.array;n(S,0,m,e),n(S,1,v,e);for(_=0,M=f.links.length;_<M;_++){n(S,_+2,w=h[f.links[_].index],e)}line.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(o.matrixWorld),Object3D.prototype.updateMatrixWorld.call(this,t)}}(),_init:function(){var e=this,t=this.iks;function r(t){return new Line(function(e){var t=new BufferGeometry,r=new Float32Array(3*(2+e.links.length));return t.setAttribute("position",new BufferAttribute(r,3)),t}(t),e.lineMaterial)}for(var i=0,n=t.length;i<n;i++){var o=t[i];this.add(new Mesh(e.sphereGeometry,e.targetSphereMaterial)),this.add(new Mesh(e.sphereGeometry,e.effectorSphereMaterial));for(var l=0,c=o.links.length;l<c;l++)this.add(new Mesh(e.sphereGeometry,e.linkSphereMaterial));this.add(r(o))}}}),e}();function AnimationAction(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,o=n.length,l=new Array(o),c={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},i=0;i!==o;++i){var h=n[i].createInterpolant(null);l[i]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(time){return this._startTime=time,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,o=e._clip.duration,l=o/n,c=n/o;e.warp(1,l,t),this.warp(c,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,o=n.time,l=this._timeScaleInterpolant,c=this.timeScale;null===l&&(l=n._lendControlInterpolant(),this._timeScaleInterpolant=l);var h=l.parameterPositions,d=l.sampleValues;return h[0]=o,h[1]=o+r,d[0]=e/c,d[1]=t/c,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(time,e,t,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(time-n)*t;if(o<0||0===t)return;this._startTime=null,e=t*o}e*=this._updateTimeScale(time);var l=this._updateTime(e),c=this._updateWeight(time);if(c>0)for(var h=this._interpolants,d=this._propertyBindings,f=0,m=h.length;f!==m;++f)h[f].evaluate(l),d[f].accumulate(r,c)}else this._updateWeight(time)},_updateWeight:function(time){var e=0;if(this.enabled){e=this.weight;var t=this._weightInterpolant;if(null!==t){var r=t.evaluate(time)[0];e*=r,time>t.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(time){var e=0;if(!this.paused){e=this.timeScale;var t=this._timeScaleInterpolant;if(null!==t)e*=t.evaluate(time)[0],time>t.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(e){var time=this.time+e,t=this._clip.duration,r=this.loop,n=this._loopCount,o=r===LoopPingPong;if(0===e)return-1===n?time:o&&1==(1&n)?t-time:time;if(r===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(time>=t)time=t;else{if(!(time<0)){this.time=time;break e}time=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=time,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),time>=t||time<0){var l=Math.floor(time/t);time-=t*l,n+=Math.abs(l);var c=this.repetitions-n;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,time=e>0?t:0,this.time=time,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===c){var h=e<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=time,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=time;if(o&&1==(1&n))return t-time}return time},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=ZeroSlopeEnding,n.endingEnd=ZeroSlopeEnding):(n.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,n.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)},_scheduleFading:function(e,t,r){var n=this._mixer,o=n.time,l=this._weightInterpolant;null===l&&(l=n._lendControlInterpolant(),this._weightInterpolant=l);var c=l.parameterPositions,h=l.sampleValues;return c[0]=o,h[0]=t,c[1]=o+e,h[1]=r,this}});var _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(e,path,t){var r=t||PropertyBinding.parseTrackName(path);this._targetGroup=e,this._bindings=e.subscribe_(path,r)}function PropertyBinding(e,path,t){this.path=path,this.parsedPath=t||PropertyBinding.parseTrackName(path),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function PropertyMixer(e,t,r){this.binding=e,this.valueSize=r;var n,o=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":o=Array,n=this._select;break;default:n=this._lerp}this.buffer=new o(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Bone(){Object3D.call(this),this.type="Bone"}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,i=this._targetGroup.nCachedObjects_,t=e.length;i!==t;++i)e[i].bind()},unbind:function(){for(var e=this._bindings,i=this._targetGroup.nCachedObjects_,t=e.length;i!==t;++i)e[i].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,path,t){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,path,t):new PropertyBinding(e,path,t)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){var t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var o=r.nodeName.substring(n+1);-1!==_supportedObjectNames.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var i=0;i<e.length;i++){var r=e[i];if(r.name===t||r.uuid===t)return r;var o=n(r.children);if(o)return o}return null},o=n(e.children);if(o)return o}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var source=this.resolvedProperty,i=0,r=source.length;i!==r;++i)e[t++]=source[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,o=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var l=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var i=0;i<e.length;i++)if(e[i].name===l){l=i;break}break;default:if(void 0===e[r])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==l){if(void 0===e[l])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[l]}}var c=e[n];if(void 0!==c){var h=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?h=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(h=this.Versioning.MatrixWorldNeedsUpdate);var d=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(i=0;i<this.node.geometry.morphAttributes.position.length;i++)if(e.geometry.morphAttributes.position[i].name===o){o=i;break}}else{if(!e.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(i=0;i<this.node.geometry.morphTargets.length;i++)if(e.geometry.morphTargets[i].name===o){o=i;break}}}d=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else void 0!==c.fromArray&&void 0!==c.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(d=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=n;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][h]}else{var f=t.nodeName;console.error("PropertyBinding: Trying to update property for track: "+f+"."+n+" but it wasn't found.",e)}}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,o=e*n+n,l=this.cumulativeWeight;if(0===l){for(var i=0;i!==n;++i)r[o+i]=r[i];l=t}else{var c=t/(l+=t);this._mixBufferRegion(r,o,0,c,n)}this.cumulativeWeight=l},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,o=this.cumulativeWeight,l=this.binding;if(this.cumulativeWeight=0,o<1){var c=3*t;this._mixBufferRegion(r,n,c,1-o,t)}for(var i=t,h=t+t;i!==h;++i)if(r[i]!==r[i+t]){l.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,o=n;i!==o;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,o){if(n>=.5)for(var i=0;i!==o;++i)e[t+i]=e[r+i]},_slerp:function(e,t,r,n){Quaternion.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,o){for(var s=1-n,i=0;i!==o;++i){var l=t+i;e[l]=e[l]*s+e[r+i]*n}}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,o=n.length,l=e._propertyBindings,c=e._interpolants,h=r.uuid,d=this._bindingsByRootAndName,f=d[h];void 0===f&&(f={},d[h]=f);for(var i=0;i!==o;++i){var track=n[i],m=track.name,v=f[m];if(void 0!==v)l[i]=v;else{if(void 0!==(v=l[i])){null===v._cacheIndex&&(++v.referenceCount,this._addInactiveBinding(v,h,m));continue}var path=t&&t._propertyBindings[i].binding.parsedPath;++(v=new PropertyMixer(PropertyBinding.create(r,m,path),track.ValueTypeName,track.getValueSize())).referenceCount,this._addInactiveBinding(v,h,m),l[i]=v}c[i].resultBuffer=v.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var o=e._propertyBindings,i=0,l=o.length;i!==l;++i){var c=o[i];0==c.useCount++&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,o=this._actionsByClip,l=o[t];if(void 0===l)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=l;else{var c=l.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=n.length,n.push(e),l.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var o=e._clip.uuid,l=this._actionsByClip,c=l[o],h=c.knownActions,d=h[h.length-1],f=e._byClipCacheIndex;d._byClipCacheIndex=f,h[f]=d,h.pop(),e._byClipCacheIndex=null,delete c.actionByRoot[(e._localRoot||this._root).uuid],0===h.length&&delete l[o],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,o=n[t],l=this._bindings;void 0===o&&(o={},n[t]=o),o[r]=e,e._cacheIndex=l.length,l.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,o=r.path,l=this._bindingsByRootAndName,c=l[n],h=t[t.length-1],d=e._cacheIndex;h._cacheIndex=d,t[d]=h,t.pop(),delete c[o],0===Object.keys(c).length&&delete l[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,o=t[n];e.__cacheIndex=n,t[n]=e,o.__cacheIndex=r,t[r]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,o="string"==typeof e?AnimationClip.findByName(r,e):e,l=null!==o?o.uuid:e,c=this._actionsByClip[l],h=null;if(void 0!==c){var d=c.actionByRoot[n];if(void 0!==d)return d;h=c.knownActions[0],null===o&&(o=h._clip)}if(null===o)return null;var f=new AnimationAction(this,o,t);return this._bindAction(f,h),this._addInactiveAction(f,l,n),f},existingAction:function(e,t){var r=t||this._root,n=r.uuid,o="string"==typeof e?AnimationClip.findByName(r,e):e,l=o?o.uuid:e,c=this._actionsByClip[l];return void 0!==c&&c.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,time=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,i=0;i!==r;++i){t[i]._update(time,e,n,o)}var l=this._bindings,c=this._nActiveBindings;for(i=0;i!==c;++i)l[i].apply(o);return this},setTime:function(e){this.time=0;for(var i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,o=n[r];if(void 0!==o){for(var l=o.knownActions,i=0,c=l.length;i!==c;++i){var h=l[i];this._deactivateAction(h);var d=h._cacheIndex,f=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,f._cacheIndex=d,t[d]=f,t.pop(),this._removeInactiveBindingsForAction(h)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var o=r[n].actionByRoot[t];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var l=this._bindingsByRootAndName[t];if(void 0!==l)for(var c in l){var h=l[c];h.restoreOriginalState(),this._removeInactiveBinding(h)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});var BoxGeometry=function(e){function t(t,r,n,o,l,c){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:o,heightSegments:l,depthSegments:c},this.fromBufferGeometry(new BoxBufferGeometry(t,r,n,o,l,c)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Geometry),BoxBufferGeometry=function(e){function t(t,r,n,o,l,c){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:o,heightSegments:l,depthSegments:c};var h=this;t=t||1,r=r||1,n=n||1,o=Math.floor(o)||1,l=Math.floor(l)||1,c=Math.floor(c)||1;var d=[],f=[],m=[],v=[],y=0,x=0;function _(u,e,t,r,n,o,l,c,_,M,w){var S,A,T=o/_,L=l/M,C=o/2,N=l/2,P=c/2,F=_+1,E=M+1,R=0,D=0,O=new Vector3;for(A=0;A<E;A++){var I=A*L-N;for(S=0;S<F;S++){var B=S*T-C;O[u]=B*r,O[e]=I*n,O[t]=P,f.push(O.x,O.y,O.z),O[u]=0,O[e]=0,O[t]=c>0?1:-1,m.push(O.x,O.y,O.z),v.push(S/_),v.push(1-A/M),R+=1}}for(A=0;A<M;A++)for(S=0;S<_;S++){var a=y+S+F*A,b=y+S+F*(A+1),U=y+(S+1)+F*(A+1),k=y+(S+1)+F*A;d.push(a,b,k),d.push(b,U,k),D+=6}h.addGroup(x,D,w),x+=D,y+=R}_("z","y","x",-1,-1,n,r,t,c,l,0),_("z","y","x",1,-1,n,r,-t,c,l,1),_("x","z","y",1,1,t,n,r,o,c,2),_("x","z","y",1,-1,t,n,-r,o,c,3),_("x","y","z",1,-1,t,r,n,o,l,4),_("x","y","z",-1,-1,t,r,-n,o,l,5),this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(v,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(BufferGeometry);function CylinderGeometry(e,t,r,n,o,l,c,h){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:o,openEnded:l,thetaStart:c,thetaLength:h},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,r,n,o,l,c,h)),this.mergeVertices()}function CylinderBufferGeometry(e,t,r,n,o,l,c,h){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:o,openEnded:l,thetaStart:c,thetaLength:h};var d=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,o=Math.floor(o)||1,l=void 0!==l&&l,c=void 0!==c?c:0,h=void 0!==h?h:2*Math.PI;var f=[],m=[],v=[],y=[],x=0,_=[],M=r/2,w=0;function S(r){var o,l,_,S=new Vector2,A=new Vector3,T=0,L=!0===r?e:t,C=!0===r?1:-1;for(l=x,o=1;o<=n;o++)m.push(0,M*C,0),v.push(0,C,0),y.push(.5,.5),x++;for(_=x,o=0;o<=n;o++){var N=o/n*h+c,P=Math.cos(N),F=Math.sin(N);A.x=L*F,A.y=M*C,A.z=L*P,m.push(A.x,A.y,A.z),v.push(0,C,0),S.x=.5*P+.5,S.y=.5*F*C+.5,y.push(S.x,S.y),x++}for(o=0;o<n;o++){var E=l+o,i=_+o;!0===r?f.push(i,i+1,E):f.push(i+1,i,E),T+=3}d.addGroup(w,T,!0===r?1:2),w+=T}!function(){var l,S,A=new Vector3,T=new Vector3,L=0,C=(t-e)/r;for(S=0;S<=o;S++){var N=[],P=S/o,F=P*(t-e)+e;for(l=0;l<=n;l++){var u=l/n,E=u*h+c,R=Math.sin(E),D=Math.cos(E);T.x=F*R,T.y=-P*r+M,T.z=F*D,m.push(T.x,T.y,T.z),A.set(R,C,D).normalize(),v.push(A.x,A.y,A.z),y.push(u,1-P),N.push(x++)}_.push(N)}for(l=0;l<n;l++)for(S=0;S<o;S++){var a=_[S][l],b=_[S+1][l],O=_[S+1][l+1],I=_[S][l+1];f.push(a,b,I),f.push(b,O,I),L+=6}d.addGroup(w,L,0),w+=L}(),!1===l&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;var MMDPhysics=function(){function e(e,r,n,o){if("undefined"==typeof Ammo)throw new Error("MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");n=n||[],o=o||{},this.manager=new t,this.mesh=e,this.unitStep=void 0!==o.unitStep?o.unitStep:1/65,this.maxStepNum=void 0!==o.maxStepNum?o.maxStepNum:3,this.gravity=new Vector3(0,-98,0),void 0!==o.gravity&&this.gravity.copy(o.gravity),this.world=void 0!==o.world?o.world:null,this.bodies=[],this.constraints=[],this._init(e,r,n)}function t(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}function r(e,t,r,n){this.mesh=e,this.world=t,this.params=r,this.manager=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}function n(e,t,r,n,o,l){this.mesh=e,this.world=t,this.bodyA=r,this.bodyB=n,this.params=o,this.manager=l,this.constraint=null,this._init()}function o(e,t){Object3D.call(this),this.root=e,this.physics=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new MeshBasicMaterial({color:new Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}var l,c,h,d;return e.prototype={constructor:e,update:function(e){var t,r=this.manager,n=this.mesh,o=!1,l=r.allocThreeVector3(),c=r.allocThreeQuaternion(),h=r.allocThreeVector3();return n.matrixWorld.decompose(l,c,h),1===h.x&&1===h.y&&1===h.z||(o=!0),o&&(null!==(t=n.parent)&&(n.parent=null),h.copy(this.mesh.scale),n.scale.set(1,1,1),n.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),o&&(null!==t&&(n.parent=t),n.scale.copy(h)),r.freeThreeVector3(h),r.freeThreeQuaternion(c),r.freeThreeVector3(l),this},reset:function(){for(var i=0,e=this.bodies.length;i<e;i++)this.bodies[i].reset();return this},warmup:function(e){for(var i=0;i<e;i++)this.update(1/60);return this},setGravity:function(e){return this.world.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),this.gravity.copy(e),this},createHelper:function(){return new o(this.mesh,this)},_init:function(e,t,r){var n=this.manager,o=e.parent;null!==o&&(o=null);var l=n.allocThreeVector3(),c=n.allocThreeQuaternion(),h=n.allocThreeVector3();l.copy(e.position),c.copy(e.quaternion),h.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(t),this._initConstraints(r),null!==o&&(e.parent=o),e.position.copy(l),e.quaternion.copy(c),e.scale.copy(h),e.updateMatrixWorld(!0),this.reset(),n.freeThreeVector3(l),n.freeThreeQuaternion(c),n.freeThreeVector3(h)},_createWorld:function(){var e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(t,r,n,e)},_initRigidBodies:function(e){for(var i=0,t=e.length;i<t;i++)this.bodies.push(new r(this.mesh,this.world,e[i],this.manager))},_initConstraints:function(e){for(var i=0,t=e.length;i<t;i++){var r=e[i],o=this.bodies[r.rigidBodyIndex1],l=this.bodies[r.rigidBodyIndex2];this.constraints.push(new n(this.mesh,this.world,o,l,r,this.manager))}},_stepSimulation:function(e){var t=this.unitStep,r=e,n=1+(e/t|0);r<t&&(r=t,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,t)},_updateRigidBodies:function(){for(var i=0,e=this.bodies.length;i<e;i++)this.bodies[i].updateFromBone()},_updateBones:function(){for(var i=0,e=this.bodies.length;i<e;i++)this.bodies[i].updateBone()}},t.prototype={constructor:t,allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Vector3},freeThreeVector3:function(e){this.threeVector3s.push(e)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Matrix4},freeThreeMatrix4:function(e){this.threeMatrix4s.push(e)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Quaternion},freeThreeQuaternion:function(q){this.threeQuaternions.push(q)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new Euler},freeThreeEuler:function(e){this.threeEulers.push(e)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(e){this.transforms.push(e)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(q){this.quaternions.push(q)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(e){this.vector3s.push(e)},setIdentity:function(e){e.setIdentity()},getBasis:function(e){var q=this.allocQuaternion();return e.getBasis().getRotation(q),q},getBasisAsMatrix3:function(e){var q=this.getBasis(e),t=this.quaternionToMatrix3(q);return this.freeQuaternion(q),t},getOrigin:function(e){return e.getOrigin()},setOrigin:function(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())},copyOrigin:function(e,t){var r=t.getOrigin();this.setOrigin(e,r)},setBasis:function(e,q){e.setRotation(q)},setBasisFromMatrix3:function(e,t){var q=this.matrix3ToQuaternion(t);this.setBasis(e,q),this.freeQuaternion(q)},setOriginFromArray3:function(e,a){e.getOrigin().setValue(a[0],a[1],a[2])},setOriginFromThreeVector3:function(e,t){e.getOrigin().setValue(t.x,t.y,t.z)},setBasisFromArray3:function(e,a){var t=this.allocThreeQuaternion(),r=this.allocThreeEuler();r.set(a[0],a[1],a[2]),this.setBasisFromThreeQuaternion(e,t.setFromEuler(r)),this.freeThreeEuler(r),this.freeThreeQuaternion(t)},setBasisFromThreeQuaternion:function(e,a){var q=this.allocQuaternion();q.setX(a.x),q.setY(a.y),q.setZ(a.z),q.setW(a.w),this.setBasis(e,q),this.freeQuaternion(q)},multiplyTransforms:function(e,t){var r=this.allocTransform();this.setIdentity(r);var n=this.getBasisAsMatrix3(e),o=this.getBasisAsMatrix3(t),l=this.getOrigin(e),c=this.getOrigin(t),h=this.multiplyMatrix3ByVector3(n,c),d=this.addVector3(h,l);this.setOrigin(r,d);var f=this.multiplyMatrices3(n,o);return this.setBasisFromMatrix3(r,f),this.freeVector3(h),this.freeVector3(d),r},inverseTransform:function(e){var t=this.allocTransform(),r=this.getBasisAsMatrix3(e),n=this.getOrigin(e),o=this.transposeMatrix3(r),l=this.negativeVector3(n),c=this.multiplyMatrix3ByVector3(o,l);return this.setOrigin(t,c),this.setBasisFromMatrix3(t,o),this.freeVector3(l),this.freeVector3(c),t},multiplyMatrices3:function(e,t){var r=[],n=this.rowOfMatrix3(e,0),o=this.rowOfMatrix3(e,1),l=this.rowOfMatrix3(e,2),c=this.columnOfMatrix3(t,0),h=this.columnOfMatrix3(t,1),d=this.columnOfMatrix3(t,2);return r[0]=this.dotVectors3(n,c),r[1]=this.dotVectors3(n,h),r[2]=this.dotVectors3(n,d),r[3]=this.dotVectors3(o,c),r[4]=this.dotVectors3(o,h),r[5]=this.dotVectors3(o,d),r[6]=this.dotVectors3(l,c),r[7]=this.dotVectors3(l,h),r[8]=this.dotVectors3(l,d),this.freeVector3(n),this.freeVector3(o),this.freeVector3(l),this.freeVector3(c),this.freeVector3(h),this.freeVector3(d),r},addVector3:function(e,t){var r=this.allocVector3();return r.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),r},dotVectors3:function(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()},rowOfMatrix3:function(e,i){var t=this.allocVector3();return t.setValue(e[3*i+0],e[3*i+1],e[3*i+2]),t},columnOfMatrix3:function(e,i){var t=this.allocVector3();return t.setValue(e[i+0],e[i+3],e[i+6]),t},negativeVector3:function(e){var t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t},multiplyMatrix3ByVector3:function(e,t){var r=this.allocVector3(),n=this.rowOfMatrix3(e,0),o=this.rowOfMatrix3(e,1),l=this.rowOfMatrix3(e,2),c=this.dotVectors3(n,t),h=this.dotVectors3(o,t),d=this.dotVectors3(l,t);return r.setValue(c,h,d),this.freeVector3(n),this.freeVector3(o),this.freeVector3(l),r},transposeMatrix3:function(e){var t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},quaternionToMatrix3:function(q){var e=[],t=q.x(),r=q.y(),n=q.z(),o=q.w(),l=t*t,c=r*r,h=n*n,d=t*r,f=r*n,m=n*t,v=t*o,y=r*o,x=n*o;return e[0]=1-2*(c+h),e[1]=2*(d-x),e[2]=2*(m+y),e[3]=2*(d+x),e[4]=1-2*(h+l),e[5]=2*(f-v),e[6]=2*(m-y),e[7]=2*(f+v),e[8]=1-2*(l+c),e},matrix3ToQuaternion:function(e){var s,t,r,n,o,l=e[0]+e[4]+e[8];l>0?(o=.25*(s=2*Math.sqrt(l+1)),t=(e[7]-e[5])/s,r=(e[2]-e[6])/s,n=(e[3]-e[1])/s):e[0]>e[4]&&e[0]>e[8]?(s=2*Math.sqrt(1+e[0]-e[4]-e[8]),o=(e[7]-e[5])/s,t=.25*s,r=(e[1]+e[3])/s,n=(e[2]+e[6])/s):e[4]>e[8]?(s=2*Math.sqrt(1+e[4]-e[0]-e[8]),o=(e[2]-e[6])/s,t=(e[1]+e[3])/s,r=.25*s,n=(e[5]+e[7])/s):(s=2*Math.sqrt(1+e[8]-e[0]-e[4]),o=(e[3]-e[1])/s,t=(e[2]+e[6])/s,r=(e[5]+e[7])/s,n=.25*s);var q=this.allocQuaternion();return q.setX(t),q.setY(r),q.setZ(n),q.setW(o),q}},r.prototype={constructor:e.RigidBody,reset:function(){return this._setTransformFromBone(),this},updateFromBone:function(){return-1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this},updateBone:function(){return 0===this.params.type||-1===this.params.boneIndex||(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone()),this},_init:function(){var e=this.manager,t=this.params,r=this.mesh.skeleton.bones,n=-1===t.boneIndex?new Bone:r[t.boneIndex],o=function(p){switch(p.shapeType){case 0:return new Ammo.btSphereShape(p.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(p.width,p.height,p.depth));case 2:return new Ammo.btCapsuleShape(p.width,p.height);default:throw"unknown shape type "+p.shapeType}}(t),l=0===t.type?0:t.weight,c=e.allocVector3();c.setValue(0,0,0),0!==l&&o.calculateLocalInertia(l,c);var h=e.allocTransform();e.setIdentity(h),e.setOriginFromArray3(h,t.position),e.setBasisFromArray3(h,t.rotation);var d=e.allocThreeVector3(),f=e.allocTransform();e.setIdentity(f),e.setOriginFromThreeVector3(f,n.getWorldPosition(d));var form=e.multiplyTransforms(f,h),m=new Ammo.btDefaultMotionState(form),v=new Ammo.btRigidBodyConstructionInfo(l,m,o,c);v.set_m_friction(t.friction),v.set_m_restitution(t.restitution);var body=new Ammo.btRigidBody(v);0===t.type&&(body.setCollisionFlags(2|body.getCollisionFlags()),body.setActivationState(4)),body.setDamping(t.positionDamping,t.rotationDamping),body.setSleepingThresholds(0,0),this.world.addRigidBody(body,1<<t.groupIndex,t.groupTarget),this.body=body,this.bone=n,this.boneOffsetForm=h,this.boneOffsetFormInverse=e.inverseTransform(h),e.freeVector3(c),e.freeTransform(form),e.freeTransform(f),e.freeThreeVector3(d)},_getBoneTransform:function(){var e=this.manager,p=e.allocThreeVector3(),q=e.allocThreeQuaternion(),s=e.allocThreeVector3();this.bone.matrixWorld.decompose(p,q,s);var tr=e.allocTransform();e.setOriginFromThreeVector3(tr,p),e.setBasisFromThreeQuaternion(tr,q);var form=e.multiplyTransforms(tr,this.boneOffsetForm);return e.freeTransform(tr),e.freeThreeVector3(s),e.freeThreeQuaternion(q),e.freeThreeVector3(p),form},_getWorldTransformForBone:function(){var e=this.manager,tr=this.body.getCenterOfMassTransform();return e.multiplyTransforms(tr,this.boneOffsetFormInverse)},_setTransformFromBone:function(){var e=this.manager,form=this._getBoneTransform();this.body.setCenterOfMassTransform(form),this.body.getMotionState().setWorldTransform(form),e.freeTransform(form)},_setPositionFromBone:function(){var e=this.manager,form=this._getBoneTransform(),tr=e.allocTransform();this.body.getMotionState().getWorldTransform(tr),e.copyOrigin(tr,form),this.body.setCenterOfMassTransform(tr),this.body.getMotionState().setWorldTransform(tr),e.freeTransform(tr),e.freeTransform(form)},_updateBoneRotation:function(){var e=this.manager,tr=this._getWorldTransformForBone(),q=e.getBasis(tr),t=e.allocThreeQuaternion(),r=e.allocThreeQuaternion(),n=e.allocThreeQuaternion();t.set(q.x(),q.y(),q.z(),q.w()),r.setFromRotationMatrix(this.bone.matrixWorld),r.conjugate(),r.multiply(t),n.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(r.multiply(n).normalize()),e.freeThreeQuaternion(t),e.freeThreeQuaternion(r),e.freeThreeQuaternion(n),e.freeQuaternion(q),e.freeTransform(tr)},_updateBonePosition:function(){var e=this.manager,tr=this._getWorldTransformForBone(),t=e.allocThreeVector3(),r=e.getOrigin(tr);t.set(r.x(),r.y(),r.z()),this.bone.parent&&this.bone.parent.worldToLocal(t),this.bone.position.copy(t),e.freeThreeVector3(t),e.freeTransform(tr)}},n.prototype={constructor:n,_init:function(){var e=this.manager,t=this.params,r=this.bodyA,n=this.bodyB,form=e.allocTransform();e.setIdentity(form),e.setOriginFromArray3(form,t.position),e.setBasisFromArray3(form,t.rotation);var o=e.allocTransform(),l=e.allocTransform();r.body.getMotionState().getWorldTransform(o),n.body.getMotionState().getWorldTransform(l);var c=e.inverseTransform(o),h=e.inverseTransform(l),d=e.multiplyTransforms(c,form),f=e.multiplyTransforms(h,form),m=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,d,f,!0),v=e.allocVector3(),y=e.allocVector3(),x=e.allocVector3(),_=e.allocVector3();v.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),y.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),x.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),_.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),m.setLinearLowerLimit(v),m.setLinearUpperLimit(y),m.setAngularLowerLimit(x),m.setAngularUpperLimit(_);for(var i=0;i<3;i++)0!==t.springPosition[i]&&(m.enableSpring(i,!0),m.setStiffness(i,t.springPosition[i]));for(i=0;i<3;i++)0!==t.springRotation[i]&&(m.enableSpring(i+3,!0),m.setStiffness(i+3,t.springRotation[i]));if(void 0!==m.setParam)for(i=0;i<6;i++)m.setParam(2,.475,i);this.world.addConstraint(m,!0),this.constraint=m,e.freeTransform(form),e.freeTransform(o),e.freeTransform(l),e.freeTransform(c),e.freeTransform(h),e.freeTransform(d),e.freeTransform(f),e.freeVector3(v),e.freeVector3(y),e.freeVector3(x),e.freeVector3(_)}},o.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:o,updateMatrixWorld:(l=new Vector3,c=new Quaternion,h=new Vector3,d=new Matrix4,function(e){var t=this.root;if(this.visible){var r=this.physics.bodies;d.copy(t.matrixWorld).decompose(l,c,h).compose(l,c,h.set(1,1,1)).getInverse(d);for(var i=0,n=r.length;i<n;i++){var body=r[i].body,o=this.children[i],tr=body.getCenterOfMassTransform(),f=tr.getOrigin(),m=tr.getRotation();o.position.set(f.x(),f.y(),f.z()).applyMatrix4(d),o.quaternion.setFromRotationMatrix(d).multiply(c.set(m.x(),m.y(),m.z(),m.w()))}}this.matrix.copy(t.matrixWorld).decompose(l,c,h).compose(l,c,h.set(1,1,1)),Object3D.prototype.updateMatrixWorld.call(this,e)}),_init:function(){var e=this.physics.bodies;function t(param){switch(param.shapeType){case 0:return new SphereBufferGeometry(param.width,16,8);case 1:return new BoxBufferGeometry(2*param.width,2*param.height,2*param.depth,8,8,8);case 2:return new r(param.width,param.height,16,8);default:return null}}function r(e,t,r,n){var o=new CylinderBufferGeometry(e,e,t,r,n,!0),l=new Mesh(new SphereBufferGeometry(e,r,n,0,2*Math.PI,0,Math.PI/2)),c=new Mesh(new SphereBufferGeometry(e,r,n,0,2*Math.PI,Math.PI/2,Math.PI/2));return l.position.set(0,t/2,0),c.position.set(0,-t/2,0),l.updateMatrix(),c.updateMatrix(),o.merge(l.geometry,l.matrix),o.merge(c.geometry,c.matrix),o}for(var i=0,n=e.length;i<n;i++){var param=e[i].params;this.add(new Mesh(t(param),this.materials[param.type]))}}}),e}(),MMDAnimationHelper=function(){function e(e){e=e||{},this.meshes=[],this.camera=null,this.cameraTarget=new Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(){},this.sharedPhysics=!1,this.masterPhysics=null}function t(audio,e){e=e||{},this.audio=audio,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==e.delayTime?e.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}function r(e,t){this.mesh=e,this.grants=t||[]}var n;return e.prototype={constructor:e,add:function(object,e){if(e=e||{},object.isSkinnedMesh)this._addMesh(object,e);else if(object.isCamera)this._setupCamera(object,e);else{if("Audio"!==object.type)throw new Error("MMDAnimationHelper.add: accepts only SkinnedMesh or Camera or Audio instance.");this._setupAudio(object,e)}return this.configuration.sync&&this._syncDuration(),this},remove:function(object){if(object.isSkinnedMesh)this._removeMesh(object);else if(object.isCamera)this._clearCamera(object);else{if("Audio"!==object.type)throw new Error("MMDAnimationHelper.remove: accepts only SkinnedMesh or Camera or Audio instance.");this._clearAudio(object)}return this.configuration.sync&&this._syncDuration(),this},update:function(e){null!==this.audioManager&&this.audioManager.control(e);for(var i=0;i<this.meshes.length;i++)this._animateMesh(this.meshes[i],e);return this.sharedPhysics&&this._updateSharedPhysics(e),null!==this.camera&&this._animateCamera(this.camera,e),this},pose:function(e,t,r){!1!==(r=r||{}).resetPose&&e.pose();for(var n=e.skeleton.bones,o=t.bones,l={},i=0,c=n.length;i<c;i++)l[n[i].name]=i;var h=new Vector3,d=new Quaternion;for(i=0,c=o.length;i<c;i++){var f=o[i],m=l[f.name];if(void 0!==m){var v=n[m];v.position.add(h.fromArray(f.translation)),v.quaternion.multiply(d.fromArray(f.quaternion))}}return e.updateMatrixWorld(!0),!1!==r.ik&&this._createCCDIKSolver(e).update(r.saveOriginalBonesBeforeIK),!1!==r.grant&&this.createGrantSolver(e).update(),this},enable:function(e,t){if(void 0===this.enabled[e])throw new Error("MMDAnimationHelper.enable: unknown key "+e);if(this.enabled[e]=t,"physics"===e)for(var i=0,r=this.meshes.length;i<r;i++)this._optimizeIK(this.meshes[i],t);return this},createGrantSolver:function(e){return new r(e,e.geometry.userData.MMD.grants)},_addMesh:function(e,t){if(this.meshes.indexOf(e)>=0)throw new Error("MMDAnimationHelper._addMesh: SkinnedMesh '"+e.name+"' has already been added.");return this.meshes.push(e),this.objects.set(e,{looped:!1}),this._setupMeshAnimation(e,t.animation),!1!==t.physics&&this._setupMeshPhysics(e,t),this},_setupCamera:function(e,t){if(this.camera===e)throw new Error("MMDAnimationHelper._setupCamera: Camera '"+e.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),this.camera=e,e.add(this.cameraTarget),this.objects.set(e,{}),void 0!==t.animation&&this._setupCameraAnimation(e,t.animation),this},_setupAudio:function(audio,e){if(this.audio===audio)throw new Error("MMDAnimationHelper._setupAudio: Audio '"+audio.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=audio,this.audioManager=new t(audio,e),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this},_removeMesh:function(e){for(var t=!1,r=0,i=0,n=this.meshes.length;i<n;i++)this.meshes[i]!==e?this.meshes[r++]=this.meshes[i]:(this.objects.delete(e),t=!0);if(!t)throw new Error("MMDAnimationHelper._removeMesh: SkinnedMesh '"+e.name+"' has not been added yet.");return this.meshes.length=r,this},_clearCamera:function(e){if(e!==this.camera)throw new Error("MMDAnimationHelper._clearCamera: Camera '"+e.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this},_clearAudio:function(audio){if(audio!==this.audio)throw new Error("MMDAnimationHelper._clearAudio: Audio '"+audio.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this},_setupMeshAnimation:function(e,t){var r=this.objects.get(e);if(void 0!==t){var n=Array.isArray(t)?t:[t];r.mixer=new AnimationMixer(e);for(var i=0,o=n.length;i<o;i++)r.mixer.clipAction(n[i]).play();r.mixer.addEventListener("loop",(function(e){var t=e.action._clip.tracks;t.length>0&&".bones"!==t[0].name.slice(0,6)||(r.looped=!0)}))}return r.ikSolver=this._createCCDIKSolver(e),r.grantSolver=this.createGrantSolver(e),this},_setupCameraAnimation:function(e,t){var r=Array.isArray(t)?t:[t],n=this.objects.get(e);n.mixer=new AnimationMixer(e);for(var i=0,o=r.length;i<o;i++)n.mixer.clipAction(r[i]).play()},_setupMeshPhysics:function(e,t){var r=this.objects.get(e);if(void 0===t.world&&this.sharedPhysics){var n=this._getMasterPhysics();null!==n&&(world=n.world)}r.physics=this._createMMDPhysics(e,t),r.mixer&&!1!==t.animationWarmup&&(this._animateMesh(e,0),r.physics.reset()),r.physics.warmup(void 0!==t.warmup?t.warmup:60),this._optimizeIK(e,!0)},_animateMesh:function(e,t){var r=this.objects.get(e),n=r.mixer,o=r.ikSolver,l=r.grantSolver,c=r.physics,h=r.looped;n&&this.enabled.animation&&(this._restoreBones(e),n.update(t),this._saveBones(e),o&&this.enabled.ik&&(e.updateMatrixWorld(!0),o.update()),l&&this.enabled.grant&&l.update()),!0===h&&this.enabled.physics&&(c&&this.configuration.resetPhysicsOnLoop&&c.reset(),r.looped=!1),c&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(e),c.update(t))},_animateCamera:function(e,t){var r=this.objects.get(e).mixer;r&&this.enabled.cameraAnimation&&(r.update(t),e.updateProjectionMatrix(),e.up.set(0,1,0),e.up.applyQuaternion(e.quaternion),e.lookAt(this.cameraTarget.position))},_optimizeIK:function(e,t){for(var r=e.geometry.userData.MMD.iks,n=e.geometry.userData.MMD.bones,i=0,o=r.length;i<o;i++)for(var l=r[i].links,c=0,h=l.length;c<h;c++){var link=l[c];link.enabled=!0!==t||!(n[link.index].rigidBodyType>0)}},_createCCDIKSolver:function(e){if(void 0===CCDIKSolver)throw new Error("MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(e,e.geometry.userData.MMD.iks)},_createMMDPhysics:function(e,t){if(void 0===MMDPhysics)throw new Error("MMDPhysics: Import MMDPhysics.");return new MMDPhysics(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,t)},_syncDuration:function(){for(var e=0,t=this.objects,r=this.meshes,n=this.camera,o=this.audioManager,i=0,l=r.length;i<l;i++){if(void 0!==(d=this.objects.get(r[i]).mixer))for(var c=0;c<d._actions.length;c++){var h=d._actions[c]._clip;t.has(h)||t.set(h,{duration:h.duration}),e=Math.max(e,t.get(h).duration)}}if(null!==n&&void 0!==(d=this.objects.get(n).mixer))for(i=0,l=d._actions.length;i<l;i++){h=d._actions[i]._clip;t.has(h)||t.set(h,{duration:h.duration}),e=Math.max(e,t.get(h).duration)}null!==o&&(e=Math.max(e,t.get(o).duration)),e+=this.configuration.afterglow;for(i=0,l=this.meshes.length;i<l;i++){var d;if(void 0!==(d=this.objects.get(this.meshes[i]).mixer)){c=0;for(var f=d._actions.length;c<f;c++)d._actions[c]._clip.duration=e}}if(null!==n&&void 0!==(d=this.objects.get(n).mixer))for(i=0,l=d._actions.length;i<l;i++)d._actions[i]._clip.duration=e;null!==o&&(o.duration=e)},_updatePropertyMixersBuffer:function(e){for(var t=this.objects.get(e).mixer,r=t._bindings,n=t._accuIndex,i=0,o=r.length;i<o;i++){var l=r[i],c=l.buffer,h=(n+1)*l.valueSize;l.binding.getValue(c,h)}},_saveBones:function(e){var t=this.objects.get(e),r=e.skeleton.bones,n=t.backupBones;void 0===n&&(n=new Float32Array(7*r.length),t.backupBones=n);for(var i=0,o=r.length;i<o;i++){var l=r[i];l.position.toArray(n,7*i),l.quaternion.toArray(n,7*i+3)}},_restoreBones:function(e){var t=this.objects.get(e).backupBones;if(void 0!==t)for(var r=e.skeleton.bones,i=0,n=r.length;i<n;i++){var o=r[i];o.position.fromArray(t,7*i),o.quaternion.fromArray(t,7*i+3)}},_getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var i=0,e=this.meshes.length;i<e;i++){var t=this.meshes[i].physics;if(null!=t)return this.masterPhysics=t,this.masterPhysics}return null},_updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.enabled.physics&&this.sharedPhysics){var t=this._getMasterPhysics();if(null!==t){for(var i=0,r=this.meshes.length;i<r;i++){null!=(p=this.meshes[i].physics)&&p.updateRigidBodies()}t.stepSimulation(e);for(i=0,r=this.meshes.length;i<r;i++){var p;null!=(p=this.meshes[i].physics)&&p.updateBones()}}}}},t.prototype={constructor:t,control:function(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this},_shouldStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&(!(this.currentTime-this.delayTime>this.audioDuration)&&(this.audio.startTime=this.currentTime-this.delayTime,!0))},_shouldStopAudio:function(){return this.audio.isPlaying&&this.currentTime>=this.duration}},r.prototype={constructor:r,update:(n=new Quaternion,function(){for(var e=this.mesh.skeleton.bones,t=this.grants,i=0,r=t.length;i<r;i++){var o=t[i],l=e[o.index],c=e[o.parentIndex];o.isLocal?(o.affectPosition,o.affectRotation):(o.affectPosition,o.affectRotation&&(n.set(0,0,0,1),n.slerp(c.quaternion,o.ratio),l.quaternion.multiply(n)))}return this})},e}(),TimelinerController=function(e,t,r){this._scene=e,this._trackInfo=t,this._onUpdate=r,this._mixer=new AnimationMixer(e),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function OrthographicCamera(e,t,r,n,o,l){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==o?o:.1,this.far=void 0!==l?l:2e3,this.updateProjectionMatrix()}function PerspectiveCamera(e,t,r,n){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function PlaneGeometry(e,t,r,n){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,r,n)),this.mergeVertices()}function PlaneBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var o,l,c=(e=e||1)/2,h=(t=t||1)/2,d=Math.floor(r)||1,f=Math.floor(n)||1,m=d+1,v=f+1,y=e/d,x=t/f,_=[],M=[],w=[],S=[];for(l=0;l<v;l++){var A=l*x-h;for(o=0;o<m;o++){var T=o*y-c;M.push(T,-A,0),w.push(0,0,1),S.push(o/d),S.push(1-l/f)}}for(l=0;l<f;l++)for(o=0;o<d;o++){var a=o+m*l,b=o+m*(l+1),L=o+1+m*(l+1),C=o+1+m*l;_.push(a,b,C),_.push(b,L,C)}this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function cloneUniforms(e){var t={};for(var u in e)for(var p in t[u]={},e[u]){var r=e[u][p];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[u][p]=r.clone():Array.isArray(r)?t[u][p]=r.slice():t[u][p]=r}return t}function mergeUniforms(e){for(var t={},u=0;u<e.length;u++){var r=cloneUniforms(e[u]);for(var p in r)t[p]=r[p]}return t}TimelinerController.prototype={constructor:TimelinerController,init:function(){for(var e=[],t=this._trackInfo,i=0,r=t.length;i!==r;++i){var n=t[i];e.push(this._addTrack(n.type,n.propertyPath,n.initialValue,n.interpolation))}this._clip=new AnimationClip("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(time){this._action.time=time,this._mixer.update(0),this._onUpdate()},setDuration:function(e){this._clip.duration=e},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(e){return this._tracks[e].times},setKeyframe:function(e,time){var track=this._tracks[e],t=track.times,r=Timeliner.binarySearch(t,time),n=track.values,o=track.getValueSize(),l=r*o;if(r<0){l=(r=~r)*o;for(var c=t.length+1,h=n.length+o,i=c-1;i!==r;--i)t[i]=t[i-1];i=h-1;for(var d=l+o-1;i!==d;--i)n[i]=n[i-o]}t[r]=time,this._propRefs[e].getValue(n,l)},delKeyframe:function(e,time){var track=this._tracks[e],t=track.times,r=Timeliner.binarySearch(t,time);if(t.length>1&&r>=0){for(var n=t.length-1,o=track.values,l=track.getValueSize(),c=o.length-l,i=r;i!==n;++i)t[i]=t[i+1];t.pop();for(var h=r*l;h!==c;++h)o[h]=o[h+l];o.length=c}},moveKeyframe:function(e,time,t,r){var track=this._tracks[e],n=track.times,o=Timeliner.binarySearch(n,time);if(o>=0){for(var l=r?n.length:o+1,c=n[o-1]<=time||!r&&time>=n[o+1];o!==l;)n[o++]+=t;c&&this._sort(track)}},serialize:function(){for(var e={duration:this._clip.duration,channels:{}},t=this._channelNames,r=this._tracks,n=e.channels,i=0,o=t.length;i!==o;++i){var l=t[i],track=r[l];n[l]={times:track.times,values:track.values}}return e},deserialize:function(e){var t=this._channelNames,r=this._tracks,n=e.channels;this.setDuration(e.duration);for(var i=0,o=t.length;i!==o;++i){var l=t[i],track=r[l],data=n[l];this._setArray(track.times,data.times),this._setArray(track.values,data.values)}this.setDisplayTime(this._mixer.time)},_sort:function(track){var e=track.times,t=AnimationUtils.getKeyframeOrder(e);this._setArray(e,AnimationUtils.sortedArray(e,1,t));var r=track.values,n=track.getValueSize();this._setArray(r,AnimationUtils.sortedArray(r,n,t))},_setArray:function(e,t){e.length=0,e.push.apply(e,t)},_addTrack:function(e,t,r,n){var track=new e(t,[0],r,n);return track.times=Array.prototype.slice.call(track.times),track.values=Array.prototype.slice.call(track.values),this._channelNames.push(t),this._tracks[t]=track,this._propRefs[t]=new PropertyBinding(this._scene,t),track}},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(source,e){return Object3D.prototype.copy.call(this,source,e),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this.projectionMatrixInverse.copy(source.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(source,e){return Camera.prototype.copy.call(this,source,e),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this},setViewOffset:function(e,t,r,n,o,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,o=r-e,l=r+e,c=n+t,h=n-t;if(null!==this.view&&this.view.enabled){var d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l=(o+=d*this.view.offsetX)+d*this.view.width,h=(c-=f*this.view.offsetY)-f*this.view.height}this.projectionMatrix.makeOrthographic(o,l,c,h,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.zoom=this.zoom,data.object.left=this.left,data.object.right=this.right,data.object.top=this.top,data.object.bottom=this.bottom,data.object.near=this.near,data.object.far=this.far,null!==this.view&&(data.object.view=Object.assign({},this.view)),data}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(source,e){return Camera.prototype.copy.call(this,source,e),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.view=null===source.view?null:Object.assign({},source.view),this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*MathUtils.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*MathUtils.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*MathUtils.RAD2DEG*Math.atan(Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,o,l){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,o=-.5*n,view=this.view;if(null!==this.view&&this.view.enabled){var l=view.fullWidth,c=view.fullHeight;o+=view.offsetX*n/l,t-=view.offsetY*r/c,n*=view.width/l,r*=view.height/c}var h=this.filmOffset;0!==h&&(o+=e*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.fov=this.fov,data.object.zoom=this.zoom,data.object.near=this.near,data.object.far=this.far,data.object.focus=this.focus,data.object.aspect=this.aspect,null!==this.view&&(data.object.view=Object.assign({},this.view)),data.object.filmGauge=this.filmGauge,data.object.filmOffset=this.filmOffset,data}}),PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry,Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:!0,copy:function(source,e){return Object3D.prototype.copy.call(this,source,e),null!==source.background&&(this.background=source.background.clone()),null!==source.environment&&(this.environment=source.environment.clone()),null!==source.fog&&(this.fog=source.fog.clone()),null!==source.overrideMaterial&&(this.overrideMaterial=source.overrideMaterial.clone()),this.autoUpdate=source.autoUpdate,this.matrixAutoUpdate=source.matrixAutoUpdate,this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return null!==this.background&&(data.object.background=this.background.toJSON(meta)),null!==this.environment&&(data.object.environment=this.environment.toJSON(meta)),null!==this.fog&&(data.object.fog=this.fog.toJSON()),data},dispose:function(){this.dispatchEvent({type:"dispose"})}});var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",default_fragment="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",_canvas;function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(e))}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.fragmentShader=source.fragmentShader,this.vertexShader=source.vertexShader,this.uniforms=cloneUniforms(source.uniforms),this.defines=Object.assign({},source.defines),this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.lights=source.lights,this.clipping=source.clipping,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this.extensions=source.extensions,this},ShaderMaterial.prototype.toJSON=function(meta){var data=Material.prototype.toJSON.call(this,meta);for(var e in data.uniforms={},this.uniforms){var t=this.uniforms[e].value;t&&t.isTexture?data.uniforms[e]={type:"t",value:t.toJSON(meta).uuid}:t&&t.isColor?data.uniforms[e]={type:"c",value:t.getHex()}:t&&t.isVector2?data.uniforms[e]={type:"v2",value:t.toArray()}:t&&t.isVector3?data.uniforms[e]={type:"v3",value:t.toArray()}:t&&t.isVector4?data.uniforms[e]={type:"v4",value:t.toArray()}:t&&t.isMatrix3?data.uniforms[e]={type:"m3",value:t.toArray()}:t&&t.isMatrix4?data.uniforms[e]={type:"m4",value:t.toArray()}:data.uniforms[e]={value:t}}Object.keys(this.defines).length>0&&(data.defines=this.defines),data.vertexShader=this.vertexShader,data.fragmentShader=this.fragmentShader;var r={};for(var n in this.extensions)!0===this.extensions[n]&&(r[n]=!0);return Object.keys(r).length>0&&(data.extensions=r),data};var ImageUtils={getDataURL:function(image){var canvas;if("undefined"==typeof HTMLCanvasElement)return image.src;if(image instanceof HTMLCanvasElement)canvas=image;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=image.width,_canvas.height=image.height;var e=_canvas.getContext("2d");image instanceof ImageData?e.putImageData(image,0,0):e.drawImage(image,0,0,image.width,image.height),canvas=_canvas}return canvas.width>2048||canvas.height>2048?canvas.toDataURL("image/jpeg",.6):canvas.toDataURL("image/png")}},textureId=0;function Texture(image,e,t,r,n,o,l,c,h,d){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=void 0!==image?image:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==t?t:ClampToEdgeWrapping,this.wrapT=void 0!==r?r:ClampToEdgeWrapping,this.magFilter=void 0!==n?n:LinearFilter,this.minFilter=void 0!==o?o:LinearMipmapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==l?l:RGBAFormat,this.internalFormat=null,this.type=void 0!==c?c:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==d?d:LinearEncoding,this.version=0,this.onUpdate=null}function WebGLRenderTarget(e,t,r){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),r=r||{},this.texture=new Texture(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.name=source.name,this.image=source.image,this.mipmaps=source.mipmaps.slice(0),this.mapping=source.mapping,this.wrapS=source.wrapS,this.wrapT=source.wrapT,this.magFilter=source.magFilter,this.minFilter=source.minFilter,this.anisotropy=source.anisotropy,this.format=source.format,this.internalFormat=source.internalFormat,this.type=source.type,this.offset.copy(source.offset),this.repeat.copy(source.repeat),this.center.copy(source.center),this.rotation=source.rotation,this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrix.copy(source.matrix),this.generateMipmaps=source.generateMipmaps,this.premultiplyAlpha=source.premultiplyAlpha,this.flipY=source.flipY,this.unpackAlignment=source.unpackAlignment,this.encoding=source.encoding,this},toJSON:function(meta){var e=void 0===meta||"string"==typeof meta;if(!e&&void 0!==meta.textures[this.uuid])return meta.textures[this.uuid];var output={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var image=this.image;if(void 0===image.uuid&&(image.uuid=MathUtils.generateUUID()),!e&&void 0===meta.images[image.uuid]){var t;if(Array.isArray(image)){t=[];for(var i=0,r=image.length;i<r;i++)t.push(ImageUtils.getDataURL(image[i]))}else t=ImageUtils.getDataURL(image);meta.images[image.uuid]={uuid:image.uuid,url:t}}output.image=image.uuid}return e||(meta.textures[this.uuid]=output),output},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.width=source.width,this.height=source.height,this.viewport.copy(source.viewport),this.texture=source.texture.clone(),this.depthBuffer=source.depthBuffer,this.stencilBuffer=source.stencilBuffer,this.depthTexture=source.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var BokehShader={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","\tvec2 aspectcorrect = vec2( 1.0, aspect );","\tfloat viewZ = getViewZ( getDepth( vUv ) );","\tfloat factor = ( focus + viewZ );","\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","\tvec2 dofblur9 = dofblur * 0.9;","\tvec2 dofblur7 = dofblur * 0.7;","\tvec2 dofblur4 = dofblur * 0.4;","\tvec4 col = vec4( 0.0 );","\tcol += texture2D( tColor, vUv.xy );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","\tgl_FragColor = col / 41.0;","\tgl_FragColor.a = 1.0;","}"].join("\n")},BokehShader2={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","\t//pentagonal shape","\tfloat scale = float(rings) - 1.3;","\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","\tvec4  one = vec4( 1.0 );","\tvec4 P = vec4((coords),vec2(scale, scale));","\tvec4 dist = vec4(0.0);","\tfloat inorout = -4.0;","\tdist.x = dot( P, HS0 );","\tdist.y = dot( P, HS1 );","\tdist.z = dot( P, HS2 );","\tdist.w = dot( P, HS3 );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dot( dist, one );","\tdist.x = dot( P, HS4 );","\tdist.y = HS5.w - abs( P.z );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dist.x;","\treturn clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","\t// Depth buffer blur","\tfloat d = 0.0;","\tfloat kernel[9];","\tvec2 offset[9];","\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","\toffset[0] = vec2(-wh.x,-wh.y);","\toffset[1] = vec2( 0.0, -wh.y);","\toffset[2] = vec2( wh.x -wh.y);","\toffset[3] = vec2(-wh.x,  0.0);","\toffset[4] = vec2( 0.0,   0.0);","\toffset[5] = vec2( wh.x,  0.0);","\toffset[6] = vec2(-wh.x, wh.y);","\toffset[7] = vec2( 0.0,  wh.y);","\toffset[8] = vec2( wh.x, wh.y);","\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","\tfor( int i=0; i<9; i++ ) {","\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;","\t\td += tmp * kernel[i];","\t}","\treturn d;","}","vec3 color(vec2 coords,float blur) {","\t//processing the sample","\tvec3 col = vec3(0.0);","\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","\tvec3 lumcoeff = vec3(0.299,0.587,0.114);","\tfloat lum = dot(col.rgb, lumcoeff);","\tfloat thresh = max((lum-threshold)*gain, 0.0);","\treturn col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","\tfloat edge = 0.002*depth; //distance based edge smoothing","\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","\treturn col;","}","float linearize(float depth) {","\treturn -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));","\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","\treturn clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","\tfloat rings2 = float(rings);","\tfloat step = PI*2.0 / float(ringsamples);","\tfloat pw = cos(j*step)*i;","\tfloat ph = sin(j*step)*i;","\tfloat p = 1.0;","\tif (pentagon) {","\t\tp = penta(vec2(pw,ph));","\t}","\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","\treturn 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","\t//scene depth calculation","\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);","\t// Blur depth?","\tif ( depthblur ) {","\t\tdepth = linearize(bdepth(vUv.xy));","\t}","\t//focal plane calculation","\tfloat fDepth = focalDepth;","\tif (shaderFocus) {","\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);","\t}","\t// dof blur factor calculation","\tfloat blur = 0.0;","\tif (manualdof) {","\t\tfloat a = depth-fDepth; // Focal plane","\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF","\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof","\t\tblur = (a>0.0) ? b : c;","\t} else {","\t\tfloat f = focalLength; // focal length in mm","\t\tfloat d = fDepth*1000.0; // focal plane in mm","\t\tfloat o = depth*1000.0; // depth in mm","\t\tfloat a = (o*f)/(o-f);","\t\tfloat b = (d*f)/(d-f);","\t\tfloat c = (d-f)/(d*fstop*CoC);","\t\tblur = abs(a-b)*c;","\t}","\tblur = clamp(blur,0.0,1.0);","\t// calculation of pattern for dithering","\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","\t// getting blur x and y step factor","\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;","\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;","\t// calculation of final color","\tvec3 col = vec3(0.0);","\tif(blur < 0.05) {","\t\t//some optimization thingy","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t} else {","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t\tfloat s = 1.0;","\t\tint ringsamples;","\t\tfor (int i = 1; i <= rings; i++) {","\t\t\t/*unboxstart*/","\t\t\tringsamples = i * samples;","\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {","\t\t\t\tif (j >= ringsamples) break;","\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);","\t\t\t}","\t\t\t/*unboxend*/","\t\t}","\t\tcol /= s; //divide by sample count","\t}","\tif (showFocus) {","\t\tcol = debugFocus(col, blur, depth);","\t}","\tif (vignetting) {","\t\tcol *= vignette();","\t}","\tgl_FragColor.rgb = col;","\tgl_FragColor.a = 1.0;","} "].join("\n")},BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")},CinematicCamera=function(e,t,r,n){PerspectiveCamera.call(this,e,t,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4};var o=BokehDepthShader;this.materialDepth=new ShaderMaterial({uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.materialDepth.uniforms.mNear.value=r,this.materialDepth.uniforms.mFar.value=n,this.setLens(),this.initPostProcessing()};CinematicCamera.prototype=Object.create(PerspectiveCamera.prototype),CinematicCamera.prototype.constructor=CinematicCamera,CinematicCamera.prototype.setLens=function(e,t,r,n){void 0===e&&(e=35),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=e/this.fNumber,this.hyperFocal=e*e/(this.aperture*this.coc)},CinematicCamera.prototype.linearize=function(e){var t=this.far,r=this.near;return-t*r/(e*(t-r)-t)},CinematicCamera.prototype.smoothstep=function(e,t,r){var n=this.saturate((r-e)/(t-e));return n*n*(3-2*n)},CinematicCamera.prototype.saturate=function(e){return Math.max(0,Math.min(1,e))},CinematicCamera.prototype.focusAt=function(e){void 0===e&&(e=20);var t=this.getFocalLength();this.focus=e,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-t)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-t)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},CinematicCamera.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new Scene,this.postprocessing.camera=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var e={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat};this.postprocessing.rtTextureDepth=new WebGLRenderTarget(window.innerWidth,window.innerHeight,e),this.postprocessing.rtTextureColor=new WebGLRenderTarget(window.innerWidth,window.innerHeight,e);var t=BokehShader;this.postprocessing.bokeh_uniforms=UniformsUtils.clone(t.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples,DEPTH_PACKING:1}}),this.postprocessing.quad=new Mesh(new PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},CinematicCamera.prototype.renderCinematic=function(e,t){if(this.postprocessing.enabled){var r=t.getRenderTarget();t.clear(),e.overrideMaterial=null,t.setRenderTarget(this.postprocessing.rtTextureColor),t.clear(),t.render(e,this),e.overrideMaterial=this.materialDepth,t.setRenderTarget(this.postprocessing.rtTextureDepth),t.clear(),t.render(e,this),t.setRenderTarget(null),t.render(this.postprocessing.scene,this.postprocessing.camera),t.setRenderTarget(r)}};var DeviceOrientationControls=function(object){var e=this;this.object=object,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var t,r,n,o,l=function(t){e.deviceOrientation=t},c=function(){e.screenOrientation=window.orientation||0},h=(t=new Vector3(0,0,1),r=new Euler,n=new Quaternion,o=new Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,l,c,h,d){r.set(c,l,-h,"YXZ"),e.setFromEuler(r),e.multiply(o),e.multiply(n.setFromAxisAngle(t,-d))});this.connect=function(){c(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(e){"granted"==e&&(window.addEventListener("orientationchange",c,!1),window.addEventListener("deviceorientation",l,!1))})).catch((function(e){console.error("DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",c,!1),window.addEventListener("deviceorientation",l,!1)),e.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",c,!1),window.removeEventListener("deviceorientation",l,!1),e.enabled=!1},this.update=function(){if(!1!==e.enabled){var t=e.deviceOrientation;if(t){var r=t.alpha?MathUtils.degToRad(t.alpha)+e.alphaOffset:0,n=t.beta?MathUtils.degToRad(t.beta):0,o=t.gamma?MathUtils.degToRad(t.gamma):0,l=e.screenOrientation?MathUtils.degToRad(e.screenOrientation):0;h(e.object.quaternion,r,n,o,l)}}},this.dispose=function(){e.disconnect()},this.connect()};function Raycaster(e,t,r,n){this.ray=new Ray(e,t),this.near=r||0,this.far=n||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,e,t,r){if(!1!==object.visible&&(object.raycast(e,t),!0===r))for(var n=object.children,i=0,o=n.length;i<o;i++)intersectObject(n[i],e,t,!0)}Object.assign(Raycaster.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(object,e,t){var r=t||[];return intersectObject(object,this,r,e),r.sort(ascSort),r},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=e.length;i<o;i++)intersectObject(e[i],this,n,t);return n.sort(ascSort),n}});var DragControls=function(e,t,r){var n=new Plane,o=new Raycaster,l=new Vector2,c=new Vector3,h=new Vector3,d=new Vector3,f=new Matrix4,m=null,v=null,y=this;function x(){r.addEventListener("mousemove",M,!1),r.addEventListener("mousedown",w,!1),r.addEventListener("mouseup",S,!1),r.addEventListener("mouseleave",S,!1),r.addEventListener("touchmove",A,!1),r.addEventListener("touchstart",T,!1),r.addEventListener("touchend",L,!1)}function _(){r.removeEventListener("mousemove",M,!1),r.removeEventListener("mousedown",w,!1),r.removeEventListener("mouseup",S,!1),r.removeEventListener("mouseleave",S,!1),r.removeEventListener("touchmove",A,!1),r.removeEventListener("touchstart",T,!1),r.removeEventListener("touchend",L,!1)}function M(x){x.preventDefault();var rect=r.getBoundingClientRect();if(l.x=(x.clientX-rect.left)/rect.width*2-1,l.y=-(x.clientY-rect.top)/rect.height*2+1,o.setFromCamera(l,t),m&&y.enabled)return o.ray.intersectPlane(n,h)&&m.position.copy(h.sub(c).applyMatrix4(f)),void y.dispatchEvent({type:"drag",object:m});o.setFromCamera(l,t);var _=o.intersectObjects(e,!0);if(_.length>0){var object=_[0].object;n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),d.setFromMatrixPosition(object.matrixWorld)),v!==object&&(y.dispatchEvent({type:"hoveron",object:object}),r.style.cursor="pointer",v=object)}else null!==v&&(y.dispatchEvent({type:"hoveroff",object:v}),r.style.cursor="auto",v=null)}function w(v){v.preventDefault(),o.setFromCamera(l,t);var x=o.intersectObjects(e,!0);x.length>0&&(m=x[0].object,o.ray.intersectPlane(n,h)&&(f.getInverse(m.parent.matrixWorld),c.copy(h).sub(d.setFromMatrixPosition(m.matrixWorld))),r.style.cursor="move",y.dispatchEvent({type:"dragstart",object:m}))}function S(e){e.preventDefault(),m&&(y.dispatchEvent({type:"dragend",object:m}),m=null),r.style.cursor=v?"pointer":"auto"}function A(e){e.preventDefault(),e=e.changedTouches[0];var rect=r.getBoundingClientRect();if(l.x=(e.clientX-rect.left)/rect.width*2-1,l.y=-(e.clientY-rect.top)/rect.height*2+1,o.setFromCamera(l,t),m&&y.enabled)return o.ray.intersectPlane(n,h)&&m.position.copy(h.sub(c).applyMatrix4(f)),void y.dispatchEvent({type:"drag",object:m})}function T(v){v.preventDefault(),v=v.changedTouches[0];var rect=r.getBoundingClientRect();l.x=(v.clientX-rect.left)/rect.width*2-1,l.y=-(v.clientY-rect.top)/rect.height*2+1,o.setFromCamera(l,t);var x=o.intersectObjects(e,!0);x.length>0&&(m=x[0].object,n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),d.setFromMatrixPosition(m.matrixWorld)),o.ray.intersectPlane(n,h)&&(f.getInverse(m.parent.matrixWorld),c.copy(h).sub(d.setFromMatrixPosition(m.matrixWorld))),r.style.cursor="move",y.dispatchEvent({type:"dragstart",object:m}))}function L(e){e.preventDefault(),m&&(y.dispatchEvent({type:"dragend",object:m}),m=null),r.style.cursor="auto"}x(),this.enabled=!0,this.activate=x,this.deactivate=_,this.dispose=function(){_()}};function Spherical(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}DragControls.prototype=Object.create(EventDispatcher.prototype),DragControls.prototype.constructor=DragControls,Object.assign(Spherical.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(MathUtils.clamp(t/this.radius,-1,1))),this}});var FirstPersonControls=function(object,e){void 0===e&&(console.warn('FirstPersonControls: The second parameter "domElement" is now mandatory.'),e=document),this.object=object,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var t,r=0,n=0,o=new Vector3,l=new Spherical,c=new Vector3;function h(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?c.copy(e):c.set(e,t,r),this.object.lookAt(c),_(this),this},this.update=(t=new Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var o=MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(o*this.heightCoef)}else this.autoSpeedFactor=0;var l=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(l+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(l),this.moveLeft&&this.object.translateX(-l),this.moveRight&&this.object.translateX(l),this.moveUp&&this.object.translateY(l),this.moveDown&&this.object.translateY(-l);var c=e*this.lookSpeed;this.activeLook||(c=0);var h=1;this.constrainVertical&&(h=Math.PI/(this.verticalMax-this.verticalMin)),n-=this.mouseX*c,this.lookVertical&&(r-=this.mouseY*c*h),r=Math.max(-85,Math.min(85,r));var d=MathUtils.degToRad(90-r),f=MathUtils.degToRad(n);this.constrainVertical&&(d=MathUtils.mapLinear(d,0,Math.PI,this.verticalMin,this.verticalMax));var m=this.object.position;t.setFromSphericalCoords(1,d,f).add(m),this.object.lookAt(t)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",h,!1),this.domElement.removeEventListener("mousedown",f,!1),this.domElement.removeEventListener("mousemove",d,!1),this.domElement.removeEventListener("mouseup",m,!1),window.removeEventListener("keydown",v,!1),window.removeEventListener("keyup",y,!1)};var d=x(this,this.onMouseMove),f=x(this,this.onMouseDown),m=x(this,this.onMouseUp),v=x(this,this.onKeyDown),y=x(this,this.onKeyUp);function x(e,t){return function(){t.apply(e,arguments)}}function _(e){var t=e.object.quaternion;o.set(0,0,-1).applyQuaternion(t),l.setFromVector3(o),r=90-MathUtils.radToDeg(l.phi),n=MathUtils.radToDeg(l.theta)}this.domElement.addEventListener("contextmenu",h,!1),this.domElement.addEventListener("mousemove",d,!1),this.domElement.addEventListener("mousedown",f,!1),this.domElement.addEventListener("mouseup",m,!1),window.addEventListener("keydown",v,!1),window.addEventListener("keyup",y,!1),this.handleResize(),_(this)},FlyControls=function(object,e){function t(e,t){return function(){t.apply(e,arguments)}}function r(e){e.preventDefault()}void 0===e&&(console.warn('FlyControls: The second parameter "domElement" is now mandatory.'),e=document),this.object=object,this.domElement=e,e&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.tmpQuaternion=new Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new Vector3(0,0,0),this.rotationVector=new Vector3(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),r=t.size[0]/2,n=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-n)/n,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousemove",n,!1),this.domElement.removeEventListener("mouseup",l,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",h,!1)};var n=t(this,this.mousemove),o=t(this,this.mousedown),l=t(this,this.mouseup),c=t(this,this.keydown),h=t(this,this.keyup);this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",n,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",l,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",h,!1),this.updateMovementVector(),this.updateRotationVector()},OrbitControls=function(object,e){var t,r,n,o,l;void 0===e&&console.warn('OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=object,this.domElement=e,this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return x.phi},this.getAzimuthalAngle=function(){return x.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(h),c.update(),v=m.NONE},this.update=(t=new Vector3,r=(new Quaternion).setFromUnitVectors(object.up,new Vector3(0,1,0)),n=r.clone().inverse(),o=new Vector3,l=new Quaternion,function(){var e=c.object.position;return t.copy(e).sub(c.target),t.applyQuaternion(r),x.setFromVector3(t),c.autoRotate&&v===m.NONE&&O(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(x.theta+=_.theta*c.dampingFactor,x.phi+=_.phi*c.dampingFactor):(x.theta+=_.theta,x.phi+=_.phi),x.theta=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,x.theta)),x.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,x.phi)),x.makeSafe(),x.radius*=M,x.radius=Math.max(c.minDistance,Math.min(c.maxDistance,x.radius)),!0===c.enableDamping?c.target.addScaledVector(w,c.dampingFactor):c.target.add(w),t.setFromSpherical(x),t.applyQuaternion(n),e.copy(c.target).add(t),c.object.lookAt(c.target),!0===c.enableDamping?(_.theta*=1-c.dampingFactor,_.phi*=1-c.dampingFactor,w.multiplyScalar(1-c.dampingFactor)):(_.set(0,0,0),w.set(0,0,0)),M=1,!!(S||o.distanceToSquared(c.object.position)>y||8*(1-l.dot(c.object.quaternion))>y)&&(c.dispatchEvent(h),o.copy(c.object.position),l.copy(c.object.quaternion),S=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",oe,!1),c.domElement.removeEventListener("mousedown",Z,!1),c.domElement.removeEventListener("wheel",te,!1),c.domElement.removeEventListener("touchstart",ie,!1),c.domElement.removeEventListener("touchend",ae,!1),c.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",$,!1),document.removeEventListener("mouseup",ee,!1),c.domElement.removeEventListener("keydown",re,!1)};var c=this,h={type:"change"},d={type:"start"},f={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=m.NONE,y=1e-6,x=new Spherical,_=new Spherical,M=1,w=new Vector3,S=!1,A=new Vector2,T=new Vector2,L=new Vector2,C=new Vector2,N=new Vector2,P=new Vector2,F=new Vector2,E=new Vector2,R=new Vector2;function D(){return Math.pow(.95,c.zoomSpeed)}function O(e){_.theta-=e}function I(e){_.phi-=e}var B,U=(B=new Vector3,function(e,t){B.setFromMatrixColumn(t,0),B.multiplyScalar(-e),w.add(B)}),k=function(){var e=new Vector3;return function(t,r){!0===c.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),w.add(e)}}(),V=function(){var e=new Vector3;return function(t,r){var element=c.domElement;if(c.object.isPerspectiveCamera){var n=c.object.position;e.copy(n).sub(c.target);var o=e.length();o*=Math.tan(c.object.fov/2*Math.PI/180),U(2*t*o/element.clientHeight,c.object.matrix),k(2*r*o/element.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(U(t*(c.object.right-c.object.left)/c.object.zoom/element.clientWidth,c.object.matrix),k(r*(c.object.top-c.object.bottom)/c.object.zoom/element.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function G(e){c.object.isPerspectiveCamera?M/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function z(e){c.object.isPerspectiveCamera?M*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function j(e){A.set(e.clientX,e.clientY)}function W(e){C.set(e.clientX,e.clientY)}function H(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,r)}}function X(e){if(1==e.touches.length)C.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);C.set(t,r)}}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);F.set(0,n)}function Q(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,r)}L.subVectors(T,A).multiplyScalar(c.rotateSpeed);var element=c.domElement;O(2*Math.PI*L.x/element.clientHeight),I(2*Math.PI*L.y/element.clientHeight),A.copy(T)}function K(e){if(1==e.touches.length)N.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);N.set(t,r)}P.subVectors(N,C).multiplyScalar(c.panSpeed),V(P.x,P.y),C.copy(N)}function J(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);E.set(0,n),R.set(0,Math.pow(E.y/F.y,c.zoomSpeed)),G(R.y),F.copy(E)}function Z(e){if(!1!==c.enabled){var t;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case MOUSE.DOLLY:if(!1===c.enableZoom)return;!function(e){F.set(e.clientX,e.clientY)}(e),v=m.DOLLY;break;case MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;W(e),v=m.PAN}else{if(!1===c.enableRotate)return;j(e),v=m.ROTATE}break;case MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;j(e),v=m.ROTATE}else{if(!1===c.enablePan)return;W(e),v=m.PAN}break;default:v=m.NONE}v!==m.NONE&&(document.addEventListener("mousemove",$,!1),document.addEventListener("mouseup",ee,!1),c.dispatchEvent(d))}}function $(e){if(!1!==c.enabled)switch(e.preventDefault(),v){case m.ROTATE:if(!1===c.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),L.subVectors(T,A).multiplyScalar(c.rotateSpeed);var element=c.domElement;O(2*Math.PI*L.x/element.clientHeight),I(2*Math.PI*L.y/element.clientHeight),A.copy(T),c.update()}(e);break;case m.DOLLY:if(!1===c.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),R.subVectors(E,F),R.y>0?G(D()):R.y<0&&z(D()),F.copy(E),c.update()}(e);break;case m.PAN:if(!1===c.enablePan)return;!function(e){N.set(e.clientX,e.clientY),P.subVectors(N,C).multiplyScalar(c.panSpeed),V(P.x,P.y),C.copy(N),c.update()}(e)}}function ee(e){!1!==c.enabled&&(document.removeEventListener("mousemove",$,!1),document.removeEventListener("mouseup",ee,!1),c.dispatchEvent(f),v=m.NONE)}function te(e){!1===c.enabled||!1===c.enableZoom||v!==m.NONE&&v!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),c.dispatchEvent(d),function(e){e.deltaY<0?z(D()):e.deltaY>0&&G(D()),c.update()}(e),c.dispatchEvent(f))}function re(e){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(e){var t=!1;switch(e.keyCode){case c.keys.UP:V(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:V(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:V(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT:V(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}(e)}function ie(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case TOUCH.ROTATE:if(!1===c.enableRotate)return;H(e),v=m.TOUCH_ROTATE;break;case TOUCH.PAN:if(!1===c.enablePan)return;X(e),v=m.TOUCH_PAN;break;default:v=m.NONE}break;case 2:switch(c.touches.TWO){case TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&Y(e),c.enablePan&&X(e)}(e),v=m.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&Y(e),c.enableRotate&&H(e)}(e),v=m.TOUCH_DOLLY_ROTATE;break;default:v=m.NONE}break;default:v=m.NONE}v!==m.NONE&&c.dispatchEvent(d)}}function ne(e){if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),v){case m.TOUCH_ROTATE:if(!1===c.enableRotate)return;Q(e),c.update();break;case m.TOUCH_PAN:if(!1===c.enablePan)return;K(e),c.update();break;case m.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&J(e),c.enablePan&&K(e)}(e),c.update();break;case m.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&J(e),c.enableRotate&&Q(e)}(e),c.update();break;default:v=m.NONE}}function ae(e){!1!==c.enabled&&(c.dispatchEvent(f),v=m.NONE)}function oe(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",oe,!1),c.domElement.addEventListener("mousedown",Z,!1),c.domElement.addEventListener("wheel",te,!1),c.domElement.addEventListener("touchstart",ie,!1),c.domElement.addEventListener("touchend",ae,!1),c.domElement.addEventListener("touchmove",ne,!1),c.domElement.addEventListener("keydown",re,!1),-1===c.domElement.tabIndex&&(c.domElement.tabIndex=0),this.update()};OrbitControls.prototype=Object.create(EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls;var MapControls=function(object,e){OrbitControls.call(this,object,e),this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE};MapControls.prototype=Object.create(EventDispatcher.prototype),MapControls.prototype.constructor=MapControls;var PointerLockControls=function(e,t){void 0===t&&(console.warn('PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1;var r,n=this,o={type:"change"},l={type:"lock"},c={type:"unlock"},h=new Euler(0,0,0,"YXZ"),d=Math.PI/2,f=new Vector3;function m(t){if(!1!==n.isLocked){var r=t.movementX||t.mozMovementX||t.webkitMovementX||0,l=t.movementY||t.mozMovementY||t.webkitMovementY||0;h.setFromQuaternion(e.quaternion),h.y-=.002*r,h.x-=.002*l,h.x=Math.max(-d,Math.min(d,h.x)),e.quaternion.setFromEuler(h),n.dispatchEvent(o)}}function v(){document.pointerLockElement===n.domElement?(n.dispatchEvent(l),n.isLocked=!0):(n.dispatchEvent(c),n.isLocked=!1)}function y(){console.error("PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){document.addEventListener("mousemove",m,!1),document.addEventListener("pointerlockchange",v,!1),document.addEventListener("pointerlockerror",y,!1)},this.disconnect=function(){document.removeEventListener("mousemove",m,!1),document.removeEventListener("pointerlockchange",v,!1),document.removeEventListener("pointerlockerror",y,!1)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=(r=new Vector3(0,0,-1),function(t){return t.copy(r).applyQuaternion(e.quaternion)}),this.moveForward=function(t){f.setFromMatrixColumn(e.matrix,0),f.crossVectors(e.up,f),e.position.addScaledVector(f,t)},this.moveRight=function(t){f.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(f,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){document.exitPointerLock()},this.connect()};PointerLockControls.prototype=Object.create(EventDispatcher.prototype),PointerLockControls.prototype.constructor=PointerLockControls;var TrackballControls=function(object,e){void 0===e&&console.warn('TrackballControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var t=this,r=-1,n=0,o=1,l=2,c=3,h=4;this.object=object,this.domElement=e,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.ZOOM,RIGHT:MOUSE.PAN},this.target=new Vector3;var d=new Vector3,f=1,m=r,v=r,y=new Vector3,x=new Vector2,_=new Vector2,M=new Vector3,w=0,S=new Vector2,A=new Vector2,T=0,L=0,C=new Vector2,N=new Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var P={type:"change"},F={type:"start"},E={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var R,D,O,I,B,U,k,V,G,z,j,W=(R=new Vector2,function(e,r){return R.set((e-t.screen.left)/t.screen.width,(r-t.screen.top)/t.screen.height),R}),H=function(){var e=new Vector2;return function(r,n){return e.set((r-.5*t.screen.width-t.screen.left)/(.5*t.screen.width),(t.screen.height+2*(t.screen.top-n))/t.screen.width),e}}();function X(e){!1!==t.enabled&&(window.removeEventListener("keydown",X),v===r&&(e.keyCode!==t.keys[n]||t.noRotate?e.keyCode!==t.keys[o]||t.noZoom?e.keyCode!==t.keys[l]||t.noPan||(v=l):v=o:v=n))}function Y(){!1!==t.enabled&&(v=r,window.addEventListener("keydown",X,!1))}function Q(e){if(!1!==t.enabled){if(e.preventDefault(),e.stopPropagation(),m===r)switch(e.button){case t.mouseButtons.LEFT:m=n;break;case t.mouseButtons.MIDDLE:m=o;break;case t.mouseButtons.RIGHT:m=l;break;default:m=r}var c=v!==r?v:m;c!==n||t.noRotate?c!==o||t.noZoom?c!==l||t.noPan||(C.copy(W(e.pageX,e.pageY)),N.copy(C)):(S.copy(W(e.pageX,e.pageY)),A.copy(S)):(_.copy(H(e.pageX,e.pageY)),x.copy(_)),document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",J,!1),t.dispatchEvent(F)}}function K(e){if(!1!==t.enabled){e.preventDefault(),e.stopPropagation();var c=v!==r?v:m;c!==n||t.noRotate?c!==o||t.noZoom?c!==l||t.noPan||N.copy(W(e.pageX,e.pageY)):A.copy(W(e.pageX,e.pageY)):(x.copy(_),_.copy(H(e.pageX,e.pageY)))}}function J(e){!1!==t.enabled&&(e.preventDefault(),e.stopPropagation(),m=r,document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",J),t.dispatchEvent(E))}function Z(e){if(!1!==t.enabled&&!0!==t.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:S.y-=.025*e.deltaY;break;case 1:S.y-=.01*e.deltaY;break;default:S.y-=25e-5*e.deltaY}t.dispatchEvent(F),t.dispatchEvent(E)}}function $(e){if(!1!==t.enabled){switch(e.preventDefault(),e.touches.length){case 1:m=c,_.copy(H(e.touches[0].pageX,e.touches[0].pageY)),x.copy(_);break;default:m=h;var r=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;L=T=Math.sqrt(r*r+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,l=(e.touches[0].pageY+e.touches[1].pageY)/2;C.copy(W(o,l)),N.copy(C)}t.dispatchEvent(F)}}function ee(e){if(!1!==t.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:x.copy(_),_.copy(H(e.touches[0].pageX,e.touches[0].pageY));break;default:var r=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;L=Math.sqrt(r*r+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,l=(e.touches[0].pageY+e.touches[1].pageY)/2;N.copy(W(o,l))}}function te(e){if(!1!==t.enabled){switch(e.touches.length){case 0:m=r;break;case 1:m=c,_.copy(H(e.touches[0].pageX,e.touches[0].pageY)),x.copy(_)}t.dispatchEvent(E)}}function re(e){!1!==t.enabled&&e.preventDefault()}this.rotateCamera=(O=new Vector3,I=new Quaternion,B=new Vector3,U=new Vector3,k=new Vector3,V=new Vector3,function(){V.set(_.x-x.x,_.y-x.y,0),(D=V.length())?(y.copy(t.object.position).sub(t.target),B.copy(y).normalize(),U.copy(t.object.up).normalize(),k.crossVectors(U,B).normalize(),U.setLength(_.y-x.y),k.setLength(_.x-x.x),V.copy(U.add(k)),O.crossVectors(V,y).normalize(),D*=t.rotateSpeed,I.setFromAxisAngle(O,D),y.applyQuaternion(I),t.object.up.applyQuaternion(I),M.copy(O),w=D):!t.staticMoving&&w&&(w*=Math.sqrt(1-t.dynamicDampingFactor),y.copy(t.object.position).sub(t.target),I.setFromAxisAngle(M,w),y.applyQuaternion(I),t.object.up.applyQuaternion(I)),x.copy(_)}),this.zoomCamera=function(){var e;m===h?(e=T/L,T=L,t.object.isPerspectiveCamera?y.multiplyScalar(e):t.object.isOrthographicCamera?(t.object.zoom*=e,t.object.updateProjectionMatrix()):console.warn("TrackballControls: Unsupported camera type")):(1!==(e=1+(A.y-S.y)*t.zoomSpeed)&&e>0&&(t.object.isPerspectiveCamera?y.multiplyScalar(e):t.object.isOrthographicCamera?(t.object.zoom/=e,t.object.updateProjectionMatrix()):console.warn("TrackballControls: Unsupported camera type")),t.staticMoving?S.copy(A):S.y+=(A.y-S.y)*this.dynamicDampingFactor)},this.panCamera=(G=new Vector2,z=new Vector3,j=new Vector3,function(){if(G.copy(N).sub(C),G.lengthSq()){if(t.object.isOrthographicCamera){var e=(t.object.right-t.object.left)/t.object.zoom/t.domElement.clientWidth,r=(t.object.top-t.object.bottom)/t.object.zoom/t.domElement.clientWidth;G.x*=e,G.y*=r}G.multiplyScalar(y.length()*t.panSpeed),j.copy(y).cross(t.object.up).setLength(G.x),j.add(z.copy(t.object.up).setLength(G.y)),t.object.position.add(j),t.target.add(j),t.staticMoving?C.copy(N):C.add(G.subVectors(N,C).multiplyScalar(t.dynamicDampingFactor))}}),this.checkDistances=function(){t.noZoom&&t.noPan||(y.lengthSq()>t.maxDistance*t.maxDistance&&(t.object.position.addVectors(t.target,y.setLength(t.maxDistance)),S.copy(A)),y.lengthSq()<t.minDistance*t.minDistance&&(t.object.position.addVectors(t.target,y.setLength(t.minDistance)),S.copy(A)))},this.update=function(){y.subVectors(t.object.position,t.target),t.noRotate||t.rotateCamera(),t.noZoom||t.zoomCamera(),t.noPan||t.panCamera(),t.object.position.addVectors(t.target,y),t.object.isPerspectiveCamera?(t.checkDistances(),t.object.lookAt(t.target),d.distanceToSquared(t.object.position)>1e-6&&(t.dispatchEvent(P),d.copy(t.object.position))):t.object.isOrthographicCamera?(t.object.lookAt(t.target),(d.distanceToSquared(t.object.position)>1e-6||f!==t.object.zoom)&&(t.dispatchEvent(P),d.copy(t.object.position),f=t.object.zoom)):console.warn("TrackballControls: Unsupported camera type")},this.reset=function(){m=r,v=r,t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.up.copy(t.up0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),y.subVectors(t.object.position,t.target),t.object.lookAt(t.target),t.dispatchEvent(P),d.copy(t.object.position),f=t.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",re,!1),this.domElement.removeEventListener("mousedown",Q,!1),this.domElement.removeEventListener("wheel",Z,!1),this.domElement.removeEventListener("touchstart",$,!1),this.domElement.removeEventListener("touchend",te,!1),this.domElement.removeEventListener("touchmove",ee,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",J,!1),window.removeEventListener("keydown",X,!1),window.removeEventListener("keyup",Y,!1)},this.domElement.addEventListener("contextmenu",re,!1),this.domElement.addEventListener("mousedown",Q,!1),this.domElement.addEventListener("wheel",Z,!1),this.domElement.addEventListener("touchstart",$,!1),this.domElement.addEventListener("touchend",te,!1),this.domElement.addEventListener("touchmove",ee,!1),window.addEventListener("keydown",X,!1),window.addEventListener("keyup",Y,!1),this.handleResize(),this.update()};function PolyhedronGeometry(e,t,r,n){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,r,n)),this.mergeVertices()}function PolyhedronBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var o=[],l=[];function c(a,b,e,t){var i,r,n=Math.pow(2,t),o=[];for(i=0;i<=n;i++){o[i]=[];var l=a.clone().lerp(e,i/n),c=b.clone().lerp(e,i/n),d=n-i;for(r=0;r<=d;r++)o[i][r]=0===r&&i===n?l:l.clone().lerp(c,r/d)}for(i=0;i<n;i++)for(r=0;r<2*(n-i)-1;r++){var f=Math.floor(r/2);r%2==0?(h(o[i][f+1]),h(o[i+1][f]),h(o[i][f])):(h(o[i][f+1]),h(o[i+1][f+1]),h(o[i+1][f]))}}function h(e){o.push(e.x,e.y,e.z)}function d(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function f(e,t,r,n){n<0&&1===e.x&&(l[t]=e.x-1),0===r.x&&0===r.z&&(l[t]=n/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}!function(e){for(var a=new Vector3,b=new Vector3,r=new Vector3,i=0;i<t.length;i+=3)d(t[i+0],a),d(t[i+1],b),d(t[i+2],r),c(a,b,r,e)}(n=n||0),function(e){for(var t=new Vector3,i=0;i<o.length;i+=3)t.x=o[i+0],t.y=o[i+1],t.z=o[i+2],t.normalize().multiplyScalar(e),o[i+0]=t.x,o[i+1]=t.y,o[i+2]=t.z}(r),function(){for(var e=new Vector3,i=0;i<o.length;i+=3){e.x=o[i+0],e.y=o[i+1],e.z=o[i+2];var u=m(e)/2/Math.PI+.5,t=(r=e,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);l.push(u,1-t)}var r;(function(){for(var a=new Vector3,b=new Vector3,e=new Vector3,t=new Vector3,r=new Vector2,n=new Vector2,c=new Vector2,i=0,h=0;i<o.length;i+=9,h+=6){a.set(o[i+0],o[i+1],o[i+2]),b.set(o[i+3],o[i+4],o[i+5]),e.set(o[i+6],o[i+7],o[i+8]),r.set(l[h+0],l[h+1]),n.set(l[h+2],l[h+3]),c.set(l[h+4],l[h+5]),t.copy(a).add(b).add(e).divideScalar(3);var d=m(t);f(r,h+0,a,d),f(n,h+2,b,d),f(c,h+4,e,d)}})(),function(){for(var i=0;i<l.length;i+=6){var e=l[i+0],t=l[i+2],r=l[i+4],n=Math.max(e,t,r),o=Math.min(e,t,r);n>.9&&o<.1&&(e<.2&&(l[i+0]+=1),t<.2&&(l[i+2]+=1),r<.2&&(l[i+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(o.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}function OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TorusGeometry(e,t,r,n,o){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:o},this.fromBufferGeometry(new TorusBufferGeometry(e,t,r,n,o)),this.mergeVertices()}function TorusBufferGeometry(e,t,r,n,o){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:o},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,o=o||2*Math.PI;var l,i,c=[],h=[],d=[],f=[],m=new Vector3,v=new Vector3,y=new Vector3;for(l=0;l<=r;l++)for(i=0;i<=n;i++){var u=i/n*o,x=l/r*Math.PI*2;v.x=(e+t*Math.cos(x))*Math.cos(u),v.y=(e+t*Math.cos(x))*Math.sin(u),v.z=t*Math.sin(x),h.push(v.x,v.y,v.z),m.x=e*Math.cos(u),m.y=e*Math.sin(u),y.subVectors(v,m).normalize(),d.push(y.x,y.y,y.z),f.push(i/n),f.push(l/r)}for(l=1;l<=r;l++)for(i=1;i<=n;i++){var a=(n+1)*l+i-1,b=(n+1)*(l-1)+i-1,_=(n+1)*(l-1)+i,M=(n+1)*l+i;c.push(a,b,M),c.push(b,_,M)}this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}TrackballControls.prototype=Object.create(EventDispatcher.prototype),TrackballControls.prototype.constructor=TrackballControls,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var TransformControls=function(e,t){void 0===t&&(console.warn('TransformControls: The second parameter "domElement" is now mandatory.'),t=document),Object3D.call(this),this.visible=!1,this.domElement=t;var r=new TransformControlsGizmo;this.add(r);var n=new TransformControlsPlane;this.add(n);var o=this;X("camera",e),X("object",void 0),X("enabled",!0),X("axis",null),X("mode","translate"),X("translationSnap",null),X("rotationSnap",null),X("scaleSnap",null),X("space","world"),X("size",1),X("dragging",!1),X("showX",!0),X("showY",!0),X("showZ",!0);var l={type:"change"},c={type:"mouseDown"},h={type:"mouseUp",mode:o.mode},d={type:"objectChange"},f=new Raycaster,m=new Vector3,v=new Vector3,y=new Quaternion,x={X:new Vector3(1,0,0),Y:new Vector3(0,1,0),Z:new Vector3(0,0,1)},_=new Vector3,M=new Vector3,w=new Vector3,S=new Vector3,A=new Vector3,T=new Vector3,L=0,C=new Vector3,N=new Quaternion,P=new Vector3,F=new Vector3,E=new Quaternion,R=new Quaternion,D=new Vector3,O=new Vector3,I=new Quaternion,B=new Vector3,U=new Vector3,k=new Quaternion,V=new Quaternion,G=new Vector3,z=new Vector3,j=new Vector3,W=new Quaternion,H=new Vector3;function X(e,t){var c=t;Object.defineProperty(o,e,{get:function(){return void 0!==c?c:t},set:function(t){c!==t&&(c=t,n[e]=t,r[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent(l))}}),o[e]=t,n[e]=t,r[e]=t}function Y(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var r=e.changedTouches?e.changedTouches[0]:e,rect=t.getBoundingClientRect();return{x:(r.clientX-rect.left)/rect.width*2-1,y:-(r.clientY-rect.top)/rect.height*2+1,button:e.button}}function Q(e){o.enabled&&o.pointerHover(Y(e))}function K(e){o.enabled&&(document.addEventListener("mousemove",J,!1),o.pointerHover(Y(e)),o.pointerDown(Y(e)))}function J(e){o.enabled&&o.pointerMove(Y(e))}function Z(e){o.enabled&&(document.removeEventListener("mousemove",J,!1),o.pointerUp(Y(e)))}X("worldPosition",U),X("worldPositionStart",O),X("worldQuaternion",k),X("worldQuaternionStart",I),X("cameraPosition",C),X("cameraQuaternion",N),X("pointStart",_),X("pointEnd",M),X("rotationAxis",S),X("rotationAngle",L),X("eye",z),t.addEventListener("mousedown",K,!1),t.addEventListener("touchstart",K,!1),t.addEventListener("mousemove",Q,!1),t.addEventListener("touchmove",Q,!1),t.addEventListener("touchmove",J,!1),document.addEventListener("mouseup",Z,!1),t.addEventListener("touchend",Z,!1),t.addEventListener("touchcancel",Z,!1),t.addEventListener("touchleave",Z,!1),this.dispose=function(){t.removeEventListener("mousedown",K),t.removeEventListener("touchstart",K),t.removeEventListener("mousemove",Q),document.removeEventListener("mousemove",J),t.removeEventListener("touchmove",Q),t.removeEventListener("touchmove",J),document.removeEventListener("mouseup",Z),t.removeEventListener("touchend",Z),t.removeEventListener("touchcancel",Z),t.removeEventListener("touchleave",Z),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(object){return this.object=object,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(F,E,D),this.object.matrixWorld.decompose(U,k,G),R.copy(E).inverse(),V.copy(k).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(C,N,P),z.copy(C).sub(U).normalize(),Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){f.setFromCamera(e,this.camera);var t=f.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){f.setFromCamera(e,this.camera);var t=f.intersectObjects([n],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var o=this.rotationSnap;"X"===this.axis&&o&&(this.object.rotation.x=Math.round(this.object.rotation.x/o)*o),"Y"===this.axis&&o&&(this.object.rotation.y=Math.round(this.object.rotation.y/o)*o),"Z"===this.axis&&o&&(this.object.rotation.z=Math.round(this.object.rotation.z/o)*o)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),j.copy(this.object.position),W.copy(this.object.quaternion),H.copy(this.object.scale),this.object.matrixWorld.decompose(O,I,B),_.copy(t.point).sub(O)}this.dragging=!0,c.mode=this.mode,this.dispatchEvent(c)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,object=this.object,o=this.space;if("scale"===r?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==object&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){f.setFromCamera(e,this.camera);var c=f.intersectObjects([n],!0)[0]||!1;if(!1!==c){if(M.copy(c.point).sub(O),"translate"===r)w.copy(M).sub(_),"local"===o&&"XYZ"!==t&&w.applyQuaternion(V),-1===t.indexOf("X")&&(w.x=0),-1===t.indexOf("Y")&&(w.y=0),-1===t.indexOf("Z")&&(w.z=0),"local"===o&&"XYZ"!==t?w.applyQuaternion(W).divide(D):w.applyQuaternion(R).divide(D),object.position.copy(w).add(j),this.translationSnap&&("local"===o&&(object.position.applyQuaternion(y.copy(W).inverse()),-1!==t.search("X")&&(object.position.x=Math.round(object.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(object.position.y=Math.round(object.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(object.position.z=Math.round(object.position.z/this.translationSnap)*this.translationSnap),object.position.applyQuaternion(W)),"world"===o&&(object.parent&&object.position.add(m.setFromMatrixPosition(object.parent.matrixWorld)),-1!==t.search("X")&&(object.position.x=Math.round(object.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(object.position.y=Math.round(object.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(object.position.z=Math.round(object.position.z/this.translationSnap)*this.translationSnap),object.parent&&object.position.sub(m.setFromMatrixPosition(object.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var h=M.length()/_.length();M.dot(_)<0&&(h*=-1),v.set(h,h,h)}else m.copy(_),v.copy(M),m.applyQuaternion(V),v.applyQuaternion(V),v.divide(m),-1===t.search("X")&&(v.x=1),-1===t.search("Y")&&(v.y=1),-1===t.search("Z")&&(v.z=1);object.scale.copy(H).multiply(v),this.scaleSnap&&(-1!==t.search("X")&&(object.scale.x=Math.round(object.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(object.scale.y=Math.round(object.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(object.scale.z=Math.round(object.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){w.copy(M).sub(_);var C=20/U.distanceTo(m.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(S.copy(z),L=M.angleTo(_),A.copy(_).normalize(),T.copy(M).normalize(),L*=T.cross(A).dot(z)<0?1:-1):"XYZE"===t?(S.copy(w).cross(z).normalize(),L=w.dot(m.copy(S).cross(this.eye))*C):"X"!==t&&"Y"!==t&&"Z"!==t||(S.copy(x[t]),m.copy(x[t]),"local"===o&&m.applyQuaternion(k),L=w.dot(m.cross(z).normalize())*C),this.rotationSnap&&(L=Math.round(L/this.rotationSnap)*this.rotationSnap),this.rotationAngle=L,"local"===o&&"E"!==t&&"XYZE"!==t?(object.quaternion.copy(W),object.quaternion.multiply(y.setFromAxisAngle(S,L)).normalize()):(S.applyQuaternion(R),object.quaternion.copy(y.setFromAxisAngle(S,L)),object.quaternion.multiply(W).normalize())}this.dispatchEvent(l),this.dispatchEvent(d)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(h.mode=this.mode,this.dispatchEvent(h)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return o.mode},this.setMode=function(e){o.mode=e},this.setTranslationSnap=function(e){o.translationSnap=e},this.setRotationSnap=function(e){o.rotationSnap=e},this.setScaleSnap=function(e){o.scaleSnap=e},this.setSize=function(e){o.size=e},this.setSpace=function(e){o.space=e},this.update=function(){console.warn("TransformControls: update function has no more functionality and therefore has been deprecated.")}};TransformControls.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:TransformControls,isTransformControls:!0});var TransformControlsGizmo=function(){Object3D.call(this),this.type="TransformControlsGizmo";var e=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:DoubleSide,fog:!1}),t=new LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var o=e.clone();o.color.set(16711680);var l=e.clone();l.color.set(65280);var c=e.clone();c.color.set(255);var h=e.clone();h.opacity=.25;var d=h.clone();d.color.set(16776960);var f=h.clone();f.color.set(65535);var m=h.clone();m.color.set(16711935),e.clone().color.set(16776960);var v=t.clone();v.color.set(16711680);var y=t.clone();y.color.set(65280);var x=t.clone();x.color.set(255);var _=t.clone();_.color.set(65535);var M=t.clone();M.color.set(16711935);var w=t.clone();w.color.set(16776960);var S=t.clone();S.color.set(7895160);var A=w.clone();A.opacity=.25;var T=new CylinderBufferGeometry(0,.05,.2,12,1,!1),L=new BoxBufferGeometry(.125,.125,.125),C=new BufferGeometry;C.setAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));var N,P=function(e,t){for(var r=new BufferGeometry,n=[],i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.setAttribute("position",new Float32BufferAttribute(n,3)),r},F={X:[[new Mesh(T,o),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Mesh(T,o),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Line(C,v)]],Y:[[new Mesh(T,l),[0,1,0],null,null,"fwd"],[new Mesh(T,l),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Line(C,y),null,[0,0,Math.PI/2]]],Z:[[new Mesh(T,c),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Mesh(T,c),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Line(C,x),null,[0,-Math.PI/2,0]]],XYZ:[[new Mesh(new OctahedronBufferGeometry(.1,0),h.clone()),[0,0,0],[0,0,0]]],XY:[[new Mesh(new PlaneBufferGeometry(.295,.295),d.clone()),[.15,.15,0]],[new Line(C,w),[.18,.3,0],null,[.125,1,1]],[new Line(C,w),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(new PlaneBufferGeometry(.295,.295),f.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Line(C,_),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Line(C,_),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(new PlaneBufferGeometry(.295,.295),m.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Line(C,M),[.18,0,.3],null,[.125,1,1]],[new Line(C,M),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},E={X:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronBufferGeometry(.2,0),r)]],XY:[[new Mesh(new PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new Mesh(new PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Mesh(new PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},R={START:[[new Mesh(new OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new Mesh(new OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new Line((N=new BufferGeometry,N.setAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),N),n),null,null,null,"helper"]],X:[[new Line(C,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(C,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(C,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={X:[[new Line(P(1,.5),v)],[new Mesh(new OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[1,3,1]]],Y:[[new Line(P(1,.5),y),null,[0,0,-Math.PI/2]],[new Mesh(new OctahedronBufferGeometry(.04,0),l),[0,0,.99],null,[3,1,1]]],Z:[[new Line(P(1,.5),x),null,[0,Math.PI/2,0]],[new Mesh(new OctahedronBufferGeometry(.04,0),c),[.99,0,0],null,[1,3,1]]],E:[[new Line(P(1.25,1),A),null,[0,Math.PI/2,0]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),A),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),A),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),A),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),A),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Line(P(1,1),S),null,[0,Math.PI/2,0]]]},O={AXIS:[[new Line(C,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},I={X:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new Mesh(new SphereBufferGeometry(.7,10,8),r)]]},B={X:[[new Mesh(L,o),[.8,0,0],[0,0,-Math.PI/2]],[new Line(C,v),null,null,[.8,1,1]]],Y:[[new Mesh(L,l),[0,.8,0]],[new Line(C,y),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Mesh(L,c),[0,0,.8],[Math.PI/2,0,0]],[new Line(C,x),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Mesh(L,d),[.85,.85,0],null,[2,2,.2]],[new Line(C,w),[.855,.98,0],null,[.125,1,1]],[new Line(C,w),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(L,f),[0,.85,.85],null,[.2,2,2]],[new Line(C,_),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Line(C,_),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(L,m),[.85,0,.85],null,[2,.2,2]],[new Line(C,M),[.855,0,.98],null,[.125,1,1]],[new Line(C,M),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),h.clone()),[1.1,0,0]]],XYZY:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),h.clone()),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),h.clone()),[0,0,1.1]]]},U={X:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Mesh(L,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Mesh(L,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Mesh(L,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},k={X:[[new Line(C,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(C,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(C,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V=function(e){var t=new Object3D;for(var r in e)for(var i=e[r].length;i--;){var object=e[r][i][0].clone(),n=e[r][i][1],o=e[r][i][2],l=e[r][i][3],c=e[r][i][4];object.name=r,object.tag=c,n&&object.position.set(n[0],n[1],n[2]),o&&object.rotation.set(o[0],o[1],o[2]),l&&object.scale.set(l[0],l[1],l[2]),object.updateMatrix();var h=object.geometry.clone();h.applyMatrix4(object.matrix),object.geometry=h,object.renderOrder=1/0,object.position.set(0,0,0),object.rotation.set(0,0,0),object.scale.set(1,1,1),t.add(object)}return t},G=new Vector3(0,0,0),z=new Euler,j=new Vector3(0,1,0),W=new Vector3(0,0,0),H=new Matrix4,X=new Quaternion,Y=new Quaternion,Q=new Quaternion,K=new Vector3(1,0,0),J=new Vector3(0,1,0),Z=new Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(F)),this.add(this.gizmo.rotate=V(D)),this.add(this.gizmo.scale=V(B)),this.add(this.picker.translate=V(E)),this.add(this.picker.rotate=V(I)),this.add(this.picker.scale=V(U)),this.add(this.helper.translate=V(R)),this.add(this.helper.rotate=V(O)),this.add(this.helper.scale=V(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:Q;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<r.length;i++){var n=r[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(j.copy(K).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(j.copy(J).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(j.copy(Z).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(j.copy(Z).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(j.copy(K).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(j.copy(J).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(j.copy(K).applyQuaternion(t).dot(this.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(j.copy(J).applyQuaternion(t).dot(this.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(j.copy(Z).applyQuaternion(t).dot(this.eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(Y.copy(t),j.copy(this.eye).applyQuaternion(X.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(H.lookAt(this.eye,W,J)),"X"===n.name&&(X.setFromAxisAngle(K,Math.atan2(-j.y,j.z)),X.multiplyQuaternions(Y,X),n.quaternion.copy(X)),"Y"===n.name&&(X.setFromAxisAngle(J,Math.atan2(j.x,j.z)),X.multiplyQuaternions(Y,X),n.quaternion.copy(X)),"Z"===n.name&&(X.setFromAxisAngle(Z,Math.atan2(j.y,j.x)),X.multiplyQuaternions(Y,X),n.quaternion.copy(X)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis||this.axis.split("").some((function(a){return n.name===a}))?(n.material.opacity=1,n.material.color.lerp(new Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(X.setFromEuler(z.set(0,0,0)),n.quaternion.copy(t).multiply(X),Math.abs(j.copy(K).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(X.setFromEuler(z.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(X),Math.abs(j.copy(J).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(X.setFromEuler(z.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(X),Math.abs(j.copy(Z).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(X.setFromEuler(z.set(0,Math.PI/2,0)),j.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(H.lookAt(W,j,J)),n.quaternion.multiply(X),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),G.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),G.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(G),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}Object3D.prototype.updateMatrixWorld.call(this)}};TransformControlsGizmo.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:TransformControlsGizmo,isTransformControlsGizmo:!0});var TransformControlsPlane=function(){Mesh.call(this,new PlaneBufferGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new Vector3(1,0,0),t=new Vector3(0,1,0),r=new Vector3(0,0,1),n=new Vector3,o=new Vector3,l=new Vector3,c=new Matrix4,h=new Quaternion;this.updateMatrixWorld=function(){var d=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(d="local"),e.set(1,0,0).applyQuaternion("local"===d?this.worldQuaternion:h),t.set(0,1,0).applyQuaternion("local"===d?this.worldQuaternion:h),r.set(0,0,1).applyQuaternion("local"===d?this.worldQuaternion:h),l.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":l.copy(this.eye).cross(e),o.copy(e).cross(l);break;case"Y":l.copy(this.eye).cross(t),o.copy(t).cross(l);break;case"Z":l.copy(this.eye).cross(r),o.copy(r).cross(l);break;case"XY":o.copy(r);break;case"YZ":o.copy(e);break;case"XZ":l.copy(r),o.copy(t);break;case"XYZ":case"E":o.set(0,0,0)}break;case"rotate":default:o.set(0,0,0)}0===o.length()?this.quaternion.copy(this.cameraQuaternion):(c.lookAt(n.set(0,0,0),o,l),this.quaternion.setFromRotationMatrix(c)),Object3D.prototype.updateMatrixWorld.call(this)}};function Curve(){this.type="Curve",this.arcLengthDivisions=200}function GrannyKnot(){Curve.call(this)}function HeartCurve(e){Curve.call(this),this.scale=void 0===e?5:e}function VivianiCurve(e){Curve.call(this),this.scale=void 0===e?70:e}function KnotCurve(){Curve.call(this)}function HelixCurve(){Curve.call(this)}function TrefoilKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function TorusKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function CinquefoilKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function TrefoilPolynomialKnot(e){Curve.call(this),this.scale=void 0===e?10:e}TransformControlsPlane.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:TransformControlsPlane,isTransformControlsPlane:!0}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(u,e){var t=this.getUtoTmapping(u);return this.getPoint(t,e)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,p,r=[],n=this.getPoint(0),o=0;for(r.push(0),p=1;p<=e;p++)o+=(t=this.getPoint(p/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(u,e){var t,r=this.getLengths(),i=0,n=r.length;t=e||u*r[n-1];for(var o,l=0,c=n-1;l<=c;)if((o=r[i=Math.floor(l+(c-l)/2)]-t)<0)l=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(r[i=c]===t)return i/(n-1);var h=r[i];return(i+(t-h)/(r[i+1]-h))/(n-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(u){var e=this.getUtoTmapping(u);return this.getTangent(e)},computeFrenetFrames:function(e,t){var i,u,r,n=new Vector3,o=[],l=[],c=[],h=new Vector3,d=new Matrix4;for(i=0;i<=e;i++)u=i/e,o[i]=this.getTangentAt(u),o[i].normalize();l[0]=new Vector3,c[0]=new Vector3;var f=Number.MAX_VALUE,m=Math.abs(o[0].x),v=Math.abs(o[0].y),y=Math.abs(o[0].z);for(m<=f&&(f=m,n.set(1,0,0)),v<=f&&(f=v,n.set(0,1,0)),y<=f&&n.set(0,0,1),h.crossVectors(o[0],n).normalize(),l[0].crossVectors(o[0],h),c[0].crossVectors(o[0],l[0]),i=1;i<=e;i++)l[i]=l[i-1].clone(),c[i]=c[i-1].clone(),h.crossVectors(o[i-1],o[i]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(MathUtils.clamp(o[i-1].dot(o[i]),-1,1)),l[i].applyMatrix4(d.makeRotationAxis(h,r))),c[i].crossVectors(o[i],l[i]);if(!0===t)for(r=Math.acos(MathUtils.clamp(l[0].dot(l[e]),-1,1)),r/=e,o[0].dot(h.crossVectors(l[0],l[e]))>0&&(r=-r),i=1;i<=e;i++)l[i].applyMatrix4(d.makeRotationAxis(o[i],r*i)),c[i].crossVectors(o[i],l[i]);return{tangents:o,normals:l,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.arcLengthDivisions=source.arcLengthDivisions,this},toJSON:function(){var data={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return data.arcLengthDivisions=this.arcLengthDivisions,data.type=this.type,data},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),GrannyKnot.prototype=Object.create(Curve.prototype),GrannyKnot.prototype.constructor=GrannyKnot,GrannyKnot.prototype.getPoint=function(e,t){var r=t||new Vector3;e=2*Math.PI*e;var n=-.22*Math.cos(e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),o=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),l=.7*Math.cos(3*e)-.4*Math.sin(3*e);return r.set(n,o,l).multiplyScalar(20)},HeartCurve.prototype=Object.create(Curve.prototype),HeartCurve.prototype.constructor=HeartCurve,HeartCurve.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=16*Math.pow(Math.sin(e),3),o=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return r.set(n,o,0).multiplyScalar(this.scale)},VivianiCurve.prototype=Object.create(Curve.prototype),VivianiCurve.prototype.constructor=VivianiCurve,VivianiCurve.prototype.getPoint=function(e,t){var r=t||new Vector3;e=4*e*Math.PI;var a=this.scale/2,n=a*(1+Math.cos(e)),o=a*Math.sin(e),l=2*a*Math.sin(e/2);return r.set(n,o,l)},KnotCurve.prototype=Object.create(Curve.prototype),KnotCurve.prototype.constructor=KnotCurve,KnotCurve.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=50*Math.sin(e),o=Math.cos(e)*(10+50*Math.cos(e)),l=Math.sin(e)*(10+50*Math.cos(e));return r.set(n,o,l)},HelixCurve.prototype=Object.create(Curve.prototype),HelixCurve.prototype.constructor=HelixCurve,HelixCurve.prototype.getPoint=function(e,t){var r=t||new Vector3,n=2*Math.PI*e*150/30,o=30*Math.cos(n),l=30*Math.sin(n),c=150*e;return r.set(o,l,c)},TrefoilKnot.prototype=Object.create(Curve.prototype),TrefoilKnot.prototype.constructor=TrefoilKnot,TrefoilKnot.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=(2+Math.cos(3*e))*Math.cos(2*e),o=(2+Math.cos(3*e))*Math.sin(2*e),l=Math.sin(3*e);return r.set(n,o,l).multiplyScalar(this.scale)},TorusKnot.prototype=Object.create(Curve.prototype),TorusKnot.prototype.constructor=TorusKnot,TorusKnot.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=(2+Math.cos(4*e))*Math.cos(3*e),o=(2+Math.cos(4*e))*Math.sin(3*e),l=Math.sin(4*e);return r.set(n,o,l).multiplyScalar(this.scale)},CinquefoilKnot.prototype=Object.create(Curve.prototype),CinquefoilKnot.prototype.constructor=CinquefoilKnot,CinquefoilKnot.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=(2+Math.cos(5*e))*Math.cos(2*e),o=(2+Math.cos(5*e))*Math.sin(2*e),l=Math.sin(5*e);return r.set(n,o,l).multiplyScalar(this.scale)},TrefoilPolynomialKnot.prototype=Object.create(Curve.prototype),TrefoilPolynomialKnot.prototype.constructor=TrefoilPolynomialKnot,TrefoilPolynomialKnot.prototype.getPoint=function(e,t){var r=t||new Vector3;e=4*e-2;var n=Math.pow(e,3)-3*e,o=Math.pow(e,4)-4*e*e,l=.2*Math.pow(e,5)-2*e;return r.set(n,o,l).multiplyScalar(this.scale)};var scaleTo=function(e,t,r){return r*(t-e)+e};function FigureEightPolynomialKnot(e){Curve.call(this),this.scale=void 0===e?1:e}function DecoratedTorusKnot4a(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot4b(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot5a(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot5c(e){Curve.call(this),this.scale=void 0===e?40:e}FigureEightPolynomialKnot.prototype=Object.create(Curve.prototype),FigureEightPolynomialKnot.prototype.constructor=FigureEightPolynomialKnot,FigureEightPolynomialKnot.prototype.getPoint=function(e,t){var r=t||new Vector3,n=.4*(e=scaleTo(-4,4,e))*(e*e-7)*(e*e-10),o=Math.pow(e,4)-13*e*e,l=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return r.set(n,o,l).multiplyScalar(this.scale)},DecoratedTorusKnot4a.prototype=Object.create(Curve.prototype),DecoratedTorusKnot4a.prototype.constructor=DecoratedTorusKnot4a,DecoratedTorusKnot4a.prototype.getPoint=function(e,t){var r=t||new Vector3;e*=2*Math.PI;var n=Math.cos(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),o=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),l=.35*Math.sin(5*e);return r.set(n,o,l).multiplyScalar(this.scale)},DecoratedTorusKnot4b.prototype=Object.create(Curve.prototype),DecoratedTorusKnot4b.prototype.constructor=DecoratedTorusKnot4b,DecoratedTorusKnot4b.prototype.getPoint=function(e,t){var r=t||new Vector3,n=e*Math.PI*2,o=Math.cos(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),l=Math.sin(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),c=.2*Math.sin(9*n);return r.set(o,l,c).multiplyScalar(this.scale)},DecoratedTorusKnot5a.prototype=Object.create(Curve.prototype),DecoratedTorusKnot5a.prototype.constructor=DecoratedTorusKnot5a,DecoratedTorusKnot5a.prototype.getPoint=function(e,t){var r=t||new Vector3,n=e*Math.PI*2,o=Math.cos(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),l=Math.sin(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),c=.2*Math.sin(20*n);return r.set(o,l,c).multiplyScalar(this.scale)},DecoratedTorusKnot5c.prototype=Object.create(Curve.prototype),DecoratedTorusKnot5c.prototype.constructor=DecoratedTorusKnot5c,DecoratedTorusKnot5c.prototype.getPoint=function(e,t){var r=t||new Vector3,n=e*Math.PI*2,o=Math.cos(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),l=Math.sin(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),c=.35*Math.sin(15*n);return r.set(o,l,c).multiplyScalar(this.scale)};var NURBSUtils={findSpan:function(p,u,e){var t=e.length-p-1;if(u>=e[t])return t-1;if(u<=e[p])return p;for(var r=p,n=t,o=Math.floor((r+n)/2);u<e[o]||u>=e[o+1];)u<e[o]?n=o:r=o,o=Math.floor((r+n)/2);return o},calcBasisFunctions:function(span,u,p,e){var t=[],r=[],n=[];t[0]=1;for(var o=1;o<=p;++o){r[o]=u-e[span+1-o],n[o]=e[span+o]-u;for(var l=0,c=0;c<o;++c){var h=n[c+1],d=r[o-c],f=t[c]/(h+d);t[c]=l+h*f,l=d*f}t[o]=l}return t},calcBSplinePoint:function(p,e,t,u){for(var span=this.findSpan(p,u,e),r=this.calcBasisFunctions(span,u,p,e),n=new Vector4(0,0,0,0),o=0;o<=p;++o){var l=t[span-p+o],c=r[o],h=l.w*c;n.x+=l.x*h,n.y+=l.y*h,n.z+=l.z*h,n.w+=l.w*c}return n},calcBasisFunctionDerivatives:function(span,u,p,e,t){for(var r=[],i=0;i<=p;++i)r[i]=0;var n=[];for(i=0;i<=e;++i)n[i]=r.slice(0);var o=[];for(i=0;i<=p;++i)o[i]=r.slice(0);o[0][0]=1;for(var l=r.slice(0),c=r.slice(0),h=1;h<=p;++h){l[h]=u-t[span+1-h],c[h]=t[span+h]-u;for(var d=0,f=0;f<h;++f){var m=c[f+1],v=l[h-f];o[h][f]=m+v;var y=o[f][h-1]/o[h][f];o[f][h]=d+m*y,d=v*y}o[h][h]=d}for(h=0;h<=p;++h)n[0][h]=o[h][p];for(f=0;f<=p;++f){var x=0,_=1,a=[];for(i=0;i<=p;++i)a[i]=r.slice(0);a[0][0]=1;for(var M=1;M<=e;++M){var w=0,S=f-M,A=p-M;f>=M&&(a[_][0]=a[x][0]/o[A+1][S],w=a[_][0]*o[S][A]);var T=f-1<=A?M-1:p-f;for(h=S>=-1?1:-S;h<=T;++h)a[_][h]=(a[x][h]-a[x][h-1])/o[A+1][S+h],w+=a[_][h]*o[S+h][A];f<=A&&(a[_][M]=-a[x][M-1]/o[A+1][f],w+=a[_][M]*o[f][A]),n[M][f]=w;h=x;x=_,_=h}}for(f=p,M=1;M<=e;++M){for(h=0;h<=p;++h)n[M][h]*=f;f*=p-M}return n},calcBSplineDerivatives:function(p,e,t,u,r){for(var n=r<p?r:p,o=[],span=this.findSpan(p,u,e),l=this.calcBasisFunctionDerivatives(span,u,p,n,e),c=[],i=0;i<t.length;++i){var h=(f=t[i].clone()).w;f.x*=h,f.y*=h,f.z*=h,c[i]=f}for(var d=0;d<=n;++d){for(var f=c[span-p].clone().multiplyScalar(l[d][0]),m=1;m<=p;++m)f.add(c[span-p+m].clone().multiplyScalar(l[d][m]));o[d]=f}for(d=n+1;d<=r+1;++d)o[d]=new Vector4(0,0,0);return o},calcKoverI:function(e,i){for(var t=1,r=2;r<=e;++r)t*=r;var n=1;for(r=2;r<=i;++r)n*=r;for(r=2;r<=e-i;++r)n*=r;return t/n},calcRationalCurveDerivatives:function(e){for(var t=e.length,r=[],n=[],i=0;i<t;++i){var o=e[i];r[i]=new Vector3(o.x,o.y,o.z),n[i]=o.w}for(var l=[],c=0;c<t;++c){var h=r[c].clone();for(i=1;i<=c;++i)h.sub(l[c-i].clone().multiplyScalar(this.calcKoverI(c,i)*n[i]));l[c]=h.divideScalar(n[0])}return l},calcNURBSDerivatives:function(p,e,t,u,r){var n=this.calcBSplineDerivatives(p,e,t,u,r);return this.calcRationalCurveDerivatives(n)},calcSurfacePoint:function(p,q,e,t,r,u,n,o){for(var l=this.findSpan(p,u,e),c=this.findSpan(q,n,t),h=this.calcBasisFunctions(l,u,p,e),d=this.calcBasisFunctions(c,n,q,t),f=[],m=0;m<=q;++m){f[m]=new Vector4(0,0,0,0);for(var v=0;v<=p;++v){var y=r[l-p+v][c-q+m].clone(),x=y.w;y.x*=x,y.y*=x,y.z*=x,f[m].add(y.multiplyScalar(h[v]))}}var _=new Vector4(0,0,0,0);for(m=0;m<=q;++m)_.add(f[m].multiplyScalar(d[m]));_.divideScalar(_.w),o.set(_.x,_.y,_.z)}},NURBSCurve=function(e,t,r,n,o){Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=o||this.knots.length-1;for(var i=0;i<r.length;++i){var l=r[i];this.controlPoints[i]=new Vector4(l.x,l.y,l.z,l.w)}};NURBSCurve.prototype=Object.create(Curve.prototype),NURBSCurve.prototype.constructor=NURBSCurve,NURBSCurve.prototype.getPoint=function(e){var u=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),t=NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,u);return 1!=t.w&&t.divideScalar(t.w),new Vector3(t.x,t.y,t.z)},NURBSCurve.prototype.getTangent=function(e){var u=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),t=NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,u,1)[1].clone();return t.normalize(),t};var NURBSSurface=function(e,t,r,n,o){this.degree1=e,this.degree2=t,this.knots1=r,this.knots2=n,this.controlPoints=[];for(var l=r.length-e-1,c=n.length-t-1,i=0;i<l;++i){this.controlPoints[i]=[];for(var h=0;h<c;++h){var d=o[i][h];this.controlPoints[i][h]=new Vector4(d.x,d.y,d.z,d.w)}}};NURBSSurface.prototype={constructor:NURBSSurface,getPoint:function(e,t,r){var u=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),n=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);NURBSUtils.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,u,n,r)}};var _eyeRight=new Matrix4,_eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var r,n,o=e.projectionMatrix.clone(),l=t.eyeSep/2,c=l*t.near/t.focus,h=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom;_eyeLeft.elements[12]=-l,_eyeRight.elements[12]=l,r=-h*t.aspect+c,n=h*t.aspect+c,o.elements[0]=2*t.near/(n-r),o.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(o),r=-h*t.aspect-c,n=h*t.aspect-c,o.elements[0]=2*t.near/(n-r),o.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(o)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}});var AnaglyphEffect=function(e,t,r){this.colorMatrixLeft=(new Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var n=new OrthographicCamera(-1,1,1,-1,0,1),o=new Scene,l=new StereoCamera,c={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var h=new WebGLRenderTarget(t,r,c),d=new WebGLRenderTarget(t,r,c),f=new ShaderMaterial({uniforms:{mapLeft:{value:h.texture},mapRight:{value:d.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),m=new Mesh(new PlaneBufferGeometry(2,2),f);o.add(m),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();h.setSize(t*n,r*n),d.setSize(t*n,r*n)},this.render=function(t,r){var c=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),l.update(r),e.setRenderTarget(h),e.clear(),e.render(t,l.cameraL),e.setRenderTarget(d),e.clear(),e.render(t,l.cameraR),e.setRenderTarget(null),e.render(o,n),e.setRenderTarget(c)},this.dispose=function(){h&&h.dispose(),d&&d.dispose(),m&&m.geometry.dispose(),f&&f.dispose()}},AsciiEffect=function(e,t,r){t=void 0===t?" .:-=+*#%@":t,r||(r={});var n,o,l=r.resolution?r.resolution:.15,c=r.scale?r.scale:1,h=!!r.color&&r.color,d=!!r.alpha&&r.alpha,f=!!r.block&&r.block,m=!!r.invert&&r.invert,v=document.createElement("div");v.style.cursor="default";var y,x,_,M=document.createElement("table");v.appendChild(M),this.setSize=function(t,r){n=t,o=r,e.setSize(t,r),function(){y=Math.round(n*P),x=Math.round(o*P),L.width=y,L.height=x,(_=e.domElement).style.backgroundColor&&(M.rows[0].cells[0].style.backgroundColor=_.style.backgroundColor,M.rows[0].cells[0].style.color=_.style.color);M.cellSpacing=0,M.cellPadding=0;var t=M.style;t.display="inline",t.width=Math.round(y/P*c)+"px",t.height=Math.round(x/P*c)+"px",t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=R+"px",t.fontFamily=A,t.fontSize=F+"px",t.lineHeight=E+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,r){e.render(t,r),function(e,t){C.clearRect(0,0,y,x),C.drawImage(T,0,0,y,x);for(var r=C.getImageData(0,0,y,x).data,n="",o=0;o<x;o+=2){for(var l=0;l<y;l++){var c,v,_=4*(o*y+l),M=r[_],w=r[_+1],S=r[_+2],A=r[_+3];v=(.3*M+.59*w+.11*S)/255,0==A&&(v=1),c=Math.floor((1-v)*(N.length-1)),m&&(c=N.length-c-1);var L=N[c];void 0!==L&&" "!=L||(L="&nbsp;"),n+=h?"<span style='color:rgb("+M+","+w+","+S+");"+(f?"background-color:rgb("+M+","+w+","+S+");":"")+(d?"opacity:"+A/255+";":"")+"'>"+L+"</span>":L}n+="<br/>"}t.innerHTML="<tr><td>"+n+"</td></tr>"}(0,M)},this.domElement=v;var w=" .,:;i1tfLCG08@".split(""),S=" CGO08@".split(""),A="courier new, monospace",T=e.domElement,L=document.createElement("canvas");if(L.getContext){var C=L.getContext("2d");if(C.getImageData){var N=h?S:w;t&&(N=t);var P=.5;P=.25,l&&(P=l);var F=2/P*c,E=2/P*c,R=0;switch(c){case 1:R=-1;break;case 2:case 3:R=-2.1;break;case 4:R=-3.1;break;case 5:R=-4.15}}}},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},OutlineEffect=function(e,t){t=t||{},this.enabled=!0;var r=void 0!==t.defaultThickness?t.defaultThickness:.003,n=(new Color).fromArray(void 0!==t.defaultColor?t.defaultColor:[0,0,0]),o=void 0!==t.defaultAlpha?t.defaultAlpha:1,l=void 0!==t.defaultKeepAlive&&t.defaultKeepAlive,c={},h={},d={},f={outlineThickness:{value:r},outlineColor:{value:n},outlineAlpha:{value:o}},m=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}","void main() {","\t#include <uv_vertex>","\t#include <beginnormal_vertex>","\t#include <morphnormal_vertex>","\t#include <skinbase_vertex>","\t#include <skinnormal_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <displacementmap_vertex>","\t#include <project_vertex>","\tvec3 outlineNormal = - objectNormal;","\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <fog_vertex>","}"].join("\n"),v=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\t#include <clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","\t#include <premultiplied_alpha_fragment>","}"].join("\n");function y(e){var t=function(e){var data=c[e.uuid];return void 0===data&&(data={material:new ShaderMaterial({type:"OutlineEffect",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.displacementmap,f]),vertexShader:m,fragmentShader:v,side:BackSide}),used:!0,keepAlive:l,count:0},c[e.uuid]=data),data.used=!0,data.material}(e);return h[t.uuid]=e,function(e,t){if("invisible"===e.name)return;var r=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,e.toneMapped=t.toneMapped,e.premultipliedAlpha=t.premultipliedAlpha,e.displacementMap=t.displacementMap,void 0!==r?(!1===t.visible?e.visible=!1:e.visible=void 0===r.visible||r.visible,e.transparent=void 0!==r.alpha&&r.alpha<1||t.transparent,void 0!==r.keepAlive&&(c[t.uuid].keepAlive=r.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible);!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1);t.clippingPlanes&&(e.clipping=!0,e.clippingPlanes=t.clippingPlanes,e.clipIntersection=t.clipIntersection,e.clipShadows=t.clipShadows);e.version=t.version}(t,e),t}function x(object){var e=object.geometry,t=!1;return void 0!==object.geometry&&(t=!e.isBufferGeometry||void 0!==e.attributes.normal),!0===object.isMesh&&void 0!==object.material&&!0===t}function _(object){if(!1!==x(object)){if(Array.isArray(object.material))for(var i=0,e=object.material.length;i<e;i++)object.material[i]=y(object.material[i]);else object.material=y(object.material);d[object.uuid]=object.onBeforeRender,object.onBeforeRender=w}}function M(object){if(!1!==x(object)){if(Array.isArray(object.material))for(var i=0,e=object.material.length;i<e;i++)object.material[i]=h[object.material[i].uuid];else object.material=h[object.material.uuid];object.onBeforeRender=d[object.uuid]}}function w(e,t,r,n,o){var l=h[o.uuid];void 0!==l&&function(e,t){var r=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==r&&(void 0!==r.thickness&&(e.uniforms.outlineThickness.value=r.thickness),void 0!==r.color&&e.uniforms.outlineColor.value.fromArray(r.color),void 0!==r.alpha&&(e.uniforms.outlineAlpha.value=r.alpha));t.displacementMap&&(e.uniforms.displacementMap.value=t.displacementMap,e.uniforms.displacementScale.value=t.displacementScale,e.uniforms.displacementBias.value=t.displacementBias)}(o,l)}this.render=function(t,r){var n,o=!1;if(void 0!==arguments[2]&&(console.warn("OutlineEffect.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("OutlineEffect.render(): the forceClear argument has been removed. Use .clear() instead."),o=arguments[3]),void 0!==n&&e.setRenderTarget(n),o&&e.clear(),!1!==this.enabled){var l=e.autoClear;e.autoClear=this.autoClear,e.render(t,r),e.autoClear=l,this.renderOutline(t,r)}else e.render(t,r)},this.renderOutline=function(t,r){var n=e.autoClear,o=t.autoUpdate,l=t.background,f=e.shadowMap.enabled;t.autoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(_),e.render(t,r),t.traverse(M),function(){for(var e,i=0,t=(e=Object.keys(h)).length;i<t;i++)h[e[i]]=void 0;for(i=0,t=(e=Object.keys(d)).length;i<t;i++)d[e[i]]=void 0;for(i=0,t=(e=Object.keys(c)).length;i<t;i++){var r=e[i];!1===c[r].used?(c[r].count++,!1===c[r].keepAlive&&c[r].count>60&&delete c[r]):(c[r].used=!1,c[r].count=0)}}(),t.autoUpdate=o,t.background=l,e.autoClear=n,e.shadowMap.enabled=f},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(t,r,n){e.clear(t,r,n)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.getSize=function(t){return e.getSize(t)},this.setSize=function(t,r,n){e.setSize(t,r,n)},this.setViewport=function(t,r,n,o){e.setViewport(t,r,n,o)},this.setScissor=function(t,r,n,o){e.setScissor(t,r,n,o)},this.setScissorTest=function(t){e.setScissorTest(t)},this.setRenderTarget=function(t){e.setRenderTarget(t)}},ParallaxBarrierEffect=function(e){var t=new OrthographicCamera(-1,1,1,-1,0,1),r=new Scene,n=new StereoCamera,o={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},l=new WebGLRenderTarget(512,512,o),c=new WebGLRenderTarget(512,512,o),h=new ShaderMaterial({uniforms:{mapLeft:{value:l.texture},mapRight:{value:c.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),d=new Mesh(new PlaneBufferGeometry(2,2),h);r.add(d),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();l.setSize(t*n,r*n),c.setSize(t*n,r*n)},this.render=function(o,h){o.updateMatrixWorld(),null===h.parent&&h.updateMatrixWorld(),n.update(h),e.setRenderTarget(l),e.clear(),e.render(o,n.cameraL),e.setRenderTarget(c),e.clear(),e.render(o,n.cameraR),e.setRenderTarget(null),e.render(r,t)}},PeppersGhostEffect=function(e){var t,r,n,o=this;o.cameraDistance=15,o.reflectFromAbove=!1;var l=new PerspectiveCamera,c=new PerspectiveCamera,h=new PerspectiveCamera,d=new PerspectiveCamera,f=new Vector3,m=new Quaternion,v=new Vector3;e.autoClear=!1,this.setSize=function(o,l){t=o/2,o<l?(r=o/3,n=o/3):(r=l/3,n=l/3),e.setSize(o,l)},this.render=function(y,x){y.updateMatrixWorld(),null===x.parent&&x.updateMatrixWorld(),x.matrixWorld.decompose(f,m,v),l.position.copy(f),l.quaternion.copy(m),l.translateZ(o.cameraDistance),l.lookAt(y.position),c.position.copy(f),c.quaternion.copy(m),c.translateZ(-o.cameraDistance),c.lookAt(y.position),c.rotation.z+=Math.PI/180*180,h.position.copy(f),h.quaternion.copy(m),h.translateX(-o.cameraDistance),h.lookAt(y.position),h.rotation.x+=Math.PI/180*90,d.position.copy(f),d.quaternion.copy(m),d.translateX(o.cameraDistance),d.lookAt(y.position),d.rotation.x+=Math.PI/180*90,e.clear(),e.setScissorTest(!0),e.setScissor(t-r/2,2*n,r,n),e.setViewport(t-r/2,2*n,r,n),o.reflectFromAbove?e.render(y,c):e.render(y,l),e.setScissor(t-r/2,0,r,n),e.setViewport(t-r/2,0,r,n),o.reflectFromAbove?e.render(y,l):e.render(y,c),e.setScissor(t-r/2-r,n,r,n),e.setViewport(t-r/2-r,n,r,n),o.reflectFromAbove?e.render(y,d):e.render(y,h),e.setScissor(t+r/2,n,r,n),e.setViewport(t+r/2,n,r,n),o.reflectFromAbove?e.render(y,h):e.render(y,d),e.setScissorTest(!1)}},StereoEffect=function(e){var t=new StereoCamera;t.aspect=.5;var r=new Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,o){n.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),t.update(o),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}};function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this};var ColladaExporter=function(){};ColladaExporter.prototype={constructor:ColladaExporter,parse:function(object,e,t){t=t||{},""!==(t=Object.assign({version:"1.4.1",author:null,textureDirectory:""},t)).textureDirectory&&(t.textureDirectory=(t.textureDirectory+"/").replace(/\\/g,"/").replace(/\/+/g,"/"));var canvas,r,n=t.version;if("1.4.1"!==n&&"1.5.0"!==n)return console.warn("ColladaExporter : Version "+n+" not supported for export. Only 1.4.1 and 1.5.0."),null;function o(image,e){return canvas=canvas||document.createElement("canvas"),r=r||canvas.getContext("2d"),canvas.width=image.naturalWidth,canvas.height=image.naturalHeight,r.drawImage(image,0,0),function(e){for(var b=atob(e),t=new Uint8Array(b.length),i=0,r=t.length;i<r;i++)t[i]=b.charCodeAt(i);return t}(canvas.toDataURL("image/"+e,1).replace(/^data:image\/(png|jpg);base64,/,""))}var l,c=["getX","getY","getZ","getW"];function h(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize,i=0,n=e.count;i<n;i++)for(var o=0;o<r;o++)t[i*r+o]=e[c[o]](i);return t}return e.array}function d(e,t,r,n){var o=h(e);return'<source id="'+t+'"><float_array id="'+t+'-array" count="'+o.length+'">'+o.join(" ")+'</float_array><technique_common><accessor source="#'+t+'-array" count="'+Math.floor(o.length/e.itemSize)+'" stride="'+e.itemSize+'">'+r.map((function(e){return'<param name="'+e+'" type="'+n+'" />'})).join("")+"</accessor></technique_common></source>"}function f(e){var r=y.get(e);if(null==r){r="image-"+(_.length+1);var l=e.name||r,c='<image id="'+r+'" name="'+l+'">';c+="1.5.0"===n?"<init_from><ref>"+t.textureDirectory+l+".png</ref></init_from>":"<init_from>"+t.textureDirectory+l+".png</init_from>",c+="</image>",_.push(c),y.set(e,r),x.push({directory:t.textureDirectory,name:l,ext:"png",data:o(e.image,"png"),original:e})}return r}var m=new WeakMap,v=new WeakMap,y=new WeakMap,x=[],_=[],M=[],w=[],S=[],A=function e(t){var r='<node name="'+t.name+'">';if(r+=function(e){return e.updateMatrix(),(l=l||new Matrix4).copy(e.matrix),l.transpose(),"<matrix>"+l.toArray().join(" ")+"</matrix>"}(t),t instanceof Mesh&&null!=t.geometry){var n=function(g){var e,t,r,n=m.get(g);if(!n){var o=g;o instanceof Geometry&&(o=(new BufferGeometry).fromGeometry(o));var l="Mesh"+(M.length+1),c=o.index?o.index.count*o.index.itemSize:o.attributes.position.count,f=null!=o.groups&&0!==o.groups.length?o.groups:[{start:0,count:c,materialIndex:0}],v='<geometry id="'+l+'"'+(g.name?' name="'+g.name+'"':"")+"><mesh>",y=l+"-position",x=l+"-vertices";v+=d(o.attributes.position,y,["X","Y","Z"],"float"),v+='<vertices id="'+x+'"><input semantic="POSITION" source="#'+y+'" /></vertices>';var _='<input semantic="VERTEX" source="#'+x+'" offset="0" />';if("normal"in o.attributes){var w=l+"-normal";v+=d(o.attributes.normal,w,["X","Y","Z"],"float"),_+='<input semantic="NORMAL" source="#'+w+'" offset="0" />'}if("uv"in o.attributes){var S=l+"-texcoord";v+=d(o.attributes.uv,S,["S","T"],"float"),_+='<input semantic="TEXCOORD" source="#'+S+'" offset="0" set="0" />'}if("color"in o.attributes){var A=l+"-color";v+=d(o.attributes.color,A,["X","Y","Z"],"uint8"),_+='<input semantic="COLOR" source="#'+A+'" offset="0" />'}var T=null;if(o.index)T=h(o.index);else for(var i=0,L=(T=new Array(c)).length;i<L;i++)T[i]=i;for(i=0,L=f.length;i<L;i++){var C=f[i],N=(e=T,t=C.start,r=C.count,Array.isArray(e)?e.slice(t,t+r):new e.constructor(e.buffer,t*e.BYTES_PER_ELEMENT,r)),P=N.length/3;v+='<triangles material="MESH_MATERIAL_'+C.materialIndex+'" count="'+P+'">',v+=_,v+="<p>"+N.join(" ")+"</p>",v+="</triangles>"}v+="</mesh></geometry>",M.push(v),n={meshid:l,bufferGeometry:o},m.set(g,n)}return n}(t.geometry),o=n.meshid,c=n.bufferGeometry,y=null,x=t.material||new MeshBasicMaterial,_=Array.isArray(x)?x:[x];y=(c.groups.length>_.length?new Array(c.groups.length):new Array(_.length)).fill().map((function(e,i){return function(e){var t=v.get(e);if(null==t){t="Mat"+(w.length+1);var r="phong";e instanceof MeshLambertMaterial?r="lambert":e instanceof MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var n=e.emissive?e.emissive:new Color(0,0,0),o=e.color?e.color:new Color(0,0,0),l=e.specular?e.specular:new Color(1,1,1),c=e.shininess||0,h=e.reflectivity||0,d="";!0===e.transparent&&(d+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(d+="<transparency><float>"+e.opacity+"</float></transparency>"));var m='<technique sid="common"><'+r+"><emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':'<color sid="emission">'+n.r+" "+n.g+" "+n.b+" 1</color>")+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':'<color sid="diffuse">'+o.r+" "+o.g+" "+o.b+" 1</color>")+"</diffuse>":"")+("phong"===r?'<specular><color sid="specular">'+l.r+" "+l.g+" "+l.b+" 1</color></specular><shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':'<float sid="shininess">'+c+"</float>")+"</shininess>":"")+"<reflective><color>"+o.r+" "+o.g+" "+o.b+" 1</color></reflective><reflectivity><float>"+h+"</float></reflectivity>"+d+"</"+r+"></technique>",y='<effect id="'+t+'-effect"><profile_COMMON>'+(e.map?'<newparam sid="diffuse-surface"><surface type="2D"><init_from>'+f(e.map)+'</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D"><init_from>'+f(e.specularMap)+'</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D"><init_from>'+f(e.emissiveMap)+'</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+m+(e.side===DoubleSide?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",x='<material id="'+t+'"'+(e.name?' name="'+e.name+'"':"")+'><instance_effect url="#'+t+'-effect" /></material>';S.push(x),w.push(y),v.set(e,t)}return t}(_[i%_.length])})),r+='<instance_geometry url="#'+o+'">'+(null!=y?"<bind_material><technique_common>"+y.map((function(e,i){return'<instance_material symbol="MESH_MATERIAL_'+i+'" target="#'+e+'" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>'})).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach((function(t){return r+=e(t)})),r+="</node>"}(object),T='<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="'+("1.4.1"===n?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/")+'" version="'+n+'"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>'+(null!==t.author?"<author>"+t.author+"</author>":"")+"</contributor><created>"+(new Date).toISOString()+"</created><modified>"+(new Date).toISOString()+"</modified><up_axis>Y_UP</up_axis></asset>";T+="<library_images>"+_.join("")+"</library_images>",T+="<library_effects>"+w.join("")+"</library_effects>",T+="<library_materials>"+S.join("")+"</library_materials>",T+="<library_geometries>"+M.join("")+"</library_geometries>",T+='<library_visual_scenes><visual_scene id="Scene" name="scene">'+A+"</visual_scene></library_visual_scenes>",T+='<scene><instance_visual_scene url="#Scene"/></scene>';var L,C,N,P,F,E,R={data:(L=T+="</COLLADA>",C=/^<\//,N=/(\?>$)|(\/>$)/,P=/<[^>]+>[^<]*<\/[^<]+>/,F=function(e,t){return t>0?e+F(e,t-1):""},E=0,L.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map((function(e){P.test(e)||N.test(e)||!C.test(e)||E--;var t=""+F("  ",E)+e;return P.test(e)||N.test(e)||C.test(e)||E++,t})).join("\n")),textures:x};return"function"==typeof e&&requestAnimationFrame((function(){return e(R)})),R}};var DRACOExporter=function(){};DRACOExporter.prototype={constructor:DRACOExporter,parse:function(e,t){if(void 0===DracoEncoderModule)throw new Error("DRACOExporter: required the draco_decoder to work.");void 0===t&&(t={decodeSpeed:5,encodeSpeed:5,encoderMethod:DRACOExporter.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1});var r=DracoEncoderModule(),n=new r.Encoder,o=new r.MeshBuilder,l=new r.Mesh;if(!0===e.isGeometry){var c=new BufferGeometry;c.fromGeometry(e),e=c}if(!0!==e.isBufferGeometry)throw new Error("DRACOExporter.parse(geometry, options): geometry is not a Geometry or BufferGeometry instance.");var h=e.getAttribute("position");if(o.AddFloatAttributeToMesh(l,r.POSITION,h.count,h.itemSize,h.array),null!==(d=e.getIndex()))o.AddFacesToMesh(l,d.count,d.array);else{for(var d=new(h.count>65535?Uint32Array:Uint16Array)(h.count),i=0;i<d.length;i++)d[i]=i;o.AddFacesToMesh(l,h.count,d)}if(!0===t.exportNormals){var f=e.getAttribute("normal");void 0!==f&&o.AddFloatAttributeToMesh(l,r.NORMAL,f.count,f.itemSize,f.array)}if(!0===t.exportUvs){var m=e.getAttribute("uv");void 0!==m&&o.AddFloatAttributeToMesh(l,r.TEX_COORD,m.count,m.itemSize,m.array)}if(!0===t.exportColor){var v=e.getAttribute("color");void 0!==v&&o.AddFloatAttributeToMesh(l,r.COLOR,v.count,v.itemSize,v.array)}var y=new r.DracoInt8Array;if(n.SetSpeedOptions(t.encodeSpeed||5,t.decodeSpeed||5),void 0!==t.encoderMethod&&n.SetEncodingMethod(t.encoderMethod),void 0!==t.quantization)for(i=0;i<5;i++)void 0!==t.quantization[i]&&n.SetAttributeQuantization(i,t.quantization[i]);var x=n.EncodeMeshToDracoBuffer(l,y);if(r.destroy(l),0===x)throw new Error("DRACOExporter: Draco encoding failed.");var _=new Int8Array(new ArrayBuffer(x));for(i=0;i<x;i++)_[i]=y.GetValue(i);return r.destroy(y),r.destroy(n),r.destroy(o),_}},DRACOExporter.MESH_EDGEBREAKER_ENCODING=1,DRACOExporter.MESH_SEQUENTIAL_ENCODING=0,DRACOExporter.POINT_CLOUD=0,DRACOExporter.TRIANGULAR_MESH=1,DRACOExporter.INVALID=-1,DRACOExporter.POSITION=0,DRACOExporter.NORMAL=1,DRACOExporter.COLOR=2,DRACOExporter.TEX_COORD=3,DRACOExporter.GENERIC=4;var WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},THREE_TO_WEBGL={};THREE_TO_WEBGL[NearestFilter]=WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[NearestMipmapNearestFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[NearestMipmapLinearFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[LinearFilter]=WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[LinearMipmapNearestFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[LinearMipmapLinearFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[ClampToEdgeWrapping]=WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[RepeatWrapping]=WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[MirroredRepeatWrapping]=WEBGL_CONSTANTS.MIRRORED_REPEAT;var PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},GLTFExporter=function(){};GLTFExporter.prototype={constructor:GLTFExporter,parse:function(input,e,t){var r={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};(t=Object.assign({},r,t)).animations.length>0&&(t.trs=!0);var n,o={asset:{version:"2.0",generator:"GLTFExporter"}},l=0,c=[],h=[],d=new Map,f=[],m={},v={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},y=new Map,x=0;function _(object){return y.has(object)||y.set(object,x++),y.get(object)}function M(e,t){return e.length===t.length&&e.every((function(element,e){return element===t[e]}))}function w(e){return 4*Math.ceil(e/4)}function S(e,t){t=t||0;var r=w(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function A(object,e){if(0!==Object.keys(object.userData).length)try{var r=JSON.parse(JSON.stringify(object.userData));if(t.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===e.extensions&&(e.extensions={}),r.gltfExtensions)e.extensions[n]=r.gltfExtensions[n],m[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(e.extras=r)}catch(e){console.warn("GLTFExporter: userData of '"+object.name+"' won't be serialized because of JSON.stringify error - "+e.message)}}function T(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,m.KHR_texture_transform=!0)}function L(e){return o.buffers||(o.buffers=[{byteLength:0}]),c.push(e),0}function C(e,r,n,c){var h;if(e.array.constructor===Float32Array)h=WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)h=WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)h=WEBGL_CONSTANTS.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");h=WEBGL_CONSTANTS.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===c&&(c=e.count),t.truncateDrawRange&&void 0!==r&&null===r.index){var d=n+c,f=r.drawRange.count===1/0?e.count:r.drawRange.start+r.drawRange.count;n=Math.max(n,r.drawRange.start),(c=Math.min(d,f)-n)<0&&(c=0)}if(0===c)return null;var m,v=function(e,t,r){for(var output={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var a=0;a<e.itemSize;a++){var n=e.array[i*e.itemSize+a];output.min[a]=Math.min(output.min[a],n),output.max[a]=Math.max(output.max[a],n)}return output}(e,n,c);void 0!==r&&(m=e===r.index?WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS.ARRAY_BUFFER);var y=function(e,t,r,n,c){var h;o.bufferViews||(o.bufferViews=[]),h=t===WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;for(var d=w(n*e.itemSize*h),f=new DataView(new ArrayBuffer(d)),m=0,i=r;i<r+n;i++)for(var a=0;a<e.itemSize;a++){var v=e.array[i*e.itemSize+a];t===WEBGL_CONSTANTS.FLOAT?f.setFloat32(m,v,!0):t===WEBGL_CONSTANTS.UNSIGNED_INT?f.setUint32(m,v,!0):t===WEBGL_CONSTANTS.UNSIGNED_SHORT?f.setUint16(m,v,!0):t===WEBGL_CONSTANTS.UNSIGNED_BYTE&&f.setUint8(m,v),m+=h}var y={buffer:L(f.buffer),byteOffset:l,byteLength:d};return void 0!==c&&(y.target=c),c===WEBGL_CONSTANTS.ARRAY_BUFFER&&(y.byteStride=e.itemSize*h),l+=d,o.bufferViews.push(y),{id:o.bufferViews.length-1,byteLength:0}}(e,h,n,c,m),x={bufferView:y.id,byteOffset:y.byteOffset,componentType:h,count:c,max:v.max,min:v.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return o.accessors||(o.accessors=[]),o.accessors.push(x),o.accessors.length-1}function N(image,e,r){v.images.has(image)||v.images.set(image,{});var c=v.images.get(image),d=e===RGBAFormat?"image/png":"image/jpeg",f=d+":flipY/"+r.toString();if(void 0!==c[f])return c[f];o.images||(o.images=[]);var m={mimeType:d};if(t.embedImages){var canvas=n=n||document.createElement("canvas");canvas.width=Math.min(image.width,t.maxTextureSize),canvas.height=Math.min(image.height,t.maxTextureSize),t.forcePowerOfTwoTextures&&!function(image){return MathUtils.isPowerOfTwo(image.width)&&MathUtils.isPowerOfTwo(image.height)}(canvas)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",image),canvas.width=MathUtils.floorPowerOfTwo(canvas.width),canvas.height=MathUtils.floorPowerOfTwo(canvas.height));var y=canvas.getContext("2d");!0===r&&(y.translate(0,canvas.height),y.scale(1,-1)),y.drawImage(image,0,0,canvas.width,canvas.height),!0===t.binary?h.push(new Promise((function(e){canvas.toBlob((function(t){(function(e){return o.bufferViews||(o.bufferViews=[]),new Promise((function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=S(r.result),n={buffer:L(e),byteOffset:l,byteLength:e.byteLength};l+=e.byteLength,o.bufferViews.push(n),t(o.bufferViews.length-1)}}))})(t).then((function(t){m.bufferView=t,e()}))}),d)}))):m.uri=canvas.toDataURL(d)}else m.uri=image.src;o.images.push(m);var x=o.images.length-1;return c[f]=x,x}function P(map){o.samplers||(o.samplers=[]);var e={magFilter:THREE_TO_WEBGL[map.magFilter],minFilter:THREE_TO_WEBGL[map.minFilter],wrapS:THREE_TO_WEBGL[map.wrapS],wrapT:THREE_TO_WEBGL[map.wrapT]};return o.samplers.push(e),o.samplers.length-1}function F(map){if(v.textures.has(map))return v.textures.get(map);o.textures||(o.textures=[]);var e={sampler:P(map),source:N(map.image,map.format,map.flipY)};map.name&&(e.name=map.name),o.textures.push(e);var t=o.textures.length-1;return v.textures.set(map,t),t}function E(e){if(v.materials.has(e))return v.materials.get(e);if(o.materials||(o.materials=[]),e.isShaderMaterial&&!e.isGLTFSpecularGlossinessMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},m.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},m.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(M(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var n=[1,1,1];e.specular.toArray(n,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=n,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var l={index:F(e.metalnessMap)};T(l,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=l}else console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var c={index:F(e.map)};T(c,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=c),t.pbrMetallicRoughness.baseColorTexture=c}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var h={index:F(e.specularMap)};T(h,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=h}if(e.emissive){var d=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(M(d,[0,0,0])||(t.emissiveFactor=d),e.emissiveMap){var f={index:F(e.emissiveMap)};T(f,e.emissiveMap),t.emissiveTexture=f}}if(e.normalMap){var y={index:F(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),y.scale=e.normalScale.x),T(y,e.normalMap),t.normalTexture=y}if(e.aoMap){var x={index:F(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(x.strength=e.aoMapIntensity),T(x,e.aoMap),t.occlusionTexture=x}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),A(e,t),o.materials.push(t);var _=o.materials.length-1;return v.materials.set(e,_),_}function R(e){var r=e.geometry.uuid+":"+e.material.uuid;if(v.meshes.has(r))return v.meshes.get(r);var n,l=e.geometry;if(e.isLineSegments)n=WEBGL_CONSTANTS.LINES;else if(e.isLineLoop)n=WEBGL_CONSTANTS.LINE_LOOP;else if(e.isLine)n=WEBGL_CONSTANTS.LINE_STRIP;else if(e.isPoints)n=WEBGL_CONSTANTS.POINTS;else{if(!l.isBufferGeometry){console.warn("GLTFExporter: Exporting Geometry will increase file size. Use BufferGeometry instead.");var c=new BufferGeometry;c.fromGeometry(l),l=c}n=e.material.wireframe?WEBGL_CONSTANTS.LINES:WEBGL_CONSTANTS.TRIANGLES}var h={},d={},f=[],m=[],y={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},x=l.getAttribute("normal");void 0===x||function(e){if(v.attributesNormalized.has(e))return!1;for(var t=new Vector3,i=0,r=e.count;i<r;i++)if(Math.abs(t.fromArray(e.array,3*i).length()-1)>5e-4)return!1;return!0}(x)||(console.warn("GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",function(e){if(v.attributesNormalized.has(e))return v.attributesNormalized.get(e);for(var t=e.clone(),r=new Vector3,i=0,n=t.count;i<n;i++)r.fromArray(t.array,3*i),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*i);return v.attributesNormalized.set(e,t),t}(x)));var M=null;for(var w in l.attributes)if("morph"!==w.substr(0,5)){var S=l.attributes[w];w=y[w]||w.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(w)||(w="_"+w),v.attributes.has(_(S)))d[w]=v.attributes.get(_(S));else{M=null;var T=S.array;"JOINTS_0"!==w||T instanceof Uint16Array||T instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),M=new BufferAttribute(new Uint16Array(T),S.itemSize,S.normalized));var L=C(M||S,l);null!==L&&(d[w]=L,v.attributes.set(_(S),L))}}if(void 0!==x&&l.setAttribute("normal",x),0===Object.keys(d).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var N=[],P=[],F={};if(void 0!==e.morphTargetDictionary)for(var R in e.morphTargetDictionary)F[e.morphTargetDictionary[R]]=R;for(var i=0;i<e.morphTargetInfluences.length;++i){var D={},O=!1;for(var w in l.morphAttributes)if("position"===w||"normal"===w){S=l.morphAttributes[w][i];var I=w.toUpperCase(),B=l.attributes[w];if(v.attributes.has(_(S)))D[I]=v.attributes.get(_(S));else{var U=S.clone();if(!l.morphTargetsRelative)for(var k=0,V=S.count;k<V;k++)U.setXYZ(k,S.getX(k)-B.getX(k),S.getY(k)-B.getY(k),S.getZ(k)-B.getZ(k));D[I]=C(U,l),v.attributes.set(_(B),D[I])}}else O||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),O=!0);m.push(D),N.push(e.morphTargetInfluences[i]),void 0!==e.morphTargetDictionary&&P.push(F[i])}h.weights=N,P.length>0&&(h.extras={},h.extras.targetNames=P)}var G=t.forceIndices,z=Array.isArray(e.material);if(z&&0===l.groups.length)return null;!G&&null===l.index&&z&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),G=!0);var j=!1;if(null===l.index&&G){for(var W=[],H=(i=0,l.attributes.position.count);i<H;i++)W[i]=i;l.setIndex(W),j=!0}var X=z?e.material:[e.material],Y=z?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(i=0,H=Y.length;i<H;i++){var Q={mode:n,attributes:d};if(A(l,Q),m.length>0&&(Q.targets=m),null!==l.index){r=_(l.index);void 0===Y[i].start&&void 0===Y[i].count||(r+=":"+Y[i].start+":"+Y[i].count),v.attributes.has(r)?Q.indices=v.attributes.get(r):(Q.indices=C(l.index,l,Y[i].start,Y[i].count),v.attributes.set(r,Q.indices)),null===Q.indices&&delete Q.indices}var K=E(X[Y[i].materialIndex]);null!==K&&(Q.material=K),f.push(Q)}j&&l.setIndex(null),h.primitives=f,o.meshes||(o.meshes=[]),o.meshes.push(h);var J=o.meshes.length-1;return v.meshes.set(r,J),J}function D(e,t){o.animations||(o.animations=[]);for(var r=(e=GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],l=[],i=0;i<r.length;++i){var track=r[i],c=PropertyBinding.parseTrackName(track.name),h=PropertyBinding.findNode(t,c.nodeName),f=PATH_PROPERTIES[c.propertyName];if("bones"===c.objectName&&(h=!0===h.isSkinnedMesh?h.skeleton.getBoneByName(c.objectIndex):void 0),!h||!f)return console.warn('GLTFExporter: Could not export animation track "%s".',track.name),null;var m,v=track.values.length/track.times.length;f===PATH_PROPERTIES.morphTargetInfluences&&(v/=h.morphTargetInfluences.length),!0===track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(m="CUBICSPLINE",v/=3):m=track.getInterpolation()===InterpolateDiscrete?"STEP":"LINEAR",l.push({input:C(new BufferAttribute(track.times,1)),output:C(new BufferAttribute(track.values,v)),interpolation:m}),n.push({sampler:l.length-1,target:{node:d.get(h),path:f}})}return o.animations.push({name:e.name||"clip_"+o.animations.length,samplers:l,channels:n}),o.animations.length-1}function O(object){var e=o.nodes[d.get(object)],t=object.skeleton;if(void 0===t)return null;var r=object.skeleton.bones[0];if(void 0===r)return null;for(var n=[],l=new Float32Array(16*t.bones.length),i=0;i<t.bones.length;++i)n.push(d.get(t.bones[i])),t.boneInverses[i].toArray(l,16*i);return void 0===o.skins&&(o.skins=[]),o.skins.push({inverseBindMatrices:C(new BufferAttribute(l,16)),joints:n,skeleton:d.get(r)}),e.skin=o.skins.length-1}function I(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=o.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function B(object){o.nodes||(o.nodes=[]);var e={};if(t.trs){var r=object.quaternion.toArray(),n=object.position.toArray(),l=object.scale.toArray();M(r,[0,0,0,1])||(e.rotation=r),M(n,[0,0,0])||(e.translation=n),M(l,[1,1,1])||(e.scale=l)}else object.matrixAutoUpdate&&object.updateMatrix(),M(object.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(e.matrix=object.matrix.elements);if(""!==object.name&&(e.name=String(object.name)),A(object,e),object.isMesh||object.isLine||object.isPoints){var c=R(object);null!==c&&(e.mesh=c)}else if(object.isCamera)e.camera=function(e){o.cameras||(o.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),o.cameras.push(r),o.cameras.length-1}(object);else if(object.isDirectionalLight||object.isPointLight||object.isSpotLight)m.KHR_lights_punctual||(o.extensions=o.extensions||{},o.extensions.KHR_lights_punctual={lights:[]},m.KHR_lights_punctual=!0),e.extensions=e.extensions||{},e.extensions.KHR_lights_punctual={light:I(object)};else if(object.isLight)return console.warn("GLTFExporter: Only directional, point, and spot lights are supported.",object),null;if(object.isSkinnedMesh&&f.push(object),object.children.length>0){for(var h=[],i=0,v=object.children.length;i<v;i++){var y=object.children[i];if(y.visible||!1===t.onlyVisible){var x=B(y);null!==x&&h.push(x)}}h.length>0&&(e.children=h)}o.nodes.push(e);var _=o.nodes.length-1;return d.set(object,_),_}function U(e){o.scenes||(o.scenes=[],o.scene=0);var r={nodes:[]};""!==e.name&&(r.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(r.extras=A(e)),o.scenes.push(r);for(var n=[],i=0,l=e.children.length;i<l;i++){var c=e.children[i];if(c.visible||!1===t.onlyVisible){var h=B(c);null!==h&&n.push(h)}}n.length>0&&(r.nodes=n),A(e,r)}!function(input){input=input instanceof Array?input:[input];for(var e=[],i=0;i<input.length;i++)input[i]instanceof Scene?U(input[i]):e.push(input[i]);for(e.length>0&&function(e){var t=new Scene;t.name="AuxScene";for(var i=0;i<e.length;i++)t.children.push(e[i]);U(t)}(e),i=0;i<f.length;++i)O(f[i]);for(i=0;i<t.animations.length;++i)D(t.animations[i],input[0])}(input),Promise.all(h).then((function(){var r=new Blob(c,{type:"application/octet-stream"}),n=Object.keys(m);if(n.length>0&&(o.extensionsUsed=n),o.buffers&&o.buffers.length>0){o.buffers[0].byteLength=r.size;var l=new window.FileReader;if(!0===t.binary){l.readAsArrayBuffer(r),l.onloadend=function(){var t=S(l.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,t.byteLength,!0),r.setUint32(4,5130562,!0);var n=S(function(text){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(text).buffer;for(var e=new Uint8Array(new ArrayBuffer(text.length)),i=0,t=text.length;i<t;i++){var r=text.charCodeAt(i);e[i]=r>255?32:r}return e.buffer}(JSON.stringify(o)),32),c=new DataView(new ArrayBuffer(8));c.setUint32(0,n.byteLength,!0),c.setUint32(4,1313821514,!0);var header=new ArrayBuffer(12),h=new DataView(header);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0);var d=12+c.byteLength+n.byteLength+r.byteLength+t.byteLength;h.setUint32(8,d,!0);var f=new Blob([header,c,n,r,t],{type:"application/octet-stream"}),m=new window.FileReader;m.readAsArrayBuffer(f),m.onloadend=function(){e(m.result)}}}else l.readAsDataURL(r),l.onloadend=function(){var t=l.result;o.buffers[0].uri=t,e(o)}}else e(o)}))}},GLTFExporter.Utils={insertKeyframe:function(track,time){var e,t=track.getValueSize(),r=new track.TimeBufferType(track.times.length+1),n=new track.ValueBufferType(track.values.length+t),o=track.createInterpolant(new track.ValueBufferType(t));if(0===track.times.length){r[0]=time;for(var i=0;i<t;i++)n[i]=0;e=0}else if(time<track.times[0]){if(Math.abs(track.times[0]-time)<.001)return 0;r[0]=time,r.set(track.times,1),n.set(o.evaluate(time),0),n.set(track.values,t),e=0}else if(time>track.times[track.times.length-1]){if(Math.abs(track.times[track.times.length-1]-time)<.001)return track.times.length-1;r[r.length-1]=time,r.set(track.times,0),n.set(track.values,0),n.set(o.evaluate(time),track.values.length),e=r.length-1}else for(i=0;i<track.times.length;i++){if(Math.abs(track.times[i]-time)<.001)return i;if(track.times[i]<time&&track.times[i+1]>time){r.set(track.times.slice(0,i+1),0),r[i+1]=time,r.set(track.times.slice(i+1),i+2),n.set(track.values.slice(0,(i+1)*t),0),n.set(o.evaluate(time),(i+1)*t),n.set(track.values.slice((i+1)*t),(i+2)*t),e=i+1;break}}return track.times=r,track.values=n,e},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},o=e.tracks,i=0;i<o.length;++i){var l=o[i],c=PropertyBinding.parseTrackName(l.name),h=PropertyBinding.findNode(t,c.nodeName);if("morphTargetInfluences"===c.propertyName&&void 0!==c.propertyIndex){if(l.createInterpolant!==l.InterpolantFactoryMethodDiscrete&&l.createInterpolant!==l.InterpolantFactoryMethodLinear){if(l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(l=l.clone()).setInterpolation(InterpolateLinear)}var d,f=h.morphTargetInfluences.length,m=h.morphTargetDictionary[c.propertyIndex];if(void 0===m)throw new Error("GLTFExporter: Morph target name not found: "+c.propertyIndex);if(void 0!==n[h.uuid]){var v=l.createInterpolant(new l.ValueBufferType(1));d=n[h.uuid];for(_=0;_<d.times.length;_++)d.values[_*f+m]=v.evaluate(d.times[_]);for(_=0;_<l.times.length;_++){var y=this.insertKeyframe(d,l.times[_]);d.values[y*f+m]=l.values[_]}}else{for(var x=new((d=l.clone()).ValueBufferType)(f*d.times.length),_=0;_<d.times.length;_++)x[_*f+m]=d.values[_];d.name=".morphTargetInfluences",d.values=x,n[h.uuid]=d,r.push(d)}}else r.push(l)}return e.tracks=r,e}};var MMDExporter=function(){var e;this.parseVpd=function(t,r,n){if(!0!==t.isSkinnedMesh)return console.warn("MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function o(e){Math.abs(e)<1e-6&&(e=0);var a=e.toString();-1===a.indexOf(".")&&(a+=".");var t=(a+="000000").indexOf(".");return a.slice(0,t)+"."+a.slice(t+1,t+7)}function l(e){for(var a=[],i=0,t=e.length;i<t;i++)a.push(o(e[i]));return a.join(",")}t.updateMatrixWorld(!0);var c=t.skeleton.bones,h=function(e){var t=e.clone();return t.pose(),t.skeleton.bones}(t),d=new Vector3,f=new Quaternion,m=new Quaternion,v=new Matrix4,y=[];y.push("Vocaloid Pose Data file"),y.push(""),y.push((""!==t.name?t.name.replace(/\s/g,"_"):"skin")+".osm;"),y.push(c.length+";"),y.push("");for(var i=0,x=c.length;i<x;i++){var _=c[i],M=h[i];!0===n&&void 0!==_.userData.ik&&void 0!==_.userData.ik.originalMatrix?v.fromArray(_.userData.ik.originalMatrix):v.copy(_.matrix),d.setFromMatrixPosition(v),f.setFromRotationMatrix(v);var w=d.sub(M.position).toArray(),S=m.copy(M.quaternion).conjugate().multiply(f).toArray();w[2]=-w[2],S[0]=-S[0],S[1]=-S[1],y.push("Bone"+i+"{"+_.name),y.push("  "+l(w)+";"),y.push("  "+l(S)+";"),y.push("}"),y.push("")}y.push("");var A=y.join("\n");return!0===r?function(t){if(void 0===e){var table=(new MMDParser.CharsetEncoder).s2uTable;e={};for(var r=Object.keys(table),i=0,n=r.length;i<n;i++){var o=r[i],l=table[o];o=parseInt(o),e[l]=o}}var c=[];for(i=0,n=t.length;i<n;i++){var code=t.charCodeAt(i);if(void 0===(l=e[code]))throw"cannot convert charcode 0x"+code.toString(16);l>255?(c.push(l>>8&255),c.push(255&l)):c.push(255&l)}return new Uint8Array(c)}(A):A}},OBJExporter=function(){};OBJExporter.prototype={constructor:OBJExporter,parse:function(object){var i,e,t,r,n,output="",o=0,l=0,c=0,h=new Vector3,d=new Vector3,f=new Vector2,m=[];return object.traverse((function(v){v instanceof Mesh&&function(t){var v=0,y=0,x=0,_=t.geometry,M=new Matrix3;if(_ instanceof Geometry&&(_=(new BufferGeometry).setFromObject(t)),_ instanceof BufferGeometry){var w=_.getAttribute("position"),S=_.getAttribute("normal"),A=_.getAttribute("uv"),T=_.getIndex();if(output+="o "+t.name+"\n",t.material&&t.material.name&&(output+="usemtl "+t.material.name+"\n"),void 0!==w)for(i=0,r=w.count;i<r;i++,v++)h.x=w.getX(i),h.y=w.getY(i),h.z=w.getZ(i),h.applyMatrix4(t.matrixWorld),output+="v "+h.x+" "+h.y+" "+h.z+"\n";if(void 0!==A)for(i=0,r=A.count;i<r;i++,x++)f.x=A.getX(i),f.y=A.getY(i),output+="vt "+f.x+" "+f.y+"\n";if(void 0!==S)for(M.getNormalMatrix(t.matrixWorld),i=0,r=S.count;i<r;i++,y++)d.x=S.getX(i),d.y=S.getY(i),d.z=S.getZ(i),d.applyMatrix3(M).normalize(),output+="vn "+d.x+" "+d.y+" "+d.z+"\n";if(null!==T)for(i=0,r=T.count;i<r;i+=3){for(n=0;n<3;n++)e=T.getX(i+n)+1,m[n]=o+e+(S||A?"/"+(A?l+e:"")+(S?"/"+(c+e):""):"");output+="f "+m.join(" ")+"\n"}else for(i=0,r=w.count;i<r;i+=3){for(n=0;n<3;n++)e=i+n+1,m[n]=o+e+(S||A?"/"+(A?l+e:"")+(S?"/"+(c+e):""):"");output+="f "+m.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",_);o+=v,l+=x,c+=y}(v),v instanceof Line&&function(line){var n=0,l=line.geometry,c=line.type;if(l instanceof Geometry&&(l=(new BufferGeometry).setFromObject(line)),l instanceof BufferGeometry){var d=l.getAttribute("position");if(output+="o "+line.name+"\n",void 0!==d)for(i=0,r=d.count;i<r;i++,n++)h.x=d.getX(i),h.y=d.getY(i),h.z=d.getZ(i),h.applyMatrix4(line.matrixWorld),output+="v "+h.x+" "+h.y+" "+h.z+"\n";if("Line"===c){for(output+="l ",e=1,r=d.count;e<=r;e++)output+=o+e+" ";output+="\n"}if("LineSegments"===c)for(t=(e=1)+1,r=d.count;e<r;t=(e+=2)+1)output+="l "+(o+e)+" "+(o+t)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",l);o+=n}(v)})),output}};var PLYExporter=function(){};PLYExporter.prototype={constructor:PLYExporter,parse:function(object,e,t){function r(e){object.traverse((function(t){if(!0===t.isMesh){var r=t,n=r.geometry;!0===n.isGeometry&&(n=o.get(n)),!0===n.isBufferGeometry&&void 0!==n.getAttribute("position")&&e(r,n)}}))}e&&"object"==typeof e&&(console.warn('PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),t=e,e=void 0);var n=(t=Object.assign({binary:!1,excludeAttributes:[]},t)).excludeAttributes,o=new WeakMap,l=!1,c=!1,h=!1,d=0,f=0;object.traverse((function(e){if(!0===e.isMesh){var t=e,r=t.geometry;if(!0===r.isGeometry){var n=o.get(r)||(new BufferGeometry).setFromObject(t);o.set(r,n),r=n}if(!0===r.isBufferGeometry){var m=r.getAttribute("position"),v=r.getAttribute("normal"),y=r.getAttribute("uv"),x=r.getAttribute("color"),_=r.getIndex();if(void 0===m)return;d+=m.count,f+=_?_.count/3:m.count/3,void 0!==v&&(l=!0),void 0!==y&&(h=!0),void 0!==x&&(c=!0)}}}));var m=-1===n.indexOf("index");if(l=l&&-1===n.indexOf("normal"),c=c&&-1===n.indexOf("color"),h=h&&-1===n.indexOf("uv"),m&&f!==Math.floor(f))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var header="ply\nformat "+(t.binary?"binary_big_endian":"ascii")+" 1.0\nelement vertex "+d+"\nproperty float x\nproperty float y\nproperty float z\n";!0===l&&(header+="property float nx\nproperty float ny\nproperty float nz\n"),!0===h&&(header+="property float s\nproperty float t\n"),!0===c&&(header+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===m&&(header+="element face "+f+"\nproperty list uchar int vertex_index\n"),header+="end_header\n";var v=new Vector3,y=new Matrix3,x=null;if(!0===t.binary){var _=(new TextEncoder).encode(header),M=d*(12+(l?12:0)+(c?3:0)+(h?8:0)),w=m?13*f:0,output=new DataView(new ArrayBuffer(_.length+M+w));new Uint8Array(output.buffer).set(_,0);var S=_.length,A=_.length+M,T=0;r((function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),o=t.getAttribute("uv"),d=t.getAttribute("color"),f=t.getIndex();y.getNormalMatrix(e.matrixWorld);for(var i=0,x=r.count;i<x;i++)v.x=r.getX(i),v.y=r.getY(i),v.z=r.getZ(i),v.applyMatrix4(e.matrixWorld),output.setFloat32(S,v.x),S+=4,output.setFloat32(S,v.y),S+=4,output.setFloat32(S,v.z),S+=4,!0===l&&(null!=n?(v.x=n.getX(i),v.y=n.getY(i),v.z=n.getZ(i),v.applyMatrix3(y).normalize(),output.setFloat32(S,v.x),S+=4,output.setFloat32(S,v.y),S+=4,output.setFloat32(S,v.z),S+=4):(output.setFloat32(S,0),S+=4,output.setFloat32(S,0),S+=4,output.setFloat32(S,0),S+=4)),!0===h&&(null!=o?(output.setFloat32(S,o.getX(i)),S+=4,output.setFloat32(S,o.getY(i)),S+=4):!1!==h&&(output.setFloat32(S,0),S+=4,output.setFloat32(S,0),S+=4)),!0===c&&(null!=d?(output.setUint8(S,Math.floor(255*d.getX(i))),S+=1,output.setUint8(S,Math.floor(255*d.getY(i))),S+=1,output.setUint8(S,Math.floor(255*d.getZ(i))),S+=1):(output.setUint8(S,255),S+=1,output.setUint8(S,255),S+=1,output.setUint8(S,255),S+=1));if(!0===m)if(null!==f)for(i=0,x=f.count;i<x;i+=3)output.setUint8(A,3),A+=1,output.setUint32(A,f.getX(i+0)+T),A+=4,output.setUint32(A,f.getX(i+1)+T),A+=4,output.setUint32(A,f.getX(i+2)+T),A+=4;else for(i=0,x=r.count;i<x;i+=3)output.setUint8(A,3),A+=1,output.setUint32(A,T+i),A+=4,output.setUint32(A,T+i+1),A+=4,output.setUint32(A,T+i+2),A+=4;T+=r.count})),x=output.buffer}else{T=0;var L="",C="";r((function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),o=t.getAttribute("uv"),d=t.getAttribute("color"),x=t.getIndex();y.getNormalMatrix(e.matrixWorld);for(var i=0,_=r.count;i<_;i++){v.x=r.getX(i),v.y=r.getY(i),v.z=r.getZ(i),v.applyMatrix4(e.matrixWorld);var line=v.x+" "+v.y+" "+v.z;!0===l&&(null!=n?(v.x=n.getX(i),v.y=n.getY(i),v.z=n.getZ(i),v.applyMatrix3(y).normalize(),line+=" "+v.x+" "+v.y+" "+v.z):line+=" 0 0 0"),!0===h&&(null!=o?line+=" "+o.getX(i)+" "+o.getY(i):!1!==h&&(line+=" 0 0")),!0===c&&(line+=null!=d?" "+Math.floor(255*d.getX(i))+" "+Math.floor(255*d.getY(i))+" "+Math.floor(255*d.getZ(i)):" 255 255 255"),L+=line+"\n"}if(!0===m){if(null!==x)for(i=0,_=x.count;i<_;i+=3)C+="3 "+(x.getX(i+0)+T),C+=" "+(x.getX(i+1)+T),C+=" "+(x.getX(i+2)+T)+"\n";else for(i=0,_=r.count;i<_;i+=3)C+="3 "+(T+i)+" "+(T+i+1)+" "+(T+i+2)+"\n";f+=x?x.count/3:r.count/3}T+=r.count})),x=""+header+L+(m?C+"\n":"\n")}return"function"==typeof e&&requestAnimationFrame((function(){return e(x)})),x}};var STLExporter=function(){},vector,normalMatrixWorld;STLExporter.prototype={constructor:STLExporter,parse:(vector=new Vector3,normalMatrixWorld=new Matrix3,function(e,t){void 0===t&&(t={});var r=void 0!==t.binary&&t.binary,n=[],o=0;if(e.traverse((function(object){if(object.isMesh){var e=object.geometry;e.isBufferGeometry&&(e=(new Geometry).fromBufferGeometry(e)),e.isGeometry&&(o+=e.faces.length,n.push({geometry:e,matrixWorld:object.matrixWorld}))}})),r){var l=80,c=new ArrayBuffer(2*o+3*o*4*4+80+4);(output=new DataView(c)).setUint32(l,o,!0),l+=4;for(var i=0,h=n.length;i<h;i++){var d=(object=n[i]).geometry.vertices,f=object.geometry.faces,m=object.matrixWorld;normalMatrixWorld.getNormalMatrix(m);for(var v=0,y=f.length;v<y;v++){var x=f[v];vector.copy(x.normal).applyMatrix3(normalMatrixWorld).normalize(),output.setFloat32(l,vector.x,!0),l+=4,output.setFloat32(l,vector.y,!0),l+=4,output.setFloat32(l,vector.z,!0),l+=4;for(var _=[x.a,x.b,x.c],M=0;M<3;M++)vector.copy(d[_[M]]).applyMatrix4(m),output.setFloat32(l,vector.x,!0),l+=4,output.setFloat32(l,vector.y,!0),l+=4,output.setFloat32(l,vector.z,!0),l+=4;output.setUint16(l,0,!0),l+=2}}return output}var output="";for(output+="solid exported\n",i=0,h=n.length;i<h;i++){var object;for(d=(object=n[i]).geometry.vertices,f=object.geometry.faces,m=object.matrixWorld,normalMatrixWorld.getNormalMatrix(m),v=0,y=f.length;v<y;v++){for(x=f[v],vector.copy(x.normal).applyMatrix3(normalMatrixWorld).normalize(),output+="\tfacet normal "+vector.x+" "+vector.y+" "+vector.z+"\n",output+="\t\touter loop\n",_=[x.a,x.b,x.c],M=0;M<3;M++)vector.copy(d[_[M]]).applyMatrix4(m),output+="\t\t\tvertex "+vector.x+" "+vector.y+" "+vector.z+"\n";output+="\t\tendloop\n",output+="\tendfacet\n"}}return output+="endsolid exported\n"})};var TypedGeometryExporter=function(){};TypedGeometryExporter.prototype={constructor:TypedGeometryExporter,parse:function(e){var output={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},t=["vertices","normals","uvs"];for(var r in t){for(var n=t[r],o=e[n],l=[],i=0,c=o.length;i<c;i++)l[i]=o[i];output[n]=l}var h=e.boundingSphere;return null!==h&&(output.boundingSphere={center:h.center.toArray(),radius:h.radius}),output}};var BoxLineGeometry=function(e,t,r,n,o,l){BufferGeometry.call(this);for(var c=(e=e||1)/2,h=(t=t||1)/2,d=(r=r||1)/2,f=e/(n=Math.floor(n)||1),m=t/(o=Math.floor(o)||1),v=r/(l=Math.floor(l)||1),y=[],x=-c,_=-h,M=-d,i=0;i<=n;i++)y.push(x,-h,-d,x,h,-d),y.push(x,h,-d,x,h,d),y.push(x,h,d,x,-h,d),y.push(x,-h,d,x,-h,-d),x+=f;for(i=0;i<=o;i++)y.push(-c,_,-d,c,_,-d),y.push(c,_,-d,c,_,d),y.push(c,_,d,-c,_,d),y.push(-c,_,d,-c,_,-d),_+=m;for(i=0;i<=l;i++)y.push(-c,-h,M,-c,h,M),y.push(-c,h,M,c,h,M),y.push(c,h,M,c,-h,M),y.push(c,-h,M,-c,-h,M),M+=v;this.setAttribute("position",new Float32BufferAttribute(y,3))};BoxLineGeometry.prototype=Object.create(BufferGeometry.prototype),BoxLineGeometry.prototype.constructor=BoxLineGeometry;var _startP=new Vector3,_startEnd=new Vector3;function Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}Object.assign(Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(line){return this.start.copy(line.start),this.end.copy(line.end),this},getCenter:function(e){return void 0===e&&(console.warn("Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);var r=_startEnd.dot(_startEnd),n=_startEnd.dot(_startP)/r;return t&&(n=MathUtils.clamp(n,0,1)),n},closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}});var ConvexHull=function(){var e,t,r,n,o=new Vector3;function l(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new f,this.unassigned=new f,this.vertices=[]}function c(){this.normal=new Vector3,this.midpoint=new Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function h(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function d(e){this.point=e,this.prev=null,this.next=null,this.face=null}function f(){this.head=null,this.tail=null}return Object.assign(l.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("ConvexHull: Points parameter is not an array."),e.length<4&&console.error("ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var i=0,t=e.length;i<t;i++)this.vertices.push(new d(e[i]));return this.compute(),this},setFromObject:function(object){var e=[];return object.updateMatrixWorld(!0),object.traverse((function(t){var i,r,n,o=t.geometry;if(void 0!==o)if(o.isGeometry){var l=o.vertices;for(i=0,r=l.length;i<r;i++)(n=l[i].clone()).applyMatrix4(t.matrixWorld),e.push(n)}else if(o.isBufferGeometry){var c=o.attributes.position;if(void 0!==c)for(i=0,r=c.count;i<r;i++)(n=new Vector3).fromBufferAttribute(c,i).applyMatrix4(t.matrixWorld),e.push(n)}})),this.setFromPoints(e)},containsPoint:function(e){for(var t=this.faces,i=0,r=t.length;i<r;i++){if(t[i].distanceToPoint(e)>this.tolerance)return!1}return!0},intersectRay:function(e,t){for(var r=this.faces,n=-1/0,o=1/0,i=0,l=r.length;i<l;i++){var c=r[i],h=c.distanceToPoint(e.origin),d=c.normal.dot(e.direction);if(h>0&&d>=0)return null;var f=0!==d?-h/d:0;if(!(f<=0)&&(d>0?o=Math.min(f,o):n=Math.max(f,n),n>o))return null}return n!==-1/0?e.at(n,t):e.at(o,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,r=e.outside;null!==r.next&&r.next.face===e;)r=r.next;return this.assigned.removeSubList(t,r),t.prev=r.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var r=this.removeAllVerticesFromFace(e);if(void 0!==r)if(void 0===t)this.unassigned.appendChain(r);else{var n=r;do{var o=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=o}while(null!==n)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var r=t.next,n=this.tolerance,o=null,i=0;i<e.length;i++){var l=e[i];if(0===l.mark){var c=l.distanceToPoint(t.point);if(c>n&&(n=c,o=l),n>1e3*this.tolerance)break}}null!==o&&this.addVertexToFace(t,o),t=r}while(null!==t)}return this},computeExtremes:function(){var i,e,t,r=new Vector3,n=new Vector3,o=[],l=[];for(i=0;i<3;i++)o[i]=l[i]=this.vertices[0];for(r.copy(this.vertices[0].point),n.copy(this.vertices[0].point),i=0,e=this.vertices.length;i<e;i++){var c=this.vertices[i],h=c.point;for(t=0;t<3;t++)h.getComponent(t)<r.getComponent(t)&&(r.setComponent(t,h.getComponent(t)),o[t]=c);for(t=0;t<3;t++)h.getComponent(t)>n.getComponent(t)&&(n.setComponent(t,h.getComponent(t)),l[t]=c)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(n.x))+Math.max(Math.abs(r.y),Math.abs(n.y))+Math.max(Math.abs(r.z),Math.abs(n.z))),{min:o,max:l}},computeInitialHull:function(){void 0===e&&(e=new Line3,t=new Plane,r=new Vector3);var n,o,l,h,d,i,f,m,v,y=this.vertices,x=this.computeExtremes(),_=x.min,M=x.max,w=0,S=0;for(i=0;i<3;i++)(v=M[i].point.getComponent(i)-_[i].point.getComponent(i))>w&&(w=v,S=i);for(o=_[S],l=M[S],w=0,e.set(o.point,l.point),i=0,f=this.vertices.length;i<f;i++)(n=y[i])!==o&&n!==l&&(e.closestPointToPoint(n.point,!0,r),(v=r.distanceToSquared(n.point))>w&&(w=v,h=n));for(w=-1,t.setFromCoplanarPoints(o.point,l.point,h.point),i=0,f=this.vertices.length;i<f;i++)(n=y[i])!==o&&n!==l&&n!==h&&(v=Math.abs(t.distanceToPoint(n.point)))>w&&(w=v,d=n);var A=[];if(t.distanceToPoint(d.point)<0)for(A.push(c.create(o,l,h),c.create(d,l,o),c.create(d,h,l),c.create(d,o,h)),i=0;i<3;i++)m=(i+1)%3,A[i+1].getEdge(2).setTwin(A[0].getEdge(m)),A[i+1].getEdge(1).setTwin(A[m+1].getEdge(0));else for(A.push(c.create(o,h,l),c.create(d,o,l),c.create(d,l,h),c.create(d,h,o)),i=0;i<3;i++)m=(i+1)%3,A[i+1].getEdge(2).setTwin(A[0].getEdge((3-i)%3)),A[i+1].getEdge(0).setTwin(A[m+1].getEdge(1));for(i=0;i<4;i++)this.faces.push(A[i]);for(i=0,f=y.length;i<f;i++)if((n=y[i])!==o&&n!==l&&n!==h&&n!==d){w=this.tolerance;var T=null;for(m=0;m<4;m++)(v=this.faces[m].distanceToPoint(n.point))>w&&(w=v,T=this.faces[m]);null!==T&&this.addVertexToFace(n,T)}return this},reindexFaces:function(){for(var e=[],i=0;i<this.faces.length;i++){var t=this.faces[i];0===t.mark&&e.push(t)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,r=this.assigned.first().face,n=r.outside;do{var o=r.distanceToPoint(n.point);o>t&&(t=o,e=n),n=n.next}while(null!==n&&n.face===r);return e}},computeHorizon:function(e,t,r,n){var o;this.deleteFaceVertices(r),r.mark=1,o=null===t?t=r.getEdge(0):t.next;do{var l=o.twin,c=l.face;0===c.mark&&(c.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,l,c,n):n.push(o)),o=o.next}while(o!==t);return this},addAdjoiningFace:function(e,t){var r=c.create(e,t.tail(),t.head());return this.faces.push(r),r.getEdge(-1).setTwin(t.twin),r.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var r=null,n=null,i=0;i<t.length;i++){var o=t[i],l=this.addAdjoiningFace(e,o);null===r?r=l:l.next.setTwin(n),this.newFaces.push(l.face),n=l}return r.next.setTwin(n),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(c,{create:function(a,b,e){var t=new c,r=new h(a,t),n=new h(b,t),o=new h(e,t);return r.next=o.prev=n,n.next=r.prev=o,o.next=n.prev=r,t.edge=r,t.compute()}}),Object.assign(c.prototype,{getEdge:function(i){for(var e=this.edge;i>0;)e=e.next,i--;for(;i<0;)e=e.prev,i++;return e},compute:function(){void 0===n&&(n=new Triangle);var a=this.edge.tail(),b=this.edge.head(),e=this.edge.next.head();return n.set(a.point,b.point,e.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(h.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var head=this.head(),e=this.tail();return null!==e?e.point.distanceTo(head.point):-1},lengthSquared:function(){var head=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(head.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(f.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(a,b){return null===a.prev?this.head=b.next:a.prev.next=b.next,null===b.next?this.tail=a.prev:b.next.prev=a.prev,this},isEmpty:function(){return null===this.head}}),l}(),ConvexGeometry=function(e){Geometry.call(this),this.fromBufferGeometry(new ConvexBufferGeometry(e)),this.mergeVertices()};ConvexGeometry.prototype=Object.create(Geometry.prototype),ConvexGeometry.prototype.constructor=ConvexGeometry;var ConvexBufferGeometry=function(e){BufferGeometry.call(this);var t=[],r=[];void 0===ConvexHull&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");for(var n=(new ConvexHull).setFromPoints(e).faces,i=0;i<n.length;i++){var o=n[i],l=o.edge;do{var c=l.head().point;t.push(c.x,c.y,c.z),r.push(o.normal.x,o.normal.y,o.normal.z),l=l.next}while(l!==o.edge)}this.setAttribute("position",new Float32BufferAttribute(t,3)),this.setAttribute("normal",new Float32BufferAttribute(r,3))};ConvexBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ConvexBufferGeometry.prototype.constructor=ConvexBufferGeometry;var DecalGeometry=function(e,t,r,n){BufferGeometry.call(this);var o=[],l=[],c=[],h=new Vector3,d=new Matrix4;d.makeRotationFromEuler(r),d.setPosition(t);var f=(new Matrix4).getInverse(d);function m(t,r,n){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(f),n.transformDirection(e.matrixWorld),t.push(new DecalVertex(r.clone(),n.clone()))}function v(e,t){for(var r=[],s=.5*Math.abs(n.dot(t)),i=0;i<e.length;i+=3){var o,l,c,h,d,f,m;switch(((o=e[i+0].position.dot(t)-s>0)?1:0)+((l=e[i+1].position.dot(t)-s>0)?1:0)+((c=e[i+2].position.dot(t)-s>0)?1:0)){case 0:r.push(e[i]),r.push(e[i+1]),r.push(e[i+2]);break;case 1:if(o&&(h=e[i+1],d=e[i+2],f=y(e[i],h,t,s),m=y(e[i],d,t,s)),l){h=e[i],d=e[i+2],f=y(e[i+1],h,t,s),m=y(e[i+1],d,t,s),r.push(f),r.push(d.clone()),r.push(h.clone()),r.push(d.clone()),r.push(f.clone()),r.push(m);break}c&&(h=e[i],d=e[i+1],f=y(e[i+2],h,t,s),m=y(e[i+2],d,t,s)),r.push(h.clone()),r.push(d.clone()),r.push(f),r.push(m),r.push(f.clone()),r.push(d.clone());break;case 2:o||(d=y(h=e[i].clone(),e[i+1],t,s),f=y(h,e[i+2],t,s),r.push(h),r.push(d),r.push(f)),l||(d=y(h=e[i+1].clone(),e[i+2],t,s),f=y(h,e[i],t,s),r.push(h),r.push(d),r.push(f)),c||(d=y(h=e[i+2].clone(),e[i],t,s),f=y(h,e[i+1],t,s),r.push(h),r.push(d),r.push(f))}}return r}function y(e,t,p,s){var r=e.position.dot(p)-s,n=r/(r-(t.position.dot(p)-s));return new DecalVertex(new Vector3(e.position.x+n*(t.position.x-e.position.x),e.position.y+n*(t.position.y-e.position.y),e.position.z+n*(t.position.z-e.position.z)),new Vector3(e.normal.x+n*(t.normal.x-e.normal.x),e.normal.y+n*(t.normal.y-e.normal.y),e.normal.z+n*(t.normal.z-e.normal.z)))}!function(){var i,t=new BufferGeometry,r=[],f=new Vector3,y=new Vector3;e.geometry.isGeometry?t.fromGeometry(e.geometry):t.copy(e.geometry);var x=t.attributes.position,_=t.attributes.normal;if(null!==t.index){var M=t.index;for(i=0;i<M.count;i++)f.fromBufferAttribute(x,M.getX(i)),y.fromBufferAttribute(_,M.getX(i)),m(r,f,y)}else for(i=0;i<x.count;i++)f.fromBufferAttribute(x,i),y.fromBufferAttribute(_,i),m(r,f,y);for(r=v(r,h.set(1,0,0)),r=v(r,h.set(-1,0,0)),r=v(r,h.set(0,1,0)),r=v(r,h.set(0,-1,0)),r=v(r,h.set(0,0,1)),r=v(r,h.set(0,0,-1)),i=0;i<r.length;i++){var w=r[i];c.push(.5+w.position.x/n.x,.5+w.position.y/n.y),w.position.applyMatrix4(d),o.push(w.position.x,w.position.y,w.position.z),l.push(w.normal.x,w.normal.y,w.normal.z)}}(),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))};DecalGeometry.prototype=Object.create(BufferGeometry.prototype),DecalGeometry.prototype.constructor=DecalGeometry;var DecalVertex=function(e,t){this.position=e,this.normal=t};DecalVertex.prototype.clone=function(){return new this.constructor(this.position.clone(),this.normal.clone())};var SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var i=0;i<256;i++)this.p[i]=Math.floor(256*e.random());this.perm=[];for(i=0;i<512;i++)this.perm[i]=this.p[255&i];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(g,e,t){return g[0]*e+g[1]*t},SimplexNoise.prototype.dot3=function(g,e,t,r){return g[0]*e+g[1]*t+g[2]*r},SimplexNoise.prototype.dot4=function(g,e,t,r,n){return g[0]*e+g[1]*t+g[2]*r+g[3]*n},SimplexNoise.prototype.noise=function(e,t){var r,n,s=(e+t)*(.5*(Math.sqrt(3)-1)),i=Math.floor(e+s),o=Math.floor(t+s),l=(3-Math.sqrt(3))/6,c=(i+o)*l,h=e-(i-c),d=t-(o-c);h>d?(r=1,n=0):(r=0,n=1);var f=h-r+l,m=d-n+l,v=h-1+2*l,y=d-1+2*l,x=255&i,_=255&o,M=this.perm[x+this.perm[_]]%12,w=this.perm[x+r+this.perm[_+n]]%12,S=this.perm[x+1+this.perm[_+1]]%12,A=.5-h*h-d*d,T=.5-f*f-m*m,L=.5-v*v-y*y;return 70*((A<0?0:(A*=A)*A*this.dot(this.grad3[M],h,d))+(T<0?0:(T*=T)*T*this.dot(this.grad3[w],f,m))+(L<0?0:(L*=L)*L*this.dot(this.grad3[S],v,y)))},SimplexNoise.prototype.noise3d=function(e,t,r){var n,o,l,c,h,d,s=(e+t+r)*(1/3),i=Math.floor(e+s),f=Math.floor(t+s),m=Math.floor(r+s),v=1/6,y=(i+f+m)*v,x=e-(i-y),_=t-(f-y),M=r-(m-y);x>=_?_>=M?(n=1,o=0,l=0,c=1,h=1,d=0):x>=M?(n=1,o=0,l=0,c=1,h=0,d=1):(n=0,o=0,l=1,c=1,h=0,d=1):_<M?(n=0,o=0,l=1,c=0,h=1,d=1):x<M?(n=0,o=1,l=0,c=0,h=1,d=1):(n=0,o=1,l=0,c=1,h=1,d=0);var w=x-n+v,S=_-o+v,A=M-l+v,T=x-c+2*v,L=_-h+2*v,C=M-d+2*v,N=x-1+.5,P=_-1+.5,F=M-1+.5,E=255&i,R=255&f,D=255&m,O=this.perm[E+this.perm[R+this.perm[D]]]%12,I=this.perm[E+n+this.perm[R+o+this.perm[D+l]]]%12,B=this.perm[E+c+this.perm[R+h+this.perm[D+d]]]%12,U=this.perm[E+1+this.perm[R+1+this.perm[D+1]]]%12,k=.6-x*x-_*_-M*M,V=.6-w*w-S*S-A*A,G=.6-T*T-L*L-C*C,z=.6-N*N-P*P-F*F;return 32*((k<0?0:(k*=k)*k*this.dot3(this.grad3[O],x,_,M))+(V<0?0:(V*=V)*V*this.dot3(this.grad3[I],w,S,A))+(G<0?0:(G*=G)*G*this.dot3(this.grad3[B],T,L,C))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[U],N,P,F)))},SimplexNoise.prototype.noise4d=function(e,t,r,n){var o,l,c,h,d,f,m,v,y,x,_,M,w=this.grad4,S=this.simplex,A=this.perm,T=(Math.sqrt(5)-1)/4,L=(5-Math.sqrt(5))/20,s=(e+t+r+n)*T,i=Math.floor(e+s),C=Math.floor(t+s),N=Math.floor(r+s),P=Math.floor(n+s),F=(i+C+N+P)*L,E=e-(i-F),R=t-(C-F),D=r-(N-F),O=n-(P-F),I=(E>R?32:0)+(E>D?16:0)+(R>D?8:0)+(E>O?4:0)+(R>O?2:0)+(D>O?1:0),B=E-(o=S[I][0]>=3?1:0)+L,U=R-(l=S[I][1]>=3?1:0)+L,k=D-(c=S[I][2]>=3?1:0)+L,V=O-(h=S[I][3]>=3?1:0)+L,G=E-(d=S[I][0]>=2?1:0)+2*L,z=R-(f=S[I][1]>=2?1:0)+2*L,j=D-(m=S[I][2]>=2?1:0)+2*L,W=O-(v=S[I][3]>=2?1:0)+2*L,H=E-(y=S[I][0]>=1?1:0)+3*L,X=R-(x=S[I][1]>=1?1:0)+3*L,Y=D-(_=S[I][2]>=1?1:0)+3*L,Q=O-(M=S[I][3]>=1?1:0)+3*L,K=E-1+4*L,J=R-1+4*L,Z=D-1+4*L,$=O-1+4*L,ee=255&i,te=255&C,re=255&N,ie=255&P,ne=A[ee+A[te+A[re+A[ie]]]]%32,ae=A[ee+o+A[te+l+A[re+c+A[ie+h]]]]%32,oe=A[ee+d+A[te+f+A[re+m+A[ie+v]]]]%32,se=A[ee+y+A[te+x+A[re+_+A[ie+M]]]]%32,le=A[ee+1+A[te+1+A[re+1+A[ie+1]]]]%32,ce=.6-E*E-R*R-D*D-O*O,ue=.6-B*B-U*U-k*k-V*V,he=.6-G*G-z*z-j*j-W*W,de=.6-H*H-X*X-Y*Y-Q*Q,pe=.6-K*K-J*J-Z*Z-$*$;return 27*((ce<0?0:(ce*=ce)*ce*this.dot4(w[ne],E,R,D,O))+(ue<0?0:(ue*=ue)*ue*this.dot4(w[ae],B,U,k,V))+(he<0?0:(he*=he)*he*this.dot4(w[oe],G,z,j,W))+(de<0?0:(de*=de)*de*this.dot4(w[se],H,X,Y,Q))+(pe<0?0:(pe*=pe)*pe*this.dot4(w[le],K,J,Z,$)))};var LightningStrike=function(e){BufferGeometry.call(this),this.type="LightningStrike",e=e||{},this.init(LightningStrike.copyParameters(e,e)),this.createMesh()};LightningStrike.prototype=Object.create(BufferGeometry.prototype),LightningStrike.prototype.constructor=LightningStrike,LightningStrike.prototype.isLightningStrike=!0,LightningStrike.RAY_INITIALIZED=0,LightningStrike.RAY_UNBORN=1,LightningStrike.RAY_PROPAGATING=2,LightningStrike.RAY_STEADY=3,LightningStrike.RAY_VANISHING=4,LightningStrike.RAY_EXTINGUISHED=5,LightningStrike.COS30DEG=Math.cos(30*Math.PI/180),LightningStrike.SIN30DEG=Math.sin(30*Math.PI/180),LightningStrike.createRandomGenerator=function(){for(var e=[],i=0;i<2053;i++)e.push(Math.random());var t={currentSeed:0,random:function(){var r=e[t.currentSeed];return t.currentSeed=(t.currentSeed+1)%2053,r},getSeed:function(){return t.currentSeed/2053},setSeed:function(e){t.currentSeed=Math.floor(2053*e)%2053}};return t},LightningStrike.copyParameters=function(e,source){source=source||{};var t=function(t){return source===e?t:t.clone()};return(e=e||{}).sourceOffset=void 0!==source.sourceOffset?t(source.sourceOffset):new Vector3(0,100,0),e.destOffset=void 0!==source.destOffset?t(source.destOffset):new Vector3(0,0,0),e.timeScale=void 0!==source.timeScale?source.timeScale:1,e.roughness=void 0!==source.roughness?source.roughness:.9,e.straightness=void 0!==source.straightness?source.straightness:.7,e.up0=void 0!==source.up0?t(source.up0):new Vector3(0,0,1),e.up1=void 0!==source.up1?t(source.up1):new Vector3(0,0,1),e.radius0=void 0!==source.radius0?source.radius0:1,e.radius1=void 0!==source.radius1?source.radius1:1,e.radius0Factor=void 0!==source.radius0Factor?source.radius0Factor:.5,e.radius1Factor=void 0!==source.radius1Factor?source.radius1Factor:.2,e.minRadius=void 0!==source.minRadius?source.minRadius:.2,e.isEternal=void 0!==source.isEternal?source.isEternal:void 0===source.birthTime||void 0===source.deathTime,e.birthTime=source.birthTime,e.deathTime=source.deathTime,e.propagationTimeFactor=void 0!==source.propagationTimeFactor?source.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==source.vanishingTimeFactor?source.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==source.subrayPeriod?source.subrayPeriod:4,e.subrayDutyCycle=void 0!==source.subrayDutyCycle?source.subrayDutyCycle:.6,e.maxIterations=void 0!==source.maxIterations?source.maxIterations:9,e.isStatic=void 0!==source.isStatic&&source.isStatic,e.ramification=void 0!==source.ramification?source.ramification:5,e.maxSubrayRecursion=void 0!==source.maxSubrayRecursion?source.maxSubrayRecursion:3,e.recursionProbability=void 0!==source.recursionProbability?source.recursionProbability:.6,e.generateUVs=void 0!==source.generateUVs&&source.generateUVs,e.randomGenerator=source.randomGenerator,e.noiseSeed=source.noiseSeed,e.onDecideSubrayCreation=source.onDecideSubrayCreation,e.onSubrayCreation=source.onSubrayCreation,e},LightningStrike.prototype.update=function(time){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=time&&time<=this.rayParameters.deathTime?(this.updateMesh(time),time<this.subrays[0].endPropagationTime?this.state=LightningStrike.RAY_PROPAGATING:time>this.subrays[0].beginVanishingTime?this.state=LightningStrike.RAY_VANISHING:this.state=LightningStrike.RAY_STEADY,this.visible=!0):(this.visible=!1,time<this.rayParameters.birthTime?this.state=LightningStrike.RAY_UNBORN:this.state=LightningStrike.RAY_EXTINGUISHED))},LightningStrike.prototype.init=function(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=LightningStrike.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=LightningStrike.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(var i=0;i<this.maxSubrays;i++)this.subrays.push(this.createSubray());this.raySegments=[];for(i=0;i<this.maxRaySegments;i++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new SimplexNoise(this.seedGenerator),this.simplexY=new SimplexNoise(this.seedGenerator),this.simplexZ=new SimplexNoise(this.seedGenerator),this.forwards=new Vector3,this.forwardsFill=new Vector3,this.side=new Vector3,this.down=new Vector3,this.middlePos=new Vector3,this.middleLinPos=new Vector3,this.newPos=new Vector3,this.vPos=new Vector3,this.cross1=new Vector3},LightningStrike.prototype.createMesh=function(){var e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,r=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(r),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new Uint32BufferAttribute(this.indices,1)),this.positionAttribute=new Float32BufferAttribute(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new Float32BufferAttribute(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=DynamicDrawUsage,this.positionAttribute.usage=DynamicDrawUsage,this.generateUVs&&(this.uvsAttribute.usage=DynamicDrawUsage)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)},LightningStrike.prototype.updateMesh=function(time){this.fillMesh(time),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)},LightningStrike.prototype.fillMesh=function(time){var e=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(time,(function(t){var r=e.currentSubray;time<r.birthTime||(this.rayParameters.isEternal&&0==e.currentSubray.recursion?(e.createPrism(t),e.onDecideSubrayCreation(t,e)):time<r.endPropagationTime?e.timeFraction>=t.fraction0*r.propagationTimeFactor&&(e.createPrism(t),e.onDecideSubrayCreation(t,e)):time<r.beginVanishingTime?(e.createPrism(t),e.onDecideSubrayCreation(t,e)):(e.timeFraction<=r.vanishingTimeFactor+t.fraction1*(1-r.vanishingTimeFactor)&&e.createPrism(t),e.onDecideSubrayCreation(t,e)))}))},LightningStrike.prototype.addNewSubray=function(){return this.subrays[this.numSubrays++]},LightningStrike.prototype.initSubray=function(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0},LightningStrike.prototype.fractalRay=function(time,e){this.time=time,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(var t=0;t<this.numSubrays;t++){var r=this.subrays[t];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=MathUtils.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=MathUtils.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);var n=this.randomGenerator.random;r.linPos0.set(n(),n(),n()).multiplyScalar(1e3),r.linPos1.set(n(),n(),n()).multiplyScalar(1e3),this.timeFraction=(time-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;var o=this.getNewSegment();o.iteration=0,o.pos0.copy(r.pos0),o.pos1.copy(r.pos1),o.linPos0.copy(r.linPos0),o.linPos1.copy(r.linPos1),o.up0.copy(r.up0),o.up1.copy(r.up1),o.radius0=r.radius0,o.radius1=r.radius1,o.fraction0=0,o.fraction1=1,o.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(o)}this.currentSegmentCallback=null,this.currentSubray=null},LightningStrike.prototype.fractalRayRecursive=function(e){if(e.iteration>=this.currentSubray.maxIterations)this.currentSegmentCallback(e);else{this.forwards.subVectors(e.pos1,e.pos0);var t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());var r=.5*(e.radius0+e.radius1),n=.5*(e.fraction0+e.fraction1),o=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);var p=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(p.x,p.y,p.z,o),this.simplexY.noise4d(p.x,p.y,p.z,o),this.simplexZ.noise4d(p.x,p.y,p.z,o)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);var l=this.getNewSegment();l.pos0.copy(e.pos0),l.pos1.copy(this.newPos),l.linPos0.copy(e.linPos0),l.linPos1.copy(this.middleLinPos),l.up0.copy(e.up0),l.up1.copy(e.up1),l.radius0=e.radius0,l.radius1=r,l.fraction0=e.fraction0,l.fraction1=n,l.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,l.iteration=e.iteration+1;var c=this.getNewSegment();c.pos0.copy(this.newPos),c.pos1.copy(e.pos1),c.linPos0.copy(this.middleLinPos),c.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),c.up0.crossVectors(this.forwards,this.cross1).normalize(),c.up1.copy(e.up1),c.radius0=r,c.radius1=e.radius1,c.fraction0=n,c.fraction1=e.fraction1,c.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,c.iteration=e.iteration+1,this.fractalRayRecursive(l),this.fractalRayRecursive(c)}},LightningStrike.prototype.createPrism=function(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()},LightningStrike.prototype.createTriangleVerticesWithoutUVs=function(e,t,r,n){this.side.crossVectors(t,r).multiplyScalar(n*LightningStrike.COS30DEG),this.down.copy(t).multiplyScalar(-n*LightningStrike.SIN30DEG);var p=this.vPos,o=this.vertices;p.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,p.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,p.copy(t).multiplyScalar(n).add(e),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,this.currentVertex+=3},LightningStrike.prototype.createTriangleVerticesWithUVs=function(e,t,r,n,u){this.side.crossVectors(t,r).multiplyScalar(n*LightningStrike.COS30DEG),this.down.copy(t).multiplyScalar(-n*LightningStrike.SIN30DEG);var p=this.vPos,o=this.vertices,l=this.uvs;p.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,l[this.currentUVCoordinate++]=u,l[this.currentUVCoordinate++]=0,p.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,l[this.currentUVCoordinate++]=u,l[this.currentUVCoordinate++]=.5,p.copy(t).multiplyScalar(n).add(e),o[this.currentCoordinate++]=p.x,o[this.currentCoordinate++]=p.y,o[this.currentCoordinate++]=p.z,l[this.currentUVCoordinate++]=u,l[this.currentUVCoordinate++]=1,this.currentVertex+=3},LightningStrike.prototype.createPrismFaces=function(e){var t=this.indices;e=this.currentVertex-6;t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+5},LightningStrike.prototype.createDefaultSubrayCreationCallbacks=function(){var e=this.randomGenerator.random;this.onDecideSubrayCreation=function(t,r){var n=r.currentSubray,o=r.rayParameters.subrayPeriod,l=r.rayParameters.subrayDutyCycle,c=r.rayParameters.isEternal&&0==n.recursion?-e()*o:MathUtils.lerp(n.birthTime,n.endPropagationTime,t.fraction0)-e()*o,h=r.time-c,d=Math.floor(h/o),f=e()*(d+1),m=0;if(h%o<=l*o&&(m=r.subrayProbability),n.recursion<r.maxSubrayRecursion&&r.numSubrays<r.maxSubrays&&e()<m){var v=r.addNewSubray(),y=r.randomGenerator.getSeed();v.seed=f,r.randomGenerator.setSeed(f),v.recursion=n.recursion+1,v.maxIterations=Math.max(1,n.maxIterations-1),v.linPos0.set(e(),e(),e()).multiplyScalar(1e3),v.linPos1.set(e(),e(),e()).multiplyScalar(1e3),v.up0.copy(n.up0),v.up1.copy(n.up1),v.radius0=t.radius0*r.rayParameters.radius0Factor,v.radius1=Math.min(r.rayParameters.minRadius,t.radius1*r.rayParameters.radius1Factor),v.birthTime=c+d*o,v.deathTime=v.birthTime+o*l,r.rayParameters.isEternal||0!=n.recursion||(v.birthTime=Math.max(v.birthTime,n.birthTime),v.deathTime=Math.min(v.deathTime,n.deathTime)),v.timeScale=2*n.timeScale,v.roughness=n.roughness,v.straightness=n.straightness,v.propagationTimeFactor=n.propagationTimeFactor,v.vanishingTimeFactor=n.vanishingTimeFactor,r.onSubrayCreation(t,n,v,r),r.randomGenerator.setSeed(y)}};var t=new Vector3,r=new Vector3,n=new Vector3,o=new Vector3;this.onSubrayCreation=function(e,t,r,n){n.subrayCylinderPosition(e,t,r,.5,.6,.2)},this.subrayConePosition=function(l,c,h,d,f,m){h.pos0.copy(l.pos0),t.subVectors(c.pos1,c.pos0),r.copy(t).normalize(),t.multiplyScalar(l.fraction0+(1-l.fraction0)*(e()*d));var v=t.length();n.crossVectors(c.up0,r);var y=2*Math.PI*e();n.multiplyScalar(Math.cos(y)),o.copy(c.up0).multiplyScalar(Math.sin(y)),h.pos1.copy(n).add(o).multiplyScalar(v*f*(m+e()*(1-m))).add(t).add(c.pos0)},this.subrayCylinderPosition=function(l,c,h,d,f,m){h.pos0.copy(l.pos0),t.subVectors(c.pos1,c.pos0),r.copy(t).normalize(),t.multiplyScalar(l.fraction0+(1-l.fraction0)*((2*e()-1)*d));var v=t.length();n.crossVectors(c.up0,r);var y=2*Math.PI*e();n.multiplyScalar(Math.cos(y)),o.copy(c.up0).multiplyScalar(Math.sin(y)),h.pos1.copy(n).add(o).multiplyScalar(v*f*(m+e()*(1-m))).add(t).add(c.pos0)}},LightningStrike.prototype.createSubray=function(){return{seed:0,maxIterations:0,recursion:0,pos0:new Vector3,pos1:new Vector3,linPos0:new Vector3,linPos1:new Vector3,up0:new Vector3,up1:new Vector3,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}},LightningStrike.prototype.createSegment=function(){return{iteration:0,pos0:new Vector3,pos1:new Vector3,linPos0:new Vector3,linPos1:new Vector3,up0:new Vector3,up1:new Vector3,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}},LightningStrike.prototype.getNewSegment=function(){return this.raySegments[this.currentSegmentIndex++]},LightningStrike.prototype.copy=function(source){return BufferGeometry.prototype.copy.call(this,source),this.init(LightningStrike.copyParameters({},source.rayParameters)),this},LightningStrike.prototype.clone=function(){return new this.constructor(LightningStrike.copyParameters({},this.rayParameters))};var _axis=new Vector3,_lineGeometry,_coneGeometry;function ArrowHelper(e,t,r,n,o,l){Object3D.call(this),void 0===e&&(e=new Vector3(0,0,1)),void 0===t&&(t=new Vector3(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===o&&(o=.2*r),void 0===l&&(l=.2*o),void 0===_lineGeometry&&((_lineGeometry=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,l)}function ParametricGeometry(e,t,r){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,r)),this.mergeVertices()}function ParametricBufferGeometry(e,t,r){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,o=[],l=[],c=[],h=[],d=1e-5,f=new Vector3,m=new Vector3,v=new Vector3,y=new Vector3,x=new Vector3;e.length<3&&console.error("ParametricGeometry: Function must now modify a Vector3 as third parameter.");var _=t+1;for(i=0;i<=r;i++){var M=i/r;for(n=0;n<=t;n++){var u=n/t;e(u,M,m),l.push(m.x,m.y,m.z),u-d>=0?(e(u-d,M,v),y.subVectors(m,v)):(e(u+d,M,v),y.subVectors(v,m)),M-d>=0?(e(u,M-d,v),x.subVectors(m,v)):(e(u,M+d,v),x.subVectors(v,m)),f.crossVectors(y,x).normalize(),c.push(f.x,f.y,f.z),h.push(u,M)}}for(i=0;i<r;i++)for(n=0;n<t;n++){var a=i*_+n,b=i*_+n+1,w=(i+1)*_+n+1,S=(i+1)*_+n;o.push(a,b,S),o.push(b,w,S)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_axis,t)}},ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},ArrowHelper.prototype.copy=function(source){return Object3D.prototype.copy.call(this,source,!1),this.line.copy(source.line),this.cone.copy(source.cone),this},ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)},ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;var ParametricGeometries={klein:function(e,u,t){var r,n,o;u*=Math.PI,e*=2*Math.PI,(u*=2)<Math.PI?(r=3*Math.cos(u)*(1+Math.sin(u))+2*(1-Math.cos(u)/2)*Math.cos(u)*Math.cos(e),o=-8*Math.sin(u)-2*(1-Math.cos(u)/2)*Math.sin(u)*Math.cos(e)):(r=3*Math.cos(u)*(1+Math.sin(u))+2*(1-Math.cos(u)/2)*Math.cos(e+Math.PI),o=-8*Math.sin(u)),n=-2*(1-Math.cos(u)/2)*Math.sin(e),t.set(r,n,o)},plane:function(e,t){return function(u,r,n){var o=u*e,l=r*t;n.set(o,0,l)}},mobius:function(u,e,t){u-=.5;var r,n,o,l=2*Math.PI*e;r=Math.cos(l)*(2+u*Math.cos(l/2)),n=Math.sin(l)*(2+u*Math.cos(l/2)),o=u*Math.sin(l/2),t.set(r,n,o)},mobius3d:function(u,e,t){u*=Math.PI,e*=2*Math.PI;var r,n,o,l=(u*=2)/2;r=.125*Math.cos(e)*Math.cos(l)-.65*Math.sin(e)*Math.sin(l),o=.125*Math.cos(e)*Math.sin(l)+.65*Math.sin(e)*Math.cos(l),n=(2.25+r)*Math.sin(u),r=(2.25+r)*Math.cos(u),t.set(r,n,o)},TubeGeometry:function(path,e,t,r,n,o){this.path=path,this.segments=e||64,this.radius=t||1,this.segmentsRadius=r||8,this.closed=n||!1,o&&(this.debug=new Object3D);var l=this,c=this.segments+1,h=path.computeFrenetFrames(e,n),d=h.tangents,f=h.normals,m=h.binormals;this.tangents=d,this.normals=f,this.binormals=m;ParametricGeometry.call(this,(function(u,e,r){e*=2*Math.PI;var i=u*(c-1);i=Math.floor(i);var n=path.getPointAt(u),o=d[i],h=f[i],v=m[i];l.debug&&(l.debug.add(new ArrowHelper(o,n,t,255)),l.debug.add(new ArrowHelper(h,n,t,16711680)),l.debug.add(new ArrowHelper(v,n,t,65280)));var y=-l.radius*Math.cos(e),x=l.radius*Math.sin(e);n.x+=y*h.x+x*v.x,n.y+=y*h.y+x*v.y,n.z+=y*h.z+x*v.z,r.copy(n)}),e,r)}};ParametricGeometries.TubeGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometries.TubeGeometry.prototype.constructor=ParametricGeometries.TubeGeometry,ParametricGeometries.TorusKnotGeometry=function(e,t,r,n,p,q){function o(){Curve.call(this)}this.radius=e||200,this.tube=t||40,this.segmentsT=r||64,this.segmentsR=n||8,this.p=p||2,this.q=q||3,o.prototype=Object.create(Curve.prototype),o.prototype.constructor=o,o.prototype.getPoint=function(t,r){var n=r||new Vector3;t*=2*Math.PI;var o=(1+.5*Math.cos(q*t))*Math.cos(p*t),l=(1+.5*Math.cos(q*t))*Math.sin(p*t),c=.5*Math.sin(q*t);return n.set(o,l,c).multiplyScalar(e)};var l=r,c=n,h=new o;ParametricGeometries.TubeGeometry.call(this,h,l,t,c,!0,!1)},ParametricGeometries.TorusKnotGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometries.TorusKnotGeometry.prototype.constructor=ParametricGeometries.TorusKnotGeometry,ParametricGeometries.SphereGeometry=function(e,u,t){ParametricGeometry.call(this,(function(u,t,r){u*=Math.PI,t*=2*Math.PI;var n=e*Math.sin(u)*Math.cos(t),o=e*Math.sin(u)*Math.sin(t),l=e*Math.cos(u);r.set(n,o,l)}),u,t)},ParametricGeometries.SphereGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometries.SphereGeometry.prototype.constructor=ParametricGeometries.SphereGeometry,ParametricGeometries.PlaneGeometry=function(e,t,r,n){ParametricGeometry.call(this,(function(u,r,n){var o=u*e,l=r*t;n.set(o,0,l)}),r,n)},ParametricGeometries.PlaneGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometries.PlaneGeometry.prototype.constructor=ParametricGeometries.PlaneGeometry;var TeapotBufferGeometry=function(e,t,r,n,body,o,l){var c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],h=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];BufferGeometry.call(this),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,o=void 0===o||o;var d=3.15*((l=void 0===l||l)?1:1.3)/2,f=e/d,m=(r=void 0===r||r)?(8*t-4)*t:0;m+=(n=void 0===n||n)?(16*t-4)*t:0,m+=(body=void 0===body||body)?40*t*t:0;var v=new Uint32Array(3*m),y=r?4:0;y+=n?8:0,y+=body?20:0,y*=(t+1)*(t+1);var x=new Float32Array(3*y),_=new Float32Array(3*y),M=new Float32Array(2*y),w=new Matrix4;w.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var i,S,A,T,L,C,N,s,P,F,E,p,R,D,O,I,g=[],B=[],U=[],k=[],V=[],G=[],z=[],j=[],W=[],H=new Vector3,X=0,Y=0,Q=new Vector3,K=new Matrix4,J=new Matrix4,Z=new Vector4,$=new Vector4,ee=new Vector4,te=new Vector4,re=new Vector3,ie=new Vector3,ne=w.clone();ne.transpose();var ae=function(e,t,r){return!(x[3*e]===x[3*t]&&x[3*e+1]===x[3*t+1]&&x[3*e+2]===x[3*t+2]||x[3*e]===x[3*r]&&x[3*e+1]===x[3*r+1]&&x[3*e+2]===x[3*r+2]||x[3*t]===x[3*r]&&x[3*t+1]===x[3*r+1]&&x[3*t+2]===x[3*r+2])};for(i=0;i<3;i++)G[i]=new Matrix4;var oe=r?32:28;N=t+1;for(var se=0,le=0,ce=0,ue=0,he=0,de=body?0:20;de<oe;de++)if(n||de<20||de>=28){for(i=0;i<3;i++){for(S=0;S<4;S++)for(A=0;A<4;A++)g[4*A+S]=h[3*c[16*de+4*S+A]+i],o&&de>=20&&de<28&&2!==i&&(g[4*A+S]*=1.077),l||2!==i||(g[4*A+S]*=1.3);K.set(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),J.multiplyMatrices(K,w),G[i].multiplyMatrices(ne,J)}for(L=0;L<=t;L++)for(s=L/t,C=0;C<=t;C++){for(P=C/t,p=4,F=E=1;p--;)B[p]=F,U[p]=E,F*=s,E*=P,3===p?(k[p]=V[p]=0,X=Y=1):(k[p]=X*(3-p),V[p]=Y*(3-p),X*=s,Y*=P);for(Z.fromArray(B),$.fromArray(U),ee.fromArray(k),te.fromArray(V),i=0;i<3;i++)(T=Z.clone()).applyMatrix4(G[i]),z[i]=T.dot($),(T=ee.clone()).applyMatrix4(G[i]),j[i]=T.dot($),(T=Z.clone()).applyMatrix4(G[i]),W[i]=T.dot(te);re.fromArray(j),ie.fromArray(W),H.crossVectors(ie,re),H.normalize(),0===z[0]&&0===z[1]?Q.set(0,z[2]>d?1:-1,0):Q.set(H.x,H.z,-H.y),x[le++]=f*z[0],x[le++]=f*(z[2]-d),x[le++]=-f*z[1],_[ce++]=Q.x,_[ce++]=Q.y,_[ce++]=Q.z,M[ue++]=1-P,M[ue++]=1-s}for(L=0;L<t;L++)for(C=0;C<t;C++)I=(R=se*N*N+L*N+C)+N,ae(R,D=R+1,O=D+N)&&(v[he++]=R,v[he++]=D,v[he++]=O),ae(R,O,I)&&(v[he++]=R,v[he++]=O,v[he++]=I);se++}this.setIndex(new BufferAttribute(v,1)),this.setAttribute("position",new BufferAttribute(x,3)),this.setAttribute("normal",new BufferAttribute(_,3)),this.setAttribute("uv",new BufferAttribute(M,2)),this.computeBoundingSphere()};TeapotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TeapotBufferGeometry.prototype.constructor=TeapotBufferGeometry;var _start$1=new Vector3,_end$1=new Vector3;function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],i=0,n=t.count;i<n;i+=2)_start$1.fromBufferAttribute(t,i),_end$1.fromBufferAttribute(t,i+1),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(r=e.lineDistances,i=0,n=o.length;i<n;i+=2)_start$1.copy(o[i]),_end$1.copy(o[i+1]),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+_start$1.distanceTo(_end$1)}return this}});var _v1$4=new Vector3,_v2$2=new Vector3,_normalMatrix$1=new Matrix3;function FaceNormalsHelper(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;var n=void 0!==t?t:16776960,o=void 0!==r?r:1,l=0,c=this.object.geometry;c&&c.isGeometry?l=c.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var h=new BufferGeometry,d=new Float32BufferAttribute(2*l*3,3);h.setAttribute("position",d),LineSegments.call(this,h,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function LightProbeHelper(e,t){this.lightProbe=e,this.size=t;var r=new ShaderMaterial({type:"LightProbeHelperMaterial",uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\tgl_FragColor = linearToOutputTexel( vec4( outgoingLight, 1.0 ) );","}"].join("\n")}),n=new SphereBufferGeometry(1,32,16);Mesh.call(this,n,r),this.onBeforeRender()}function PositionalAudioHelper(audio,e,t,r){this.audio=audio,this.range=e||1,this.divisionsInnerAngle=t||16,this.divisionsOuterAngle=r||2;var n=new BufferGeometry,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,l=new Float32Array(3*(3*o+3));n.setAttribute("position",new BufferAttribute(l,3));var c=new LineBasicMaterial({color:65280}),h=new LineBasicMaterial({color:16776960});Line.call(this,n,[h,c]),this.update()}function RectAreaLightHelper(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var n=new LineBasicMaterial({fog:!1});Line.call(this,r,n);var o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new Mesh(o,new MeshBasicMaterial({side:BackSide,fog:!1}))),this.update()}FaceNormalsHelper.prototype=Object.create(LineSegments.prototype),FaceNormalsHelper.prototype.constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){this.object.updateMatrixWorld(!0),_normalMatrix$1.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.vertices,o=r.faces,l=0,i=0,c=o.length;i<c;i++){var h=o[i],d=h.normal;_v1$4.copy(n[h.a]).add(n[h.b]).add(n[h.c]).divideScalar(3).applyMatrix4(e),_v2$2.copy(d).applyMatrix3(_normalMatrix$1).normalize().multiplyScalar(this.size).add(_v1$4),t.setXYZ(l,_v1$4.x,_v1$4.y,_v1$4.z),l+=1,t.setXYZ(l,_v2$2.x,_v2$2.y,_v2$2.z),l+=1}t.needsUpdate=!0},LightProbeHelper.prototype=Object.create(Mesh.prototype),LightProbeHelper.prototype.constructor=LightProbeHelper,LightProbeHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},LightProbeHelper.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},PositionalAudioHelper.prototype=Object.create(Line.prototype),PositionalAudioHelper.prototype.constructor=PositionalAudioHelper,PositionalAudioHelper.prototype.update=function(){var i,e,audio=this.audio,t=this.range,r=this.divisionsInnerAngle,n=this.divisionsOuterAngle,o=MathUtils.degToRad(audio.panner.coneInnerAngle),l=MathUtils.degToRad(audio.panner.coneOuterAngle),c=o/2,h=l/2,d=0,f=0,m=this.geometry,v=m.attributes.position;function y(r,n,o,l){var c=(n-r)/o;for(v.setXYZ(d,0,0,0),f++,i=r;i<n;i+=c)e=d+f,v.setXYZ(e,Math.sin(i)*t,0,Math.cos(i)*t),v.setXYZ(e+1,Math.sin(Math.min(i+c,n))*t,0,Math.cos(Math.min(i+c,n))*t),v.setXYZ(e+2,0,0,0),f+=3;m.addGroup(d,f,l),d+=f,f=0}m.clearGroups(),y(-h,-c,n,0),y(-c,c,r,1),y(c,h,n,0),v.needsUpdate=!0,o===l&&(this.material[0].visible=!1)},PositionalAudioHelper.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},RectAreaLightHelper.prototype=Object.create(Line.prototype),RectAreaLightHelper.prototype.constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},RectAreaLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var _v1$5=new Vector3,_v2$3=new Vector3,_normalMatrix$2=new Matrix3,_keys=["a","b","c"];function VertexNormalsHelper(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;var n=void 0!==t?t:16711680,o=void 0!==r?r:1,l=0,c=this.object.geometry;c&&c.isGeometry?l=3*c.faces.length:c&&c.isBufferGeometry&&(l=c.attributes.normal.count);var h=new BufferGeometry,d=new Float32BufferAttribute(2*l*3,3);h.setAttribute("position",d),LineSegments.call(this,h,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}VertexNormalsHelper.prototype=Object.create(LineSegments.prototype),VertexNormalsHelper.prototype.constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){this.object.updateMatrixWorld(!0),_normalMatrix$2.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r&&r.isGeometry)for(var n=r.vertices,o=r.faces,l=0,i=0,c=o.length;i<c;i++)for(var h=o[i],d=0,f=h.vertexNormals.length;d<f;d++){var m=n[h[_keys[d]]],v=h.vertexNormals[d];_v1$5.copy(m).applyMatrix4(e),_v2$3.copy(v).applyMatrix3(_normalMatrix$2).normalize().multiplyScalar(this.size).add(_v1$5),t.setXYZ(l,_v1$5.x,_v1$5.y,_v1$5.z),l+=1,t.setXYZ(l,_v2$3.x,_v2$3.y,_v2$3.z),l+=1}else if(r&&r.isBufferGeometry){var y=r.attributes.position,x=r.attributes.normal;for(l=0,d=0,f=y.count;d<f;d++)_v1$5.set(y.getX(d),y.getY(d),y.getZ(d)).applyMatrix4(e),_v2$3.set(x.getX(d),x.getY(d),x.getZ(d)),_v2$3.applyMatrix3(_normalMatrix$2).normalize().multiplyScalar(this.size).add(_v1$5),t.setXYZ(l,_v1$5.x,_v1$5.y,_v1$5.z),l+=1,t.setXYZ(l,_v2$3.x,_v2$3.y,_v2$3.z),l+=1}t.needsUpdate=!0};var _v1$6=new Vector3,_v2$4=new Vector3;function VertexTangentsHelper(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;var n=void 0!==t?t:65535,o=void 0!==r?r:1,l=this.object.geometry;if(l&&l.isBufferGeometry){var c=l.attributes.tangent.count,h=new BufferGeometry,d=new Float32BufferAttribute(2*c*3,3);h.setAttribute("position",d),LineSegments.call(this,h,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}else console.error("VertexTangentsHelper: geometry not an instance of BufferGeometry.",l)}VertexTangentsHelper.prototype=Object.create(LineSegments.prototype),VertexTangentsHelper.prototype.constructor=VertexTangentsHelper,VertexTangentsHelper.prototype.update=function(){this.object.updateMatrixWorld(!0);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.attributes.position,o=r.attributes.tangent,l=0,c=0,h=n.count;c<h;c++)_v1$6.set(n.getX(c),n.getY(c),n.getZ(c)).applyMatrix4(e),_v2$4.set(o.getX(c),o.getY(c),o.getZ(c)),_v2$4.transformDirection(e).multiplyScalar(this.size).add(_v1$6),t.setXYZ(l,_v1$6.x,_v1$6.y,_v1$6.z),l+=1,t.setXYZ(l,_v2$4.x,_v2$4.y,_v2$4.z),l+=1;t.needsUpdate=!0};var _sphere$2=new Sphere,_vector$5=new Vector3;function Frustum(e,t,r,n,o,l){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==o?o:new Plane,void 0!==l?l:new Plane]}Object.assign(Frustum.prototype,{set:function(e,t,r,n,o,l){var c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(r),c[3].copy(n),c[4].copy(o),c[5].copy(l),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromProjectionMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],o=r[1],l=r[2],c=r[3],h=r[4],d=r[5],f=r[6],m=r[7],v=r[8],y=r[9],x=r[10],_=r[11],M=r[12],w=r[13],S=r[14],A=r[15];return t[0].setComponents(c-n,m-h,_-v,A-M).normalize(),t[1].setComponents(c+n,m+h,_+v,A+M).normalize(),t[2].setComponents(c+o,m+d,_+y,A+w).normalize(),t[3].setComponents(c-o,m-d,_-y,A-w).normalize(),t[4].setComponents(c-l,m-f,_-x,A-S).normalize(),t[5].setComponents(c+l,m+f,_+x,A+S).normalize(),this},intersectsObject:function(object){var e=object.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$2.copy(e.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(_sphere$2)},intersectsSprite:function(e){return _sphere$2.center.set(0,0,0),_sphere$2.radius=.7071067811865476,_sphere$2.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$2)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(_vector$5.x=r.normal.x>0?e.max.x:e.min.x,_vector$5.y=r.normal.y>0?e.max.y:e.min.y,_vector$5.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(_vector$5)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var SelectionBox=function(){var e=new Frustum,t=new Vector3,r=new Vector3,n=new Vector3,o=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3,d=new Vector3,f=new Vector3,m=new Vector3;function v(e,t,r){this.camera=e,this.scene=t,this.startPoint=new Vector3,this.endPoint=new Vector3,this.collection=[],this.deep=r||Number.MAX_VALUE}return v.prototype.select=function(t,r){return this.startPoint=t||this.startPoint,this.endPoint=r||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection},v.prototype.updateFrustum=function(t,v){t=t||this.startPoint,v=v||this.endPoint,this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),r.copy(t),r.x=Math.min(t.x,v.x),r.y=Math.max(t.y,v.y),v.x=Math.max(t.x,v.x),v.y=Math.min(t.y,v.y),n.copy(this.camera.position),o.copy(r),l.set(v.x,r.y,0),c.copy(v),h.set(r.x,v.y,0),o.unproject(this.camera),l.unproject(this.camera),c.unproject(this.camera),h.unproject(this.camera),d.copy(o).sub(n),f.copy(l).sub(n),m.copy(c).sub(n),d.normalize(),f.normalize(),m.normalize(),d.multiplyScalar(this.deep),f.multiplyScalar(this.deep),m.multiplyScalar(this.deep),d.add(n),f.add(n),m.add(n);var y=e.planes;y[0].setFromCoplanarPoints(n,o,l),y[1].setFromCoplanarPoints(n,l,c),y[2].setFromCoplanarPoints(c,h,n),y[3].setFromCoplanarPoints(h,o,n),y[4].setFromCoplanarPoints(l,c,h),y[5].setFromCoplanarPoints(m,f,d),y[5].normal.multiplyScalar(-1)},v.prototype.searchChildInFrustum=function(e,object){if(object.isMesh&&void 0!==object.material&&(object.geometry.computeBoundingSphere(),t.copy(object.geometry.boundingSphere.center),t.applyMatrix4(object.matrixWorld),e.containsPoint(t)&&this.collection.push(object)),object.children.length>0)for(var r=0;r<object.children.length;r++)this.searchChildInFrustum(e,object.children[r])},v}(),SelectionHelper=function(){function e(e,t,r){this.element=document.createElement("div"),this.element.classList.add(r),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint=new Vector2,this.pointTopLeft=new Vector2,this.pointBottomRight=new Vector2,this.isDown=!1,this.renderer.domElement.addEventListener("mousedown",function(e){this.isDown=!0,this.onSelectStart(e)}.bind(this),!1),this.renderer.domElement.addEventListener("mousemove",function(e){this.isDown&&this.onSelectMove(e)}.bind(this),!1),this.renderer.domElement.addEventListener("mouseup",function(e){this.isDown=!1,this.onSelectOver(e)}.bind(this),!1)}return e.prototype.onSelectStart=function(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY},e.prototype.onSelectMove=function(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"},e.prototype.onSelectOver=function(){this.element.parentElement.removeChild(this.element)},e}();function SphericalHarmonics3(){this.coefficients=[];for(var i=0;i<9;i++)this.coefficients.push(new Vector3)}function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function LightProbe(e,t){Light.call(this,void 0,t),this.sh=void 0!==e?e:new SphericalHarmonics3}Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this},zero:function(){for(var i=0;i<9;i++)this.coefficients[i].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScale(l[1],.488603*n),t.addScale(l[2],.488603*o),t.addScale(l[3],.488603*r),t.addScale(l[4],r*n*1.092548),t.addScale(l[5],n*o*1.092548),t.addScale(l[6],.315392*(3*o*o-1)),t.addScale(l[7],r*o*1.092548),t.addScale(l[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScale(l[1],1.023328*n),t.addScale(l[2],1.023328*o),t.addScale(l[3],1.023328*r),t.addScale(l[4],.858086*r*n),t.addScale(l[5],.858086*n*o),t.addScale(l[6],.743125*o*o-.247708),t.addScale(l[7],.858086*r*o),t.addScale(l[8],.429043*(r*r-n*n)),t},add:function(e){for(var i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this},scale:function(s){for(var i=0;i<9;i++)this.coefficients[i].multiplyScalar(s);return this},lerp:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},equals:function(e){for(var i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}}),Object.assign(SphericalHarmonics3,{getBasisAt:function(e,t){var r=e.x,n=e.y,o=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*o,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*r*o,t[8]=.546274*(r*r-n*n)}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(source){return Object3D.prototype.copy.call(this,source),this.color.copy(source.color),this.intensity=source.intensity,this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.color=this.color.getHex(),data.object.intensity=this.intensity,void 0!==this.groundColor&&(data.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(data.object.distance=this.distance),void 0!==this.angle&&(data.object.angle=this.angle),void 0!==this.decay&&(data.object.decay=this.decay),void 0!==this.penumbra&&(data.object.penumbra=this.penumbra),void 0!==this.shadow&&(data.object.shadow=this.shadow.toJSON()),data}}),LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.sh.copy(source.sh),this.intensity=source.intensity,this},toJSON:function(meta){return Light.prototype.toJSON.call(this,meta)}});var LightProbeGenerator={fromCubeTexture:function(e){for(var t,r,n,o=0,l=new Vector3,c=new Vector3,h=new Color,d=[0,0,0,0,0,0,0,0,0],f=new SphericalHarmonics3,m=f.coefficients,v=0;v<6;v++){var image=e.image[v],y=image.width,x=image.height,canvas=document.createElement("canvas");canvas.width=y,canvas.height=x;var _=canvas.getContext("2d");_.drawImage(image,0,0,y,x);for(var M=_.getImageData(0,0,y,x),data=M.data,w=M.width,S=2/w,i=0,A=data.length;i<A;i+=4){h.setRGB(data[i]/255,data[i+1]/255,data[i+2]/255),convertColorToLinear(h,e.encoding);var T=i/4,col=(T%w+.5)*S-1,L=1-(Math.floor(T/w)+.5)*S;switch(v){case 0:l.set(-1,L,-col);break;case 1:l.set(1,L,col);break;case 2:l.set(-col,1,-L);break;case 3:l.set(-col,-1,L);break;case 4:l.set(-col,L,1);break;case 5:l.set(col,L,-1)}r=l.lengthSq(),o+=n=4/(Math.sqrt(r)*r),c.copy(l).normalize(),SphericalHarmonics3.getBasisAt(c,d);for(var C=0;C<9;C++)m[C].x+=d[C]*h.r*n,m[C].y+=d[C]*h.g*n,m[C].z+=d[C]*h.b*n}}t=4*Math.PI/o;for(C=0;C<9;C++)m[C].x*=t,m[C].y*=t,m[C].z*=t;return new LightProbe(f)},fromCubeRenderTarget:function(e,t){for(var r,n,o,l=0,c=new Vector3,h=new Vector3,d=new Color,f=[0,0,0,0,0,0,0,0,0],m=new SphericalHarmonics3,v=m.coefficients,y=0;y<6;y++){var x=t.width,data=new Uint8Array(x*x*4);e.readRenderTargetPixels(t,0,0,x,x,data,y);for(var _=2/x,i=0,M=data.length;i<M;i+=4){d.setRGB(data[i]/255,data[i+1]/255,data[i+2]/255),convertColorToLinear(d,t.texture.encoding);var w=i/4,col=(w%x+.5)*_-1,S=1-(Math.floor(w/x)+.5)*_;switch(y){case 0:c.set(1,S,-col);break;case 1:c.set(-1,S,col);break;case 2:c.set(col,1,-S);break;case 3:c.set(col,-1,S);break;case 4:c.set(col,S,1);break;case 5:c.set(-col,S,-1)}n=c.lengthSq(),l+=o=4/(Math.sqrt(n)*n),h.copy(c).normalize(),SphericalHarmonics3.getBasisAt(h,f);for(var A=0;A<9;A++)v[A].x+=f[A]*d.r*o,v[A].y+=f[A]*d.g*o,v[A].z+=f[A]*d.b*o}}r=4*Math.PI/l;for(A=0;A<9;A++)v[A].x*=r,v[A].y*=r,v[A].z*=r;return new LightProbe(m)}},convertColorToLinear=function(e,t){switch(t){case sRGBEncoding:e.convertSRGBToLinear();break;case LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return e};function DataTexture(data,e,t,r,n,o,l,c,h,d,f,m){Texture.call(this,null,o,l,c,h,d,r,n,f,m),this.image={data:data||null,width:e||1,height:t||1},this.magFilter=void 0!==h?h:NearestFilter,this.minFilter=void 0!==d?d:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var alphamap_fragment="\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment="\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment="\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment="\n#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment="\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex="\nvec3 transformed = vec3( position );\n",beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs="\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} \n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} \n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} \nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; \n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); \n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} \nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); \n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} \nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; \n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit(  ) {\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit(  );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} \nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\t\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); \n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\t\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n",bumpmap_pars_fragment="\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment="\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment="\n#if NUM_CLIPPING_PLANES > 0\n\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex="\n#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex="\n#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment="\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment="\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex="\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex="\n#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif\n",common="\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#ifndef saturate\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n  return m[ 2 ][ 3 ] == - 1.0;\n\n}\n",cube_uv_reflection_fragment="\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\n\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\n\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\n\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);\n  }\n  return mip;\n}\n\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif\n",defaultnormal_vertex="\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex="\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex="\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment="\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment="\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment="\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment="\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t}  else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment="\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment="\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex="\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_vertex="\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) { \n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex="\n#ifdef USE_FOG\n\n\tfogDepth = -mvPosition.z;\n\n#endif\n",fog_pars_vertex="\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment="\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment="\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment="\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n\n",lightmap_fragment="\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; \n\n#endif\n",lightmap_pars_fragment="\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex="\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\n#endif\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\n#endif\n",lights_pars_begin="\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1; \n\tuniform sampler2D ltc_2; \n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",envmap_physical_pars_fragment="\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance(  const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",lights_toon_fragment="\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_toon_pars_fragment="\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\nstruct ToonMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; \n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment="\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment="\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\nstruct BlinnPhongMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; \n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment="\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = saturate( clearcoat ); \n\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment="\nstruct PhysicalMaterial {\n\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; \n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; \n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; \n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin="\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps="\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; \n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance(  geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance(  geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end="\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex="\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex="\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment="\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment="\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment="\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment="\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment="\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment="\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex="\n#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex="\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex="\n#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin="\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps="\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; \n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment="\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); \n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin="\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps="\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_normalmap_pars_fragment="\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing="\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; \nconst float UnpackDownscale = 255. / 256.; \n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; \n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment="\n#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex="\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment="\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment="\n#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\t\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment="\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment="\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); \n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); \n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); \n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else \n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); \n\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else \n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n#endif\n",shadowmap_vertex="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n#endif\n",shadowmask_pars_fragment="\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\n\t#endif\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex="\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex="\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex="\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex="\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment="\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment="\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment="\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment="\n#ifndef saturate\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n\n}\n",uv_pars_fragment="\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex="\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex="\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex="\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag="\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert="\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag="\n\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert="\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; \n\n}\n",depth_frag="\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\n\t#endif\n\n}\n",depth_vert="\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n}\n",distanceRGBA_frag="\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); \n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert="\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag="\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV;\n\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert="\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; \n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert="\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\n\tvLineDistance = scale * lineDistance;\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshbasic_vert="\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag="\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert="\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag="\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; \n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshmatcap_vert="\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED \n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag="\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert="\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED \n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag="\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert="\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED \n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag="\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert="\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED \n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag="\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert="\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED \n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert="\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag="\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert="\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert="\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_normalmap_pars_fragment:clearcoat_normalmap_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Color(0)},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};var RectAreaLightUniformsLib={init:function(){var e=new DataTexture(new Float32Array([1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-4.48815e-7,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,9.07581e-7,1.12813,.997866,-8.96716e-7,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,8.79224e-7,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,6.55682e-7,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,4.62391e-7,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,3.04092e-7,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,1.73682e-7,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,7.78271e-8,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-6.27338e-7,.0306409,1.97672e-8,99168e-8,-158573e-10,.0314638,4.99803e-7,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,2.37499e-8,-9.99999e-8,282592e-10,1.14596e-10,100292e-11,-166369e-11,250354e-9,6.77492e-9,350752e-11,-637769e-11,357289e-9,6.31655e-8,826445e-11,-174689e-10,516179e-9,3.1851e-7,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577]),64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1),t=new DataTexture(new Float32Array([1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,5.45037e-10,0,0,.999994,2.85095e-9,0,0,.999989,1.26931e-8,0,0,.999973,4.89938e-8,0,0,.999947,1.66347e-7,0,0,.999894,5.02694e-7,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,1.15855e-10,0,0,.999996,6.6947e-10,0,0,.999991,3.30863e-9,0,0,.999983,1.41737e-8,0,0,.999968,5.32626e-8,0,0,.99994,1.77431e-7,0,0,.999891,5.28835e-7,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,2.22338e-10,0,0,.999995,1.0967e-9,0,0,.999991,4.82132e-9,0,0,.999981,1.89434e-8,0,0,.999967,6.67716e-8,0,0,.999938,2.12066e-7,0,0,.999886,6.0977e-7,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,1.01739e-10,0,0,.999997,4.70132e-10,0,0,.999993,2.00436e-9,0,0,.999988,7.83682e-9,0,0,.999979,2.80338e-8,0,0,.999962,9.17033e-8,0,0,.999933,2.74514e-7,0,0,.999881,7.53201e-7,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,2.51859e-10,0,0,.999996,9.96192e-10,0,0,.999992,3.74531e-9,0,0,.999986,1.32022e-8,0,0,.999975,4.33315e-8,0,0,.999959,1.31956e-7,0,0,.999927,3.72249e-7,0,0,.999871,9.72461e-7,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,1.79597e-10,0,0,.999997,6.02367e-10,0,0,.999994,2.06835e-9,0,0,.99999,6.94952e-9,0,0,.999984,2.23363e-8,0,0,.999972,6.78578e-8,0,0,.999952,1.93571e-7,0,0,.999919,5.16594e-7,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,1.14608e-10,0,0,.999998,2.10507e-10,0,0,.999997,4.99595e-10,0,0,.999995,1.39897e-9,0,0,.999994,4.19818e-9,0,0,.999988,1.27042e-8,0,0,.999979,3.75153e-8,0,0,.999965,1.06206e-7,0,0,.999945,2.85381e-7,0,0,.999908,7.23611e-7,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,2.86798e-10,0,0,1,2.86877e-10,0,0,1,2.88094e-10,0,0,1,2.93506e-10,0,0,1,3.09262e-10,0,0,.999999,3.48593e-10,0,0,.999999,4.44582e-10,0,0,.999998,6.88591e-10,0,0,.999996,1.34391e-9,0,0,.999993,3.17438e-9,0,0,.999989,8.35609e-9,0,0,.999983,2.28677e-8,0,0,.999974,6.23361e-8,0,0,.999959,1.65225e-7,0,0,.999936,4.19983e-7,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,1.68222e-7,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,1.09018e-9,0,0,1,1.0904e-9,0,0,1,1.09393e-9,0,0,1,1.1095e-9,0,0,1,1.154e-9,0,0,1,1.26089e-9,0,0,.999999,1.5059e-9,0,0,.999997,2.07899e-9,0,0,.999994,3.48164e-9,0,0,.999993,7.05728e-9,0,0,.999987,1.63692e-8,0,0,.999981,4.06033e-8,0,0,.999969,1.0245e-7,0,0,.999953,2.55023e-7,0,0,.999925,6.1511e-7,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,3.54014e-9,0,0,1,3.54073e-9,0,0,1,3.54972e-9,0,0,1,3.58929e-9,0,0,1,3.70093e-9,0,0,.999999,3.96194e-9,0,0,.999998,4.53352e-9,0,0,.999997,5.78828e-9,0,0,.999994,8.63812e-9,0,0,.999991,1.53622e-8,0,0,.999985,3.16356e-8,0,0,.999977,7.12781e-8,0,0,.999964,1.66725e-7,0,0,.999945,3.90501e-7,0,0,.999912,8.95622e-7,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,1.0153e-8,0,0,1,1.01544e-8,0,0,1,1.01751e-8,0,0,1,1.02662e-8,0,0,1,1.0521e-8,0,0,.999999,1.11049e-8,0,0,.999999,1.23408e-8,0,0,.999996,1.4924e-8,0,0,.999992,2.04471e-8,0,0,.999989,3.26539e-8,0,0,.99998,6.03559e-8,0,0,.999971,1.23936e-7,0,0,.999955,2.69058e-7,0,0,.999933,5.93604e-7,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,2.2038e-7,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,2.63344e-8,0,0,1,2.63373e-8,0,0,1,2.63815e-8,0,0,1,2.65753e-8,0,0,1,2.71132e-8,0,0,.999999,2.83279e-8,0,0,.999997,3.0833e-8,0,0,.999995,3.58711e-8,0,0,.999992,4.61266e-8,0,0,.999985,6.7574e-8,0,0,.999977,1.1358e-7,0,0,.999966,2.13657e-7,0,0,.999948,4.31151e-7,0,0,.999923,8.96656e-7,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,6.28647e-8,0,0,1,6.28705e-8,0,0,1,6.29587e-8,0,0,1,6.33441e-8,0,0,.999999,6.44087e-8,0,0,.999998,6.67856e-8,0,0,.999997,7.15889e-8,0,0,.999995,8.09577e-8,0,0,.999989,9.92764e-8,0,0,.999983,1.35834e-7,0,0,.999974,2.10482e-7,0,0,.999959,3.65215e-7,0,0,.999939,6.86693e-7,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,1.39968e-7,0,0,1,1.39979e-7,0,0,1,1.40145e-7,0,0,1,1.4087e-7,0,0,.999999,1.42865e-7,0,0,.999998,1.47279e-7,0,0,.999997,1.56057e-7,0,0,.999992,1.7276e-7,0,0,.999989,2.04352e-7,0,0,.99998,2.6494e-7,0,0,.999969,3.83435e-7,0,0,.999953,6.18641e-7,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,2.9368e-7,0,0,1,2.937e-7,0,0,1,2.93998e-7,0,0,1,2.95298e-7,0,0,.999999,2.98865e-7,0,0,.999998,3.067e-7,0,0,.999995,3.22082e-7,0,0,.999992,3.50767e-7,0,0,.999986,4.03538e-7,0,0,.999976,5.01372e-7,0,0,.999964,6.8562e-7,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,5.85473e-7,0,0,1,5.85507e-7,0,0,1,5.8602e-7,0,0,.999999,5.88259e-7,0,0,.999999,5.94381e-7,0,0,.999998,6.07754e-7,0,0,.999995,6.33729e-7,0,0,.99999,6.8137e-7,0,0,.999984,7.67003e-7,0,0,.999973,9.21212e-7,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,8.8288e-7,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1]),64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1);UniformsLib.LTC_1=e,UniformsLib.LTC_2=t;var r={ltc_1:{value:null},ltc_2:{value:null}};Object.assign(ShaderLib.standard.uniforms,r),Object.assign(ShaderLib.physical.uniforms,r)}};function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function InstancedInterleavedBuffer(e,t,r){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(source){return this.array=new source.array.constructor(source.array),this.count=source.count,this.stride=source.stride,this.usage=source.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(source){return InterleavedBuffer.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this}});var _vector$6=new Vector3;function InterleavedBufferAttribute(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";var i,t,r,n,ol,o,l,c,h,d,f=[],m=[0,0],v={},y=["a","b","c"];if(e&&e.isGeometry){var x=e.faces;for(i=0,r=x.length;i<r;i++){var _=x[i];for(t=0;t<3;t++)l=_[y[t]],c=_[y[(t+1)%3]],m[0]=Math.min(l,c),m[1]=Math.max(l,c),void 0===v[h=m[0]+","+m[1]]&&(v[h]={index1:m[0],index2:m[1]})}for(h in v)o=v[h],d=e.vertices[o.index1],f.push(d.x,d.y,d.z),d=e.vertices[o.index2],f.push(d.x,d.y,d.z)}else if(e&&e.isBufferGeometry){var M,w,S,A,T,L,C;if(d=new Vector3,null!==e.index){for(M=e.attributes.position,w=e.index,0===(S=e.groups).length&&(S=[{start:0,count:w.count,materialIndex:0}]),n=0,ol=S.length;n<ol;++n)for(i=T=(A=S[n]).start,r=T+A.count;i<r;i+=3)for(t=0;t<3;t++)l=w.getX(i+t),c=w.getX(i+(t+1)%3),m[0]=Math.min(l,c),m[1]=Math.max(l,c),void 0===v[h=m[0]+","+m[1]]&&(v[h]={index1:m[0],index2:m[1]});for(h in v)o=v[h],d.fromBufferAttribute(M,o.index1),f.push(d.x,d.y,d.z),d.fromBufferAttribute(M,o.index2),f.push(d.x,d.y,d.z)}else for(i=0,r=(M=e.attributes.position).count/3;i<r;i++)for(t=0;t<3;t++)L=3*i+t,d.fromBufferAttribute(M,L),f.push(d.x,d.y,d.z),C=3*i+(t+1)%3,d.fromBufferAttribute(M,C),f.push(d.x,d.y,d.z)}this.setAttribute("position",new Float32BufferAttribute(f,3))}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var i=0,t=this.data.count;i<t;i++)_vector$6.x=this.getX(i),_vector$6.y=this.getY(i),_vector$6.z=this.getZ(i),_vector$6.applyMatrix4(e),this.setXYZ(i,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=o,this}}),InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(source){return BufferGeometry.prototype.copy.call(this,source),this.maxInstancedCount=source.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var data=BufferGeometry.prototype.toJSON.call(this);return data.maxInstancedCount=this.maxInstancedCount,data.isInstancedBufferGeometry=!0,data}}),WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry;var LineSegmentsGeometry=function(){InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))},box;LineSegmentsGeometry.prototype=Object.assign(Object.create(InstancedBufferGeometry.prototype),{constructor:LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix4:function(e){var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(r,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new WireframeGeometry(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:(box=new Box3,function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),box.setFromBufferAttribute(t),this.boundingBox.union(box))}),computeBoundingSphere:function(){var e=new Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==t&&void 0!==r){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var o=0,i=0,l=t.count;i<l;i++)e.fromBufferAttribute(t,i),o=Math.max(o,n.distanceToSquared(e)),e.fromBufferAttribute(r,i),o=Math.max(o,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}),UniformsLib.line={linewidth:{value:1},resolution:{value:new Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var LineMaterial=function(e){ShaderMaterial.call(this,{type:"LineMaterial",uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};LineMaterial.prototype=Object.create(ShaderMaterial.prototype),LineMaterial.prototype.constructor=LineMaterial,LineMaterial.prototype.isLineMaterial=!0;var LineSegments2=function(e,t){Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new LineSegmentsGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})},start,end;LineSegments2.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:LineSegments2,isLineSegments2:!0,computeLineDistances:(start=new Vector3,end=new Vector3,function(){for(var e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.data.count),i=0,o=0,l=t.data.count;i<l;i++,o+=2)start.fromBufferAttribute(t,i),end.fromBufferAttribute(r,i),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+start.distanceTo(end);var c=new InstancedInterleavedBuffer(n,2,1);return e.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(c,1,0)),e.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(c,1,1)),this}),raycast:function(){var e=new Vector4,t=new Vector4,r=new Vector4,n=new Vector3,o=new Matrix4,line=new Line3,l=new Vector3;return function(c,h){null===c.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var d=c.ray,f=c.camera,m=f.projectionMatrix,v=this.geometry,y=this.material,x=y.resolution,_=y.linewidth,M=v.attributes.instanceStart,w=v.attributes.instanceEnd;d.at(1,r),r.w=1,r.applyMatrix4(f.matrixWorldInverse),r.applyMatrix4(m),r.multiplyScalar(1/r.w),r.x*=x.x/2,r.y*=x.y/2,r.z=0,n.copy(r);var S=this.matrixWorld;o.multiplyMatrices(f.matrixWorldInverse,S);for(var i=0,A=M.count;i<A;i++){e.fromBufferAttribute(M,i),t.fromBufferAttribute(w,i),e.w=1,t.w=1,e.applyMatrix4(o),t.applyMatrix4(o),e.applyMatrix4(m),t.applyMatrix4(m),e.multiplyScalar(1/e.w),t.multiplyScalar(1/t.w);var T=e.z<-1&&t.z<-1,L=e.z>1&&t.z>1;if(!T&&!L){e.x*=x.x/2,e.y*=x.y/2,t.x*=x.x/2,t.y*=x.y/2,line.start.copy(e),line.start.z=0,line.end.copy(t),line.end.z=0;var param=line.closestPointToPointParameter(n,!0);line.at(param,l);var C=MathUtils.lerp(e.z,t.z,param),N=C>=-1&&C<=1,P=n.distanceTo(l)<.5*_;if(N&&P){line.start.fromBufferAttribute(M,i),line.end.fromBufferAttribute(w,i),line.start.applyMatrix4(S),line.end.applyMatrix4(S);var F=new Vector3,E=new Vector3;d.distanceSqToSegment(line.start,line.end,E,F),h.push({point:E,pointOnLine:F,distance:d.origin.distanceTo(E),object:this,face:null,faceIndex:i,uv:null,uv2:null})}}}}}()});var LineGeometry=function(){LineSegmentsGeometry.call(this),this.type="LineGeometry"};LineGeometry.prototype=Object.assign(Object.create(LineSegmentsGeometry.prototype),{constructor:LineGeometry,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,r=new Float32Array(2*t),i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return LineSegmentsGeometry.prototype.setPositions.call(this,r),this},setColors:function(e){for(var t=e.length-3,r=new Float32Array(2*t),i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return LineSegmentsGeometry.prototype.setColors.call(this,r),this},fromLine:function(line){var e=line.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(){return this}});var Line2=function(e,t){LineSegments2.call(this),this.type="Line2",this.geometry=void 0!==e?e:new LineGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})};Line2.prototype=Object.assign(Object.create(LineSegments2.prototype),{constructor:Line2,isLine2:!0});var Wireframe=function(e,t){Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==e?e:new LineSegmentsGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})};Wireframe.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:Wireframe,isWireframe:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,o=r.attributes.instanceEnd,l=new Float32Array(2*n.data.count),i=0,c=0,h=n.data.count;i<h;i++,c+=2)e.fromBufferAttribute(n,i),t.fromBufferAttribute(o,i),l[c]=0===c?0:l[c-1],l[c+1]=l[c]+e.distanceTo(t);var d=new InstancedInterleavedBuffer(l,2,1);return r.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(d,1,0)),r.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(d,1,1)),this}}()});var WireframeGeometry2=function(e){LineSegmentsGeometry.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new WireframeGeometry(e))};WireframeGeometry2.prototype=Object.assign(Object.create(LineSegmentsGeometry.prototype),{constructor:WireframeGeometry2,isWireframeGeometry2:!0});var Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,r){var n=this,o=!1,l=0,c=0,h=void 0,d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){c++,!1===o&&void 0!==n.onStart&&n.onStart(e,l,c),o=!0},this.itemEnd=function(e){l++,void 0!==n.onProgress&&n.onProgress(e,l,c),l===c&&(o=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return h?h(e):e},this.setURLModifier=function(e){return h=e,this},this.addHandler=function(e,t){return d.push(e,t),this},this.removeHandler=function(e){var t=d.indexOf(e);return-1!==t&&d.splice(t,2),this},this.getHandler=function(e){for(var i=0,t=d.length;i<t;i+=2){var r=d[i],n=d[i+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}var DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Loader.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(path){return this.path=path,this},setResourcePath:function(e){return this.resourcePath=e,this}});var loading={};function FileLoader(e){Loader.call(this,e)}function Group(){Object3D.call(this),this.type="Group"}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,l=Cache.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout((function(){t&&t(l),o.manager.itemEnd(e)}),0),l;if(void 0===loading[e]){var c=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(c){var h=c[1],d=!!c[2],data=c[3];data=decodeURIComponent(data),d&&(data=atob(data));try{var f,m=(this.responseType||"").toLowerCase();switch(m){case"arraybuffer":case"blob":for(var view=new Uint8Array(data.length),i=0;i<data.length;i++)view[i]=data.charCodeAt(i);f="blob"===m?new Blob([view.buffer],{type:h}):view.buffer;break;case"document":var v=new DOMParser;f=v.parseFromString(data,h);break;case"json":f=JSON.parse(data);break;default:f=data}setTimeout((function(){t&&t(f),o.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),o.manager.itemError(e),o.manager.itemEnd(e)}),0)}}else{loading[e]=[],loading[e].push({onLoad:t,onProgress:r,onError:n});var y=new XMLHttpRequest;for(var header in y.open("GET",e,!0),y.addEventListener("load",(function(t){var r=this.response,n=loading[e];if(delete loading[e],200===this.status||0===this.status){0===this.status&&console.warn("FileLoader: HTTP Status 0 received."),Cache.add(e,r);for(var i=0,l=n.length;i<l;i++){(c=n[i]).onLoad&&c.onLoad(r)}o.manager.itemEnd(e)}else{for(i=0,l=n.length;i<l;i++){var c;(c=n[i]).onError&&c.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}}),!1),y.addEventListener("progress",(function(t){for(var r=loading[e],i=0,n=r.length;i<n;i++){var o=r[i];o.onProgress&&o.onProgress(t)}}),!1),y.addEventListener("error",(function(t){var r=loading[e];delete loading[e];for(var i=0,n=r.length;i<n;i++){var l=r[i];l.onError&&l.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}),!1),y.addEventListener("abort",(function(t){var r=loading[e];delete loading[e];for(var i=0,n=r.length;i<n;i++){var l=r[i];l.onError&&l.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(y.responseType=this.responseType),void 0!==this.withCredentials&&(y.withCredentials=this.withCredentials),y.overrideMimeType&&y.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)y.setRequestHeader(header,this.requestHeader[header]);y.send(null)}return o.manager.itemStart(e),y}loading[e].push({onLoad:t,onProgress:r,onError:n})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0});var LoaderUtils={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var s="",i=0,t=e.length;i<t;i++)s+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(s))}catch(e){return s}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ImageLoader(e){Loader.call(this,e)}function TextureLoader(e){Loader.call(this,e)}MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.specular.copy(source.specular),this.shininess=source.shininess,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.defines={STANDARD:""},this.color.copy(source.color),this.roughness=source.roughness,this.metalness=source.metalness,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.roughnessMap=source.roughnessMap,this.metalnessMap=source.metalnessMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.envMapIntensity=source.envMapIntensity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,l=Cache.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout((function(){t&&t(l),o.manager.itemEnd(e)}),0),l;var image=document.createElementNS("http://www.w3.org/1999/xhtml","img");function c(){image.removeEventListener("load",c,!1),image.removeEventListener("error",h,!1),Cache.add(e,this),t&&t(this),o.manager.itemEnd(e)}function h(t){image.removeEventListener("load",c,!1),image.removeEventListener("error",h,!1),n&&n(t),o.manager.itemError(e),o.manager.itemEnd(e)}return image.addEventListener("load",c,!1),image.addEventListener("error",h,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(image.crossOrigin=this.crossOrigin),o.manager.itemStart(e),image.src=e,image}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(e,t,r,n){var o=new Texture,l=new ImageLoader(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,(function(image){o.image=image;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);o.format=r?RGBFormat:RGBAFormat,o.needsUpdate=!0,void 0!==t&&t(o)}),r,n),o}});var ThreeMFLoader=function(e){Loader.call(this,e),this.availableExtensions=[]};ThreeMFLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ThreeMFLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(e){t(o.parse(e))}),r,n)},parse:function(data){var e=this,t=new TextureLoader(this.manager);function r(e){for(var t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship"),i=0;i<r.length;i++){var n=r[i],o={target:n.getAttribute("Target"),id:n.getAttribute("Id"),type:n.getAttribute("Type")};t.push(o)}return t}function n(e){for(var t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base"),i=0;i<r.length;i++){var n=h(r[i]);n.index=i,t.basematerials.push(n)}return t}function o(e){for(var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),n=[],i=0;i<r.length;i++){var o=r[i],u=o.getAttribute("u"),l=o.getAttribute("v");n.push(parseFloat(u),parseFloat(l))}return t.uvs=new Float32Array(n),t}function l(e){for(var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],o=new Color,i=0;i<r.length;i++){var l=r[i].getAttribute("color");o.setStyle(l.substring(0,7)),o.convertSRGBToLinear(),n.push(o.r,o.g,o.b)}return t.colors=new Float32Array(n),t}function c(e){for(var t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),n=[],i=0;i<r.length;i++){var o=r[i];n.push({name:o.getAttribute("name"),metallicness:parseFloat(o.getAttribute("metallicness")),roughness:parseFloat(o.getAttribute("roughness"))})}return t.data=n,t}function h(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function d(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=f(r)),t}function f(e){var t=[];e.split(" ").forEach((function(s){t.push(parseFloat(s))}));var r=new Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function m(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var o=e.getAttribute("pindex");o&&(t.pindex=o);var l=e.getAttribute("thumbnail");l&&(t.thumbnail=l);var c=e.getAttribute("partnumber");c&&(t.partnumber=c);var h=e.getAttribute("name");h&&(t.name=h);var f=e.querySelector("mesh");f&&(t.mesh=function(e){for(var t={},r=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var o=n[i],l=o.getAttribute("x"),c=o.getAttribute("y"),h=o.getAttribute("z");r.push(parseFloat(l),parseFloat(c),parseFloat(h))}t.vertices=new Float32Array(r);var d=[],f=[],m=e.querySelectorAll("triangles triangle");for(i=0;i<m.length;i++){var v=m[i],y=v.getAttribute("v1"),x=v.getAttribute("v2"),_=v.getAttribute("v3"),M=v.getAttribute("p1"),w=v.getAttribute("p2"),S=v.getAttribute("p3"),A=v.getAttribute("pid"),T={};T.v1=parseInt(y,10),T.v2=parseInt(x,10),T.v3=parseInt(_,10),f.push(T.v1,T.v2,T.v3),M&&(T.p1=parseInt(M,10)),w&&(T.p2=parseInt(w,10)),S&&(T.p3=parseInt(S,10)),A&&(T.pid=A),0<Object.keys(T).length&&d.push(T)}return t.triangleProperties=d,t.triangles=new Uint32Array(f),t}(f));var m=e.querySelector("components");return m&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),i=0;i<r.length;i++){var n=d(r[i]);t.push(n)}return t}(m)),t}function v(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i],n=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(n)&&(t[n]=r.textContent)}return t}(r));var h=e.querySelector("resources");h&&(t.resources=function(e){for(var t={basematerials:{}},r=e.querySelectorAll("basematerials"),i=0;i<r.length;i++){var h=n(r[i]);t.basematerials[h.id]=h}t.texture2d={};var d,f=e.querySelectorAll("texture2d");for(i=0;i<f.length;i++){var v=f[i],y={id:(d=v).getAttribute("id"),path:d.getAttribute("path"),contenttype:d.getAttribute("contenttype"),tilestyleu:d.getAttribute("tilestyleu"),tilestylev:d.getAttribute("tilestylev"),filter:d.getAttribute("filter")};t.texture2d[y.id]=y}t.colorgroup={};var x=e.querySelectorAll("colorgroup");for(i=0;i<x.length;i++){var _=l(x[i]);t.colorgroup[_.id]=_}t.pbmetallicdisplayproperties={};var M=e.querySelectorAll("pbmetallicdisplayproperties");for(i=0;i<M.length;i++){var w=c(M[i]);t.pbmetallicdisplayproperties[w.id]=w}t.texture2dgroup={};var S=e.querySelectorAll("texture2dgroup");for(i=0;i<S.length;i++){var A=o(S[i]);t.texture2dgroup[A.id]=A}t.object={};var T=e.querySelectorAll("object");for(i=0;i<T.length;i++){var L=m(T[i]);t.object[L.id]=L}return t}(h));var d=e.querySelector("build");return d&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),i=0;i<r.length;i++){var n=r[i],o={objectId:n.getAttribute("objectid")},l=n.getAttribute("transform");l&&(o.transform=f(l)),t.push(o)}return t}(d)),t}function y(e,r,n,o){var l=e.texid,c=n.resources.texture2d[l];if(c){var data=o[c.path],h=c.contenttype,d=new Blob([data],{type:h}),f=URL.createObjectURL(d),m=t.load(f,(function(){URL.revokeObjectURL(f)}));switch(m.encoding=sRGBEncoding,c.tilestyleu){case"wrap":m.wrapS=RepeatWrapping;break;case"mirror":m.wrapS=MirroredRepeatWrapping;break;case"none":case"clamp":m.wrapS=ClampToEdgeWrapping;break;default:m.wrapS=RepeatWrapping}switch(c.tilestylev){case"wrap":m.wrapT=RepeatWrapping;break;case"mirror":m.wrapT=MirroredRepeatWrapping;break;case"none":case"clamp":m.wrapT=ClampToEdgeWrapping;break;default:m.wrapT=RepeatWrapping}switch(c.filter){case"auto":m.magFilter=LinearFilter,m.minFilter=LinearMipmapLinearFilter;break;case"linear":m.magFilter=LinearFilter,m.minFilter=LinearFilter;break;case"nearest":m.magFilter=NearestFilter,m.minFilter=NearestFilter;break;default:m.magFilter=LinearFilter,m.minFilter=LinearMipmapLinearFilter}return m}return null}function x(e,t,r,n,o,l){for(var c=l.pindex,h={},i=0,d=t.length;i<d;i++){var f=void 0!==(N=t[i]).p1?N.p1:c;void 0===h[f]&&(h[f]=[]),h[f].push(N)}var m=Object.keys(h),v=[];for(i=0,d=m.length;i<d;i++){for(var y=m[i],x=h[y],_=T(e.basematerials[y],F,r,o,l,L),M=new BufferGeometry,w=[],S=n.vertices,A=0,C=x.length;A<C;A++){var N=x[A];w.push(S[3*N.v1+0]),w.push(S[3*N.v1+1]),w.push(S[3*N.v1+2]),w.push(S[3*N.v2+0]),w.push(S[3*N.v2+1]),w.push(S[3*N.v2+2]),w.push(S[3*N.v3+0]),w.push(S[3*N.v3+1]),w.push(S[3*N.v3+2])}M.setAttribute("position",new Float32BufferAttribute(w,3));var P=new Mesh(M,_);v.push(P)}return v}function _(e,t,r,n,o,l){for(var c=new BufferGeometry,h=[],d=[],f=n.vertices,m=e.uvs,i=0,v=t.length;i<v;i++){var x=t[i];h.push(f[3*x.v1+0]),h.push(f[3*x.v1+1]),h.push(f[3*x.v1+2]),h.push(f[3*x.v2+0]),h.push(f[3*x.v2+1]),h.push(f[3*x.v2+2]),h.push(f[3*x.v3+0]),h.push(f[3*x.v3+1]),h.push(f[3*x.v3+2]),d.push(m[2*x.p1+0]),d.push(m[2*x.p1+1]),d.push(m[2*x.p2+0]),d.push(m[2*x.p2+1]),d.push(m[2*x.p3+0]),d.push(m[2*x.p3+1])}return c.setAttribute("position",new Float32BufferAttribute(h,3)),c.setAttribute("uv",new Float32BufferAttribute(d,2)),new Mesh(c,new MeshPhongMaterial({map:T(e,F,r,o,l,y),flatShading:!0}))}function M(e,t,r,n){for(var o=new BufferGeometry,l=[],c=[],h=n.vertices,d=e.colors,i=0,f=t.length;i<f;i++){var m=t[i],v=m.v1,y=m.v2,x=m.v3;l.push(h[3*v+0]),l.push(h[3*v+1]),l.push(h[3*v+2]),l.push(h[3*y+0]),l.push(h[3*y+1]),l.push(h[3*y+2]),l.push(h[3*x+0]),l.push(h[3*x+1]),l.push(h[3*x+2]);var _=m.p1,M=m.p2,w=m.p3;c.push(d[3*_+0]),c.push(d[3*_+1]),c.push(d[3*_+2]),c.push(d[3*(M||_)+0]),c.push(d[3*(M||_)+1]),c.push(d[3*(M||_)+2]),c.push(d[3*(w||_)+0]),c.push(d[3*(w||_)+1]),c.push(d[3*(w||_)+2])}return o.setAttribute("position",new Float32BufferAttribute(l,3)),o.setAttribute("color",new Float32BufferAttribute(c,3)),new Mesh(o,new MeshPhongMaterial({vertexColors:VertexColors,flatShading:!0}))}function w(e){var t=new BufferGeometry;return t.setIndex(new BufferAttribute(e.triangles,1)),t.setAttribute("position",new BufferAttribute(e.vertices,3)),new Mesh(t,new MeshPhongMaterial({color:11184895,flatShading:!0}))}function S(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function A(e,t,r,n,o){for(var l=new Group,c=function(e,t,r,n,o){for(var l=Object.keys(e),c=[],i=0,h=l.length;i<h;i++){var d=l[i],f=e[d];switch(S(d,t)){case"material":for(var m=x(t.resources.basematerials[d],f,t,r,n,o),v=0,y=m.length;v<y;v++)c.push(m[v]);break;case"texture":var A=t.resources.texture2dgroup[d];c.push(_(A,f,t,r,n,o));break;case"vertexColors":var T=t.resources.colorgroup[d];c.push(M(T,f,0,r));break;case"default":c.push(w(r));break;default:console.error("3MFLoader: Unsupported resource type.")}}return c}(function(e,t,r){for(var n={},o=t.triangleProperties,l=r.pid,i=0,c=o.length;i<c;i++){var h=o[i],d=void 0!==h.pid?h.pid:l;void 0===d&&(d="default"),void 0===n[d]&&(n[d]=[]),n[d].push(h)}return n}(0,e,o),r,e,n,o),i=0,h=c.length;i<h;i++)l.add(c[i]);return l}function T(data,e,t,r,n,o){return void 0!==data.build||(data.build=o(data,e,t,r,n)),data.build}function L(e,t,r){var n,o=e.displaypropertiesid,l=r.resources.pbmetallicdisplayproperties;if(null!==o&&void 0!==l[o]){var c=l[o].data[e.index];n=new MeshStandardMaterial({flatShading:!0,roughness:c.roughness,metalness:c.metallicness})}else n=new MeshPhongMaterial({flatShading:!0});n.name=e.name;var h=e.displaycolor,d=h.substring(0,7);return n.color.setStyle(d),n.color.convertSRGBToLinear(),9===h.length&&(n.opacity=parseInt(h.charAt(7)+h.charAt(8),16)/255),n}function C(e,t,r,n){for(var o=new Group,l=0;l<e.length;l++){var component=e[l],c=t[component.objectId];void 0===c&&(N(component.objectId,t,r,n),c=t[component.objectId]);var h=c.clone(),d=component.transform;d&&h.applyMatrix4(d),o.add(h)}return o}function N(t,r,n,o){var l=n.resources.object[t];if(l.mesh){var c=l.mesh;!function(t,r,n){if(t){for(var o=[],l=Object.keys(t),i=0;i<l.length;i++)for(var c=l[i],h=0;h<e.availableExtensions.length;h++){(d=e.availableExtensions[h]).ns===c&&o.push(d)}for(i=0;i<o.length;i++){var d;(d=o[i]).apply(n,t[d.ns],r)}}}(n.extensions,c,n.xml),r[l.id]=T(c,r,n,o,l,A)}else{var h=l.components;r[l.id]=T(h,r,n,o,l,C)}}var P=function(data){var e,t,n,o,l=null,c=null,h=[],d=[],f={},m={};try{l=new JSZip(data)}catch(e){if(e instanceof ReferenceError)return console.error("3MFLoader: jszip missing and file is compressed."),null}for(c in l.files)c.match(/\_rels\/.rels$/)?e=c:c.match(/3D\/_rels\/.*\.model\.rels$/)?t=c:c.match(/^3D\/.*\.model$/)?h.push(c):c.match(/^3D\/Metadata\/.*\.xml$/)||(c.match(/^3D\/Textures?\/.*/)?d.push(c):c.match(/^3D\/Other\/.*/));var y=new Uint8Array(l.file(e).asArrayBuffer());if(n=r(LoaderUtils.decodeText(y)),t){y=new Uint8Array(l.file(t).asArrayBuffer());o=r(LoaderUtils.decodeText(y))}for(var i=0;i<h.length;i++){var x=h[i],view=new Uint8Array(l.file(x).asArrayBuffer()),_=LoaderUtils.decodeText(view),M=(new DOMParser).parseFromString(_,"application/xml");"model"!==M.documentElement.nodeName.toLowerCase()&&console.error("3MFLoader: Error loading 3MF - no 3MF document found: ",x);var w=M.querySelector("model"),S={};for(i=0;i<w.attributes.length;i++){var A=w.attributes[i];A.name.match(/^xmlns:(.+)$/)&&(S[A.value]=RegExp.$1)}var T=v(w);T.xml=w,0<Object.keys(S).length&&(T.extensions=S),f[x]=T}for(i=0;i<d.length;i++){var L=d[i];m[L]=l.file(L).asArrayBuffer()}return{rels:n,modelRels:o,model:f,printTicket:{},texture:m,other:{}}}(data),F=function(e){var t=e.model,r=e.modelRels,n={},o=Object.keys(t),l={};if(r)for(var i=0,c=r.length;i<c;i++){var h=r[i],d=h.target.substring(1);e.texture[d]&&(l[h.target]=e.texture[d])}for(i=0;i<o.length;i++)for(var f=t[o[i]],m=Object.keys(f.resources.object),v=0;v<m.length;v++){N(m[v],n,f,l)}return n}(P);return function(e,t){for(var r=new Group,n=t.rels[0],o=t.model[n.target.substring(1)].build,i=0;i<o.length;i++){var l=o[i],c=e[l.objectId],h=l.transform;h&&c.applyMatrix4(h),r.add(c)}return r}(F,P)},addExtension:function(e){this.availableExtensions.push(e)}});var AMFLoader=function(e){Loader.call(this,e)};AMFLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AMFLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(data){function e(e){for(var r="AMF Material",n=e.attributes.id.textContent,o={r:1,g:1,b:1,a:1},l=null,i=0;i<e.childNodes.length;i++){var c=e.childNodes[i];"metadata"===c.nodeName&&void 0!==c.attributes.type?"name"===c.attributes.type.value&&(r=c.textContent):"color"===c.nodeName&&(o=t(c))}return l=new MeshPhongMaterial({flatShading:!0,color:new Color(o.r,o.g,o.b),name:r}),1!==o.a&&(l.transparent=!0,l.opacity=o.a),{id:n,material:l}}function t(e){for(var t={r:1,g:1,b:1,a:1},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];"r"===r.nodeName?t.r=r.textContent:"g"===r.nodeName?t.g=r.textContent:"b"===r.nodeName?t.b=r.textContent:"a"===r.nodeName&&(t.a=r.textContent)}return t}function r(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,o=r.getElementsByTagName("v2")[0].textContent,l=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,o,l)}r=r.nextElementSibling}return t}function n(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var o=n.firstElementChild;o;){if("coordinates"===o.nodeName){var l=o.getElementsByTagName("x")[0].textContent,c=o.getElementsByTagName("y")[0].textContent,h=o.getElementsByTagName("z")[0].textContent;t.push(l,c,h)}else if("normal"===o.nodeName){var d=o.getElementsByTagName("nx")[0].textContent,f=o.getElementsByTagName("ny")[0].textContent,m=o.getElementsByTagName("nz")[0].textContent;r.push(d,f,m)}o=o.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var o=e.attributes.id.textContent,l={name:"amfobject",meshes:[]},c=null,h=e.firstElementChild;h;){if("metadata"===h.nodeName)void 0!==h.attributes.type&&"name"===h.attributes.type.value&&(l.name=h.textContent);else if("color"===h.nodeName)c=t(h);else if("mesh"===h.nodeName){for(var d=h.firstElementChild,f={vertices:[],normals:[],volumes:[],color:c};d;){if("vertices"===d.nodeName){var m=n(d);f.normals=f.normals.concat(m.normals),f.vertices=f.vertices.concat(m.vertices)}else"volume"===d.nodeName&&f.volumes.push(r(d));d=d.nextElementSibling}l.meshes.push(f)}h=h.nextElementSibling}return{id:o,obj:l}}var i,l,c=function(data){var view=new DataView(data);if("PK"===String.fromCharCode(view.getUint8(0),view.getUint8(1))){var e=null,t=null;console.log("AMFLoader: Loading Zip");try{e=new JSZip(data)}catch(e){if(e instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(t in e.files)if(".amf"===t.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+t),view=new DataView(e.file(t).asArrayBuffer())}var r=LoaderUtils.decodeText(view),n=(new DOMParser).parseFromString(r,"application/xml");return"amf"!==n.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):n}(data),h="",d="",f=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("AMFLoader: Unit scale: "+t),t}(c),m={},v={},y=c.documentElement.childNodes;for(i=0;i<y.length;i++){var x=y[i];if("metadata"===x.nodeName)void 0!==x.attributes.type&&("name"===x.attributes.type.value?h=x.textContent:"author"===x.attributes.type.value&&(d=x.textContent));else if("material"===x.nodeName){var _=e(x);m[_.id]=_.material}else if("object"===x.nodeName){var M=o(x);v[M.id]=M.obj}}var w=new Group,S=new MeshPhongMaterial({color:11184895,flatShading:!0});for(var A in w.name=h,w.userData.author=d,w.userData.loader="AMF",v){var T=v[A],L=T.meshes,C=new Group;for(C.name=T.name||"",i=0;i<L.length;i++){var N=S,P=L[i],F=new Float32BufferAttribute(P.vertices,3),E=null;if(P.normals.length&&(E=new Float32BufferAttribute(P.normals,3)),P.color){var R=P.color;(N=S.clone()).color=new Color(R.r,R.g,R.b),1!==R.a&&(N.transparent=!0,N.opacity=R.a)}var D=P.volumes;for(l=0;l<D.length;l++){var O=D[l],I=new BufferGeometry,B=N;I.setIndex(O.triangles),I.setAttribute("position",F.clone()),E&&I.setAttribute("normal",E.clone()),void 0!==m[O.materialId]&&(B=m[O.materialId]),I.scale(f,f,f),C.add(new Mesh(I,B.clone()))}}w.add(C)}return w}});var _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;function Skeleton(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Matrix4)}}function SkinnedMesh(e,t){e&&e.isGeometry&&console.error("SkinnedMesh no longer supports Geometry. Use BufferGeometry instead."),Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var i=0,e=this.bones.length;i<e;i++){var t=new Matrix4;this.bones[i]&&t.getInverse(this.bones[i].matrixWorld),this.boneInverses.push(t)}},pose:function(){var e,i,t;for(i=0,t=this.bones.length;i<t;i++)(e=this.bones[i])&&e.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,t=this.bones.length;i<t;i++)(e=this.bones[i])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=e.length;i<o;i++){var l=e[i]?e[i].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(l,t[i]),_offsetMatrix.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var i=0,t=this.bones.length;i<t;i++){var r=this.bones[i];if(r.name===e)return r}}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Vector4,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var AssimpLoader=function(e){Loader.call(this,e)};AssimpLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AssimpLoader,load:function(e,t,r,n){var o=this,path=""===o.path?LoaderUtils.extractUrlBase(e):o.path,l=new FileLoader(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(e){t(o.parse(e,path))}),r,n)},parse:function(e,path){var t=new TextureLoader(this.manager);t.setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin);var r={KeyFrame:function(time,e){this.time=time,this.matrix=e.clone(),this.position=new Vector3,this.quaternion=new Quaternion,this.scale=new Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new r.KeyFrame(this.time,this.matrix)},this.lerp=function(e,time){var t=(time-=this.time)/(e.time-this.time),n=1-t,o=this.position,l=this.quaternion,c=e.position,h=e.quaternion;return r.KeyFrame.tempAniPos.x=o.x*n+c.x*t,r.KeyFrame.tempAniPos.y=o.y*n+c.y*t,r.KeyFrame.tempAniPos.z=o.z*n+c.z*t,r.KeyFrame.tempAniQuat.set(l.x,l.y,l.z,l.w),r.KeyFrame.tempAniQuat.slerp(h,t),r.KeyFrame.tempAniMatrix.compose(r.KeyFrame.tempAniPos,r.KeyFrame.tempAniQuat,r.KeyFrame.tempAniScale)}}};r.KeyFrame.tempAniPos=new Vector3,r.KeyFrame.tempAniQuat=new Quaternion,r.KeyFrame.tempAniScale=new Vector3(1,1,1),r.KeyFrame.tempAniMatrix=new Matrix4,r.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var i=0;i<this.keys.length;i++){if(this.keys[i].time==e){this._accelTable[e]=i;break}if(this.keys[i].time<e/this.fps&&this.keys[i+1]&&this.keys[i+1].time>=e/this.fps){this._accelTable[e]=i;break}}},this.parseFromThree=function(data){var e=data.fps;this.target=data.node;for(var track=data.hierarchy[0].keys,i=0;i<track.length;i++)this.addKey(new r.KeyFrame(i/e||track[i].time,track[i].targets[0].data));this.init()},this.parseFromCollada=function(data){for(var track=data.keys,e=this.fps,i=0;i<track.length;i++)this.addKey(new r.KeyFrame(i/e||track[i].time,track[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(a,b){return a.time-b.time},this.clone=function(){var e=new r.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var i=0;i<this.keys.length;i++)e.addKey(this.keys[i].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=r.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(time){return time*=this.fps,time=Math.floor(time),this._accelTable[time]||0},this.setTime=function(time){time=Math.abs(time),this.length&&(time=time%this.length+.05);for(var e=null,t=null,i=this.keySearchAccel(time);i<this.keys.length;i++){if(this.keys[i].time==time){e=this.keys[i],t=this.keys[i];break}if(this.keys[i].time<time&&this.keys[i+1]&&this.keys[i+1].time>time){e=this.keys[i],t=this.keys[i+1];break}if(this.keys[i].time<time&&i==this.keys.length-1){e=this.keys[i],(t=this.keys[0].clone()).time+=this.length+.05;break}}return e&&t&&e!==t?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.lerp(t,time)),void(this.target.matrixWorldNeedsUpdate=!0)):e&&t&&e==t?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(e.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},r.TrackTargetNodeNameCompare=function(e,t){return function e(t,r){if(t.name==r)return t;for(var i=0;i<t.children.length;i++){var n=e(t.children[i],r);if(n)return n}return null}(e,t.name)},r.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(track){this.tracks.push(track),this.length=Math.max(track.length,this.length)},this.setTime=function(time){this.time=time;for(var i=0;i<this.tracks.length;i++)this.tracks[i].setTime(time)},this.clone=function(e,t){t||(t=r.TrackTargetNodeNameCompare);var n=new r.Animation;n.target=e;for(var i=0;i<this.tracks.length;i++){var track=this.tracks[i].clone();track.reTarget(e,t),n.addTrack(track)}return n}};function n(e){return 256<<e}function o(e){return 65536<<e}function l(e,t){var r=new Bone;for(var i in r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r),e.children){var n=l(e.children[i],t);r.add(n)}return r}function c(e,t){for(var r=[],i=0;i<e.length;i++)r.push({i:e[i],w:t[i]});for(r.sort((function(a,b){return b.w-a.w}));r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var n=0;for(i=0;i<4;i++)n+=r[i].w*r[i].w;n=Math.sqrt(n);for(i=0;i<4;i++)r[i].w=r[i].w/n,e[i]=r[i].i,t[i]=r[i].w}function h(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var i in e.children){var r=h(e.children[i],t);if(r)return r}}function d(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e){if(0!=this.mBones.length){for(var t=[],r=[],n=e.findNode(this.mBones[0].mName);n.mParent&&n.mParent.isBone;)n=n.mParent;var o=l(n.toTHREE(e),e);this.threeNode.add(o);for(var i=0;i<this.mBones.length;i++){if(d=h(o,this.mBones[i].mName)){var c=d;t.push(c),r.push(this.mBones[i].mOffsetMatrix.toTHREE())}else{if(!(n=e.findNode(this.mBones[i].mName)))return;o=l(n.toTHREE(e),e);this.threeNode.add(o);var d;c=d=h(o,this.mBones[i].mName);t.push(c),r.push(this.mBones[i].mOffsetMatrix.toTHREE())}}var f=new Skeleton(t,r);this.threeNode.bind(f,new Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r,n=new BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new MeshLambertMaterial,n.setIndex(new BufferAttribute(new Uint32Array(this.mIndexArray),1)),n.setAttribute("position",new BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.setAttribute("normal",new BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.setAttribute("color",new BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.setAttribute("uv",new BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.setAttribute("uv1",new BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.setAttribute("tangents",new BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.setAttribute("bitangents",new BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){for(var o=[],l=[],i=0;i<this.mBones.length;i++)for(var h=0;h<this.mBones[i].mWeights.length;h++){var d=this.mBones[i].mWeights[h];d&&(o[d.mVertexId]||(o[d.mVertexId]=[]),l[d.mVertexId]||(l[d.mVertexId]=[]),o[d.mVertexId].push(d.mWeight),l[d.mVertexId].push(parseInt(i)))}for(var i in l)c(l[i],o[i]);var f=[],m=[];for(i=0;i<o.length;i++)for(h=0;h<4;h++)o[i]&&l[i]?(f.push(o[i][h]),m.push(l[i][h])):(f.push(0),m.push(0));n.setAttribute("skinWeight",new BufferAttribute(new Float32Array(f),4)),n.setAttribute("skinIndex",new BufferAttribute(new Float32Array(m),4))}return 0==this.mBones.length&&(r=new Mesh(n,t)),this.mBones.length>0&&(r=new SkinnedMesh(n,t)).normalizeSkinWeights(),this.threeNode=r,r}}function f(){this.mNumIndices=0,this.mIndices=[]}function m(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new Vector3(this.x,this.y,this.z)}}function v(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new Color(this.r,this.g,this.b)}}function y(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new Quaternion(this.x,this.y,this.z,this.w)}}function x(){this.mVertexId=0,this.mWeight=0}function _(){this.data=[],this.toString=function(){var e="";return this.data.forEach((function(i){e+=String.fromCharCode(i)})),e.replace(/[^\x20-\x7E]+/g,"")}}function M(){this.mTime=0,this.mValue=null}function w(){this.mTime=0,this.mValue=null}function S(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var i=0;i<this.mChildren.length;i++)t.add(this.mChildren[i].toTHREE(e));for(i=0;i<this.mMeshes.length;i++)t.add(e.mMeshes[this.mMeshes[i]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function A(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function T(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e);return new Color(t.getFloat32(0,!0),t.getFloat32(4,!0),t.getFloat32(8,!0))},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var s=new _;return s.data=this.mData,s.toString()},this.dataAsMap=function(){var s=new _;s.data=this.mData;var path=s.toString();return-1!=(path=path.replace(/\\/g,"/")).indexOf("/")&&(path=path.substr(path.lastIndexOf("/")+1)),t.load(path)}}var L={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},C={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function N(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(){for(var e=new MeshPhongMaterial,i=0;i<this.mProperties.length;i++)if("float"==C[this.mProperties[i].mKey]&&(e[L[this.mProperties[i].mKey]]=this.mProperties[i].dataAsFloat()),"color"==C[this.mProperties[i].mKey]&&(e[L[this.mProperties[i].mKey]]=this.mProperties[i].dataAsColor()),"bool"==C[this.mProperties[i].mKey]&&(e[L[this.mProperties[i].mKey]]=this.mProperties[i].dataAsBool()),"string"==C[this.mProperties[i].mKey]&&(e[L[this.mProperties[i].mKey]]=this.mProperties[i].dataAsString()),"map"==C[this.mProperties[i].mKey]){var t=this.mProperties[i];1==t.mSemantic&&(e.map=this.mProperties[i].dataAsMap()),6==t.mSemantic&&(e.normalMap=this.mProperties[i].dataAsMap()),10==t.mSemantic&&(e.lightMap=this.mProperties[i].dataAsMap()),8==t.mSemantic&&(e.alphaMap=this.mProperties[i].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}function P(e,t,r){var n=new Vector3,o=1-r;return n.x=e.x*r+t.x*o,n.y=e.y*r+t.y*o,n.z=e.z*r+t.z*o,n}function F(e,t,r){return e.clone().slerp(t,1-r)}function E(e,time,t,r){if(1==e.length)return e[0].mValue.toTHREE();for(var n=1/0,o=null,l=null,i=0;i<e.length;i++){var c=Math.abs(e[i].mTime-time);c<n&&e[i].mTime<=time&&(n=c,o=e[i],l=e[i+1])}if(o){if(l){var h=l.mTime-o.mTime,d=(o.mTime-time)/h;return r(o.mValue.toTHREE(),l.mValue.toTHREE(),d)}(l=e[0].clone()).mTime+=t;h=l.mTime-o.mTime,d=(o.mTime-time)/h;return r(o.mValue.toTHREE(),l.mValue.toTHREE(),d)}return null}function R(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(a,b){return a.mTime-b.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map((function(a){return a.mTime}))),Math.max.apply(null,this.mRotationKeys.map((function(a){return a.mTime}))),Math.max.apply(null,this.mScalingKeys.map((function(a){return a.mTime}))))},this.toTHREE=function(e){this.sortKeys();for(var t=this.getLength(),track=new r.KeyFrameTrack,i=0;i<t;i+=.05){var n=new Matrix4,time=i,o=E(this.mPositionKeys,time,t,P),l=E(this.mScalingKeys,time,t,P),c=E(this.mRotationKeys,time,t,F);n.compose(o,c,l);var h=new r.KeyFrame(time,n);track.addKey(h)}track.target=e.findNode(this.mNodeName).toTHREE();var d=[track];if(e.nodeToBoneMap[this.mNodeName])for(i=0;i<e.nodeToBoneMap[this.mNodeName].length;i++){var f=track.clone();f.target=e.nodeToBoneMap[this.mNodeName][i],d.push(f)}return d}}function D(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new r.Animation;for(var i in this.mChannels){this.mChannels[i].init(this.mTicksPerSecond);var n=this.mChannels[i].toTHREE(e);for(var o in n)n[o].init(),t.addTrack(n[o])}return t.length=Math.max.apply(null,t.tracks.map((function(e){return e.length}))),t}}function O(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function I(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function B(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function U(){this.versionMajor=0,this.versionMinor=0,this.versionRevision=0,this.compileFlags=0,this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var i=0;i<t.mChildren.length;i++){var r=this.findNode(e,t.mChildren[i]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(var i in e.mMeshes){var t=e.mMeshes[i];for(var r in t.mBones){var n=e.findNode(t.mBones[r].mName);n&&(n.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(var i in this.mMeshes)this.mMeshes[i].hookupSkeletons(this);if(this.mAnimations.length>0)var a=this.mAnimations[0].toTHREE(this);return{object:e,animation:a}}}function k(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new Matrix4,i=0;i<4;++i)for(var t=0;t<4;++t)e.elements[4*i+t]=this.elements[t][i];return e}}function V(e){var t=e.getFloat32(e.readOffset,!0);return e.readOffset+=4,t}function G(e){var t=e.getFloat64(e.readOffset,!0);return e.readOffset+=8,t}function z(e){var t=e.getUint16(e.readOffset,!0);return e.readOffset+=2,t}function j(e){var t=e.getUint32(e.readOffset,!0);return e.readOffset+=4,t}function W(e){var t=e.getUint32(e.readOffset,!0);return e.readOffset+=4,t}function H(e){var t=new m;return t.x=V(e),t.y=V(e),t.z=V(e),t}function X(e){var t=new v;return t.r=V(e),t.g=V(e),t.b=V(e),t}function Y(e){var s=new _,t=j(e);return e.ReadBytes(s.data,1,t),s.toString()}function Q(e){var t=new x;return t.mVertexId=j(e),t.mWeight=V(e),t}function K(e){for(var t=new k,i=0;i<4;++i)for(var r=0;r<4;++r)t.elements[i][r]=V(e);return t}function J(e){var t=new M;return t.mTime=G(e),t.mValue=H(e),t}function Z(e){var t=new w;return t.mTime=G(e),t.mValue=function(e){var t=new y;return t.w=V(e),t.x=V(e),t.y=V(e),t.z=V(e),t}(e),t}function $(e,data,t){for(var i=0;i<t;i++)data[i]=J(e)}function ee(e,t,r){return e.Seek(sizeof(t)*r,fe)}function te(e){if(!e)throw"asset failed"}function re(e,b){return te(4666==W(e)),W(e),b.mName=Y(e),b.mNumWeights=j(e),b.mOffsetMatrix=K(e),de?ee(e,b.mWeights,b.mNumWeights):(b.mWeights=[],function(e,data,t){for(var i=0;i<t;i++)data[i]=Q(e)}(e,b.mWeights,b.mNumWeights)),b}function ie(e,t){te(4663==W(e)),W(e),t.mPrimitiveTypes=j(e),t.mNumVertices=j(e),t.mNumFaces=j(e),t.mNumBones=j(e),t.mMaterialIndex=j(e),t.mNumUVComponents=[];var r=j(e);1&r&&(de?ee(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,fe))),2&r&&(de?ee(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,fe))),4&r&&(de?(ee(e,t.mTangents,t.mNumVertices),ee(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,fe),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,fe)));for(var l=0;l<1&&r&o(l);++l)de?ee(e,t.mColors[l],t.mNumVertices):(t.mColors[l]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,fe));t.mTexCoordsBuffers=[];for(l=0;l<4&&r&n(l);++l)if(t.mNumUVComponents[l]=j(e),de)ee(e,t.mTextureCoords[l],t.mNumVertices);else{t.mTextureCoords[l]=[],t.mTexCoordsBuffers[l]=[];for(var c=0;c<t.mNumVertices;c++)t.mTexCoordsBuffers[l].push(V(e)),t.mTexCoordsBuffers[l].push(V(e)),V(e)}if(de)j(e);else{t.mFaces=[],t.mIndexArray=[];for(var i=0;i<t.mNumFaces;++i){var h=t.mFaces[i]=new f;h.mNumIndices=z(e),h.mIndices=[];for(var a=0;a<h.mNumIndices;++a)t.mNumVertices<65536?h.mIndices[a]=z(e):h.mIndices[a]=j(e);if(3===h.mNumIndices)t.mIndexArray.push(h.mIndices[0]),t.mIndexArray.push(h.mIndices[1]),t.mIndexArray.push(h.mIndices[2]);else{if(4!==h.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(h.mIndices[0]),t.mIndexArray.push(h.mIndices[1]),t.mIndexArray.push(h.mIndices[2]),t.mIndexArray.push(h.mIndices[2]),t.mIndexArray.push(h.mIndices[3]),t.mIndexArray.push(h.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(a=0;a<t.mNumBones;++a)t.mBones[a]=new A,re(e,t.mBones[a])}}function ne(e,t){te(4670==W(e)),W(e),t.mKey=Y(e),t.mSemantic=j(e),t.mIndex=j(e),t.mDataLength=j(e),t.mType=j(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function ae(e,t){if(te(4669==W(e)),W(e),t.mNumAllocated=t.mNumProperties=j(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var i=0;i<t.mNumProperties;++i)t.mProperties[i]=new T,ne(e,t.mProperties[i])}}function oe(e,t){te(4664==W(e)),W(e),t.mNodeName=Y(e),t.mNumPositionKeys=j(e),t.mNumRotationKeys=j(e),t.mNumScalingKeys=j(e),t.mPreState=j(e),t.mPostState=j(e),t.mNumPositionKeys&&(de?ee(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],$(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(de?ee(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],function(e,data,t){for(var i=0;i<t;i++)data[i]=Z(e)}(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(de?ee(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],$(e,t.mScalingKeys,t.mNumScalingKeys)))}function se(e,t){if(te(4667==W(e)),W(e),t.mName=Y(e),t.mDuration=G(e),t.mTicksPerSecond=G(e),t.mNumChannels=j(e),t.mNumChannels){t.mChannels=[];for(var a=0;a<t.mNumChannels;++a)t.mChannels[a]=new R,oe(e,t.mChannels[a])}}function le(e,t){te(4662==W(e)),W(e),t.mWidth=j(e),t.mHeight=j(e),e.ReadBytes(t.achFormatHint,1,4),de||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function ce(e,t){te(4661==W(e)),W(e),t.mName=Y(e),t.mType=j(e),1!=t.mType&&(t.mAttenuationConstant=V(e),t.mAttenuationLinear=V(e),t.mAttenuationQuadratic=V(e)),t.mColorDiffuse=X(e),t.mColorSpecular=X(e),t.mColorAmbient=X(e),3==t.mType&&(t.mAngleInnerCone=V(e),t.mAngleOuterCone=V(e))}function ue(e,t){te(4660==W(e)),W(e),t.mName=Y(e),t.mPosition=H(e),t.mLookAt=H(e),t.mUp=H(e),t.mHorizontalFOV=V(e),t.mClipPlaneNear=V(e),t.mClipPlaneFar=V(e),t.mAspect=V(e)}function he(e,t){if(te(4665==W(e)),W(e),t.mFlags=j(e),t.mNumMeshes=j(e),t.mNumMaterials=j(e),t.mNumAnimations=j(e),t.mNumTextures=j(e),t.mNumLights=j(e),t.mNumCameras=j(e),t.mRootNode=new S,t.mRootNode=function e(t,r,n){te(4668==W(t)),W(t);var o=new S;if(o.mParent=r,o.mDepth=n,o.mName=Y(t),o.mTransformation=K(t),o.mNumChildren=j(t),o.mNumMeshes=j(t),o.mNumMeshes){o.mMeshes=[];for(var i=0;i<o.mNumMeshes;++i)o.mMeshes[i]=j(t)}if(o.mNumChildren){o.mChildren=[];for(i=0;i<o.mNumChildren;++i){var l=e(t,o,n++);o.mChildren[i]=l}}return o}(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var i=0;i<t.mNumMeshes;++i)t.mMeshes[i]=new d,ie(e,t.mMeshes[i])}if(t.mNumMaterials){t.mMaterials=[];for(i=0;i<t.mNumMaterials;++i)t.mMaterials[i]=new N,ae(e,t.mMaterials[i])}if(t.mNumAnimations){t.mAnimations=[];for(i=0;i<t.mNumAnimations;++i)t.mAnimations[i]=new D,se(e,t.mAnimations[i])}if(t.mNumTextures){t.mTextures=[];for(i=0;i<t.mNumTextures;++i)t.mTextures[i]=new O,le(e,t.mTextures[i])}if(t.mNumLights){t.mLights=[];for(i=0;i<t.mNumLights;++i)t.mLights[i]=new I,ce(e,t.mLights[i])}if(t.mNumCameras){t.mCameras=[];for(i=0;i<t.mNumCameras;++i)t.mCameras[i]=new B,ue(e,t.mCameras[i])}}var de,pe,fe=0;return function(e){var t=new U,r=new DataView(e);if(function(e){e.readOffset=0,e.Seek=function(t,r){r==fe&&(e.readOffset+=t),1==r&&(e.readOffset=t)},e.ReadBytes=function(e,t,r){for(var n,o,l=t*r,i=0;i<l;i++)e[i]=(o=void 0,o=(n=this).getUint8(n.readOffset),n.readOffset+=1,o)},e.subArray32=function(e,t){var r=this.buffer.slice(e,t);return new Float32Array(r)},e.subArrayUint16=function(e,t){var r=this.buffer.slice(e,t);return new Uint16Array(r)},e.subArrayUint8=function(e,t){var r=this.buffer.slice(e,t);return new Uint8Array(r)},e.subArrayUint32=function(e,t){var r=this.buffer.slice(e,t);return new Uint32Array(r)}}(r),r.Seek(44,fe),t.versionMajor=j(r),t.versionMinor=j(r),t.versionRevision=j(r),t.compileFlags=j(r),de=z(r)>0,pe=z(r)>0,de)throw"Shortened binaries are not supported!";if(r.Seek(256,fe),r.Seek(128,fe),r.Seek(64,fe),pe){var n=W(r),o=r.FileSize()-r.Tell(),l=[];r.Read(l,1,o);var c=[];uncompress(c,n,l,o),he(new ArrayBuffer(c),t)}else he(r,t);return t.toTHREE()}(e)}});var AWDLoader=function(){function e(){this.id=0,this.data=null,this.namespace=0,this.flags=0}function t(){}t.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}};var r=function(t){Loader.call(this,t),this.trunk=new Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new e],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};return r.prototype=Object.assign(Object.create(Loader.prototype),{constructor:r,load:function(e,t,r,n){var o=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(data){var e=data.byteLength;for(this._ptr=0,this._data=new DataView(data),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==data.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,e-this._ptr);this._ptr<e;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,r,n=this.readU32(),o=this.readU8(),l=this.readU8(),c=this.readU8(),h=this.readU32();switch(l){case 1:t=this.parseMeshData();break;case 22:t=this.parseContainer();break;case 23:t=this.parseMeshInstance();break;case 81:t=this.parseMaterial();break;case 82:t=this.parseTexture();break;case 101:t=this.parseSkeleton();break;case 112:t=this.parseMeshPoseAnimation(!1);break;case 113:t=this.parseVertexAnimationSet();break;case 102:t=this.parseSkeletonPose();break;case 103:t=this.parseSkeletonAnimation();break;case 122:t=this.parseAnimatorSet();break;default:this._ptr+=h}this._blocks[n]=r=new e,r.data=t,r.id=n,r.namespace=o,r.flags=c},_parseHeader:function(){var e=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var t=this.readU16();this._streaming=1==(1&t),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2==(2&t),this._accuracyGeo=4==(4&t),this._accuracyProps=8==(8&t)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&t),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(){var e=new Object3D,t=this.readU32(),r=this.parseMatrix4();return e.name=this.readUTF(),e.applyMatrix4(r),(this._blocks[t].data||this.trunk).add(e),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),e.extra=this.parseUserAttributes(),e},parseMeshInstance:function(){var e,t,r,n,o,l,c,h,d,f,m,v,i;for(l=this.readU32(),h=this.parseMatrix4(),e=this.readUTF(),c=this.readU32(),v=this.readU16(),r=this.getBlock(c),d=[],i=0;i<v;i++)m=this.readU32(),f=this.getBlock(m),d.push(f);if(o=[],(n=r.length)>1)for(t=new Object3D,i=0;i<n;i++){var y=new Mesh(r[i]);o.push(y),t.add(y)}else t=new Mesh(r[0]),o.push(t);t.applyMatrix4(h),t.name=e,(this.getBlock(l)||this.trunk).add(t);var x=d.length,_=Math.max(n,x);for(i=0;i<_;i++)o[i%n].material=d[i%x];return this.parseProperties(null),t.extra=this.parseUserAttributes(),t},parseMaterial:function(){var e,t,r,n,o,l;for(e=this.readUTF(),t=this.readU8(),l=this.readU8(),r=this.parseProperties({1:3,2:23,11:21,12:7,13:21}),0;0<l;)this.readU16(),this.parseProperties(null),this.parseUserAttributes();if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(n=this.materialFactory(e)))return n;if(n=new MeshPhongMaterial,1===t)n.color.setHex(r.get(1,13421772));else if(2===t){var c=r.get(2,0);n.map=this.getBlock(c)}return n.extra=o,n.alphaThreshold=r.get(12,0),n.repeat=r.get(13,!1),n},parseTexture:function(){var e,t,r=this.readUTF();if(0===this.readU8()){t=this.readU32();var n=this.readUTFBytes(t);console.log(n),(e=this.loadTexture(n)).userData={},e.userData.name=r}return this.parseProperties(null),this.parseUserAttributes(),e},loadTexture:function(e){var t=new Texture;return new ImageLoader(this.manager).load(this._baseDir+e,(function(image){t.image=image,t.needsUpdate=!0})),t},parseSkeleton:function(){this.readUTF();var e=this.readU16(),t=[],r=0;for(this.parseProperties(null);r<e;){var n,o;this.readU16(),(n=new Bone).parent=this.readU16()-1,n.name=this.readUTF(),o=this.parseMatrix4(),n.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),t.push(n),r++}return this.parseUserAttributes(),t},parseSkeletonPose:function(){this.readUTF();var e=this.readU16();this.parseProperties(null);for(var t=[],r=0;r<e;){var n;n=1===this.readU8()?this.parseMatrix4():new Matrix4,t[r]=n,r++}return this.parseUserAttributes(),t},parseSkeletonAnimation:function(){this.readUTF();var e,t,r,n=[],o=this.readU16();this.parseProperties(null);for(var l=0;l<o;)t=this.readU32(),e=this.readU16(),r=this._blocks[t].data,n.push({pose:r,duration:e}),l++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(){this.readUTF();for(var e,t=this.readU16(),r=(this.parseProperties({1:5}),0),n=[];r<t;)e=this.readU32(),n.push(this._blocks[e].data),r++;return this.parseUserAttributes(),n},parseAnimatorSet:function(){this.readUTF();var e,t,r=this.readU16(),n=this.parseProperties({1:23});e=this.readU32();for(var o=this.readU16(),l=[],i=0;i<o;i++)l.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var c,h=[];for(i=0;i<l.length;i++)h.push(this._blocks[l[i]].data);for(t=this._blocks[e].data,1==r&&(c={animationSet:t,skeleton:this._blocks[n.get(1,0)].data}),i=0;i<h.length;i++)h[i].animator=c;return c},parseMeshData:function(){var e,t,r=this.readUTF(),n=this.readU16(),o=0,l=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<n;){var c,h,d;for((e=new BufferGeometry).name=r,l.push(e),c=this.readU32(),h=this._ptr+c,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<h;){var f=0,m=this.readU8(),v=(this.readU8(),this.readU32()),y=v+this._ptr;if(1===m)for(d=new BufferAttribute(t=new Float32Array(v/12*3),3),e.setAttribute("position",d),f=0;this._ptr<y;)t[f]=-this.readF32(),t[f+1]=this.readF32(),t[f+2]=this.readF32(),f+=3;else if(2===m)for(d=new BufferAttribute(t=new Uint16Array(v/2),1),e.setIndex(d),f=0;this._ptr<y;)t[f+1]=this.readU16(),t[f]=this.readU16(),t[f+2]=this.readU16(),f+=3;else if(3===m)for(d=new BufferAttribute(t=new Float32Array(v/8*2),2),e.setAttribute("uv",d),f=0;this._ptr<y;)t[f]=this.readF32(),t[f+1]=1-this.readF32(),f+=2;else if(4===m)for(d=new BufferAttribute(t=new Float32Array(v/12*3),3),e.setAttribute("normal",d),f=0;this._ptr<y;)t[f]=-this.readF32(),t[f+1]=this.readF32(),t[f+2]=this.readF32(),f+=3;else this._ptr=y}this.parseUserAttributes(),e.computeBoundingSphere(),o++}return this.parseUserAttributes(),l},parseMeshPoseAnimation:function(e){var t,r,n,o,l,c,h,d,f,m=1,v=0,y={},x=[],_=(this.readUTF(),this.readU32()),M=this.getBlock(_);if(null!==M){for((c=M.geometry).morphTargets=[],e||(m=this.readU16()),t=this.readU16(),h=this.readU16(),d=0;d<h;)x.push(this.readU16()),d++;for(f=this.parseProperties({1:21,2:21}),y.looping=f.get(1,!0),y.stitchFinalFrame=f.get(2,!1),r=0;r<m;){for(this.readU16(),n=0;n<t;)for(d=0,o=this.readU32(),l=this._ptr+o;d<h;){if(1===x[d]){var w=new Float32Array(o/4);for(c.morphTargets.push({array:w}),v=0;this._ptr<l;)w[v]=this.readF32(),w[v+1]=this.readF32(),w[v+2]=this.readF32(),v+=3;n++}else this._ptr=l;d++}r++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",_)},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new Matrix4,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var r=this.readU32(),n=this._ptr+r,o=new t;if(e)for(;this._ptr<n;){var l,c=this.readU16(),h=this.readU32();e.hasOwnProperty(c)?(l=e[c],o.set(c,this.parseAttrValue(l,h))):this._ptr+=h}return o},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,t){var r,n;switch(e){case 1:r=1,n=this.readI8;break;case 2:r=2,n=this.readI16;break;case 3:r=4,n=this.readI32;break;case 21:case 4:r=1,n=this.readU8;break;case 5:r=2,n=this.readU16;break;case 6:case 23:r=4,n=this.readU32;break;case 7:r=4,n=this.readF32;break;case 8:r=8,n=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,n=this.readF64}if(r<t){var o,l,c;for(o=[],l=0,c=t/r;l<c;)o.push(n.call(this)),l++;return o}return n.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var a=this._data.getUint16(this._ptr,!0);return this._ptr+=2,a},readI16:function(){var a=this._data.getInt16(this._ptr,!0);return this._ptr+=2,a},readU32:function(){var a=this._data.getUint32(this._ptr,!0);return this._ptr+=4,a},readI32:function(){var a=this._data.getInt32(this._ptr,!0);return this._ptr+=4,a},readF32:function(){var a=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,a},readF64:function(){var a=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,a},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],r=0;t.length<e;){var n=this._data.getUint8(this._ptr++,!0);if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){var o=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((31&n)<<6|63&o)}else{o=this._data.getUint8(this._ptr++,!0);var l=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((15&n)<<12|(63&o)<<6|63&l)}}return t.join("")}}),r}();function CompressedTexture(e,t,r,n,o,l,c,h,d,f,m,v){Texture.call(this,null,l,c,h,d,f,n,o,m,v),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0;var BasisTextureLoader=function(e){Loader.call(this,e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={format:null,astcSupported:!1,etcSupported:!1,dxtSupported:!1,pvrtcSupported:!1}};BasisTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BasisTextureLoader,setTranscoderPath:function(path){return this.transcoderPath=path,this},setWorkerLimit:function(e){return this.workerLimit=e,this},detectSupport:function(e){var t=this.workerConfig;if(t.astcSupported=!!e.extensions.get("WEBGL_compressed_texture_astc"),t.etcSupported=!!e.extensions.get("WEBGL_compressed_texture_etc1"),t.dxtSupported=!!e.extensions.get("WEBGL_compressed_texture_s3tc"),t.pvrtcSupported=!!e.extensions.get("WEBGL_compressed_texture_pvrtc")||!!e.extensions.get("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.astcSupported)t.format=BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4;else if(t.dxtSupported)t.format=BasisTextureLoader.BASIS_FORMAT.cTFBC3;else if(t.pvrtcSupported)t.format=BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA;else{if(!t.etcSupported)throw new Error("BasisTextureLoader: No suitable compressed texture format found.");t.format=BasisTextureLoader.BASIS_FORMAT.cTFETC1}return this},load:function(e,t,r,n){var o=this,l=new FileLoader(this.manager);l.setResponseType("arraybuffer"),l.load(e,(function(e){o._createTexture(e).then(t).catch(n)}),r,n)},_createTexture:function(e){var t,r,n=this,o=e.byteLength,l=this._allocateWorker(o).then((function(o){return t=o,r=n.workerNextTaskID++,new Promise((function(n,o){t._callbacks[r]={resolve:n,reject:o},t.postMessage({type:"transcode",id:r,buffer:e},[e])}))})).then((function(e){var t,r=n.workerConfig,o=e.width,l=e.height,c=e.mipmaps;switch(e.format){case BasisTextureLoader.BASIS_FORMAT.cTFASTC_4x4:t=new CompressedTexture(c,o,l,RGBA_ASTC_4x4_Format);break;case BasisTextureLoader.BASIS_FORMAT.cTFBC1:case BasisTextureLoader.BASIS_FORMAT.cTFBC3:t=new CompressedTexture(c,o,l,BasisTextureLoader.DXT_FORMAT_MAP[r.format],UnsignedByteType);break;case BasisTextureLoader.BASIS_FORMAT.cTFETC1:t=new CompressedTexture(c,o,l,RGB_ETC1_Format);break;case BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGB:t=new CompressedTexture(c,o,l,RGB_PVRTC_4BPPV1_Format);break;case BasisTextureLoader.BASIS_FORMAT.cTFPVRTC1_4_RGBA:t=new CompressedTexture(c,o,l,RGBA_PVRTC_4BPPV1_Format);break;default:throw new Error("BasisTextureLoader: No supported format available.")}return t.minFilter=1===c.length?LinearFilter:LinearMipmapLinearFilter,t.magFilter=LinearFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t}));return l.finally((function(){t&&r&&(t._taskLoad-=o,delete t._callbacks[r])})),l},_initTranscoder:function(){var e=this;if(!this.transcoderPending){var t=new FileLoader(this.manager);t.setPath(this.transcoderPath);var r=new Promise((function(e,r){t.load("basis_transcoder.js",e,void 0,r)})),n=new FileLoader(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer");var o=new Promise((function(e,t){n.load("basis_transcoder.wasm",e,void 0,t)}));this.transcoderPending=Promise.all([r,o]).then((function(t){var r=t[0],n=t[1],o=BasisTextureLoader.BasisWorker.toString(),body=["/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([body])),e.transcoderBinary=n}))}return this.transcoderPending},_allocateWorker:function(e){var t=this;return this._initTranscoder().then((function(){var r;t.workerPool.length<t.workerLimit?((r=new Worker(t.workerSourceURL))._callbacks={},r._taskLoad=0,r.postMessage({type:"init",config:t.workerConfig,transcoderBinary:t.transcoderBinary}),r.onmessage=function(e){var t=e.data;switch(t.type){case"transcode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('BasisTextureLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(r)):t.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));return(r=t.workerPool[t.workerPool.length-1])._taskLoad+=e,r}))},dispose:function(){for(var i=0;i<this.workerPool.length;i++)this.workerPool[i].terminate();return this.workerPool.length=0,this}}),BasisTextureLoader.BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7_M6_OPAQUE_ONLY:6,cTFBC7_M5:7,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16},BasisTextureLoader.DXT_FORMAT={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},BasisTextureLoader.DXT_FORMAT_MAP={},BasisTextureLoader.DXT_FORMAT_MAP[BasisTextureLoader.BASIS_FORMAT.cTFBC1]=BasisTextureLoader.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT,BasisTextureLoader.DXT_FORMAT_MAP[BasisTextureLoader.BASIS_FORMAT.cTFBC3]=BasisTextureLoader.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT,BasisTextureLoader.BasisWorker=function(){var e,t,r;onmessage=function(n){var o,l,c=n.data;switch(c.type){case"init":e=c.config,o=c.transcoderBinary,t=new Promise((function(e){l={wasmBinary:o,onRuntimeInitialized:e},BASIS(l)})).then((function(){var e=l.BasisFile,t=l.initializeBasis;r=e,t()}));break;case"transcode":t.then((function(){try{for(var t=function(t){var n=new r(new Uint8Array(t)),o=n.getImageWidth(0,0),l=n.getImageHeight(0,0),c=n.getNumLevels(0),h=n.getHasAlpha();function d(){n.close(),n.delete()}if(!h)switch(e.format){case 9:e.format=8}if(!o||!l||!c)throw d(),new Error("BasisTextureLoader:  Invalid .basis file");if(!n.startTranscoding())throw d(),new Error("BasisTextureLoader: .startTranscoding failed");for(var f=[],m=0;m<c;m++){var v=n.getImageWidth(0,m),y=n.getImageHeight(0,m),x=new Uint8Array(n.getImageTranscodedSizeInBytes(0,m,e.format));if(!n.transcodeImage(x,0,m,e.format,0,h))throw d(),new Error("BasisTextureLoader: .transcodeImage failed.");f.push({data:x,width:v,height:y})}return d(),{width:o,height:l,hasAlpha:h,mipmaps:f,format:e.format}}(c.buffer),n=t.width,o=t.height,l=t.hasAlpha,h=t.mipmaps,d=t.format,f=[],i=0;i<h.length;++i)f.push(h[i].data.buffer);self.postMessage({type:"transcode",id:c.id,width:n,height:o,hasAlpha:l,mipmaps:h,format:d},f)}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}}))}}};var BVHLoader=function(e){Loader.call(this,e),this.animateBonePositions=!0,this.animateBoneRotations=!0};function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function PointLight(e,t,r,n){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new PointLightShadow}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(e,t,r,n,o,l){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==o?o:0,this.decay=void 0!==l?l:1,this.shadow=new SpotLightShadow}BVHLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BVHLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(text){function e(data,t,r){if("ENDSITE"!==r.type){var n={time:t,position:new Vector3,rotation:new Quaternion};r.frames.push(n);for(var o=new Quaternion,l=new Vector3(1,0,0),c=new Vector3(0,1,0),h=new Vector3(0,0,1),i=0;i<r.channels.length;i++)switch(r.channels[i]){case"Xposition":n.position.x=parseFloat(data.shift().trim());break;case"Yposition":n.position.y=parseFloat(data.shift().trim());break;case"Zposition":n.position.z=parseFloat(data.shift().trim());break;case"Xrotation":o.setFromAxisAngle(l,parseFloat(data.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(c,parseFloat(data.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(h,parseFloat(data.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(i=0;i<r.children.length;i++)e(data,t,r.children[i])}}function t(e){for(var line;0===(line=e.shift().trim()).length;);return line}var r=this,n=function(r){"HIERARCHY"!==t(r)&&console.error("BVHLoader: HIERARCHY expected.");var n=[],o=function e(r,n,o){var l={name:"",type:"",frames:[]};o.push(l);var c=n.split(/[\s]+/);"END"===c[0].toUpperCase()&&"SITE"===c[1].toUpperCase()?(l.type="ENDSITE",l.name="ENDSITE"):(l.name=c[1],l.type=c[0].toUpperCase());"{"!==t(r)&&console.error("BVHLoader: Expected opening { after type & name");"OFFSET"!==(c=t(r).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+c[0]);4!==c.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var h=new Vector3(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));(isNaN(h.x)||isNaN(h.y)||isNaN(h.z))&&console.error("BVHLoader: Invalid values of OFFSET.");if(l.offset=h,"ENDSITE"!==l.type){"CHANNELS"!==(c=t(r).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var d=parseInt(c[1]);l.channels=c.splice(2,d),l.children=[]}for(;;){var line=t(r);if("}"===line)return l;l.children.push(e(r,line,o))}}(r,t(r),n);"MOTION"!==t(r)&&console.error("BVHLoader: MOTION expected.");var l=t(r).split(/[\s]+/),c=parseInt(l[1]);isNaN(c)&&console.error("BVHLoader: Failed to read number of frames."),l=t(r).split(/[\s]+/);var h=parseFloat(l[2]);isNaN(h)&&console.error("BVHLoader: Failed to read frame time.");for(var i=0;i<c;i++)e(l=t(r).split(/[\s]+/),i*h,o);return n}(text.split(/[\r\n]+/g)),o=[];!function e(source,t){var r=new Bone;if(t.push(r),r.position.add(source.offset),r.name=source.name,"ENDSITE"!==source.type)for(var i=0;i<source.children.length;i++)r.add(e(source.children[i],t));return r}(n[0],o);var l=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("ENDSITE"!==n.type){for(var o=[],l=[],c=[],h=0;h<n.frames.length;h++){var d=n.frames[h];o.push(d.time),l.push(d.position.x+n.offset.x),l.push(d.position.y+n.offset.y),l.push(d.position.z+n.offset.z),c.push(d.rotation.x),c.push(d.rotation.y),c.push(d.rotation.z),c.push(d.rotation.w)}r.animateBonePositions&&t.push(new VectorKeyframeTrack(".bones["+n.name+"].position",o,l)),r.animateBoneRotations&&t.push(new QuaternionKeyframeTrack(".bones["+n.name+"].quaternion",o,c))}}return new AnimationClip("animation",-1,t)}(n);return{skeleton:new Skeleton(o),clip:l}}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,n=this._projScreenMatrix,o=this._lookTarget,l=this._lightPositionWorld;l.setFromMatrixPosition(e.matrixWorld),t.position.copy(l),o.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(o),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(source){return this.camera=source.camera.clone(),this.bias=source.bias,this.radius=source.radius,this.mapSize.copy(source.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var object={};return 0!==this.bias&&(object.bias=this.bias),1!==this.radius&&(object.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(object.mapSize=this.mapSize.toArray()),object.camera=this.camera.toJSON(!1).object,delete object.camera.matrix,object}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(e){LightShadow.prototype.updateMatrices.call(this,e)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var r=this.camera,n=this.matrix,o=this._lightPositionWorld,l=this._lookTarget,c=this._projScreenMatrix;o.setFromMatrixPosition(e.matrixWorld),r.position.copy(o),l.copy(r.position),l.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(l),r.updateMatrixWorld(),n.makeTranslation(-o.x,-o.y,-o.z),c.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(c)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.decay=source.decay,this.shadow=source.shadow.clone(),this}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=2*MathUtils.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;r===t.fov&&n===t.aspect&&o===t.far||(t.fov=r,t.aspect=n,t.far=o,t.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,e)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.angle=source.angle,this.penumbra=source.penumbra,this.decay=source.decay,this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}});var TGALoader=function(e){Loader.call(this,e)};function Node(e){this.uuid=MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}TGALoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TGALoader,load:function(e,t,r,n){var o=this,l=new Texture,c=new FileLoader(this.manager);return c.setResponseType("arraybuffer"),c.setPath(this.path),c.load(e,(function(e){l.image=o.parse(e),l.needsUpdate=!0,void 0!==t&&t(l)}),r,n),l},parse:function(e){var t=0,r=1,n=2,o=3,l=9,c=10,h=11,d=48,f=4,m=0,v=1,y=2,x=3;e.length<19&&console.error("TGALoader: Not enough data to contain header.");var content=new Uint8Array(e),_=0,header={id_length:content[_++],colormap_type:content[_++],image_type:content[_++],colormap_index:content[_++]|content[_++]<<8,colormap_length:content[_++]|content[_++]<<8,colormap_size:content[_++],origin:[content[_++]|content[_++]<<8,content[_++]|content[_++]<<8],width:content[_++]|content[_++]<<8,height:content[_++]|content[_++]<<8,pixel_size:content[_++],flags:content[_++]};!function(header){switch(header.image_type){case r:case l:(header.colormap_length>256||24!==header.colormap_size||1!==header.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case n:case o:case c:case h:header.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',header.image_type)}(header.width<=0||header.height<=0)&&console.error("TGALoader: Invalid image size."),8!==header.pixel_size&&16!==header.pixel_size&&24!==header.pixel_size&&32!==header.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',header.pixel_size)}(header),header.id_length+_>e.length&&console.error("TGALoader: No data."),_+=header.id_length;var M=!1,w=!1,S=!1;switch(header.image_type){case l:M=!0,w=!0;break;case r:w=!0;break;case c:M=!0;break;case n:break;case h:M=!0,S=!0;break;case o:S=!0}var A="undefined"!=typeof OffscreenCanvas,canvas=A?new OffscreenCanvas(header.width,header.height):document.createElement("canvas");canvas.width=header.width,canvas.height=header.height;var T=canvas.getContext("2d"),L=T.createImageData(header.width,header.height),C=function(e,t,header,r,data){var n,o,l,c;if(o=header.pixel_size>>3,l=header.width*header.height*o,t&&(c=data.subarray(r,r+=header.colormap_length*(header.colormap_size>>3))),e){var h,d,i;n=new Uint8Array(l);for(var f=0,m=new Uint8Array(o);f<l;)if(d=1+(127&(h=data[r++])),128&h){for(i=0;i<o;++i)m[i]=data[r++];for(i=0;i<d;++i)n.set(m,f+i*o);f+=o*d}else{for(d*=o,i=0;i<d;++i)n[f+i]=data[r++];f+=d}}else n=data.subarray(r,r+=t?header.width*header.height:l);return{pixel_data:n,palettes:c}}(M,w,header,_,content);!function(data,e,t,image,r){var n,o,l,c,h,_;switch((header.flags&d)>>f){default:case y:n=0,l=1,h=e,o=0,c=1,_=t;break;case m:n=0,l=1,h=e,o=t-1,c=-1,_=-1;break;case x:n=e-1,l=-1,h=-1,o=0,c=1,_=t;break;case v:n=e-1,l=-1,h=-1,o=t-1,c=-1,_=-1}if(S)switch(header.pixel_size){case 8:!function(e,t,r,n,o,l,c,image){var h,d,f,i=0,m=header.width;for(f=t;f!==n;f+=r)for(d=o;d!==c;d+=l,i++)h=image[i],e[4*(d+m*f)+0]=h,e[4*(d+m*f)+1]=h,e[4*(d+m*f)+2]=h,e[4*(d+m*f)+3]=255}(data,o,c,_,n,l,h,image);break;case 16:!function(e,t,r,n,o,l,c,image){var h,d,i=0,f=header.width;for(d=t;d!==n;d+=r)for(h=o;h!==c;h+=l,i+=2)e[4*(h+f*d)+0]=image[i+0],e[4*(h+f*d)+1]=image[i+0],e[4*(h+f*d)+2]=image[i+0],e[4*(h+f*d)+3]=image[i+1]}(data,o,c,_,n,l,h,image);break;default:console.error("TGALoader: Format not supported.")}else switch(header.pixel_size){case 8:!function(e,t,r,n,o,l,c,image,h){var d,f,m,v=h,i=0,y=header.width;for(m=t;m!==n;m+=r)for(f=o;f!==c;f+=l,i++)d=image[i],e[4*(f+y*m)+3]=255,e[4*(f+y*m)+2]=v[3*d+0],e[4*(f+y*m)+1]=v[3*d+1],e[4*(f+y*m)+0]=v[3*d+2]}(data,o,c,_,n,l,h,image,r);break;case 16:!function(e,t,r,n,o,l,c,image){var h,d,f,i=0,m=header.width;for(f=t;f!==n;f+=r)for(d=o;d!==c;d+=l,i+=2)h=image[i+0]+(image[i+1]<<8),e[4*(d+m*f)+0]=(31744&h)>>7,e[4*(d+m*f)+1]=(992&h)>>2,e[4*(d+m*f)+2]=(31&h)>>3,e[4*(d+m*f)+3]=32768&h?0:255}(data,o,c,_,n,l,h,image);break;case 24:!function(e,t,r,n,o,l,c,image){var h,d,i=0,f=header.width;for(d=t;d!==n;d+=r)for(h=o;h!==c;h+=l,i+=3)e[4*(h+f*d)+3]=255,e[4*(h+f*d)+2]=image[i+0],e[4*(h+f*d)+1]=image[i+1],e[4*(h+f*d)+0]=image[i+2]}(data,o,c,_,n,l,h,image);break;case 32:!function(e,t,r,n,o,l,c,image){var h,d,i=0,f=header.width;for(d=t;d!==n;d+=r)for(h=o;h!==c;h+=l,i+=4)e[4*(h+f*d)+2]=image[i+0],e[4*(h+f*d)+1]=image[i+1],e[4*(h+f*d)+0]=image[i+2],e[4*(h+f*d)+3]=image[i+3]}(data,o,c,_,n,l,h,image);break;default:console.error("TGALoader: Format not supported.")}}(L.data,header.width,header.height,C.pixel_data,C.palettes);return T.putImageData(L,0,0),A?canvas.transferToImageBitmap():canvas}}),Node.prototype={constructor:Node,isNode:!0,analyze:function(e,t){t=t||{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1},analyzeAndFlow:function(e,output,t){return t=t||{},this.analyze(e,t),this.flow(e,output,t)},flow:function(e,output,t){t=t||{},e.addFlow(t.slot,t.cache,t.context);var r={};return r.result=this.build(e,output),r.code=e.clearNodeCode(),r.extra=e.context.extra,e.removeFlow(),r},build:function(e,output,t){output=output||this.getType(e,output);var data=e.getNodeData(t||this);return e.analyzing&&this.appendDepsNode(e,data,output),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,output,t)},generate:function(){},appendDepsNode:function(e,data,output){data.deps=(data.deps||0)+1;var t=e.getTypeLength(output);(t>(data.outputMax||0)||this.getType(e,output))&&(data.outputMax=t,data.output=output)},setName:function(e){return this.name=e,this},getName:function(){return this.name},getType:function(e,output){return"sampler2D"===output||"samplerCube"===output?output:this.type},getJSONNode:function(meta){if(!(void 0===meta||"string"==typeof meta)&&void 0!==meta.nodes[this.uuid])return meta.nodes[this.uuid]},copy:function(source){return void 0!==source.name&&(this.name=source.name),void 0!==source.userData&&(this.userData=JSON.parse(JSON.stringify(source.userData))),this},createJSONNode:function(meta){var e=void 0===meta||"string"==typeof meta,data={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return data.uuid=this.uuid,data.nodeType=this.nodeType,""!==this.name&&(data.name=this.name),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),e||(meta.nodes[this.uuid]=data),data},toJSON:function(meta){return this.getJSONNode(meta)||this.createJSONNode(meta)}};var ColladaLoader=function(e){Loader.call(this,e)};function CompressedTextureLoader(e){Loader.call(this,e)}ColladaLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ColladaLoader,load:function(e,t,r,n){var o=this,path=""===o.path?LoaderUtils.extractUrlBase(e):o.path,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(text,path))}),r,n)},options:{set convertUpAxis(e){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(text,path){function e(e,t){for(var r=[],n=e.childNodes,i=0,o=n.length;i<o;i++){var l=n[i];l.nodeName===t&&r.push(l)}return r}function t(text){if(0===text.length)return[];for(var e=text.trim().split(/\s+/),t=new Array(e.length),i=0,r=e.length;i<r;i++)t[i]=e[i];return t}function r(text){if(0===text.length)return[];for(var e=text.trim().split(/\s+/),t=new Array(e.length),i=0,r=e.length;i<r;i++)t[i]=parseFloat(e[i]);return t}function n(text){if(0===text.length)return[];for(var e=text.trim().split(/\s+/),t=new Array(e.length),i=0,r=e.length;i<r;i++)t[i]=parseInt(e[i]);return t}function o(text){return text.substring(1)}function l(object){return 0===Object.keys(object).length}function c(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function d(t,r,n,o){var l=e(t,r)[0];if(void 0!==l)for(var c=e(l,n),i=0;i<c.length;i++)o(c[i])}function f(data,e){for(var t in data){data[t].build=e(data[t])}}function m(data,e){return void 0!==data.build||(data.build=e(data)),data.build}function v(e){for(var data={inputs:{}},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var n=o(r.getAttribute("source")),l=r.getAttribute("semantic");data.inputs[l]=n}}return data}function y(e){var data={},t=e.getAttribute("target").split("/"),r=t.shift(),n=t.shift(),l=-1!==n.indexOf("("),c=-1!==n.indexOf(".");if(c)t=n.split("."),n=t.shift(),data.member=t.shift();else if(l){var h=n.split("(");n=h.shift();for(var i=0;i<h.length;i++)h[i]=parseInt(h[i].replace(/\)/,""));data.indices=h}return data.id=r,data.sid=n,data.arraySyntax=l,data.memberSyntax=c,data.sampler=o(e.getAttribute("source")),data}function x(data){var e=[],t=data.channels,r=data.samplers,n=data.sources;for(var o in t)if(t.hasOwnProperty(o)){var l=t[o],c=r[l.sampler],h=c.inputs.INPUT,d=c.inputs.OUTPUT;T(M(l,n[h],n[d]),e)}return e}function _(e){return m(it.animations[e],x)}function M(e,t,r){var time,n,i,o,l,c,h=it.nodes[e.id],d=Ge(h.id),f=h.transforms[e.sid],m=h.matrix.clone().transpose(),data={};switch(f){case"matrix":for(i=0,o=t.array.length;i<o;i++)if(time=t.array[i],n=i*r.stride,void 0===data[time]&&(data[time]={}),!0===e.arraySyntax){var v=r.array[n],y=e.indices[0]+4*e.indices[1];data[time][y]=v}else for(l=0,c=r.stride;l<c;l++)data[time][l]=r.array[n+l];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',f)}var x=function(data,e){var t=[];for(var time in data)t.push({time:parseFloat(time),value:data[time]});t.sort((function(a,b){return a.time-b.time}));for(var i=0;i<16;i++)L(t,i,e.elements[i]);return t}(data,m);return{name:d.uuid,keyframes:x}}var w=new Vector3,S=new Vector3,A=new Quaternion;function T(e,t){for(var r=e.keyframes,n=e.name,o=[],l=[],c=[],h=[],i=0,d=r.length;i<d;i++){var f=r[i],time=f.time,m=f.value;Pe.fromArray(m).transpose(),Pe.decompose(w,A,S),o.push(time),l.push(w.x,w.y,w.z),c.push(A.x,A.y,A.z,A.w),h.push(S.x,S.y,S.z)}return l.length>0&&t.push(new VectorKeyframeTrack(n+".position",o,l)),c.length>0&&t.push(new QuaternionKeyframeTrack(n+".quaternion",o,c)),h.length>0&&t.push(new VectorKeyframeTrack(n+".scale",o,h)),t}function L(e,t,r){var n,i,o,l=!0;for(i=0,o=e.length;i<o;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:l=!1;if(!0===l)for(i=0,o=e.length;i<o;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,o=e.length;i<o;i++){var l=e[i];if(null===l.value[t]){if(r=C(e,i,t),n=N(e,i,t),null===r){l.value[t]=n.value[t];continue}if(null===n){l.value[t]=r.value[t];continue}P(l,r,n,t)}}}(e,t)}function C(e,i,t){for(;i>=0;){var r=e[i];if(null!==r.value[t])return r;i--}return null}function N(e,i,t){for(;i<e.length;){var r=e[i];if(null!==r.value[t])return r;i++}return null}function P(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function F(data){for(var e=[],t=data.name,r=data.end-data.start||-1,n=data.animations,i=0,o=n.length;i<o;i++)for(var l=_(n[i]),c=0,h=l.length;c<h;c++)e.push(l[c]);return new AnimationClip(t,r,e)}function E(e){return m(it.clips[e],F)}function R(e){for(var data={sources:{}},i=0,t=e.childNodes.length;i<t;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":data.bindShapeMatrix=r(n.textContent);break;case"source":var o=n.getAttribute("id");data.sources[o]=ue(n);break;case"joints":data.joints=D(n);break;case"vertex_weights":data.vertexWeights=O(n)}}return data}function D(e){for(var data={inputs:{}},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var n=r.getAttribute("semantic"),l=o(r.getAttribute("source"));data.inputs[n]=l}}return data}function O(e){for(var data={inputs:{}},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var l=r.getAttribute("semantic"),c=o(r.getAttribute("source")),h=parseInt(r.getAttribute("offset"));data.inputs[l]={id:c,offset:h};break;case"vcount":data.vcount=n(r.textContent);break;case"v":data.v=n(r.textContent)}}return data}function I(data){var e={id:data.id},t=it.geometries[e.id];return void 0!==data.skin&&(e.skin=function(data){var i,e,t,r={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=data.sources,o=data.vertexWeights,l=o.vcount,c=o.v,h=o.inputs.JOINT.offset,d=o.inputs.WEIGHT.offset,f=data.sources[data.joints.inputs.JOINT],m=data.sources[data.joints.inputs.INV_BIND_MATRIX],v=n[o.inputs.WEIGHT.id].array,y=0;for(i=0,t=l.length;i<t;i++){var x=l[i],_=[];for(e=0;e<x;e++){var M=c[y+h],w=c[y+d],S=v[w];_.push({index:M,weight:S}),y+=2}for(_.sort(C),e=0;e<4;e++){var A=_[e];void 0!==A?(r.indices.array.push(A.index),r.weights.array.push(A.weight)):(r.indices.array.push(0),r.weights.array.push(0))}}data.bindShapeMatrix?r.bindMatrix=(new Matrix4).fromArray(data.bindShapeMatrix).transpose():r.bindMatrix=(new Matrix4).identity();for(i=0,t=f.array.length;i<t;i++){var T=f.array[i],L=(new Matrix4).fromArray(m.array,i*m.stride).transpose();r.joints.push({name:T,boneInverse:L})}return r;function C(a,b){return b.weight-a.weight}}(data.skin),t.sources.skinIndices=e.skin.indices,t.sources.skinWeights=e.skin.weights),e}function B(data){return void 0!==data.build?data.build:data.init_from}function U(e){var data=it.images[e];return void 0!==data?m(data,B):(console.warn("ColladaLoader: Couldn't find image with ID:",e),null)}function k(e){for(var data={surfaces:{},samplers:{}},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"newparam":V(r,data);break;case"technique":data.technique=j(r);break;case"extra":data.extra=K(r)}}return data}function V(e,data){for(var t=e.getAttribute("sid"),i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"surface":data.surfaces[t]=G(n);break;case"sampler2D":data.samplers[t]=z(n)}}}function G(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"init_from":data.init_from=r.textContent}}return data}function z(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"source":data.source=r.textContent}}return data}function j(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":data.type=r.nodeName,data.parameters=W(r)}}return data}function W(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":data[r.nodeName]=H(r);break;case"transparent":data[r.nodeName]={opaque:r.getAttribute("opaque"),data:H(r)}}}return data}function H(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"color":data[n.nodeName]=r(n.textContent);break;case"float":data[n.nodeName]=parseFloat(n.textContent);break;case"texture":data[n.nodeName]={id:n.getAttribute("texture"),extra:X(n)}}}return data}function X(e){for(var data={technique:{}},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"extra":Y(r,data)}}return data}function Y(e,data){for(var i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique":Q(r,data)}}}function Q(e,data){for(var i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":data.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?data.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?data.technique[r.nodeName]=0:data.technique[r.nodeName]=parseInt(r.textContent)}}}function K(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique":data.technique=J(r)}}return data}function J(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"double_sided":data[r.nodeName]=parseInt(r.textContent)}}return data}function Z(data){return data}function $(data){var e,t,r=(e=data.url,m(it.effects[e],Z)),n=r.profile.technique,o=r.profile.extra;switch(n.type){case"phong":case"blinn":t=new MeshPhongMaterial;break;case"lambert":t=new MeshLambertMaterial;break;default:t=new MeshBasicMaterial}function c(e){var t=r.profile.samplers[e.id],image=null;void 0!==t?image=U(r.profile.surfaces[t.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),image=U(e.id));if(null!==image){var n=function(image){var e,t=image.slice(2+(image.lastIndexOf(".")-1>>>0));switch(t=t.toLowerCase()){case"tga":e=Ke;break;default:e=Ze}return e}(image);if(void 0!==n){var o=n.load(image),c=e.extra;if(void 0!==c&&void 0!==c.technique&&!1===l(c.technique)){var h=c.technique;o.wrapS=h.wrapU?RepeatWrapping:ClampToEdgeWrapping,o.wrapT=h.wrapV?RepeatWrapping:ClampToEdgeWrapping,o.offset.set(h.offsetU||0,h.offsetV||0),o.repeat.set(h.repeatU||1,h.repeatV||1)}else o.wrapS=RepeatWrapping,o.wrapT=RepeatWrapping;return o}return console.warn("ColladaLoader: Loader for texture %s not found.",image),null}return console.warn("ColladaLoader: Couldn't create texture with ID:",e.id),null}t.name=data.name||"";var h=n.parameters;for(var d in h){var f=h[d];switch(d){case"diffuse":f.color&&t.color.fromArray(f.color),f.texture&&(t.map=c(f.texture));break;case"specular":f.color&&t.specular&&t.specular.fromArray(f.color),f.texture&&(t.specularMap=c(f.texture));break;case"bump":f.texture&&(t.normalMap=c(f.texture));break;case"ambient":f.texture&&(t.lightMap=c(f.texture));break;case"shininess":f.float&&t.shininess&&(t.shininess=f.float);break;case"emission":f.color&&t.emissive&&t.emissive.fromArray(f.color),f.texture&&(t.emissiveMap=c(f.texture))}}var v=h.transparent,y=h.transparency;if(void 0===y&&v&&(y={float:1}),void 0===v&&y&&(v={opaque:"A_ONE",data:{color:[1,1,1,1]}}),v&&y)if(v.data.texture)t.transparent=!0;else{var x=v.data.color;switch(v.opaque){case"A_ONE":t.opacity=x[3]*y.float;break;case"RGB_ZERO":t.opacity=1-x[0]*y.float;break;case"A_ZERO":t.opacity=1-x[3]*y.float;break;case"RGB_ONE":t.opacity=x[0]*y.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',v.opaque)}t.opacity<1&&(t.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(t.side=DoubleSide),t}function ee(e){return m(it.materials[e],$)}function te(e){for(var i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];switch(t.nodeName){case"technique_common":return re(t)}}return{}}function re(e){for(var data={},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];switch(t.nodeName){case"perspective":case"orthographic":data.technique=t.nodeName,data.parameters=ie(t)}}return data}function ie(e){for(var data={},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];switch(t.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":data[t.nodeName]=parseFloat(t.textContent)}}return data}function ne(data){var e;switch(data.optics.technique){case"perspective":e=new PerspectiveCamera(data.optics.parameters.yfov,data.optics.parameters.aspect_ratio,data.optics.parameters.znear,data.optics.parameters.zfar);break;case"orthographic":var t=data.optics.parameters.ymag,r=data.optics.parameters.xmag,n=data.optics.parameters.aspect_ratio;r=void 0===r?t*n:r,t=void 0===t?r/n:t,e=new OrthographicCamera(-(r*=.5),r,t*=.5,-t,data.optics.parameters.znear,data.optics.parameters.zfar);break;default:e=new PerspectiveCamera}return e.name=data.name||"",e}function ae(e){var data=it.cameras[e];return void 0!==data?m(data,ne):(console.warn("ColladaLoader: Couldn't find camera with ID:",e),null)}function oe(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":data.technique=r.nodeName,data.parameters=se(r)}}return data}function se(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"color":var o=r(n.textContent);data.color=(new Color).fromArray(o);break;case"falloff_angle":data.falloffAngle=parseFloat(n.textContent);break;case"quadratic_attenuation":var l=parseFloat(n.textContent);data.distance=l?Math.sqrt(1/l):0}}return data}function le(data){var e;switch(data.technique){case"directional":e=new DirectionalLight;break;case"point":e=new PointLight;break;case"spot":e=new SpotLight;break;case"ambient":e=new AmbientLight}return data.parameters.color&&e.color.copy(data.parameters.color),data.parameters.distance&&(e.distance=data.parameters.distance),e}function ce(e){var data=it.lights[e];return void 0!==data?m(data,le):(console.warn("ColladaLoader: Couldn't find light with ID:",e),null)}function ue(n){for(var data={array:[],stride:3},i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"float_array":data.array=r(o.textContent);break;case"Name_array":data.array=t(o.textContent);break;case"technique_common":var l=e(o,"accessor")[0];void 0!==l&&(data.stride=parseInt(l.getAttribute("stride")))}}return data}function he(e){for(var data={},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];1===t.nodeType&&(data[t.getAttribute("semantic")]=o(t.getAttribute("source")))}return data}function de(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,r=e.childNodes.length;i<r;i++){var l=e.childNodes[i];if(1===l.nodeType)switch(l.nodeName){case"input":var c=o(l.getAttribute("source")),h=l.getAttribute("semantic"),d=parseInt(l.getAttribute("offset")),f=parseInt(l.getAttribute("set")),m=f>0?h+f:h;t.inputs[m]={id:c,offset:d},t.stride=Math.max(t.stride,d+1),"TEXCOORD"===h&&(t.hasUV=!0);break;case"vcount":t.vcount=n(l.textContent);break;case"p":t.p=n(l.textContent)}}return t}function pe(e){for(var t=0,i=0,r=e.length;i<r;i++){!0===e[i].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function fe(data){var e={},t=data.sources,r=data.vertices,n=data.primitives;if(0===n.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(n);for(var l in o){var c=o[l];pe(c),e[l]=me(c,t,r)}return e}function me(e,t,r){for(var n={},o={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},h={array:[],stride:0},d={array:[],stride:0},f=[],m=4,v=[],y=4,x=new BufferGeometry,_=[],M=0,p=0;p<e.length;p++){var w=e[p],S=w.inputs,A=0;switch(w.type){case"lines":case"linestrips":A=2*w.count;break;case"triangles":A=3*w.count;break;case"polylist":for(var g=0;g<w.count;g++){var T=w.vcount[g];switch(T){case 3:A+=3;break;case 4:A+=6;break;default:A+=3*(T-2)}}break;default:console.warn("ColladaLoader: Unknow primitive type:",w.type)}for(var L in x.addGroup(M,A,p),M+=A,w.material&&_.push(w.material),S){var input=S[L];switch(L){case"VERTEX":for(var C in r){var N=r[C];switch(C){case"POSITION":var P=o.array.length;if(ve(w,t[N],input.offset,o.array),o.stride=t[N].stride,t.skinWeights&&t.skinIndices&&(ve(w,t.skinIndices,input.offset,f),ve(w,t.skinWeights,input.offset,v)),!1===w.hasUV&&!0===e.uvsNeedsFix){A=(o.array.length-P)/o.stride;for(var i=0;i<A;i++)c.array.push(0,0)}break;case"NORMAL":ve(w,t[N],input.offset,l.array),l.stride=t[N].stride;break;case"COLOR":ve(w,t[N],input.offset,d.array),d.stride=t[N].stride;break;case"TEXCOORD":ve(w,t[N],input.offset,c.array),c.stride=t[N].stride;break;case"TEXCOORD1":ve(w,t[N],input.offset,h.array),c.stride=t[N].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',C)}}break;case"NORMAL":ve(w,t[input.id],input.offset,l.array),l.stride=t[input.id].stride;break;case"COLOR":ve(w,t[input.id],input.offset,d.array),d.stride=t[input.id].stride;break;case"TEXCOORD":ve(w,t[input.id],input.offset,c.array),c.stride=t[input.id].stride;break;case"TEXCOORD1":ve(w,t[input.id],input.offset,h.array),h.stride=t[input.id].stride}}}return o.array.length>0&&x.setAttribute("position",new Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&x.setAttribute("normal",new Float32BufferAttribute(l.array,l.stride)),d.array.length>0&&x.setAttribute("color",new Float32BufferAttribute(d.array,d.stride)),c.array.length>0&&x.setAttribute("uv",new Float32BufferAttribute(c.array,c.stride)),h.array.length>0&&x.setAttribute("uv2",new Float32BufferAttribute(h.array,h.stride)),f.length>0&&x.setAttribute("skinIndex",new Float32BufferAttribute(f,m)),v.length>0&&x.setAttribute("skinWeight",new Float32BufferAttribute(v,y)),n.data=x,n.type=e[0].type,n.materialKeys=_,n}function ve(e,source,t,r){var n=e.p,o=e.stride,l=e.vcount;function c(i){for(var e=n[i+t]*d,o=e+d;e<o;e++)r.push(h[e])}var h=source.array,d=source.stride;if(void 0!==e.vcount)for(var f=0,i=0,m=l.length;i<m;i++){var v=l[i];if(4===v){var b=f+1*o,y=f+2*o,x=f+3*o;c(f+0*o),c(b),c(x),c(b),c(y),c(x)}else if(3===v){b=f+1*o,y=f+2*o;c(f+0*o),c(b),c(y)}else if(v>4)for(var _=1,M=v-2;_<=M;_++){b=f+o*_,y=f+o*(_+1);c(f+0*o),c(b),c(y)}f+=o*v}else for(i=0,m=n.length;i<m;i+=o)c(i)}function ge(e){return m(it.geometries[e],fe)}function ye(data){return void 0!==data.build?data.build:data}function xe(e,data){for(var i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"joint":data.joints[t.getAttribute("sid")]=be(t);break;case"link":data.links.push(Me(t))}}}function be(e){for(var data,i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"prismatic":case"revolute":data=_e(t)}}return data}function _e(e,data){data={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"axis":var n=r(t.textContent);data.axis.fromArray(n);break;case"limits":var o=t.getElementsByTagName("max")[0],l=t.getElementsByTagName("min")[0];data.limits.max=parseFloat(o.textContent),data.limits.min=parseFloat(l.textContent)}}return data.limits.min>=data.limits.max&&(data.static=!0),data.middlePosition=(data.limits.min+data.limits.max)/2,data}function Me(e){for(var data={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"attachment_full":data.attachments.push(we(t));break;case"matrix":case"translate":case"rotate":data.transforms.push(Se(t))}}return data}function we(e){for(var data={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"link":data.links.push(Me(t));break;case"matrix":case"translate":case"rotate":data.transforms.push(Se(t))}}return data}function Se(e){var data={type:e.nodeName},t=r(e.textContent);switch(data.type){case"matrix":data.obj=new Matrix4,data.obj.fromArray(t).transpose();break;case"translate":data.obj=new Vector3,data.obj.fromArray(t);break;case"rotate":data.obj=new Vector3,data.obj.fromArray(t),data.angle=MathUtils.degToRad(t[3])}return data}function Ae(e,data){for(var i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"technique_common":Te(t,data)}}}function Te(e,data){for(var i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"inertia":data.inertia=r(t.textContent);break;case"mass":data.mass=r(t.textContent)[0]}}}function Le(e){for(var data={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"axis":var param=t.getElementsByTagName("param")[0];data.axis=param.textContent;var r=data.axis.split("inst_").pop().split("axis")[0];data.jointIndex=r.substr(0,r.length-1)}}return data}function Ce(data){return void 0!==data.build?data.build:data}function Ne(e){for(var t=[],n=He.querySelector('[id="'+e.id+'"]'),i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"matrix":var l=r(o.textContent),c=(new Matrix4).fromArray(l).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"translate":case"scale":l=r(o.textContent);var h=(new Vector3).fromArray(l);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:h});break;case"rotate":l=r(o.textContent),h=(new Vector3).fromArray(l);var d=MathUtils.degToRad(l[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:h,angle:d})}}return t}var Pe=new Matrix4,Fe=new Vector3;function Ee(e){for(var data={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"node":data.nodes.push(t.getAttribute("id")),Ee(t);break;case"instance_camera":data.instanceCameras.push(o(t.getAttribute("url")));break;case"instance_controller":data.instanceControllers.push(Re(t));break;case"instance_light":data.instanceLights.push(o(t.getAttribute("url")));break;case"instance_geometry":data.instanceGeometries.push(Re(t));break;case"instance_node":data.instanceNodes.push(o(t.getAttribute("url")));break;case"matrix":var n=r(t.textContent);data.matrix.multiply(Pe.fromArray(n).transpose()),data.transforms[t.getAttribute("sid")]=t.nodeName;break;case"translate":n=r(t.textContent);Fe.fromArray(n),data.matrix.multiply(Pe.makeTranslation(Fe.x,Fe.y,Fe.z)),data.transforms[t.getAttribute("sid")]=t.nodeName;break;case"rotate":n=r(t.textContent);var l=MathUtils.degToRad(n[3]);data.matrix.multiply(Pe.makeRotationAxis(Fe.fromArray(n),l)),data.transforms[t.getAttribute("sid")]=t.nodeName;break;case"scale":n=r(t.textContent);data.matrix.scale(Fe.fromArray(n)),data.transforms[t.getAttribute("sid")]=t.nodeName;break;case"extra":break;default:console.log(t)}}return Ve(data.id)?console.warn("ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",data.id):it.nodes[data.id]=data,data}function Re(e){for(var data={id:o(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];switch(t.nodeName){case"bind_material":for(var r=t.getElementsByTagName("instance_material"),n=0;n<r.length;n++){var l=r[n],symbol=l.getAttribute("symbol"),c=l.getAttribute("target");data.materials[symbol]=o(c)}break;case"skeleton":data.skeletons.push(o(t.textContent))}}return data}function De(e,t){var i,data,r,n=[],o=[];for(i=0;i<e.length;i++){var l=e[i];if(Ve(l))Oe(Ge(l),t,n);else if(r=l,void 0!==it.visualScenes[r])for(var c=it.visualScenes[l].children,h=0;h<c.length;h++){var d=c[h];if("JOINT"===d.type)Oe(Ge(d.id),t,n)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(i=0;i<t.length;i++)for(h=0;h<n.length;h++)if((data=n[h]).bone.name===t[i].name){o[i]=data,data.processed=!0;break}for(i=0;i<n.length;i++)!1===(data=n[i]).processed&&(o.push(data),data.processed=!0);var f=[],m=[];for(i=0;i<o.length;i++)data=o[i],f.push(data.bone),m.push(data.boneInverse);return new Skeleton(f,m)}function Oe(e,t,r){e.traverse((function(object){if(!0===object.isBone){for(var e,i=0;i<t.length;i++){var n=t[i];if(n.name===object.name){e=n.boneInverse;break}}void 0===e&&(e=new Matrix4),r.push({bone:object,boneInverse:e,processed:!1})}}))}function Ie(data){for(var e,t=[],r=data.matrix,n=data.nodes,o=data.type,l=data.instanceCameras,c=data.instanceControllers,h=data.instanceLights,d=data.instanceGeometries,f=data.instanceNodes,i=0,v=n.length;i<v;i++)t.push(Ge(n[i]));for(i=0,v=l.length;i<v;i++){var y=ae(l[i]);null!==y&&t.push(y.clone())}for(i=0,v=c.length;i<v;i++)for(var x=c[i],_=(e=x.id,m(it.controllers[e],I)),M=ke(ge(_.id),x.materials),w=De(x.skeletons,_.skin.joints),S=0,A=M.length;S<A;S++){var object;(object=M[S]).isSkinnedMesh&&(object.bind(w,_.skin.bindMatrix),object.normalizeSkinWeights()),t.push(object)}for(i=0,v=h.length;i<v;i++){var T=ce(h[i]);null!==T&&t.push(T.clone())}for(i=0,v=d.length;i<v;i++)for(S=0,A=(M=ke(ge((x=d[i]).id),x.materials)).length;S<A;S++)t.push(M[S]);for(i=0,v=f.length;i<v;i++)t.push(Ge(f[i]).clone());if(0===n.length&&1===t.length)object=t[0];else{object="JOINT"===o?new Bone:new Group;for(i=0;i<t.length;i++)object.add(t[i])}return""===object.name&&(object.name="JOINT"===o?data.sid:data.name),object.matrix.copy(r),object.matrix.decompose(object.position,object.quaternion,object.scale),object}var Be=new MeshBasicMaterial({color:16711935});function Ue(e,t){for(var r=[],i=0,n=e.length;i<n;i++){var o=t[e[i]];void 0===o?(console.warn("ColladaLoader: Material with key %s not found. Apply fallback material.",e[i]),r.push(Be)):r.push(ee(o))}return r}function ke(e,t){var r=[];for(var n in e){var o=e[n],l=Ue(o.materialKeys,t);0===l.length&&("lines"===n||"linestrips"===n?l.push(new LineBasicMaterial):l.push(new MeshPhongMaterial));var c=void 0!==o.data.attributes.skinIndex;if(c)for(var i=0,h=l.length;i<h;i++)l[i].skinning=!0;var object,d=1===l.length?l[0]:l;switch(n){case"lines":object=new LineSegments(o.data,d);break;case"linestrips":object=new Line(o.data,d);break;case"triangles":case"polylist":object=c?new SkinnedMesh(o.data,d):new Mesh(o.data,d)}r.push(object)}return r}function Ve(e){return void 0!==it.nodes[e]}function Ge(e){return m(it.nodes[e],Ie)}function ze(data){var e=new Group;e.name=data.name;for(var t=data.children,i=0;i<t.length;i++){var r=t[i];e.add(Ge(r.id))}return e}function je(e){return m(it.visualScenes[e],ze)}if(0===text.length)return{scene:new Scene};var We=(new DOMParser).parseFromString(text,"application/xml"),He=e(We,"COLLADA")[0],Xe=We.getElementsByTagName("parsererror")[0];if(void 0!==Xe){var Ye,qe=e(Xe,"div")[0];return Ye=qe?qe.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(Xe),console.error("ColladaLoader: Failed to parse collada file.\n",Ye),null}var Qe=He.getAttribute("version");console.log("ColladaLoader: File version",Qe);var Ke,Je=function(t){return{unit:c(e(t,"unit")[0]),upAxis:h(e(t,"up_axis")[0])}}(e(He,"asset")[0]),Ze=new TextureLoader(this.manager);Ze.setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin),TGALoader&&(Ke=new TGALoader(this.manager)).setPath(this.resourcePath||path);var $e=[],et={},tt=0,it={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};d(He,"library_animations","animation",(function(e){for(var data={sources:{},samplers:{},channels:{}},i=0,t=e.childNodes.length;i<t;i++){var r,n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"source":r=n.getAttribute("id"),data.sources[r]=ue(n);break;case"sampler":r=n.getAttribute("id"),data.samplers[r]=v(n);break;case"channel":r=n.getAttribute("target"),data.channels[r]=y(n);break;default:console.log(n)}}it.animations[e.getAttribute("id")]=data})),d(He,"library_animation_clips","animation_clip",(function(e){for(var data={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"instance_animation":data.animations.push(o(r.getAttribute("url")))}}it.clips[e.getAttribute("id")]=data})),d(He,"library_controllers","controller",(function(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"skin":data.id=o(r.getAttribute("source")),data.skin=R(r);break;case"morph":data.id=o(r.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}it.controllers[e.getAttribute("id")]=data})),d(He,"library_images","image",(function(t){var data={init_from:e(t,"init_from")[0].textContent};it.images[t.getAttribute("id")]=data})),d(He,"library_effects","effect",(function(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"profile_COMMON":data.profile=k(r)}}it.effects[e.getAttribute("id")]=data})),d(He,"library_materials","material",(function(e){for(var data={name:e.getAttribute("name")},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"instance_effect":data.url=o(r.getAttribute("url"))}}it.materials[e.getAttribute("id")]=data})),d(He,"library_cameras","camera",(function(e){for(var data={name:e.getAttribute("name")},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"optics":data.optics=te(r)}}it.cameras[e.getAttribute("id")]=data})),d(He,"library_lights","light",(function(e){for(var data={},i=0,t=e.childNodes.length;i<t;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":data=oe(r)}}it.lights[e.getAttribute("id")]=data})),d(He,"library_geometries","geometry",(function(t){var data={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=e(t,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var n=r.childNodes[i];if(1===n.nodeType){var o=n.getAttribute("id");switch(n.nodeName){case"source":data.sources[o]=ue(n);break;case"vertices":data.vertices=he(n);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":data.primitives.push(de(n));break;default:console.log(n)}}}it.geometries[t.getAttribute("id")]=data}})),d(He,"library_nodes","node",Ee),d(He,"library_visual_scenes","visual_scene",(function(t){var data={name:t.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var element=t[i];!1===element.hasAttribute("id")&&element.setAttribute("id","three_default_"+tt++)}}(t);for(var r=e(t,"node"),i=0;i<r.length;i++)data.children.push(Ee(r[i]));it.visualScenes[t.getAttribute("id")]=data})),d(He,"library_kinematics_models","kinematics_model",(function(e){for(var data={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"technique_common":xe(t,data)}}it.kinematicsModels[e.getAttribute("id")]=data})),d(He,"library_physics_models","physics_model",(function(e){for(var data={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"rigid_body":data.rigidBodies[t.getAttribute("name")]={},Ae(t,data.rigidBodies[t.getAttribute("name")])}}it.physicsModels[e.getAttribute("id")]=data})),d(He,"scene","instance_kinematics_scene",(function(e){for(var data={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var t=e.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"bind_joint_axis":data.bindJointAxis.push(Le(t))}}it.kinematicsScenes[o(e.getAttribute("url"))]=data})),f(it.animations,x),f(it.clips,F),f(it.controllers,I),f(it.images,B),f(it.effects,Z),f(it.materials,$),f(it.cameras,ne),f(it.lights,le),f(it.geometries,fe),f(it.visualScenes,ze),function(){var e=it.clips;if(!0===l(e)){if(!1===l(it.animations)){var t=[];for(var r in it.animations)for(var n=_(r),i=0,o=n.length;i<o;i++)t.push(n[i]);$e.push(new AnimationClip("default",-1,t))}}else for(var r in e)$e.push(E(r))}(),function(){var e=Object.keys(it.kinematicsModels)[0],t=Object.keys(it.kinematicsScenes)[0],r=Object.keys(it.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,o=(n=e,m(it.kinematicsModels[n],ye)),l=function(e){return m(it.kinematicsScenes[e],Ce)}(t),c=je(r),h=l.bindJointAxis,d={},i=0,f=h.length;i<f;i++){var v=h[i],y=He.querySelector('[sid="'+v.target+'"]');if(y){var x=y.parentElement;M(v.jointIndex,x)}}var _=new Matrix4;et={joints:o&&o.joints,getJointValue:function(e){var t=d[e];if(t)return t.position;console.warn("ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=d[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("ColladaLoader: Joint "+e+" is static.");else{var object=r.object,o=n.axis,l=r.transforms;Pe.identity();for(var i=0;i<l.length;i++){var c=l[i];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":Pe.multiply(_.makeRotationAxis(o,MathUtils.degToRad(t)));break;case"prismatic":Pe.multiply(_.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":Pe.multiply(c.obj);break;case"translate":Pe.multiply(_.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":Pe.scale(c.obj);break;case"rotate":Pe.multiply(_.makeRotationAxis(c.obj,c.angle))}}object.matrix.copy(Pe),object.matrix.decompose(object.position,object.quaternion,object.scale),d[e].position=t}}else console.log("ColladaLoader: "+e+" does not exist.")}}}function M(e,t){var r=t.getAttribute("name"),n=o.joints[e];c.traverse((function(object){object.name===r&&(d[e]={object:object,transforms:Ne(t),joint:n,position:n.zeroPosition})}))}}();var nt=function(t){return je(o(e(t,"instance_visual_scene")[0].getAttribute("url")))}(e(He,"scene")[0]);return"Z_UP"===Je.upAxis&&nt.quaternion.setFromEuler(new Euler(-Math.PI/2,0,0)),nt.scale.multiplyScalar(Je.unit),{animations:$e,kinematics:et,library:it,scene:nt}}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(e,t,r,n){var o=this,l=[],c=new CompressedTexture;c.image=l;var h=new FileLoader(this.manager);function d(i){h.load(e[i],(function(e){var r=o.parse(e,!0);l[i]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(f+=1)&&(1===r.mipmapCount&&(c.minFilter=LinearFilter),c.format=r.format,c.needsUpdate=!0,t&&t(c))}),r,n)}if(h.setPath(this.path),h.setResponseType("arraybuffer"),Array.isArray(e))for(var f=0,i=0,m=e.length;i<m;++i)d(i);else h.load(e,(function(e){var r=o.parse(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,h=0;h<n;h++){l[h]={mipmaps:[]};for(var i=0;i<r.mipmapCount;i++)l[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+i]),l[h].format=r.format,l[h].width=r.width,l[h].height=r.height}else c.image.width=r.width,c.image.height=r.height,c.mipmaps=r.mipmaps;1===r.mipmapCount&&(c.minFilter=LinearFilter),c.format=r.format,c.needsUpdate=!0,t&&t(c)}),r,n);return c}});var DDSLoader=function(e){CompressedTextureLoader.call(this,e)};DDSLoader.prototype=Object.assign(Object.create(CompressedTextureLoader.prototype),{constructor:DDSLoader,parse:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function o(e,t,r,n){for(var o=r*n*4,l=new Uint8Array(e,t,o),c=new Uint8Array(o),h=0,d=0,f=0;f<n;f++)for(var m=0;m<r;m++){var b=l[d],g=l[++d],v=l[++d],a=l[++d];d++,c[h]=v,c[++h]=g,c[++h]=b,c[++h]=a,h++}return c}var l,c=n("DXT1"),h=n("DXT3"),d=n("DXT5"),f=n("ETC1"),header=new Int32Array(e,0,31);if(542327876!==header[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!header[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var m,v=header[21],y=!1;switch(v){case c:l=8,r.format=RGB_S3TC_DXT1_Format;break;case h:l=16,r.format=RGBA_S3TC_DXT3_Format;break;case d:l=16,r.format=RGBA_S3TC_DXT5_Format;break;case f:l=8,r.format=RGB_ETC1_Format;break;default:if(!(32===header[22]&&16711680&header[23]&&65280&header[24]&&255&header[25]&&4278190080&header[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",(m=v,String.fromCharCode(255&m,m>>8&255,m>>16&255,m>>24&255))),r;y=!0,l=64,r.format=RGBAFormat}r.mipmapCount=1,131072&header[2]&&!1!==t&&(r.mipmapCount=Math.max(1,header[7]));var x=header[28];if(r.isCubemap=!!(512&x),r.isCubemap&&(!(1024&x)||!(2048&x)||!(4096&x)||!(8192&x)||!(16384&x)||!(32768&x)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),r;r.width=header[4],r.height=header[3];for(var _=header[1]+4,M=r.isCubemap?6:1,w=0;w<M;w++)for(var S=r.width,A=r.height,i=0;i<r.mipmapCount;i++){if(y)var T=(L=o(e,_,S,A)).length;else{T=Math.max(4,S)/4*Math.max(4,A)/4*l;var L=new Uint8Array(e,_,T)}var C={data:L,width:S,height:A};r.mipmaps.push(C),_+=T,S=Math.max(S>>1,1),A=Math.max(A>>1,1)}return r}});var DRACOLoader=function(e){Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};function DataTextureLoader(e){Loader.call(this,e)}DRACOLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DRACOLoader,setDecoderPath:function(path){return this.decoderPath=path,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,r,n){var o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&l.setWithCredentials(!0),l.load(e,(function(e){var r={attributeIDs:o.defaultAttributeIDs,attributeTypes:o.defaultAttributeTypes,useUniqueIDs:!1};o.decodeGeometry(e,r).then(t).catch(n)}),r,n)},decodeDracoFile:function(e,t,r,n){var o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,o).then(t)},decodeGeometry:function(e,t){var r=this;for(var n in t.attributeTypes){var o=t.attributeTypes[n];void 0!==o.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=o.name)}var l,c=JSON.stringify(t);if(DRACOLoader.taskCache.has(e)){var h=DRACOLoader.taskCache.get(e);if(h.key===c)return h.promise;if(0===e.byteLength)throw new Error("DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var d=this.workerNextTaskID++,f=e.byteLength,m=this._getWorker(d,f).then((function(r){return l=r,new Promise((function(r,n){l._callbacks[d]={resolve:r,reject:n},l.postMessage({type:"decode",id:d,taskConfig:t,buffer:e},[e])}))})).then((function(e){return r._createGeometry(e.geometry)}));return m.finally((function(){l&&d&&r._releaseTask(l,d)})),DRACOLoader.taskCache.set(e,{key:c,promise:m}),m},_createGeometry:function(e){var t=new BufferGeometry;e.index&&t.setIndex(new BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var r=e.attributes[i],n=r.name,o=r.array,l=r.itemSize;t.setAttribute(n,new BufferAttribute(o,l))}return t},_loadLibrary:function(e,t){var r=new FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((function(t,n){r.load(e,t,void 0,n)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(r){var n=r[0];t||(e.decoderConfig.wasmBinary=r[1]);var o=DRACOLoader.DRACOWorker.toString(),body=["/* draco decoder */",n,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([body]))})),this.decoderPending},_getWorker:function(e,t){var r=this;return this._initDecoder().then((function(){var n;r.workerPool.length<r.workerLimit?((n=new Worker(r.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)):r.workerPool.sort((function(a,b){return a._taskLoad>b._taskLoad?-1:1}));return(n=r.workerPool[r.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},dispose:function(){for(var i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this}}),DRACOLoader.DRACOWorker=function(){var e,t;function r(e,t,r,n,o,l){var c,h,d=l.num_components(),f=r.num_points()*d;switch(o){case Float32Array:c=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,l,c),h=new Float32Array(f);break;case Int8Array:c=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,l,c),h=new Int8Array(f);break;case Int16Array:c=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,l,c),h=new Int16Array(f);break;case Int32Array:c=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,l,c),h=new Int32Array(f);break;case Uint8Array:c=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,l,c),h=new Uint8Array(f);break;case Uint16Array:c=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,l,c),h=new Uint16Array(f);break;case Uint32Array:c=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,l,c),h=new Uint32Array(f);break;default:throw new Error("DRACOLoader: Unexpected attribute type.")}for(var i=0;i<f;i++)h[i]=c.GetValue(i);return e.destroy(c),{name:n,array:h,itemSize:d}}onmessage=function(n){var o=n.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var l=o.buffer,c=o.taskConfig;t.then((function(e){var t=e.draco,n=new t.Decoder,h=new t.DecoderBuffer;h.Init(new Int8Array(l),l.byteLength);try{var d=function(e,t,n,o){var l,c,h=o.attributeIDs,d=o.attributeTypes,f=t.GetEncodedGeometryType(n);if(f===e.TRIANGULAR_MESH)l=new e.Mesh,c=t.DecodeBufferToMesh(n,l);else{if(f!==e.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");l=new e.PointCloud,c=t.DecodeBufferToPointCloud(n,l)}if(!c.ok()||0===l.ptr)throw new Error("DRACOLoader: Decoding failed: "+c.error_msg());var m={index:null,attributes:[]};for(var v in h){var y,x,_=self[d[v]];if(o.useUniqueIDs)x=h[v],y=t.GetAttributeByUniqueId(l,x);else{if(-1===(x=t.GetAttributeId(l,e[h[v]])))continue;y=t.GetAttribute(l,x)}m.attributes.push(r(e,t,l,v,_,y))}if(f===e.TRIANGULAR_MESH){for(var M=l.num_faces(),w=new Uint32Array(3*M),S=new e.DracoInt32Array,i=0;i<M;++i){t.GetFaceFromMesh(l,i,S);for(var A=0;A<3;++A)w[3*i+A]=S.GetValue(A)}m.index={array:w,itemSize:1},e.destroy(S)}return e.destroy(l),m}(t,n,h,c),f=d.attributes.map((function(e){return e.array.buffer}));d.index&&f.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},f)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(h),t.destroy(n)}}))}}},DRACOLoader.taskCache=new WeakMap,DRACOLoader.setDecoderPath=function(){console.warn("DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},DRACOLoader.setDecoderConfig=function(){console.warn("DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},DRACOLoader.releaseDecoderModule=function(){console.warn("DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},DRACOLoader.getDecoderModule=function(){console.warn("DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")},DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,t,r,n){var o=this,l=new DataTexture,c=new FileLoader(this.manager);return c.setResponseType("arraybuffer"),c.setPath(this.path),c.load(e,(function(e){var r=o.parse(e);r&&(void 0!==r.image?l.image=r.image:void 0!==r.data&&(l.image.width=r.width,l.image.height=r.height,l.image.data=r.data),l.wrapS=void 0!==r.wrapS?r.wrapS:ClampToEdgeWrapping,l.wrapT=void 0!==r.wrapT?r.wrapT:ClampToEdgeWrapping,l.magFilter=void 0!==r.magFilter?r.magFilter:LinearFilter,l.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,l.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(l.format=r.format),void 0!==r.type&&(l.type=r.type),void 0!==r.mipmaps&&(l.mipmaps=r.mipmaps,l.minFilter=LinearMipmapLinearFilter),1===r.mipmapCount&&(l.minFilter=LinearFilter),l.needsUpdate=!0,t&&t(l,r))}),r,n),l}});var EXRLoader=function(e){DataTextureLoader.call(this,e),this.type=FloatType};EXRLoader.prototype=Object.assign(Object.create(DataTextureLoader.prototype),{constructor:EXRLoader,parse:function(e){var t=Math.pow(2.7182818,2.2);var r={l:0,c:0,lc:0};function n(e,t,n,o,l){for(;n<e;)t=t<<8|U(o,l),n+=8;n-=e,r.l=t>>n&(1<<e)-1,r.c=t,r.lc=n}var o=new Array(59);function l(e,t,l,c,h,d,f){for(var p=l,m=0,v=0;h<=d;h++){if(p.value-l.value>c)return!1;n(6,m,v,e,p);var y=r.l;if(m=r.c,v=r.lc,f[h]=y,63==y){if(p.value-l.value>c)throw"Something wrong with hufUnpackEncTable";n(8,m,v,e,p);var x=r.l+6;if(m=r.c,v=r.lc,h+x>d+1)throw"Something wrong with hufUnpackEncTable";for(;x--;)f[h++]=0;h--}else if(y>=59){if(h+(x=y-59+2)>d+1)throw"Something wrong with hufUnpackEncTable";for(;x--;)f[h++]=0;h--}}!function(e){for(var i=0;i<=58;++i)o[i]=0;for(i=0;i<65537;++i)o[e[i]]+=1;var t=0;for(i=58;i>0;--i){var r=t+o[i]>>1;o[i]=t,t=r}for(i=0;i<65537;++i){var n=e[i];n>0&&(e[i]=n|o[n]++<<6)}}(f)}function c(code){return 63&code}function h(code){return code>>6}var d={c:0,lc:0};function f(e,t,r,n){e=e<<8|U(r,n),t+=8,d.c=e,d.lc=t}var m={c:0,lc:0};function v(e,t,r,n,o,l,c,h,v,y){if(e==t){n<8&&(f(r,n,o,c),r=d.c,n=d.lc);var x=r>>(n-=8);x=new Uint8Array([x])[0];if(v.value+x>y)return!1;for(var s=h[v.value-1];x-- >0;)h[v.value++]=s}else{if(!(v.value<y))return!1;h[v.value++]=e}m.c=r,m.lc=n}function y(e){var t=function(e){return 65535&e}(e);return t>32767?t-65536:t}var x={a:0,b:0};function _(e,t){var r=y(e),n=y(t),o=r+(1&n)+(n>>1),l=o,c=o-n;x.a=l,x.b=c}function M(e,t,r,n,o,l){for(var c,h=r>o?o:r,p=1;p<=h;)p<<=1;for(c=p>>=1,p>>=1;p>=1;){for(var d,f,m,v,y=0,M=y+l*(o-c),w=l*p,S=l*c,A=n*p,T=n*c;y<=M;y+=S){for(var L=y,C=y+n*(r-c);L<=C;L+=T){var N=L+A,P=(F=L+w)+A;_(e[L+t],e[F+t]),d=x.a,m=x.b,_(e[N+t],e[P+t]),f=x.a,v=x.b,_(d,f),e[L+t]=x.a,e[N+t]=x.b,_(m,v),e[F+t]=x.a,e[P+t]=x.b}if(r&p){var F=L+w;_(e[L+t],e[F+t]),d=x.a,e[F+t]=x.b,e[L+t]=d}}if(o&p)for(L=y,C=y+n*(r-c);L<=C;L+=T){N=L+A;_(e[L+t],e[N+t]),d=x.a,e[N+t]=x.b,e[L+t]=d}c=p,p>>=1}return y}function w(e,t,r,n,o,y){var x=r.value,_=B(t,r),M=B(t,r);r.value+=4;var w=B(t,r);if(r.value+=4,_<0||_>=65537||M<0||M>=65537)throw"Something wrong with HUF_ENCSIZE";var S=new Array(65537),A=new Array(16384);if(function(e){for(var i=0;i<16384;i++)e[i]={},e[i].len=0,e[i].lit=0,e[i].p=null}(A),l(e,0,r,n-(r.value-x),_,M,S),w>8*(n-(r.value-x)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var o=h(e[t]),l=c(e[t]);if(o>>l)throw"Invalid table entry";if(l>14){if((f=n[o>>l-14]).len)throw"Invalid table entry";if(f.lit++,f.p){var p=f.p;f.p=new Array(f.lit);for(var i=0;i<f.lit-1;++i)f.p[i]=p[i]}else f.p=new Array(1);f.p[f.lit-1]=t}else if(l){var d=0;for(i=1<<14-l;i>0;i--){var f;if((f=n[(o<<14-l)+d]).len||f.p)throw"Invalid table entry";f.len=l,f.lit=t,d++}}}}(S,_,M,A),function(e,t,r,n,o,l,y,x,_,M){for(var w=0,S=0,A=x,T=Math.trunc(o.value+(l+7)/8);o.value<T;)for(f(w,S,r,o),w=d.c,S=d.lc;S>=14;){if((N=t[w>>S-14&16383]).len)S-=N.len,v(N.lit,y,w,S,r,0,o,_,M,A),w=m.c,S=m.lc;else{if(!N.p)throw"hufDecode issues";var L;for(L=0;L<N.lit;L++){for(var C=c(e[N.p[L]]);S<C&&o.value<T;)f(w,S,r,o),w=d.c,S=d.lc;if(S>=C&&h(e[N.p[L]])==(w>>S-C&(1<<C)-1)){S-=C,v(N.p[L],y,w,S,r,0,o,_,M,A),w=m.c,S=m.lc;break}}if(L==N.lit)throw"hufDecode issues"}}var i=8-l&7;for(w>>=i,S-=i;S>0;){var N;if(!(N=t[w<<14-S&16383]).len)throw"hufDecode issues";S-=N.len,v(N.lit,y,w,S,r,0,o,_,M,A),w=m.c,S=m.lc}}(S,A,e,0,r,w,M,y,o,{value:0})}function S(source){for(var e=1;e<source.length;e++){var t=source[e-1]+source[e]-128;source[e]=t}}function A(source,e){for(var t=0,r=Math.floor((source.length+1)/2),s=0,n=source.length-1;!(s>n||(e[s++]=source[t++],s>n));)e[s++]=source[r++]}function T(source){for(var e=source.byteLength,t=new Array,p=0,r=new DataView(source);e>0;){var n=r.getInt8(p++);if(n<0){e-=(o=-n)+1;for(var i=0;i<o;i++)t.push(r.getUint8(p++))}else{var o=n;e-=2;var l=r.getUint8(p++);for(i=0;i<o+1;i++)t.push(l)}}return t}function L(e,t,r){for(var n,o=1;o<64;)65280==(n=t[e.value])?o=64:n>>8==255?o+=255&n:(r[o]=n,o++),e.value++}function C(e,t){t[0]=z(e[0]),t[1]=z(e[1]),t[2]=z(e[5]),t[3]=z(e[6]),t[4]=z(e[14]),t[5]=z(e[15]),t[6]=z(e[27]),t[7]=z(e[28]),t[8]=z(e[2]),t[9]=z(e[4]),t[10]=z(e[7]),t[11]=z(e[13]),t[12]=z(e[16]),t[13]=z(e[26]),t[14]=z(e[29]),t[15]=z(e[42]),t[16]=z(e[3]),t[17]=z(e[8]),t[18]=z(e[12]),t[19]=z(e[17]),t[20]=z(e[25]),t[21]=z(e[30]),t[22]=z(e[41]),t[23]=z(e[43]),t[24]=z(e[9]),t[25]=z(e[11]),t[26]=z(e[18]),t[27]=z(e[24]),t[28]=z(e[31]),t[29]=z(e[40]),t[30]=z(e[44]),t[31]=z(e[53]),t[32]=z(e[10]),t[33]=z(e[19]),t[34]=z(e[23]),t[35]=z(e[32]),t[36]=z(e[39]),t[37]=z(e[45]),t[38]=z(e[52]),t[39]=z(e[54]),t[40]=z(e[20]),t[41]=z(e[22]),t[42]=z(e[33]),t[43]=z(e[38]),t[44]=z(e[46]),t[45]=z(e[51]),t[46]=z(e[55]),t[47]=z(e[60]),t[48]=z(e[21]),t[49]=z(e[34]),t[50]=z(e[37]),t[51]=z(e[47]),t[52]=z(e[50]),t[53]=z(e[56]),t[54]=z(e[59]),t[55]=z(e[61]),t[56]=z(e[35]),t[57]=z(e[36]),t[58]=z(e[48]),t[59]=z(e[49]),t[60]=z(e[57]),t[61]=z(e[58]),t[62]=z(e[62]),t[63]=z(e[63])}function N(data){for(var a=.5*Math.cos(.7853975),b=.5*Math.cos(3.14159/16),e=.5*Math.cos(3.14159/8),t=.5*Math.cos(3*3.14159/16),r=.5*Math.cos(.981746875),n=.5*Math.cos(3*3.14159/8),g=.5*Math.cos(1.374445625),o=new Array(4),l=new Array(4),c=new Array(4),h=new Array(4),d=0;d<8;++d){var f=8*d;o[0]=e*data[f+2],o[1]=n*data[f+2],o[2]=e*data[f+6],o[3]=n*data[f+6],l[0]=b*data[f+1]+t*data[f+3]+r*data[f+5]+g*data[f+7],l[1]=t*data[f+1]-g*data[f+3]-b*data[f+5]-r*data[f+7],l[2]=r*data[f+1]-b*data[f+3]+g*data[f+5]+t*data[f+7],l[3]=g*data[f+1]-r*data[f+3]+t*data[f+5]-b*data[f+7],c[0]=a*(data[f+0]+data[f+4]),c[3]=a*(data[f+0]-data[f+4]),c[1]=o[0]+o[3],c[2]=o[1]-o[2],h[0]=c[0]+c[1],h[1]=c[3]+c[2],h[2]=c[3]-c[2],h[3]=c[0]-c[1],data[f+0]=h[0]+l[0],data[f+1]=h[1]+l[1],data[f+2]=h[2]+l[2],data[f+3]=h[3]+l[3],data[f+4]=h[3]-l[3],data[f+5]=h[2]-l[2],data[f+6]=h[1]-l[1],data[f+7]=h[0]-l[0]}for(var m=0;m<8;++m)o[0]=e*data[16+m],o[1]=n*data[16+m],o[2]=e*data[48+m],o[3]=n*data[48+m],l[0]=b*data[8+m]+t*data[24+m]+r*data[40+m]+g*data[56+m],l[1]=t*data[8+m]-g*data[24+m]-b*data[40+m]-r*data[56+m],l[2]=r*data[8+m]-b*data[24+m]+g*data[40+m]+t*data[56+m],l[3]=g*data[8+m]-r*data[24+m]+t*data[40+m]-b*data[56+m],c[0]=a*(data[m]+data[32+m]),c[3]=a*(data[m]-data[32+m]),c[1]=o[0]+o[3],c[2]=o[1]-o[2],h[0]=c[0]+c[1],h[1]=c[3]+c[2],h[2]=c[3]-c[2],h[3]=c[0]-c[1],data[0+m]=h[0]+l[0],data[8+m]=h[1]+l[1],data[16+m]=h[2]+l[2],data[24+m]=h[3]+l[3],data[32+m]=h[3]-l[3],data[40+m]=h[2]-l[2],data[48+m]=h[1]-l[1],data[56+m]=h[0]-l[0]}function P(data){for(var i=0;i<64;++i){var e=data[0][i],t=data[1][i],r=data[2][i];data[0][i]=e+1.5747*r,data[1][i]=e-.1873*t-.4682*r,data[2][i]=e+1.8556*t}}function F(e,t,r){for(var i=0;i<64;++i)t[r+i]=H(E(e[i]))}function E(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(t,Math.abs(e)-1)}function R(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);"undefined"==typeof Zlib&&console.error("EXRLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var r=new Zlib.Inflate(t,{resize:!0,verify:!0}),n=new Uint8Array(r.decompress().buffer),o=new Uint8Array(n.length);return S(n),A(n,o),new DataView(o.buffer)}function D(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(J.channels.length*e.type*2)),o={version:V(t,r),unknownUncompressedSize:V(t,r),unknownCompressedSize:V(t,r),acCompressedSize:V(t,r),dcCompressedSize:V(t,r),rleCompressedSize:V(t,r),rleUncompressedSize:V(t,r),rleRawSize:V(t,r),totalAcUncompressedCount:V(t,r),totalDcUncompressedCount:V(t,r),acCompression:V(t,r)};if(o.version<2)throw"EXRLoader.parse: "+J.compression+" version "+o.version+" is unsupported";for(var l=new Array,c=X(t,r)-2;c>0;){var h=O(t.buffer,r),d=k(t,r),f=d>>2&3,m=new Int8Array([(d>>4)-1])[0],v=k(t,r);l.push({name:h,index:m,type:v,compression:f}),c-=h.length+3}for(var y=J.channels,x=new Array(e.channels),i=0;i<e.channels;++i){var _=x[i]={},M=y[i];_.name=M.name,_.compression=0,_.decoded=!1,_.type=M.pixelType,_.pLinear=M.pLinear,_.width=e.width,_.height=e.lines}for(var S={idx:new Array(3)},A=0;A<e.channels;++A)for(_=x[A],i=0;i<l.length;++i){var E=l[i];_.name==E.name&&(_.compression=E.compression,E.index>=0&&(S.idx[E.index]=A),_.offset=A)}if(o.acCompressedSize>0)switch(o.acCompression){case 0:var D=new Uint16Array(o.totalAcUncompressedCount);w(e.array,t,r,o.acCompressedSize,D,o.totalAcUncompressedCount);break;case 1:var I=e.array.slice(r.value,r.value+o.totalAcUncompressedCount),B=new Zlib.Inflate(I,{resize:!0,verify:!0});D=new Uint16Array(B.decompress().buffer);r.value+=o.totalAcUncompressedCount}if(o.dcCompressedSize>0){var U={array:e.array,offset:r,size:o.dcCompressedSize},G=new Uint16Array(R(U).buffer);r.value+=o.dcCompressedSize}if(o.rleRawSize>0){I=e.array.slice(r.value,r.value+o.rleCompressedSize);var j=T((B=new Zlib.Inflate(I,{resize:!0,verify:!0})).decompress().buffer);r.value+=o.rleCompressedSize}var W=0,H=new Array(x.length);for(i=0;i<H.length;++i)H[i]=new Array;for(var Y=0;Y<e.lines;++Y)for(var Q=0;Q<x.length;++Q)H[Q].push(W),W+=x[Q].width*e.type*2;!function(e,t,r,n,o,l){for(var c=new DataView(l.buffer),h=r[e.idx[0]].width,d=r[e.idx[0]].height,f=Math.floor(h/8),m=Math.ceil(h/8),v=Math.ceil(d/8),y=h-8*(m-1),x=d-8*(v-1),_={value:0},M=new Array(3),w=new Array(3),S=new Array(3),A=new Array(3),T=new Array(3),E=0;E<3;++E)T[E]=t[e.idx[E]],M[E]=E<1?0:M[E-1]+m*v,w[E]=new Float32Array(64),S[E]=new Uint16Array(64),A[E]=new Uint16Array(64*m);for(var R=0;R<v;++R){var D=8;R==v-1&&(D=x);for(var O=8,I=0;I<m;++I){I==m-1&&(O=y);for(var B=0;B<3;++B)S[B].fill(0),S[B][0]=o[M[B]++],L(_,n,S[B]),C(S[B],w[B]),N(w[B]);P(w);for(var U=0;U<3;++U)F(w[U],A[U],64*I)}for(var k=0,V=0;V<3;++V){for(var G=r[e.idx[V]].type,j=8*R;j<8*R+D;++j){k=T[V][j];for(var W=0;W<f;++W){var H=64*W+8*(7&j);c.setUint16(k+0*G,A[V][H+0],!0),c.setUint16(k+2*G,A[V][H+1],!0),c.setUint16(k+4*G,A[V][H+2],!0),c.setUint16(k+6*G,A[V][H+3],!0),c.setUint16(k+8*G,A[V][H+4],!0),c.setUint16(k+10*G,A[V][H+5],!0),c.setUint16(k+12*G,A[V][H+6],!0),c.setUint16(k+14*G,A[V][H+7],!0),k+=16*G}}if(f!=m)for(var X=8*R;X<8*R+D;++X)for(var Y=T[V][X]+8*f*2*G,Q=64*f+8*(7&X),K=0;K<O;++K)c.setUint16(Y+2*K*G,A[V][Q+K],!0)}}for(var J=new Uint16Array(h),Z=(c=new DataView(l.buffer),0);Z<3;++Z){r[e.idx[Z]].decoded=!0;var $=r[e.idx[Z]].type;if(2==r[Z].type)for(var ee=0;ee<d;++ee){for(var te=T[Z][ee],re=0;re<h;++re)J[re]=c.getUint16(te+2*re*$,!0);for(re=0;re<h;++re)c.setFloat32(te+2*re*$,z(J[re]),!0)}}}(S,H,x,D,G,n);for(i=0;i<x.length;++i){if(!(_=x[i]).decoded)switch(_.compression){case 2:var K=0,Z=0;for(Y=0;Y<e.lines;++Y){for(var $=H[i][K],ee=0;ee<_.width;++ee){for(var te=0;te<2*_.type;++te)n[$++]=j[Z+te*_.width*_.height];Z++}K++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function O(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var o=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,o}function I(e,t){var r=e.getUint32(0,!0);return t.value=t.value+8,r}function B(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function U(e,t){var r=e[t.value];return t.value=t.value+1,r}function k(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}function V(e,t){var r=Number(e.getBigInt64(t.value,!0));return t.value+=8,r}function G(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function z(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}var j,W,H=(j=new Float32Array(1),W=new Int32Array(j.buffer),function(e){j[0]=e;var t=W[0],r=t>>16&32768,n=t>>12&2047,o=t>>23&255;return o<103?r:o>142?(r|=31744,r|=(255==o?0:1)&&8388607&t):o<113?r|=((n|=2048)>>114-o)+(n>>113-o&1):(r|=o-112<<10|n>>1,r+=1&n)});function X(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function Y(e,t,r,n,o){if("string"===n||"stringvector"===n||"iccProfile"===n)return function(e,t,r){var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,n}(t,r,o);if("chlist"===n)return function(e,t,r,n){for(var o=r.value,l=[];r.value<o+n-1;){var c=O(t,r),h=B(e,r),d=k(e,r);r.value+=3;var f=B(e,r),m=B(e,r);l.push({name:c,pixelType:h,pLinear:d,xSampling:f,ySampling:m})}return r.value+=1,l}(e,t,r,o);if("chromaticities"===n)return function(e,t){return{redX:G(e,t),redY:G(e,t),greenX:G(e,t),greenY:G(e,t),blueX:G(e,t),blueY:G(e,t),whiteX:G(e,t),whiteY:G(e,t)}}(e,r);if("compression"===n)return function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][k(e,t)]}(e,r);if("box2i"===n)return function(e,t){return{xMin:B(e,t),yMin:B(e,t),xMax:B(e,t),yMax:B(e,t)}}(e,r);if("lineOrder"===n)return function(e,t){return["INCREASING_Y"][k(e,t)]}(e,r);if("float"===n)return G(e,r);if("v2f"===n)return function(e,t){return[G(e,t),G(e,t)]}(e,r);if("int"===n)return B(e,r);throw"Cannot parse value for unsupported type: "+n}var Q=new DataView(e),K=new Uint8Array(e),J={};Q.getUint32(0,!0),Q.getUint8(4,!0),Q.getUint8(5,!0);for(var Z={value:8},$=!0;$;){var ee=O(e,Z);if(0==ee)$=!1;else{var te=Y(Q,e,Z,O(e,Z),B(Q,Z));J[ee]=te}}var re,ie,ne,ae,oe=J.dataWindow.yMax+1;switch(J.compression){case"NO_COMPRESSION":ie=1,re=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ie=1,re=function(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(T(t)),n=new Uint8Array(r.length);return S(r),A(r,n),new DataView(n.buffer)};break;case"ZIPS_COMPRESSION":ie=1,re=R;break;case"ZIP_COMPRESSION":ie=16,re=R;break;case"PIZ_COMPRESSION":ie=32,re=function(e){for(var t=e.viewer,r={value:e.offset.value},n=e.width*ie*(J.channels.length*e.type),o=new Uint16Array(n),l=new Uint8Array(8192),c=0,h=new Array(e.channels),i=0;i<e.channels;i++)h[i]={},h[i].start=c,h[i].end=h[i].start,h[i].nx=e.width,h[i].ny=e.lines,h[i].size=e.type,c+=h[i].nx*h[i].ny*h[i].size;var d=X(t,r),f=X(t,r);if(f>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(d<=f)for(i=0;i<f-d+1;i++)l[i+d]=k(t,r);var m=new Uint16Array(65536);!function(e,t){for(var r=0,i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);for(var n=r-1;r<65536;)t[r++]=0}(l,m);var v=B(t,r);for(w(e.array,t,r,v,o,c),i=0;i<e.channels;++i)for(var y=h[i],x=0;x<h[i].size;++x)M(o,y.start+x,y.nx,y.size,y.ny,y.nx*y.size);!function(e,data,t){for(var i=0;i<t;++i)data[i]=e[data[i]]}(m,o,c);for(var _=0,S=new Uint8Array(o.buffer.byteLength),A=0;A<e.lines;A++)for(var T=0;T<e.channels;T++){var L=(y=h[T]).nx*y.size,C=new Uint8Array(o.buffer,2*y.end,2*L);S.set(C,_),_+=2*L,y.end+=L}return new DataView(S.buffer)};break;case"DWAA_COMPRESSION":ie=32,re=D;break;case"DWAB_COMPRESSION":ie=256,re=D;break;default:throw"EXRLoader.parse: "+J.compression+" is unsupported"}var se=J.channels[0].pixelType;if(1===se)switch(this.type){case FloatType:ae=function(e,t){return z(X(e,t))},ne=2;break;case HalfFloatType:ae=X,ne=2}else{if(2!==se)throw"EXRLoader.parse: unsupported pixelType "+se+" for "+J.compression+".";switch(this.type){case FloatType:ae=G,ne=4;break;case HalfFloatType:throw"EXRLoader.parse: unsupported HalfFloatType texture for FloatType image file."}}for(var le=oe/ie,i=0;i<le;i++)I(Q,Z);var ce=J.dataWindow.xMax-J.dataWindow.xMin+1,ue=J.dataWindow.yMax-J.dataWindow.yMin+1,he=ce*ue*4;switch(this.type){case FloatType:var de=new Float32Array(he);J.channels.length<4&&de.fill(1,0,he);break;case HalfFloatType:de=new Uint16Array(he);J.channels.length<4&&de.fill(15360,0,he);break;default:console.error("EXRLoader: unsupported type: ",this.type)}for(var line,pe,fe={R:0,G:1,B:2,A:3},me={size:0,width:ce,lines:ie,offset:Z,array:K,viewer:Q,type:se,channels:J.channels.length},ve={value:0},ge=0;ge<ue/ie;ge++){line=B(Q,Z),he=B(Q,Z),me.lines=line+ie>ue?ue-line:ie,me.offset=Z,me.size=he,pe=re(me),Z.value+=he;for(var ye=0;ye<ie;ye++){var xe=ye+ge*ie;if(xe>=ue)break;for(var be=0;be<J.channels.length;be++)for(var _e=fe[J.channels[be].name],Me=0;Me<ce;Me++){var we=ye*(J.channels.length*ce)+be*ce+Me;ve.value=we*ne;var Se=ae(pe,ve);de[4*ce*(ue-1-xe)+4*Me+_e]=Se}}}return{header:J,width:ce,height:ue,data:de,format:RGBAFormat,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(e,t,r,n){return DataTextureLoader.prototype.load.call(this,e,(function(e,r){switch(e.type){case FloatType:case HalfFloatType:e.encoding=LinearEncoding,e.minFilter=LinearFilter,e.magFilter=LinearFilter,e.generateMipmaps=!1,e.flipY=!1}t&&t(e,r)}),r,n)}});var FBXLoader=function(){var e,t,r;function n(e){Loader.call(this,e)}function o(e,t){this.textureLoader=e,this.manager=t}function l(){}function c(){}function h(){}function d(){}function f(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function m(){}function v(text){var e=text.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function y(time){return time/46186158e3}n.prototype=Object.assign(Object.create(Loader.prototype),{constructor:n,load:function(e,t,r,n){var o=this,path=""===o.path?LoaderUtils.extractUrlBase(e):o.path,l=new FileLoader(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(r){try{t(o.parse(r,path))}catch(t){setTimeout((function(){n&&n(t),o.manager.itemError(e)}),0)}}),r,n)},parse:function(t,path){if(l="Kaydara FBX Binary  \0",(n=t).byteLength>=l.length&&l===L(n,0,l.length))e=(new d).parse(t);else{var r=L(t);if(!function(text){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],cursor=0;for(var i=0;i<e.length;++i){if((r=void 0,r=text[(t=1)-1],text=text.slice(cursor+t),cursor++,r)===e[i])return!1}var t,r;return!0}(r))throw new Error("FBXLoader: Unknown format.");if(v(r)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+v(r));e=(new h).parse(r)}var n,l;return new o(new TextureLoader(this.manager).setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),o.prototype={constructor:o,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),o=this.parseMaterials(n),c=this.parseDeformers(),h=(new l).parse(c);return this.parseScene(c,h,o),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],o=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var l={ID:n,relationship:o};t.get(r).parents.push(l),t.has(n)||t.set(n,{parents:[],children:[]});var c={ID:r,relationship:o};t.get(n).children.push(c)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var o in n){var l=n[o];if(t[d=parseInt(o)]=l.RelativeFilename||l.Filename,"Content"in l){var c=l.Content instanceof ArrayBuffer&&l.Content.byteLength>0,h="string"==typeof l.Content&&""!==l.Content;if(c||h){var image=this.parseImage(n[o]);r[l.RelativeFilename||l.Filename]=image}}}}for(var d in t){var f=t[d];void 0!==r[f]?t[d]=r[f]:t[d]=t[d].split("\\").pop()}return t},parseImage:function(e){var t,content=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof content)return"data:"+t+";base64,"+content;var o=new Uint8Array(content);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var o in n){var l=this.parseTexture(n[o],t);r.set(parseInt(o),l)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,o=e.WrapModeV,l=void 0!==n?n.value:0,c=void 0!==o?o.value:0;if(r.wrapS=0===l?RepeatWrapping:ClampToEdgeWrapping,r.wrapT=0===c?RepeatWrapping:ClampToEdgeWrapping,"Scaling"in e){var h=e.Scaling.value;r.repeat.x=h[0],r.repeat.y=h[1]}return r},loadTexture:function(e,r){var n,o,l=this.textureLoader.path,c=t.get(e.id).children;void 0!==c&&c.length>0&&void 0!==r[c[0].ID]&&(0!==(n=r[c[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var h=e.FileName.slice(-3).toLowerCase();if("tga"===h){var d=this.manager.getHandler(".tga");null===d?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Texture):o=d.load(n)}else"psd"===h?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Texture):o=this.textureLoader.load(n);return this.textureLoader.setPath(l),o},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var o in n){var l=this.parseMaterial(n[o],t);null!==l&&r.set(parseInt(o),l)}}return r},parseMaterial:function(e,r){var n=e.id,o=e.attrName,l=e.ShadingModel;if("object"==typeof l&&(l=l.value),!t.has(n))return null;var c,h=this.parseParameters(e,r,n);switch(l.toLowerCase()){case"phong":c=new MeshPhongMaterial;break;case"lambert":c=new MeshLambertMaterial;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',l),c=new MeshPhongMaterial}return c.setValues(h),c.name=o,c},parseParameters:function(e,r,n){var o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new Color).fromArray(e.SpecularColor.value));var l=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":o.bumpMap=l.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=l.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=l.getTexture(r,e.ID),o.map.encoding=sRGBEncoding;break;case"DisplacementColor":o.displacementMap=l.getTexture(r,e.ID);break;case"EmissiveColor":o.emissiveMap=l.getTexture(r,e.ID),o.emissiveMap.encoding=sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=l.getTexture(r,e.ID);break;case"ReflectionColor":o.envMap=l.getTexture(r,e.ID),o.envMap.mapping=EquirectangularReflectionMapping,o.envMap.encoding=sRGBEncoding;break;case"SpecularColor":o.specularMap=l.getTexture(r,e.ID),o.specularMap.encoding=sRGBEncoding;break;case"TransparentColor":o.alphaMap=l.getTexture(r,e.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),o},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var o=e.Objects.Deformer;for(var l in o){var c=o[l],h=t.get(parseInt(l));if("Skin"===c.attrType){var d=this.parseSkeleton(h,o);d.ID=l,h.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),d.geometryID=h.parents[0].ID,r[l]=d}else if("BlendShape"===c.attrType){var f={id:l};f.rawTargets=this.parseMorphTargets(h,o),f.id=l,h.parents.length>1&&console.warn("FBXLoader: morph target attached to more than one geometry is not supported."),n[l]=f}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var o={ID:e.ID,indices:[],weights:[],transformLink:(new Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(o.indices=n.Indexes.a,o.weights=n.Weights.a),r.push(o)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var o=e.children[i],l=r[o.ID],c={name:l.attrName,initialWeight:l.DeformPercent,id:l.id,fullWeights:l.FullWeights.a};if("BlendShapeChannel"!==l.attrType)return;c.geoID=t.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(c)}return n},parseScene:function(n,o,l){r=new Group;var h=this.parseModels(n.skeletons,o,l),d=e.Objects.Model,f=this;h.forEach((function(e){var n=d[e.ID];f.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=h.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(n.skeletons,o,h),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=S(e.userData.transformData);e.applyMatrix4(t)}}));var m=(new c).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=m,r=r.children[0]),r.animations=m},parseModels:function(r,n,o){var l=new Map,c=e.Objects.Model;for(var h in c){var d=parseInt(h),f=c[h],m=t.get(d),v=this.buildSkeleton(m,r,d,f.attrName);if(!v){switch(f.attrType){case"Camera":v=this.createCamera(m);break;case"Light":v=this.createLight(m);break;case"Mesh":v=this.createMesh(m,n,o);break;case"NurbsCurve":v=this.createCurve(m,n);break;case"LimbNode":case"Root":v=new Bone;break;case"Null":default:v=new Group}v.name=f.attrName?PropertyBinding.sanitizeNodeName(f.attrName):"",v.ID=d}this.getTransformData(v,f),l.set(d,v)}return l},buildSkeleton:function(e,t,r,n){var o=null;return e.parents.forEach((function(e){for(var l in t){var c=t[l];c.rawBones.forEach((function(t,i){if(t.ID===e.ID){var l=o;(o=new Bone).matrixWorld.copy(t.transformLink),o.name=n?PropertyBinding.sanitizeNodeName(n):"",o.ID=r,c.bones[i]=o,null!==l&&o.add(l)}}))}})),o},createCamera:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new Object3D;else{var o=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(o=1);var l=1;void 0!==n.NearPlane&&(l=n.NearPlane.value/1e3);var c=1e3;void 0!==n.FarPlane&&(c=n.FarPlane.value/1e3);var h=window.innerWidth,d=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(h=n.AspectWidth.value,d=n.AspectHeight.value);var f=h/d,m=45;void 0!==n.FieldOfView&&(m=n.FieldOfView.value);var v=n.FocalLength?n.FocalLength.value:null;switch(o){case 0:r=new PerspectiveCamera(m,f,l,c),null!==v&&r.setFocalLength(v);break;case 1:r=new OrthographicCamera(-h/2,h/2,d/2,-d/2,l,c);break;default:console.warn("FBXLoader: Unknown camera type "+o+"."),r=new Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new Object3D;else{var o;o=void 0===n.LightType?0:n.LightType.value;var l=16777215;void 0!==n.Color&&(l=(new Color).fromArray(n.Color.value));var c=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(c=0);var h=0;void 0!==n.FarAttenuationEnd&&(h=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(o){case 0:r=new PointLight(l,c,h,1);break;case 1:r=new DirectionalLight(l,c);break;case 2:var d=Math.PI/3;void 0!==n.InnerAngle&&(d=MathUtils.degToRad(n.InnerAngle.value));var f=0;void 0!==n.OuterAngle&&(f=MathUtils.degToRad(n.OuterAngle.value),f=Math.max(f,1)),r=new SpotLight(l,c,h,d,f,1);break;default:console.warn("FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new PointLight(l,c)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,o=null,l=null,c=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),r.has(e.ID)&&c.push(r.get(e.ID))})),c.length>1?l=c:c.length>0?l=c[0]:(l=new MeshPhongMaterial({color:13421772}),c.push(l)),"color"in o.attributes&&c.forEach((function(e){e.vertexColors=VertexColors})),o.FBX_Deformer?(c.forEach((function(e){e.skinning=!0})),(n=new SkinnedMesh(o,l)).normalizeSkinWeights()):n=new Mesh(o,l),n},createCurve:function(e,t){return new Line(e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),new LineBasicMaterial({color:3342591,linewidth:1}))},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?A(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,o){"LookAtProperty"in o&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var o=e.Objects.Model[t.ID];if("Lcl_Translation"in o){var l=o.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(l),r.add(n.target)):n.lookAt((new Vector3).fromArray(l))}}}))},bindSkeleton:function(e,r,n){var o=this.parsePoseNodes();for(var l in e){var c=e[l];t.get(parseInt(c.ID)).parents.forEach((function(e){if(r.has(e.ID)){var l=e.ID;t.get(l).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new Skeleton(c.bones),o[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var o=r[n].PoseNode;Array.isArray(o)?o.forEach((function(e){t[e.Node]=(new Matrix4).fromArray(e.Matrix.a)})):t[o.Node]=(new Matrix4).fromArray(o.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],g=t[1],b=t[2];if(0!==n||0!==g||0!==b){var o=new Color(n,g,b);r.add(new AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,i){e.setupMorphMaterial(t,r,i)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var o=e.uuid,l=t.uuid,c=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===l&&e.uuid!==o&&(c=!0)})):e.material.uuid===l&&e.uuid!==o&&(c=!0))})),!0===c){var h=t.clone();h.morphTargets=!0,void 0===n?e.material=h:e.material[n]=h}else t.morphTargets=!0}},l.prototype={constructor:l,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var o=e.Objects.Geometry;for(var l in o){var c=t.get(parseInt(l)),h=this.parseGeometry(c,o[l],r);n.set(parseInt(l),h)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var o=n.skeletons,l=[],c=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==c.length){var h=t.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null);t.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&l.push(n.morphTargets[e.ID])}));var d=c[0],f={};"RotationOrder"in d&&(f.eulerOrder=A(d.RotationOrder.value)),"InheritType"in d&&(f.inheritType=parseInt(d.InheritType.value)),"GeometricTranslation"in d&&(f.translation=d.GeometricTranslation.value),"GeometricRotation"in d&&(f.rotation=d.GeometricRotation.value),"GeometricScaling"in d&&(f.scale=d.GeometricScaling.value);var m=S(f);return this.genGeometry(r,h,l,m)}},genGeometry:function(e,t,r,n){var o=new BufferGeometry;e.attrName&&(o.name=e.attrName);var l=this.parseGeoNode(e,t),c=this.genBuffers(l),h=new Float32BufferAttribute(c.vertex,3);if(h.applyMatrix4(n),o.setAttribute("position",h),c.colors.length>0&&o.setAttribute("color",new Float32BufferAttribute(c.colors,3)),t&&(o.setAttribute("skinIndex",new Uint16BufferAttribute(c.weightsIndices,4)),o.setAttribute("skinWeight",new Float32BufferAttribute(c.vertexWeights,4)),o.FBX_Deformer=t),c.normal.length>0){var d=(new Matrix3).getNormalMatrix(n),f=new Float32BufferAttribute(c.normal,3);f.applyNormalMatrix(d),o.setAttribute("normal",f)}if(c.uvs.forEach((function(e,i){var t="uv"+(i+1).toString();0===i&&(t="uv"),o.setAttribute(t,new Float32BufferAttribute(c.uvs[i],2))})),l.material&&"AllSame"!==l.material.mappingType){var m=c.materialIndex[0],v=0;if(c.materialIndex.forEach((function(e,i){e!==m&&(o.addGroup(v,i-v,m),m=e,v=i)})),o.groups.length>0){var y=o.groups[o.groups.length-1],x=y.start+y.count;x!==c.materialIndex.length&&o.addGroup(x,c.materialIndex.length-x,m)}0===o.groups.length&&o.addGroup(0,c.materialIndex.length,c.materialIndex[0])}return this.addMorphTargets(o,e,r,n),o},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var i=0;e.LayerElementUV[i];)r.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,i){e.indices.forEach((function(t,n){void 0===r.weightTable[t]&&(r.weightTable[t]=[]),r.weightTable[t].push({id:i,weight:e.weights[n]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,o=!1,l=[],c=[],h=[],d=[],f=[],m=[],v=this;return e.vertexIndices.forEach((function(y,x){var M=!1;y<0&&(y^=-1,M=!0);var w=[],S=[];if(l.push(3*y,3*y+1,3*y+2),e.color){var data=_(x,r,y,e.color);h.push(data[0],data[1],data[2])}if(e.skeleton){if(void 0!==e.weightTable[y]&&e.weightTable[y].forEach((function(e){S.push(e.weight),w.push(e.id)})),S.length>4){o||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);var A=[0,0,0,0],T=[0,0,0,0];S.forEach((function(e,t){var r=e,n=w[t];T.forEach((function(e,t,o){if(r>e){o[t]=r,r=e;var l=A[t];A[t]=n,n=l}}))})),w=A,S=T}for(;S.length<4;)S.push(0),w.push(0);for(var i=0;i<4;++i)f.push(S[i]),m.push(w[i])}if(e.normal){data=_(x,r,y,e.normal);c.push(data[0],data[1],data[2])}if(e.material&&"AllSame"!==e.material.mappingType)var L=_(x,r,y,e.material)[0];e.uv&&e.uv.forEach((function(e,i){var data=_(x,r,y,e);void 0===d[i]&&(d[i]=[]),d[i].push(data[0]),d[i].push(data[1])})),n++,M&&(v.genFace(t,e,l,L,c,h,d,f,m,n),r++,n=0,l=[],c=[],h=[],d=[],f=[],m=[])})),t},genFace:function(e,t,r,n,o,l,c,h,d,f){for(var i=2;i<f;i++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(i-1)]]),e.vertex.push(t.vertexPositions[r[3*(i-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(i-1)+2]]),e.vertex.push(t.vertexPositions[r[3*i]]),e.vertex.push(t.vertexPositions[r[3*i+1]]),e.vertex.push(t.vertexPositions[r[3*i+2]]),t.skeleton&&(e.vertexWeights.push(h[0]),e.vertexWeights.push(h[1]),e.vertexWeights.push(h[2]),e.vertexWeights.push(h[3]),e.vertexWeights.push(h[4*(i-1)]),e.vertexWeights.push(h[4*(i-1)+1]),e.vertexWeights.push(h[4*(i-1)+2]),e.vertexWeights.push(h[4*(i-1)+3]),e.vertexWeights.push(h[4*i]),e.vertexWeights.push(h[4*i+1]),e.vertexWeights.push(h[4*i+2]),e.vertexWeights.push(h[4*i+3]),e.weightsIndices.push(d[0]),e.weightsIndices.push(d[1]),e.weightsIndices.push(d[2]),e.weightsIndices.push(d[3]),e.weightsIndices.push(d[4*(i-1)]),e.weightsIndices.push(d[4*(i-1)+1]),e.weightsIndices.push(d[4*(i-1)+2]),e.weightsIndices.push(d[4*(i-1)+3]),e.weightsIndices.push(d[4*i]),e.weightsIndices.push(d[4*i+1]),e.weightsIndices.push(d[4*i+2]),e.weightsIndices.push(d[4*i+3])),t.color&&(e.colors.push(l[0]),e.colors.push(l[1]),e.colors.push(l[2]),e.colors.push(l[3*(i-1)]),e.colors.push(l[3*(i-1)+1]),e.colors.push(l[3*(i-1)+2]),e.colors.push(l[3*i]),e.colors.push(l[3*i+1]),e.colors.push(l[3*i+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(i-1)]),e.normal.push(o[3*(i-1)+1]),e.normal.push(o[3*(i-1)+2]),e.normal.push(o[3*i]),e.normal.push(o[3*i+1]),e.normal.push(o[3*i+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(c[r][0]),e.uvs[r].push(c[r][1]),e.uvs[r].push(c[r][2*(i-1)]),e.uvs[r].push(c[r][2*(i-1)+1]),e.uvs[r].push(c[r][2*i]),e.uvs[r].push(c[r][2*i+1])}))},addMorphTargets:function(t,r,n,o){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var l=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var c=e.Objects.Geometry[n.geoID];void 0!==c&&l.genMorphGeometry(t,r,c,o,n.name)}))}))}},genMorphGeometry:function(e,t,r,n,o){for(var l=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],c=void 0!==r.Vertices?r.Vertices.a:[],h=void 0!==r.Indexes?r.Indexes.a:[],d=3*e.attributes.position.count,f=new Float32Array(d),i=0;i<h.length;i++){var m=3*h[i];f[m]=c[3*i],f[m+1]=c[3*i+1],f[m+2]=c[3*i+2]}var v={vertexIndices:l,vertexPositions:f},y=new Float32BufferAttribute(this.genBuffers(v).vertex,3);y.name=o||r.attrName,y.applyMatrix4(n),e.morphAttributes.position.push(y)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,o=[];return"IndexToDirect"===r&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:o,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,o=[];return"IndexToDirect"===r&&(o=e.UVIndex.a),{dataSize:2,buffer:n,indices:o,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,o=[];return"IndexToDirect"===r&&(o=e.ColorIndex.a),{dataSize:4,buffer:n,indices:o,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,o=[],i=0;i<n.length;++i)o.push(i);return{dataSize:1,buffer:n,indices:o,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===NURBSCurve)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new BufferGeometry;for(var r,n,o=t-1,l=e.KnotVector.a,c=[],h=e.Points.a,i=0,d=h.length;i<d;i+=4)c.push((new Vector4).fromArray(h,i));if("Closed"===e.Form)c.push(c[0]);else if("Periodic"===e.Form){r=o,n=l.length-1-r;for(i=0;i<o;++i)c.push(c[i])}var f=new NURBSCurve(o,l,c,r,n).getPoints(7*c.length),m=new Float32Array(3*f.length);f.forEach((function(e,i){e.toArray(m,3*i)}));var v=new BufferGeometry;return v.setAttribute("position",new BufferAttribute(m,3)),v}},c.prototype={constructor:c,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],o=this.addClip(n);e.push(o)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var o=t[n];if(null!==o.attrName.match(/S|R|T|DeformPercent/)){var l={id:o.id,attr:o.attrName,curves:{}};r.set(l.id,l)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var o in n){var l={id:n[o].id,times:n[o].KeyTime.a.map(y),values:n[o].KeyValueFloat.a},c=t.get(l.id);if(void 0!==c){var h=c.parents[0].ID,d=c.parents[0].relationship;d.match(/X/)?r.get(h).curves.x=l:d.match(/Y/)?r.get(h).curves.y=l:d.match(/Z/)?r.get(h).curves.z=l:d.match(/d|DeformPercent/)&&r.has(h)&&(r.get(h).curves.morph=l)}}},parseAnimationLayers:function(n){var o=e.Objects.AnimationLayer,l=new Map;for(var c in o){var h=[],d=t.get(parseInt(c));if(void 0!==d)d.children.forEach((function(o,i){if(n.has(o.ID)){var l=n.get(o.ID);if(void 0!==l.curves.x||void 0!==l.curves.y||void 0!==l.curves.z){if(void 0===h[i])if(void 0!==(y=t.get(o.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){var c={modelName:(d=e.Objects.Model[y.toString()]).attrName?PropertyBinding.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){e.ID===d.id&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new Matrix4),"PreRotation"in d&&(c.preRotation=d.PreRotation.value),"PostRotation"in d&&(c.postRotation=d.PostRotation.value),h[i]=c}h[i]&&(h[i][l.attr]=l)}else if(void 0!==l.curves.morph){if(void 0===h[i]){var d,f=t.get(o.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,m=t.get(f).parents[0].ID,v=t.get(m).parents[0].ID,y=t.get(v).parents[0].ID;c={modelName:(d=e.Objects.Model[y]).attrName?PropertyBinding.sanitizeNodeName(d.attrName):"",morphName:e.Objects.Deformer[f].attrName};h[i]=c}h[i][l.attr]=l}}})),l.set(parseInt(c),h)}return l},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,o={};for(var l in n){var c=t.get(parseInt(l)).children;c.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var h=r.get(c[0].ID);o[l]={name:n[l].attrName,layer:h}}return o},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new Vector3,n=new Quaternion,o=new Vector3;if(e.transform&&e.transform.decompose(r,n,o),r=r.toArray(),n=(new Euler).setFromQuaternion(n,e.eulerOrder).toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var l=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==l&&t.push(l)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var c=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==c&&t.push(c)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var h=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==h&&t.push(h)}if(void 0!==e.DeformPercent){var d=this.generateMorphTrack(e);void 0!==d&&t.push(d)}return t},generateVectorTrack:function(e,t,r,n){var o=this.getTimesForAllAxes(t);return new VectorKeyframeTrack(e+"."+n,o,this.getKeyframeTrackValues(o,t,r))},generateRotationTrack:function(e,t,r,n,o,l){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(MathUtils.degToRad));var c=this.getTimesForAllAxes(t),h=this.getKeyframeTrackValues(c,t,r);void 0!==n&&((n=n.map(MathUtils.degToRad)).push(l),n=(new Euler).fromArray(n),n=(new Quaternion).setFromEuler(n)),void 0!==o&&((o=o.map(MathUtils.degToRad)).push(l),o=(new Euler).fromArray(o),o=(new Quaternion).setFromEuler(o).inverse());for(var d=new Quaternion,f=new Euler,m=[],i=0;i<h.length;i+=3)f.set(h[i],h[i+1],h[i+2],l),d.setFromEuler(f),void 0!==n&&d.premultiply(n),void 0!==o&&d.multiply(o),d.toArray(m,i/3*4);return new QuaternionKeyframeTrack(e+".quaternion",c,m)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),o=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+o+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(a,b){return a-b})).filter((function(e,t,r){return r.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,r){var n=r,o=[],l=-1,c=-1,h=-1;return e.forEach((function(time){if(t.x&&(l=t.x.times.indexOf(time)),t.y&&(c=t.y.times.indexOf(time)),t.z&&(h=t.z.times.indexOf(time)),-1!==l){var e=t.x.values[l];o.push(e),n[0]=e}else o.push(n[0]);if(-1!==c){var r=t.y.values[c];o.push(r),n[1]=r}else o.push(n[1]);if(-1!==h){var d=t.z.values[h];o.push(d),n[2]=d}else o.push(n[2])})),o},interpolateRotations:function(e){for(var i=1;i<e.values.length;i++){var t=e.values[i-1],r=e.values[i]-t,n=Math.abs(r);if(n>=180){for(var o=n/180,l=r/o,c=t+l,h=e.times[i-1],d=(e.times[i]-h)/o,f=h+d,m=[],v=[];f<e.times[i];)m.push(f),f+=d,v.push(c),c+=l;e.times=C(e.times,i,m),e.values=C(e.values,i,v)}}}},h.prototype={constructor:h,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(text){this.currentIndent=0,this.allNodes=new m,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,t=text.split(/[\r\n]+/);return t.forEach((function(line,i){var r=line.match(/^[\s\t]*;/),n=line.match(/^[\s\t]*$/);if(!r&&!n){var o=line.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),l=line.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=line.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(line,o):l?e.parseNodeProperty(line,l,t[++i]):c?e.popStack():line.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(line)}})),this.allNodes},parseNodeBegin:function(line,e){var t=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),n={name:t},o=this.parseNodeAttr(r),l=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(t,n):t in l?("PoseNode"===t?l.PoseNode.push(n):void 0!==l[t].id&&(l[t]={},l[t][l[t].id]=l[t]),""!==o.id&&(l[t][o.id]=n)):"number"==typeof o.id?(l[t]={},l[t][o.id]=n):"Properties70"!==t&&(l[t]="PoseNode"===t?[n]:n),"number"==typeof o.id&&(n.id=o.id),""!==o.name&&(n.attrName=o.name),""!==o.type&&(n.attrType=o.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(line,e,t){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),n=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===n&&(n=t.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var l=n.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]),d=n.split(",").slice(3);r="connections",function(a,b){for(var i=0,e=a.length,t=b.length;i<t;i++,e++)a[e]=b[i]}(n=[c,h],d=d.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=n),r in o&&Array.isArray(o[r])?o[r].push(n):"a"!==r?o[r]=n:o.a=n,this.setCurrentProp(o,r),"a"===r&&","!==n.slice(-1)&&(o.a=T(n))}else this.parseNodeSpecialProperty(line,r,n)},parseNodePropertyContinued:function(line){var e=this.getCurrentNode();e.a+=line,","!==line.slice(-1)&&(e.a=T(e.a))},parseNodeSpecialProperty:function(line,e,t){var r=t.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),n=r[0],o=r[1],l=r[2],c=r[3],h=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=T(h)}this.getPrevNode()[n]={type:o,type2:l,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),n)}},d.prototype={constructor:d,parse:function(e){var t=new f(e);t.skip(23);var r=t.getUint32();console.log("FBXLoader: FBX binary version: "+r);for(var n=new m;!this.endOfContent(t);){var o=this.parseNode(t,r);null!==o&&n.add(o.name,o)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32(),l=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),c=e.getString(l);if(0===n)return null;for(var h=[],i=0;i<o;i++)h.push(this.parseProperty(e));var d=h.length>0?h[0]:"",f=h.length>1?h[1]:"",m=h.length>2?h[2]:"";for(r.singleProperty=1===o&&e.getOffset()===n;n>e.getOffset();){var v=this.parseNode(e,t);null!==v&&this.parseSubNode(c,r,v)}return r.propertyList=h,"number"==typeof d&&(r.id=d),""!==f&&(r.attrName=f),""!==m&&(r.attrType=m),""!==c&&(r.name=c),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var o=[];r.propertyList.forEach((function(e,i){0!==i&&o.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(o)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var l,c=r.propertyList[0],h=r.propertyList[1],d=r.propertyList[2],f=r.propertyList[3];0===c.indexOf("Lcl ")&&(c=c.replace("Lcl ","Lcl_")),0===h.indexOf("Lcl ")&&(h=h.replace("Lcl ","Lcl_")),l="Color"===h||"ColorRGB"===h||"Vector"===h||"Vector3D"===h||0===h.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[c]={type:h,type2:d,flag:f,value:l}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),o=e.getUint32(),l=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var c=new f(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(l))).decompress().buffer);switch(t){case"b":case"c":return c.getBooleanArray(n);case"d":return c.getFloat64Array(n);case"f":return c.getFloat32Array(n);case"i":return c.getInt32Array(n);case"l":return c.getInt64Array(n)}default:throw new Error("FBXLoader: Unknown property type "+t)}}},f.prototype={constructor:f,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getBoolean());return a},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getInt32());return a},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getInt64());return a},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getFloat32());return a},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getFloat64());return a},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var a=[],i=0;i<e;i++)a[i]=this.getUint8();var t=a.indexOf(0);return t>=0&&(a=a.slice(0,t)),LoaderUtils.decodeText(new Uint8Array(a))}},m.prototype={constructor:m,add:function(e,t){this[e]=t}};var x=[];function _(e,t,r,n){var o;switch(n.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=r;break;case"AllSame":o=n.indices[0];break;default:console.warn("FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(o=n.indices[o]);var l=o*n.dataSize,c=l+n.dataSize;return function(a,b,e,t){for(var i=e,r=0;i<t;i++,r++)a[r]=b[i];return a}(x,n.buffer,l,c)}var M=new Euler,w=new Vector3;function S(e){var t,r=new Matrix4,n=new Matrix4,o=new Matrix4,l=new Matrix4,c=new Matrix4,h=new Matrix4,d=new Matrix4,f=new Matrix4,m=new Matrix4,v=new Matrix4,y=new Matrix4,x=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(w.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(M.fromArray(t)));e.rotation&&((t=e.rotation.map(MathUtils.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(M.fromArray(t)));e.postRotation&&((t=e.postRotation.map(MathUtils.degToRad)).push(e.eulerOrder),l.makeRotationFromEuler(M.fromArray(t)));e.scale&&c.scale(w.fromArray(e.scale)),e.scalingOffset&&d.setPosition(w.fromArray(e.scalingOffset)),e.scalingPivot&&h.setPosition(w.fromArray(e.scalingPivot)),e.rotationOffset&&f.setPosition(w.fromArray(e.rotationOffset)),e.rotationPivot&&m.setPosition(w.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(v=e.parentMatrixWorld);var _=n.multiply(o).multiply(l),S=new Matrix4;v.extractRotation(S);var A,T,L,C,N=new Matrix4;if(N.copyPosition(v),L=N.getInverse(N).multiply(v),T=S.getInverse(S).multiply(L),A=c,0===x)C=S.multiply(_).multiply(T).multiply(A);else if(1===x)C=S.multiply(T).multiply(_).multiply(A);else{var P=(new Matrix4).copy(c),F=T.multiply(P.getInverse(P));C=S.multiply(_).multiply(F).multiply(A)}var E=r.multiply(f).multiply(m).multiply(n).multiply(o).multiply(l).multiply(m.getInverse(m)).multiply(d).multiply(h).multiply(c).multiply(h.getInverse(h)),R=(new Matrix4).copyPosition(E),D=v.multiply(R);return y.copyPosition(D),E=y.multiply(C)}function A(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function T(e){return e.split(",").map((function(e){return parseFloat(e)}))}function L(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),LoaderUtils.decodeText(new Uint8Array(e,t,r))}function C(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return n}(),GCodeLoader=function(e){Loader.call(this,e),this.splitLayer=!1};function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}GCodeLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:GCodeLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(data){var e={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},t=[],r=void 0,n=new LineBasicMaterial({color:16711680});n.name="path";var o=new LineBasicMaterial({color:65280});function l(line){r={vertex:[],pathVertex:[],z:line.z},t.push(r)}function c(t,r){return e.relative?r:r-t}function h(t,r){return e.relative?t+r:r}o.name="extruded";for(var d,f,m=data.replace(/;.+/g,"").split("\n"),i=0;i<m.length;i++){var v=m[i].split(" "),y=v[0].toUpperCase(),x={};if(v.splice(1).forEach((function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));x[t]=r}})),"G0"===y||"G1"===y){var line={x:void 0!==x.x?h(e.x,x.x):e.x,y:void 0!==x.y?h(e.y,x.y):e.y,z:void 0!==x.z?h(e.z,x.z):e.z,e:void 0!==x.e?h(e.e,x.e):e.e,f:void 0!==x.f?h(e.f,x.f):e.f};c(e.e,line.e)>0&&(line.extruding=c(e.e,line.e)>0,null!=r&&line.z==r.z||l(line)),d=e,f=line,void 0===r&&l(d),line.extruding?(r.vertex.push(d.x,d.y,d.z),r.vertex.push(f.x,f.y,f.z)):(r.pathVertex.push(d.x,d.y,d.z),r.pathVertex.push(f.x,f.y,f.z)),e=line}else if("G2"===y||"G3"===y);else if("G90"===y)e.relative=!1;else if("G91"===y)e.relative=!0;else if("G92"===y){(line=e).x=void 0!==x.x?x.x:line.x,line.y=void 0!==x.y?x.y:line.y,line.z=void 0!==x.z?x.z:line.z,line.e=void 0!==x.e?x.e:line.e,e=line}}function _(e,t){var r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(e,3));var l=new LineSegments(r,t?o:n);l.name="layer"+i,object.add(l)}var object=new Group;if(object.name="gcode",this.splitLayer)for(i=0;i<t.length;i++){_((S=t[i]).vertex,!0),_(S.pathVertex,!1)}else{var M=[],w=[];for(i=0;i<t.length;i++){var S=t[i];M=M.concat(S.vertex),w=w.concat(S.pathVertex)}_(M,!0),_(w,!1)}return object.quaternion.setFromEuler(new Euler(-Math.PI/2,0,0)),object}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.alphaMap=source.alphaMap,this.size=source.size,this.sizeAttenuation=source.sizeAttenuation,this.morphTargets=source.morphTargets,this};var _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3;function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial,this.updateMorphTargets()}function testPoint(e,t,r,n,o,l,object){var c=_ray$2.distanceSqToPoint(e);if(c<r){var h=new Vector3;_ray$2.closestPointToPoint(e,h),h.applyMatrix4(n);var d=o.ray.origin.distanceTo(h);if(d<o.near||d>o.far)return;l.push({distance:d,distanceToRay:Math.sqrt(c),point:h,index:t,face:null,object:object})}}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,o=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$3.copy(r.boundingSphere),_sphere$3.applyMatrix4(n),_sphere$3.radius+=o,!1!==e.ray.intersectsSphere(_sphere$3)){_inverseMatrix$2.getInverse(n),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2);var l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l;if(r.isBufferGeometry){var h=r.index,d=r.attributes.position.array;if(null!==h)for(var f=h.array,i=0,m=f.length;i<m;i++){var a=f[i];_position$1.fromArray(d,3*a),testPoint(_position$1,a,c,n,e,t,this)}else{i=0;for(var v=d.length/3;i<v;i++)_position$1.fromArray(d,3*i),testPoint(_position$1,i,c,n,e,t,this)}}else{var y=r.vertices;for(i=0,v=y.length;i<v;i++)testPoint(y[i],i,c,n,e,t,this)}}},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var o=n.morphAttributes,l=Object.keys(o);if(l.length>0){var c=o[l[0]];if(void 0!==c)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=c.length;e<t;e++)r=c[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var h=n.morphTargets;void 0!==h&&h.length>0&&console.error("Points.updateMorphTargets() does not support Geometry. Use BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var GLTFLoader=function(){function e(e){Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,object){e[t]=object},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(e,t,r,n){var o,l=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(e),l.manager.itemStart(e);var c=function(t){n?n(t):console.error(t),l.manager.itemError(e),l.manager.itemEnd(e)},h=new FileLoader(l.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),"use-credentials"===l.crossOrigin&&h.setWithCredentials(!0),h.load(e,(function(data){try{l.parse(data,o,(function(r){t(r),l.manager.itemEnd(e)}),c)}catch(e){c(e)}}),r,c)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(data,path,e,t){var content,h={};if("string"==typeof data)content=data;else if(LoaderUtils.decodeText(new Uint8Array(data,0,4))===c){try{h[r.KHR_BINARY_GLTF]=new f(data)}catch(e){return void(t&&t(e))}content=h[r.KHR_BINARY_GLTF].content}else content=LoaderUtils.decodeText(new Uint8Array(data));var d=JSON.parse(content);if(void 0===d.asset||d.asset.version[0]<2)t&&t(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(d.extensionsUsed)for(var i=0;i<d.extensionsUsed.length;++i){var y=d.extensionsUsed[i],M=d.extensionsRequired||[];switch(y){case r.KHR_LIGHTS_PUNCTUAL:h[y]=new o(d);break;case r.KHR_MATERIALS_UNLIT:h[y]=new l;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:h[y]=new x;break;case r.KHR_DRACO_MESH_COMPRESSION:h[y]=new m(d,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:h[y]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:h[y]=new v;break;case r.KHR_MESH_QUANTIZATION:h[y]=new _;break;default:M.indexOf(y)>=0&&console.warn('GLTFLoader: Unknown extension "'+y+'".')}}new X(d,h,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(e,t)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function o(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function l(){this.name=r.KHR_MATERIALS_UNLIT}o.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new Color(16777215);void 0!==r.color&&n.fromArray(r.color);var o=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new PointLight(n)).distance=o;break;case"spot":(t=new SpotLight(n)).distance=o,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},l.prototype.getMaterialType=function(){return MeshBasicMaterial},l.prototype.extendParams=function(e,t,r){var n=[];e.color=new Color(1,1,1),e.opacity=1;var o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var l=o.baseColorFactor;e.color.fromArray(l),e.opacity=l[3]}void 0!==o.baseColorTexture&&n.push(r.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(n)};var c="glTF",h=1313821514,d=5130562;function f(data){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(data,0,12);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==c)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");for(var t=new DataView(data,12),n=0;n<t.byteLength;){var o=t.getUint32(n,!0);n+=4;var l=t.getUint32(n,!0);if(n+=4,l===h){var f=new Uint8Array(data,12+n,o);this.content=LoaderUtils.decodeText(f)}else if(l===d){var m=12+n;this.body=data.slice(m,m+o)}n+=o}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function v(){this.name=r.KHR_TEXTURE_TRANSFORM}function y(e){MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c={specular:{value:(new Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(e){for(var h in c)e.uniforms[h]=c[h];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",l)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(e){c.specular.value=e}},specularMap:{get:function(){return c.specularMap.value},set:function(e){c.specularMap.value=e}},glossiness:{get:function(){return c.glossiness.value},set:function(e){c.glossiness.value=e}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(e){c.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function x(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return y},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new Color(1,1,1),e.opacity=1;var o=[];if(Array.isArray(n.diffuseFactor)){var l=n.diffuseFactor;e.color.fromArray(l),e.opacity=l[3]}if(void 0!==n.diffuseTexture&&o.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var c=n.specularGlossinessTexture;o.push(r.assignTexture(e,"glossinessMap",c)),o.push(r.assignTexture(e,"specularMap",c))}return Promise.all(o)},createMaterial:function(e){var t=new y(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function _(){this.name=r.KHR_MESH_QUANTIZATION}function M(e,t,r,n){Interpolant.call(this,e,t,r,n)}m.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,c={},h={},d={};for(var f in l){var m=D[f]||f.toLowerCase();c[m]=l[f]}for(f in e.attributes){m=D[f]||f.toLowerCase();if(void 0!==l[f]){var v=r.accessors[e.attributes[f]],y=P[v.componentType];d[m]=y,h[m]=!0===v.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(var r in e.attributes){var n=e.attributes[r],o=h[r];void 0!==o&&(n.normalized=o)}t(e)}),c,d)}))}))},v.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},y.prototype=Object.create(MeshStandardMaterial.prototype),y.prototype.constructor=y,y.prototype.copy=function(source){return MeshStandardMaterial.prototype.copy.call(this,source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},M.prototype=Object.create(Interpolant.prototype),M.prototype.constructor=M,M.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n*3+n,i=0;i!==n;i++)t[i]=r[o+i];return t},M.prototype.beforeStart_=M.prototype.copySampleValue_,M.prototype.afterEnd_=M.prototype.copySampleValue_,M.prototype.interpolate_=function(e,t,r,n){for(var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=2*c,d=3*c,td=n-t,p=(r-t)/td,f=p*p,m=f*p,v=e*d,y=v-d,x=-2*m+3*f,_=m-f,M=1-x,w=_-f+p,i=0;i!==c;i++){var S=l[y+i+c],A=l[y+i+h]*td,T=l[v+i+c],L=l[v+i]*td;o[i]=M*S+w*A+x*T+_*L}return o};var w=0,S=1,A=2,T=3,L=4,C=5,N=6,P={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},E={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},O={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},B="OPAQUE",U="MASK",k="BLEND",V={"image/png":RGBAFormat,"image/jpeg":RGBFormat};function G(e,path){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(path)&&/^\//.test(e)&&(path=path.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:path+e)}function z(e,object,t){for(var r in t.extensions)void 0===e[r]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[r]=t.extensions[r])}function j(object,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(object.userData,e.extras):console.warn("GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function W(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function H(e){for(var t="",r=Object.keys(e).sort(),i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function X(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Y(e,t,r){var n=t.attributes,o=[];function l(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(var c in n){var h=D[c]||c.toLowerCase();h in e.attributes||o.push(l(n[c],h))}if(void 0!==t.indices&&!e.index){var d=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(d)}return j(e,t),function(e,t,r){var n=t.attributes,o=new Box3;if(void 0!==n.POSITION){var l=(v=r.json.accessors[n.POSITION]).min,c=v.max;if(void 0!==l&&void 0!==c){o.set(new Vector3(l[0],l[1],l[2]),new Vector3(c[0],c[1],c[2]));var h=t.targets;if(void 0!==h)for(var d=new Vector3,i=0,f=h.length;i<f;i++){var m=h[i];if(void 0!==m.POSITION){var v;l=(v=r.json.accessors[m.POSITION]).min,c=v.max;void 0!==l&&void 0!==c?(d.setX(Math.max(Math.abs(l[0]),Math.abs(c[0]))),d.setY(Math.max(Math.abs(l[1]),Math.abs(c[1]))),d.setZ(Math.max(Math.abs(l[2]),Math.abs(c[2]))),o.expandByVector(d)):console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}e.boundingBox=o;var y=new Sphere;o.getCenter(y.center),y.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=y}else console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,o=!1,i=0,l=t.length;i<l;i++){if(void 0!==(d=t[i]).POSITION&&(n=!0),void 0!==d.NORMAL&&(o=!0),n&&o)break}if(!n&&!o)return Promise.resolve(e);var c=[],h=[];for(i=0,l=t.length;i<l;i++){var d=t[i];if(n){var f=void 0!==d.POSITION?r.getDependency("accessor",d.POSITION):e.attributes.position;c.push(f)}if(o){f=void 0!==d.NORMAL?r.getDependency("accessor",d.NORMAL):e.attributes.normal;h.push(f)}}return Promise.all([Promise.all(c),Promise.all(h)]).then((function(t){var r=t[0],l=t[1];return n&&(e.morphAttributes.position=r),o&&(e.morphAttributes.normal=l),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function Q(e,t){var r=e.getIndex();if(null===r){var n=[],o=e.getAttribute("position");if(void 0===o)return console.error("GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)n.push(i);e.setIndex(n),r=e.getIndex()}var l=r.count-2,c=[];if(t===TriangleFanDrawMode)for(i=1;i<=l;i++)c.push(r.getX(0)),c.push(r.getX(i)),c.push(r.getX(i+1));else for(i=0;i<l;i++)i%2==0?(c.push(r.getX(i)),c.push(r.getX(i+1)),c.push(r.getX(i+2))):(c.push(r.getX(i+2)),c.push(r.getX(i+1)),c.push(r.getX(i)));c.length/3!==l&&console.error("GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var h=e.clone();return h.setIndex(c),h}return X.prototype.parse=function(e,t){var r=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var l={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};z(o,l,n),j(l,n),e(l)})).catch(t)},X.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},o={},l=0,c=t.length;l<c;l++)for(var h=t[l].joints,i=0,d=h.length;i<d;i++)e[h[i]].isBone=!0;for(var f=0,m=e.length;f<m;f++){var v=e[f];void 0!==v.mesh&&(void 0===n[v.mesh]&&(n[v.mesh]=o[v.mesh]=0),n[v.mesh]++,void 0!==v.skin&&(r[v.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=o},X.prototype.getDependency=function(e,t){var n=e+":"+t,o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this.loadMesh(t);break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this.loadBufferView(t);break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this.loadMaterial(t);break;case"texture":o=this.loadTexture(t);break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;case"light":o=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,o)}return o},X.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,defs=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(defs.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t},X.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var o=this.options;return new Promise((function(e,r){n.load(G(t.uri,o.path),e,void 0,(function(){r(new Error('GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},X.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))},X.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var o=[];return void 0!==n.bufferView?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),void 0!==n.sparse&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then((function(e){var o,l=e[0],c=R[n.type],h=P[n.componentType],d=h.BYTES_PER_ELEMENT,f=d*c,m=n.byteOffset||0,v=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,y=!0===n.normalized;if(v&&v!==f){var x=Math.floor(m/v),_="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+x+":"+n.count,M=t.cache.get(_);M||(M=new InterleavedBuffer(new h(l,x*v,n.count*v/d),v/d),t.cache.add(_,M)),o=new InterleavedBufferAttribute(M,c,m%v/d,y)}else o=new BufferAttribute(null===l?new h(n.count*c):new h(l,m,n.count*c),c,y);if(void 0!==n.sparse){var w=R.SCALAR,S=P[n.sparse.indices.componentType],A=n.sparse.indices.byteOffset||0,T=n.sparse.values.byteOffset||0,L=new S(e[1],A,n.sparse.count*w),C=new h(e[2],T,n.sparse.count*c);null!==l&&(o=new BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var i=0,N=L.length;i<N;i++){var F=L[i];if(o.setX(F,C[i*c]),c>=2&&o.setY(F,C[i*c+1]),c>=3&&o.setZ(F,C[i*c+2]),c>=4&&o.setW(F,C[i*c+3]),c>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},X.prototype.loadTexture=function(e){var source,t=this,n=this.json,o=this.options,l=this.textureLoader,c=window.URL||window.webkitURL,h=n.textures[e],d=h.extensions||{},f=(source=d[r.MSFT_TEXTURE_DDS]?n.images[d[r.MSFT_TEXTURE_DDS].source]:n.images[h.source]).uri,m=!1;return void 0!==source.bufferView&&(f=t.getDependency("bufferView",source.bufferView).then((function(e){m=!0;var t=new Blob([e],{type:source.mimeType});return f=c.createObjectURL(t)}))),Promise.resolve(f).then((function(e){var n=o.manager.getHandler(e);return n||(n=d[r.MSFT_TEXTURE_DDS]?t.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:l),new Promise((function(t,r){n.load(G(e,o.path),t,void 0,r)}))})).then((function(e){!0===m&&c.revokeObjectURL(f),e.flipY=!1,void 0!==h.name&&(e.name=h.name),source.mimeType in V&&(e.format=V[source.mimeType]);var t=(n.samplers||{})[h.sampler]||{};return e.magFilter=F[t.magFilter]||LinearFilter,e.minFilter=F[t.minFilter]||LinearMipmapLinearFilter,e.wrapS=E[t.wrapS]||RepeatWrapping,e.wrapT=E[t.wrapT]||RepeatWrapping,e}))},X.prototype.assignTexture=function(e,t,n){var o=this;return this.getDependency("texture",n.index).then((function(l){if(!l.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":l.format=RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[r.KHR_TEXTURE_TRANSFORM]){var c=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;c&&(l=o.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(l,c))}e[t]=l}))},X.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,n=(this.extensions,void 0!==t.attributes.tangent),o=void 0!==t.attributes.color,l=void 0===t.attributes.normal,c=!0===e.isSkinnedMesh,h=Object.keys(t.morphAttributes).length>0,d=h&&void 0!==t.morphAttributes.normal;if(e.isPoints){var f="PointsMaterial:"+r.uuid,m=this.cache.get(f);m||(m=new PointsMaterial,Material.prototype.copy.call(m,r),m.color.copy(r.color),m.map=r.map,m.sizeAttenuation=!1,this.cache.add(f,m)),r=m}else if(e.isLine){f="LineBasicMaterial:"+r.uuid;var v=this.cache.get(f);v||(v=new LineBasicMaterial,Material.prototype.copy.call(v,r),v.color.copy(r.color),this.cache.add(f,v)),r=v}if(n||o||l||c||h){f="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(f+="specular-glossiness:"),c&&(f+="skinning:"),n&&(f+="vertex-tangents:"),o&&(f+="vertex-colors:"),l&&(f+="flat-shading:"),h&&(f+="morph-targets:"),d&&(f+="morph-normals:");var y=this.cache.get(f);y||(y=r.clone(),c&&(y.skinning=!0),n&&(y.vertexTangents=!0),o&&(y.vertexColors=VertexColors),l&&(y.flatShading=!0),h&&(y.morphTargets=!0),d&&(y.morphNormals=!0),this.cache.add(f,y)),r=y}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new BufferAttribute(t.attributes.uv.array,2)),r.normalScale&&!n&&(r.normalScale.y=-r.normalScale.y),e.material=r},X.prototype.loadMaterial=function(e){var t,n=this.json,o=this.extensions,l=n.materials[e],c={},h=l.extensions||{},d=[];if(h[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var f=o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=f.getMaterialType(),d.push(f.extendParams(c,l,this))}else if(h[r.KHR_MATERIALS_UNLIT]){var m=o[r.KHR_MATERIALS_UNLIT];t=m.getMaterialType(),d.push(m.extendParams(c,l,this))}else{t=MeshStandardMaterial;var v=l.pbrMetallicRoughness||{};if(c.color=new Color(1,1,1),c.opacity=1,Array.isArray(v.baseColorFactor)){var x=v.baseColorFactor;c.color.fromArray(x),c.opacity=x[3]}void 0!==v.baseColorTexture&&d.push(this.assignTexture(c,"map",v.baseColorTexture)),c.metalness=void 0!==v.metallicFactor?v.metallicFactor:1,c.roughness=void 0!==v.roughnessFactor?v.roughnessFactor:1,void 0!==v.metallicRoughnessTexture&&(d.push(this.assignTexture(c,"metalnessMap",v.metallicRoughnessTexture)),d.push(this.assignTexture(c,"roughnessMap",v.metallicRoughnessTexture)))}!0===l.doubleSided&&(c.side=DoubleSide);var _=l.alphaMode||B;return _===k?c.transparent=!0:(c.transparent=!1,_===U&&(c.alphaTest=void 0!==l.alphaCutoff?l.alphaCutoff:.5)),void 0!==l.normalTexture&&t!==MeshBasicMaterial&&(d.push(this.assignTexture(c,"normalMap",l.normalTexture)),c.normalScale=new Vector2(1,1),void 0!==l.normalTexture.scale&&c.normalScale.set(l.normalTexture.scale,l.normalTexture.scale)),void 0!==l.occlusionTexture&&t!==MeshBasicMaterial&&(d.push(this.assignTexture(c,"aoMap",l.occlusionTexture)),void 0!==l.occlusionTexture.strength&&(c.aoMapIntensity=l.occlusionTexture.strength)),void 0!==l.emissiveFactor&&t!==MeshBasicMaterial&&(c.emissive=(new Color).fromArray(l.emissiveFactor)),void 0!==l.emissiveTexture&&t!==MeshBasicMaterial&&d.push(this.assignTexture(c,"emissiveMap",l.emissiveTexture)),Promise.all(d).then((function(){var e;return e=t===y?o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new t(c),void 0!==l.name&&(e.name=l.name),e.map&&(e.map.encoding=sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=sRGBEncoding),j(e,l),l.extensions&&z(o,e,l),e}))},X.prototype.loadGeometries=function(e){var t=this,n=this.extensions,o=this.primitiveCache;function l(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return Y(r,e,t)}))}for(var c,h,d=[],i=0,f=e.length;i<f;i++){var m,v=e[i],y=(h=void 0,(h=(c=v).extensions&&c.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+h.bufferView+":"+h.indices+":"+H(h.attributes):c.indices+":"+H(c.attributes)+":"+c.mode),x=o[y];if(x)d.push(x.promise);else m=v.extensions&&v.extensions[r.KHR_DRACO_MESH_COMPRESSION]?l(v):Y(new BufferGeometry,v,t),o[y]={primitive:v,promise:m},d.push(m)}return Promise.all(d)},X.prototype.loadMesh=function(e){for(var t,r=this,n=this.json.meshes[e],o=n.primitives,l=[],i=0,c=o.length;i<c;i++){var h=void 0===o[i].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),t.DefaultMaterial):this.getDependency("material",o[i].material);l.push(h)}return l.push(r.loadGeometries(o)),Promise.all(l).then((function(t){for(var l=t.slice(0,t.length-1),c=t[t.length-1],h=[],i=0,d=c.length;i<d;i++){var f,m=c[i],v=o[i],y=l[i];if(v.mode===L||v.mode===C||v.mode===N||void 0===v.mode)!0!==(f=!0===n.isSkinnedMesh?new SkinnedMesh(m,y):new Mesh(m,y)).isSkinnedMesh||f.geometry.attributes.skinWeight.normalized||f.normalizeSkinWeights(),v.mode===C?f.geometry=Q(f.geometry,TriangleStripDrawMode):v.mode===N&&(f.geometry=Q(f.geometry,TriangleFanDrawMode));else if(v.mode===S)f=new LineSegments(m,y);else if(v.mode===T)f=new Line(m,y);else if(v.mode===A)f=new LineLoop(m,y);else{if(v.mode!==w)throw new Error("GLTFLoader: Primitive mode unsupported: "+v.mode);f=new Points(m,y)}Object.keys(f.geometry.morphAttributes).length>0&&W(f,n),f.name=n.name||"mesh_"+e,c.length>1&&(f.name+="_"+i),j(f,n),r.assignFinalMaterial(f),h.push(f)}if(1===h.length)return h[0];var x=new Group;for(i=0,d=h.length;i<d;i++)x.add(h[i]);return x}))},X.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new PerspectiveCamera(MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==r.name&&(t.name=r.name),j(t,r),Promise.resolve(t);console.warn("GLTFLoader: Missing camera parameters.")},X.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},X.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],o=[],l=[],c=[],i=0,h=t.channels.length;i<h;i++){var d=t.channels[i],f=t.samplers[d.sampler],m=d.target,v=void 0!==m.node?m.node:m.id,input=void 0!==t.parameters?t.parameters[f.input]:f.input,output=void 0!==t.parameters?t.parameters[f.output]:f.output;r.push(this.getDependency("node",v)),n.push(this.getDependency("accessor",input)),o.push(this.getDependency("accessor",output)),l.push(f),c.push(m)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(r){for(var n=r[0],o=r[1],l=r[2],c=r[3],h=r[4],d=[],i=0,f=n.length;i<f;i++){var m=n[i],v=o[i],y=l[i],x=c[i],_=h[i];if(void 0!==m){var w;switch(m.updateMatrix(),m.matrixAutoUpdate=!0,O[_.path]){case O.weights:w=NumberKeyframeTrack;break;case O.rotation:w=QuaternionKeyframeTrack;break;case O.position:case O.scale:default:w=VectorKeyframeTrack}var S=m.name?m.name:m.uuid,A=void 0!==x.interpolation?I[x.interpolation]:InterpolateLinear,T=[];O[_.path]===O.weights?m.traverse((function(object){!0===object.isMesh&&object.morphTargetInfluences&&T.push(object.name?object.name:object.uuid)})):T.push(S);var L=y.array;if(y.normalized){var C;if(L.constructor===Int8Array)C=1/127;else if(L.constructor===Uint8Array)C=1/255;else if(L.constructor==Int16Array)C=1/32767;else{if(L.constructor!==Uint16Array)throw new Error("GLTFLoader: Unsupported output accessor component type.");C=1/65535}for(var N=new Float32Array(L.length),P=0,F=L.length;P<F;P++)N[P]=L[P]*C;L=N}for(P=0,F=T.length;P<F;P++){var track=new w(T[P]+"."+O[_.path],v.array,L,A);"CUBICSPLINE"===x.interpolation&&(track.createInterpolant=function(e){return new M(this.times,this.values,this.getValueSize()/3,e)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),d.push(track)}}}return new AnimationClip(void 0!==t.name?t.name:"animation_"+e,void 0,d)}))},X.prototype.loadNode=function(e){var t,n=this.json,o=this.extensions,l=this,c=n.meshReferences,h=n.meshUses,d=n.nodes[e];return(t=[],void 0!==d.mesh&&t.push(l.getDependency("mesh",d.mesh).then((function(e){var t;if(c[d.mesh]>1){var r=h[d.mesh]++;(t=e.clone()).name+="_instance_"+r}else t=e;return void 0!==d.weights&&t.traverse((function(e){if(e.isMesh)for(var i=0,t=d.weights.length;i<t;i++)e.morphTargetInfluences[i]=d.weights[i]})),t}))),void 0!==d.camera&&t.push(l.getDependency("camera",d.camera)),d.extensions&&d.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==d.extensions[r.KHR_LIGHTS_PUNCTUAL].light&&t.push(l.getDependency("light",d.extensions[r.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===d.isBone?new Bone:e.length>1?new Group:1===e.length?e[0]:new Object3D)!==e[0])for(var i=0,r=e.length;i<r;i++)t.add(e[i]);if(void 0!==d.name&&(t.userData.name=d.name,t.name=PropertyBinding.sanitizeNodeName(d.name)),j(t,d),d.extensions&&z(o,t,d),void 0!==d.matrix){var n=new Matrix4;n.fromArray(d.matrix),t.applyMatrix4(n)}else void 0!==d.translation&&t.position.fromArray(d.translation),void 0!==d.rotation&&t.quaternion.fromArray(d.rotation),void 0!==d.scale&&t.scale.fromArray(d.scale);return t}))},X.prototype.loadScene=function(){function e(t,r,n,o){var l=n.nodes[t];return o.getDependency("node",t).then((function(e){return void 0===l.skin?e:o.getDependency("skin",l.skin).then((function(e){for(var r=[],i=0,n=(t=e).joints.length;i<n;i++)r.push(o.getDependency("node",t.joints[i]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(e.isMesh){for(var n=[],o=[],l=0,c=r.length;l<c;l++){var h=r[l];if(h){n.push(h);var d=new Matrix4;void 0!==t.inverseBindMatrices&&d.fromArray(t.inverseBindMatrices.array,16*l),o.push(d)}else console.warn('GLTFLoader: Joint "%s" could not be found.',t.joints[l])}e.bind(new Skeleton(n,o),e.matrixWorld)}})),e}));var t})).then((function(t){r.add(t);var c=[];if(l.children)for(var h=l.children,i=0,d=h.length;i<d;i++){var f=h[i];c.push(e(f,t,n,o))}return Promise.all(c)}))}return function(t){var r=this.json,n=this.extensions,o=this.json.scenes[t],l=new Scene;void 0!==o.name&&(l.name=o.name),j(l,o),o.extensions&&z(n,l,o);for(var c=o.nodes||[],h=[],i=0,d=c.length;i<d;i++)h.push(e(c[i],l,r,this));return Promise.all(h).then((function(){return l}))}}(),e}();function CubeTexture(e,t,r,n,o,l,c,h,d,f){e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,c=void 0!==c?c:RGBFormat,Texture.call(this,e,t,r,n,o,l,c,h,d,f),this.flipY=!1}CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var RGBELoader=function(e){DataTextureLoader.call(this,e),this.type=UnsignedByteType};RGBELoader.prototype=Object.assign(Object.create(DataTextureLoader.prototype),{constructor:RGBELoader,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var p=e.pos,i=-1,n=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(p,p+128)));0>(i=o.indexOf("\n"))&&n<t&&p<e.byteLength;)s+=o,n+=o.length,p+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(p,p+128)));return-1<i&&(!1!==r&&(e.pos+=n+i+1),s+o.slice(0,i))},n=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],o=n>>16&32768,l=n>>12&2047,c=n>>23&255;return c<103?o:c>142?(o|=31744,o|=(255==c?0:1)&&8388607&n):c<113?o|=((l|=2048)>>114-c)+(l>>113-c&1):(o|=c-112<<10|l>>1,o+=1&l)}return function(e,t,n,o){var l=e[t+3],c=Math.pow(2,l-128)/255;n[o+0]=r(e[t+0]*c),n[o+1]=r(e[t+1]*c),n[o+2]=r(e[t+2]*c)}}(),o=new Uint8Array(e);o.pos=0;var l,c,h,d,f,m,v=function(e){var line,n,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,c=/^\s*FORMAT=(\S+)\s*$/,h=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,header={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(line=r(e)))return t(1,"no header found");if(!(n=line.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(header.valid|=1,header.programtype=n[1],header.string+=line+"\n";!1!==(line=r(e));)if(header.string+=line+"\n","#"!==line.charAt(0)){if((n=line.match(o))&&(header.gamma=parseFloat(n[1],10)),(n=line.match(l))&&(header.exposure=parseFloat(n[1],10)),(n=line.match(c))&&(header.valid|=2,header.format=n[1]),(n=line.match(h))&&(header.valid|=4,header.height=parseInt(n[1],10),header.width=parseInt(n[2],10)),2&header.valid&&4&header.valid)break}else header.comments+=line+"\n";return 2&header.valid?4&header.valid?header:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==v){var y=v.width,x=v.height,_=function(e,r,n){var o,l,c,h,d,f,m,v,i,y,x,_,M,w=r,S=n;if(w<8||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(o=new Uint8Array(4*r*n))||!o.length)return t(4,"unable to allocate buffer space");for(l=0,c=0,v=4*w,M=new Uint8Array(4),f=new Uint8Array(v);S>0&&c<e.byteLength;){if(c+4>e.byteLength)return t(1);if(M[0]=e[c++],M[1]=e[c++],M[2]=e[c++],M[3]=e[c++],2!=M[0]||2!=M[1]||(M[2]<<8|M[3])!=w)return t(3,"bad rgbe scanline format");for(m=0;m<v&&c<e.byteLength;){if((_=(h=e[c++])>128)&&(h-=128),0===h||m+h>v)return t(3,"bad scanline data");if(_)for(d=e[c++],i=0;i<h;i++)f[m++]=d;else f.set(e.subarray(c,c+h),m),m+=h,c+=h}for(y=w,i=0;i<y;i++)x=0,o[l]=f[i+x],x+=w,o[l+1]=f[i+x],x+=w,o[l+2]=f[i+x],x+=w,o[l+3]=f[i+x],l+=4;S--}return o}(o.subarray(o.pos),y,x);if(-1!==_){switch(this.type){case UnsignedByteType:var data=_,M=RGBEFormat,w=UnsignedByteType;break;case FloatType:for(var S=_.length/4*3,A=new Float32Array(S),T=0;T<S;T++)h=A,d=3*T,f=void 0,m=void 0,f=(l=_)[(c=4*T)+3],m=Math.pow(2,f-128)/255,h[d+0]=l[c+0]*m,h[d+1]=l[c+1]*m,h[d+2]=l[c+2]*m;data=A,M=RGBFormat,w=FloatType;break;case HalfFloatType:S=_.length/4*3;var L=new Uint16Array(S);for(T=0;T<S;T++)n(_,4*T,L,3*T);data=L,M=RGBFormat,w=HalfFloatType;break;default:console.error("RGBELoader: unsupported type: ",this.type)}return{width:y,height:x,data:data,header:v.string,gamma:v.gamma,exposure:v.exposure,format:M,type:w}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,r,n){return DataTextureLoader.prototype.load.call(this,e,(function(e,r){switch(e.type){case UnsignedByteType:e.encoding=RGBEEncoding,e.minFilter=NearestFilter,e.magFilter=NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case FloatType:case HalfFloatType:e.encoding=LinearEncoding,e.minFilter=LinearFilter,e.magFilter=LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,n)}});var HDRCubeTextureLoader=function(e){Loader.call(this,e),this.hdrLoader=new RGBELoader,this.type=UnsignedByteType};HDRCubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:HDRCubeTextureLoader,load:function(e,t,r,n){Array.isArray(e)||(console.warn("HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=r,r=n,n=arguments[4]);var o=new CubeTexture;switch(o.type=this.type,o.type){case UnsignedByteType:o.encoding=RGBEEncoding,o.format=RGBAFormat,o.minFilter=NearestFilter,o.magFilter=NearestFilter,o.generateMipmaps=!1;break;case FloatType:case HalfFloatType:o.encoding=LinearEncoding,o.format=RGBFormat,o.minFilter=LinearFilter,o.magFilter=LinearFilter,o.generateMipmaps=!1}var l=this,c=0;function h(i,t,r,n){new FileLoader(l.manager).setPath(l.path).setResponseType("arraybuffer").load(e[i],(function(e){c++;var r=l.hdrLoader.parse(e);if(r){if(void 0!==r.data){var n=new DataTexture(r.data,r.width,r.height);n.type=o.type,n.encoding=o.encoding,n.format=o.format,n.minFilter=o.minFilter,n.magFilter=o.magFilter,n.generateMipmaps=o.generateMipmaps,o.images[i]=n}6===c&&(o.needsUpdate=!0,t&&t(o))}}),r,n)}for(var i=0;i<e.length;i++)h(i,t,r,n);return o},setDataType:function(e){return this.type=e,this.hdrLoader.setDataType(e),this}});var KMZLoader=function(e){Loader.call(this,e)};KMZLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:KMZLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(data){var e=new LoadingManager;e.setURLModifier((function(e){var image=function(e){for(var path in t.files)if(path.substr(-e.length)===e)return t.files[path]}(e);if(image){console.log("Loading",e);var r=new Blob([image.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e}));var t=new JSZip(data);if(t.files["doc.kml"]){var r=(new DOMParser).parseFromString(t.files["doc.kml"].asText(),"application/xml").querySelector("Placemark Model Link href");if(r)return new ColladaLoader(e).parse(t.files[r.textContent].asText())}else for(var path in console.warn("KMZLoader: Missing doc.kml file."),t.files){if("dae"===path.split(".").pop().toLowerCase())return new ColladaLoader(e).parse(t.files[path].asText())}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Group}}});var KTXLoader=function(e){CompressedTextureLoader.call(this,e)};KTXLoader.prototype=Object.assign(Object.create(CompressedTextureLoader.prototype),{constructor:KTXLoader,parse:function(e,t){var r=new KhronosTextureContainer(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}}});var KhronosTextureContainer=function(){function e(t,r){this.arrayBuffer=t;var n=new Uint8Array(this.arrayBuffer,0,12);if(171===n[0]&&75===n[1]&&84===n[2]&&88===n[3]&&32===n[4]&&49===n[5]&&49===n[6]&&187===n[7]&&13===n[8]&&10===n[9]&&26===n[10]&&10===n[11]){var o=Uint32Array.BYTES_PER_ELEMENT,l=new DataView(this.arrayBuffer,12,13*o),c=67305985===l.getUint32(0,!0);this.glType=l.getUint32(1*o,c),this.glTypeSize=l.getUint32(2*o,c),this.glFormat=l.getUint32(3*o,c),this.glInternalFormat=l.getUint32(4*o,c),this.glBaseInternalFormat=l.getUint32(5*o,c),this.pixelWidth=l.getUint32(6*o,c),this.pixelHeight=l.getUint32(7*o,c),this.pixelDepth=l.getUint32(8*o,c),this.numberOfArrayElements=l.getUint32(9*o,c),this.numberOfFaces=l.getUint32(10*o,c),this.numberOfMipmapLevels=l.getUint32(11*o,c),this.bytesOfKeyValueData=l.getUint32(12*o,c),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===r?this.loadType=e.COMPRESSED_2D:console.warn("number of faces expected"+r+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return e.prototype.mipmaps=function(t){for(var r=[],n=e.HEADER_LEN+this.bytesOfKeyValueData,o=this.pixelWidth,l=this.pixelHeight,c=t?this.numberOfMipmapLevels:1,h=0;h<c;h++){var d=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(var f=0;f<this.numberOfFaces;f++){var m=new Uint8Array(this.arrayBuffer,n,d);r.push({data:m,width:o,height:l}),n+=d,n+=3-(d+3)%4}o=Math.max(1,.5*o),l=Math.max(1,.5*l)}return r},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),LDrawLoader=function(){var e=new Vector3,t=new Vector3;function r(e){return/primitive/i.test(e)||"Subpart"===e}function n(line,e){this.line=line,this.lineLength=line.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=e}function o(a,b){return a.colourCode===b.colourCode?0:a.colourCode<b.colourCode?-1:1}function l(e,t,r){e.sort(o);for(var n=[],l=[],c=[],h=new BufferGeometry,d=null,f=0,m=0,v=0,y=e.length;v<y;v++){var x=e[v],_=x.v0,M=x.v1;if(n.push(_.x,_.y,_.z,M.x,M.y,M.z),3===t){n.push(x.v2.x,x.v2.y,x.v2.z);var w=x.n0||x.faceNormal,S=x.n1||x.faceNormal,A=x.n2||x.faceNormal;l.push(w.x,w.y,w.z),l.push(S.x,S.y,S.z),l.push(A.x,A.y,A.z)}d!==x.material?(null!==d&&h.addGroup(f,m,c.length-1),c.push(x.material),d=x.material,f=v*t,m=t):m+=t}m>0&&h.addGroup(f,1/0,c.length-1),h.setAttribute("position",new Float32BufferAttribute(n,3)),3===t&&h.setAttribute("normal",new Float32BufferAttribute(l,3));var T=null;if(2===t?T=new LineSegments(h,c):3===t&&(T=new Mesh(h,c)),r){T.isConditionalLine=!0;for(var L=new Float32Array(3*e.length*2),C=new Float32Array(3*e.length*2),N=new Float32Array(3*e.length*2),i=0,P=e.length;i<P;i++){var F=e[i],E=F.c0,R=F.c1,D=(_=F.v0,M=F.v1,3*i*2);L[D+0]=E.x,L[D+1]=E.y,L[D+2]=E.z,L[D+3]=E.x,L[D+4]=E.y,L[D+5]=E.z,C[D+0]=R.x,C[D+1]=R.y,C[D+2]=R.z,C[D+3]=R.x,C[D+4]=R.y,C[D+5]=R.z,N[D+0]=M.x-_.x,N[D+1]=M.y-_.y,N[D+2]=M.z-_.z,N[D+3]=M.x-_.x,N[D+4]=M.y-_.y,N[D+5]=M.z-_.z}h.setAttribute("control0",new BufferAttribute(L,3,!1)),h.setAttribute("control1",new BufferAttribute(C,3,!1)),h.setAttribute("direction",new BufferAttribute(N,3,!1))}return T}function c(e){Loader.call(this,e),this.parseScopesStack=null,this.materials=[],this.subobjectCache={},this.fileMap=null,this.setMaterials([this.parseColourMetaDirective(new n("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333")),this.parseColourMetaDirective(new n("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))]),this.separateObjects=!1,this.smoothNormals=!0}return n.prototype={constructor:n,seekNonSpace:function(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar)return;this.currentCharIndex++}},getToken:function(){for(var e=this.currentCharIndex++;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar);)this.currentCharIndex++;var t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)},getRemainingString:function(){return this.line.substring(this.currentCharIndex,this.lineLength)},isAtTheEnd:function(){return this.currentCharIndex>=this.lineLength},setToEnd:function(){this.currentCharIndex=this.lineLength},getLineNumberString:function(){return this.lineNumber>=0?" at line "+this.lineNumber:""}},c.FINISH_TYPE_DEFAULT=0,c.FINISH_TYPE_CHROME=1,c.FINISH_TYPE_PEARLESCENT=2,c.FINISH_TYPE_RUBBER=3,c.FINISH_TYPE_MATTE_METALLIC=4,c.FINISH_TYPE_METAL=5,c.FILE_LOCATION_AS_IS=0,c.FILE_LOCATION_TRY_PARTS=1,c.FILE_LOCATION_TRY_P=2,c.FILE_LOCATION_TRY_MODELS=3,c.FILE_LOCATION_TRY_RELATIVE=4,c.FILE_LOCATION_TRY_ABSOLUTE=5,c.FILE_LOCATION_NOT_FOUND=6,c.prototype=Object.assign(Object.create(Loader.prototype),{constructor:c,load:function(e,t,r,n){this.fileMap||(this.fileMap={});var o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.load(e,(function(text){o.processObject(text,t,null,e)}),r,n)},parse:function(text,path,e){this.processObject(text,e,null,path)},setMaterials:function(e){return this.parseScopesStack=[],this.newParseScopeLevel(e),this.getCurrentParseScope().isFromParse=!1,this.materials=e,this},setFileMap:function(e){return this.fileMap=e,this},newParseScopeLevel:function(e){var t={};if(e)for(var i=0,r=e.length;i<r;i++){var n=e[i];t[n.userData.code]=n}var o=this.getCurrentParseScope(),l={lib:t,url:null,subobjects:null,numSubobjects:0,subobjectIndex:0,inverted:!1,category:null,keywords:null,currentFileName:null,mainColourCode:o?o.mainColourCode:"16",mainEdgeColourCode:o?o.mainEdgeColourCode:"24",currentMatrix:new Matrix4,matrix:new Matrix4,isFromParse:!0,triangles:null,lineSegments:null,conditionalSegments:null,startingConstructionStep:!1};return this.parseScopesStack.push(l),l},removeScopeLevel:function(){return this.parseScopesStack.pop(),this},addMaterial:function(e){var t=this.getCurrentParseScope().lib;return t[e.userData.code]||this.materials.push(e),t[e.userData.code]=e,this},getMaterial:function(e){if(e.startsWith("0x2")){var t=e.substring(3);return this.parseColourMetaDirective(new n("Direct_Color_"+t+" CODE -1 VALUE #"+t+" EDGE #"+t))}for(var i=this.parseScopesStack.length-1;i>=0;i--){var r=this.parseScopesStack[i].lib[e];if(r)return r}return null},getParentParseScope:function(){return this.parseScopesStack.length>1?this.parseScopesStack[this.parseScopesStack.length-2]:null},getCurrentParseScope:function(){return this.parseScopesStack.length>0?this.parseScopesStack[this.parseScopesStack.length-1]:null},parseColourMetaDirective:function(e){var code=null,t=16711935,r=16711935,o=1,l=!1,h=0,d=c.FINISH_TYPE_DEFAULT,f=!0,m=null,v=e.getToken();if(!v)throw'LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".";for(var y=null;y=e.getToken();)switch(y.toUpperCase()){case"CODE":code=e.getToken();break;case"VALUE":if((t=e.getToken()).startsWith("0x"))t="#"+t.substring(2);else if(!t.startsWith("#"))throw"LDrawLoader: Invalid colour while parsing material"+e.getLineNumberString()+".";break;case"EDGE":if((r=e.getToken()).startsWith("0x"))r="#"+r.substring(2);else if(!r.startsWith("#")){if(!(m=this.getMaterial(r)))throw"LDrawLoader: Invalid edge colour while parsing material"+e.getLineNumberString()+".";m=m.userData.edgeMaterial}break;case"ALPHA":if(o=parseInt(e.getToken()),isNaN(o))throw"LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".";(o=Math.max(0,Math.min(1,o/255)))<1&&(l=!0);break;case"LUMINANCE":if(h=parseInt(e.getToken()),isNaN(h))throw"LDrawLoader: Invalid luminance value in material definition"+n.getLineNumberString()+".";h=Math.max(0,Math.min(1,h/255));break;case"CHROME":d=c.FINISH_TYPE_CHROME;break;case"PEARLESCENT":d=c.FINISH_TYPE_PEARLESCENT;break;case"RUBBER":d=c.FINISH_TYPE_RUBBER;break;case"MATTE_METALLIC":d=c.FINISH_TYPE_MATTE_METALLIC;break;case"METAL":d=c.FINISH_TYPE_METAL;break;case"MATERIAL":e.setToEnd();break;default:throw'LDrawLoader: Unknown token "'+y+'" while parsing material'+e.getLineNumberString()+"."}var x=null;switch(d){case c.FINISH_TYPE_DEFAULT:x=new MeshStandardMaterial({color:t,roughness:.3,envMapIntensity:.3,metalness:0});break;case c.FINISH_TYPE_PEARLESCENT:var _=new Color(t),M=_.getHSL({h:0,s:0,l:0});M.h=(M.h+.5)%1,M.l=Math.min(1,M.l+.7*(1-M.l)),_.setHSL(M.h,M.s,M.l),x=new MeshPhongMaterial({color:t,specular:_,shininess:10,reflectivity:.3});break;case c.FINISH_TYPE_CHROME:x=new MeshStandardMaterial({color:t,roughness:0,metalness:1});break;case c.FINISH_TYPE_RUBBER:x=new MeshStandardMaterial({color:t,roughness:.9,metalness:0}),f=!1;break;case c.FINISH_TYPE_MATTE_METALLIC:x=new MeshStandardMaterial({color:t,roughness:.8,metalness:.4});break;case c.FINISH_TYPE_METAL:x=new MeshStandardMaterial({color:t,roughness:.2,metalness:.85})}return x.transparent=l,x.premultipliedAlpha=!0,x.opacity=o,x.depthWrite=!l,x.polygonOffset=!0,x.polygonOffsetFactor=1,x.userData.canHaveEnvMap=f,0!==h&&x.emissive.set(x.color).multiplyScalar(h),m||((m=new LineBasicMaterial({color:r,transparent:l,opacity:o,depthWrite:!l})).userData.code=code,m.name=v+" - Edge",m.userData.canHaveEnvMap=!1,m.userData.conditionalEdgeMaterial=new ShaderMaterial({vertexShader:"\n\tattribute vec3 control0;\n\tattribute vec3 control1;\n\tattribute vec3 direction;\n\tvarying float discardFlag;\n\n\t#include <common>\n\t#include <color_pars_vertex>\n\t#include <fog_pars_vertex>\n\t#include <logdepthbuf_pars_vertex>\n\t#include <clipping_planes_pars_vertex>\n\tvoid main() {\n\t\t#include <color_vertex>\n\n\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t// Transform the line segment ends and control points into camera clip space\n\t\tvec4 c0 = projectionMatrix * modelViewMatrix * vec4( control0, 1.0 );\n\t\tvec4 c1 = projectionMatrix * modelViewMatrix * vec4( control1, 1.0 );\n\t\tvec4 p0 = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\tvec4 p1 = projectionMatrix * modelViewMatrix * vec4( position + direction, 1.0 );\n\n\t\tc0.xy /= c0.w;\n\t\tc1.xy /= c1.w;\n\t\tp0.xy /= p0.w;\n\t\tp1.xy /= p1.w;\n\n\t\t// Get the direction of the segment and an orthogonal vector\n\t\tvec2 dir = p1.xy - p0.xy;\n\t\tvec2 norm = vec2( -dir.y, dir.x );\n\n\t\t// Get control point directions from the line\n\t\tvec2 c0dir = c0.xy - p1.xy;\n\t\tvec2 c1dir = c1.xy - p1.xy;\n\n\t\t// If the vectors to the controls points are pointed in different directions away\n\t\t// from the line segment then the line should not be drawn.\n\t\tfloat d0 = dot( normalize( norm ), normalize( c0dir ) );\n\t\tfloat d1 = dot( normalize( norm ), normalize( c1dir ) );\n\t\tdiscardFlag = float( sign( d0 ) != sign( d1 ) );\n\n\t\t#include <logdepthbuf_vertex>\n\t\t#include <clipping_planes_vertex>\n\t\t#include <fog_vertex>\n\t}\n\t",fragmentShader:"\n\tuniform vec3 diffuse;\n\tuniform float opacity;\n\tvarying float discardFlag;\n\n\t#include <common>\n\t#include <color_pars_fragment>\n\t#include <fog_pars_fragment>\n\t#include <logdepthbuf_pars_fragment>\n\t#include <clipping_planes_pars_fragment>\n\tvoid main() {\n\n\t\tif ( discardFlag > 0.5 ) discard;\n\n\t\t#include <clipping_planes_fragment>\n\t\tvec3 outgoingLight = vec3( 0.0 );\n\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t#include <logdepthbuf_fragment>\n\t\t#include <color_fragment>\n\t\toutgoingLight = diffuseColor.rgb; // simple shader\n\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t\t#include <tonemapping_fragment>\n\t\t#include <encodings_fragment>\n\t\t#include <fog_fragment>\n\t\t#include <premultiplied_alpha_fragment>\n\t}\n\t",uniforms:{diffuse:{value:new Color(r)},opacity:{value:o}},transparent:l,depthWrite:!l}),m.userData.conditionalEdgeMaterial.userData.canHaveEnvMap=!1),x.userData.code=code,x.name=v,x.userData.edgeMaterial=m,x},objectParse:function(text){var o,l,h,d=this.getParentParseScope(),f=d.mainColourCode,m=d.mainEdgeColourCode,v=this.getCurrentParseScope(),y=[],x=null,_=null;-1!==text.indexOf("\r\n")&&(text=text.replace(/\r\n/g,"\n"));var M=text.split("\n"),w=M.length,S=0,A=!1,T=null,L=null,C=!1,N=!0,P=!1,F=!0,E="",R=!1,D=this;function O(e,t){var r=e.getToken();t||"16"!==r||(r=f),t&&"24"===r&&(r=m);var n=D.getMaterial(r);if(!n)throw'LDrawLoader: Unknown colour code "'+r+'" is used'+e.getLineNumberString()+" but it was not defined previously.";return n}function I(e){var t=new Vector3(parseFloat(e.getToken()),parseFloat(e.getToken()),parseFloat(e.getToken()));return D.separateObjects||t.applyMatrix4(v.currentMatrix),t}for(S=0;S<w;S++){var line=M[S];if(0!==line.length)if(A)line.startsWith("0 FILE ")?(this.subobjectCache[T.toLowerCase()]=L,T=line.substring(7),L=""):L+=line+"\n";else{var B=new n(line,S+1);if(B.seekNonSpace(),!B.isAtTheEnd()){var U=B.getToken();switch(U){case"0":var meta=B.getToken();if(meta)switch(meta){case"!LDRAW_ORG":if(E=B.getToken(),!A)v.triangles=[],v.lineSegments=[],v.conditionalSegments=[],v.type=E,(!d.isFromParse||D.separateObjects&&!r(E))&&(v.groupObject=new Group,v.groupObject.userData.startingConstructionStep=v.startingConstructionStep),(te=v.matrix).determinant()<0&&(D.separateObjects&&r(E)||!D.separateObjects)&&(v.inverted=!v.inverted),o=v.triangles,l=v.lineSegments,h=v.conditionalSegments;break;case"!COLOUR":(G=this.parseColourMetaDirective(B))?this.addMaterial(G):console.warn("LDrawLoader: Error parsing material"+B.getLineNumberString());break;case"!CATEGORY":x=B.getToken();break;case"!KEYWORDS":var k=B.getRemainingString().split(",");k.length>0&&(_||(_=[]),k.forEach((function(e){_.push(e.trim())})));break;case"FILE":S>0&&(A=!0,T=B.getRemainingString(),L="",C=!1,N=!0);break;case"BFC":for(;!B.isAtTheEnd();){var V=B.getToken();switch(V){case"CERTIFY":case"NOCERTIFY":C="CERTIFY"===V,N=!0;break;case"CW":case"CCW":N="CCW"===V;break;case"INVERTNEXT":P=!0;break;case"CLIP":case"NOCLIP":F="CLIP"===V;break;default:console.warn('LDrawLoader: BFC directive "'+V+'" is unknown.')}}break;case"STEP":R=!0}break;case"1":var G=O(B),z=parseFloat(B.getToken()),j=parseFloat(B.getToken()),W=parseFloat(B.getToken()),H=parseFloat(B.getToken()),X=parseFloat(B.getToken()),Y=parseFloat(B.getToken()),Q=parseFloat(B.getToken()),K=parseFloat(B.getToken()),J=parseFloat(B.getToken()),Z=parseFloat(B.getToken()),$=parseFloat(B.getToken()),ee=parseFloat(B.getToken()),te=(new Matrix4).set(H,X,Y,z,Q,K,J,j,Z,$,ee,W,0,0,0,1),re=B.getRemainingString().trim().replace(/\\/g,"/");D.fileMap[re]?re=D.fileMap[re]:re.startsWith("s/")?re="parts/"+re:re.startsWith("48/")&&(re="p/"+re),y.push({material:G,matrix:te,fileName:re,originalFileName:re,locationState:c.FILE_LOCATION_AS_IS,url:null,triedLowerCase:!1,inverted:P!==v.inverted,startingConstructionStep:R}),P=!1;break;case"2":var ie={material:(G=O(B,!0)).userData.edgeMaterial,colourCode:G.userData.code,v0:I(B),v1:I(B)};l.push(ie);break;case"5":ie={material:(G=O(B,!0)).userData.edgeMaterial.userData.conditionalEdgeMaterial,colourCode:G.userData.code,v0:I(B),v1:I(B),c0:I(B),c1:I(B)};h.push(ie);break;case"3":G=O(B);var ne=!C||!F;!0===(N!==v.inverted)?(ae=I(B),oe=I(B),se=I(B)):(se=I(B),oe=I(B),ae=I(B)),e.subVectors(oe,ae),t.subVectors(se,oe),ce=(new Vector3).crossVectors(e,t).normalize(),o.push({material:G,colourCode:G.userData.code,v0:ae,v1:oe,v2:se,faceNormal:ce,n0:null,n1:null,n2:null}),!0===ne&&o.push({material:G,colourCode:G.userData.code,v0:ae,v1:se,v2:oe,faceNormal:ce,n0:null,n1:null,n2:null});break;case"4":var ae,oe,se,le,ce;G=O(B),ne=!C||!F;!0===(N!==v.inverted)?(ae=I(B),oe=I(B),se=I(B),le=I(B)):(le=I(B),se=I(B),oe=I(B),ae=I(B)),e.subVectors(oe,ae),t.subVectors(se,oe),ce=(new Vector3).crossVectors(e,t).normalize(),o.push({material:G,colourCode:G.userData.code,v0:ae,v1:oe,v2:se,faceNormal:ce,n0:null,n1:null,n2:null}),o.push({material:G,colourCode:G.userData.code,v0:ae,v1:se,v2:le,faceNormal:ce,n0:null,n1:null,n2:null}),!0===ne&&(o.push({material:G,colourCode:G.userData.code,v0:ae,v1:se,v2:oe,faceNormal:ce,n0:null,n1:null,n2:null}),o.push({material:G,colourCode:G.userData.code,v0:ae,v1:le,v2:se,faceNormal:ce,n0:null,n1:null,n2:null}));break;default:throw'LDrawLoader: Unknown line type "'+U+'"'+B.getLineNumberString()+"."}}}}A&&(this.subobjectCache[T.toLowerCase()]=L),v.category=x,v.keywords=_,v.subobjects=y,v.numSubobjects=y.length,v.subobjectIndex=0},computeConstructionSteps:function(e){var t=0;e.traverse((function(e){e.isGroup&&(e.userData.startingConstructionStep&&t++,e.userData.constructionStep=t)})),e.userData.numConstructionSteps=t+1},processObject:function(text,n,o,h){var d=this,f=d.newParseScopeLevel();f.url=h;var m=d.getParentParseScope();o&&(f.currentMatrix.multiplyMatrices(m.currentMatrix,o.matrix),f.matrix.copy(o.matrix),f.inverted=o.inverted,f.startingConstructionStep=o.startingConstructionStep);var v=m.currentFileName;null!==v&&(v=m.currentFileName.toLowerCase()),void 0===d.subobjectCache[v]&&(d.subobjectCache[v]=text),d.objectParse(text);var y=0;function x(){if(++y===f.subobjects.length+1)!function(){d.smoothNormals&&"Part"===f.type&&function(e,t){function r(e){return~~(100*e.x)+","+~~(100*e.y)+","+~~(100*e.z)}function n(e,t){return r(e)+"_"+r(t)}for(var o=new Set,l={},c={},h=[],i=0,d=t.length;i<d;i++){var f=t[i],m=f.v0,v=f.v1;o.add(n(m,v)),o.add(n(v,m))}for(i=0,d=e.length;i<d;i++)for(var y=e[i],x=0,_=3;x<_;x++){var M=(x+1)%3,w=n(m=y["v"+(L=x)],v=y["v"+M]);o.has(w)||(l[w]=y,c[w]=y)}for(;;){var S=Object.keys(l);if(0===S.length)break;i=0;for(var A=[c[S[0]]];i<A.length;){y=A[i];i++;var T=y.faceNormal;null===y.n0&&(y.n0=T.clone(),h.push(y.n0)),null===y.n1&&(y.n1=T.clone(),h.push(y.n1)),null===y.n2&&(y.n2=T.clone(),h.push(y.n2));for(x=0,_=3;x<_;x++){var L;M=(x+1)%3;delete l[w=n(m=y["v"+(L=x)],v=y["v"+M])];var C=n(v,m),N=c[C];if(N){if(Math.abs(N.faceNormal.dot(y.faceNormal))<.25)continue;C in l&&(A.push(N),delete l[C]);for(var P=0;P<3;P++){var F=P,E=(P+1)%3;if(n(N["v"+F],N["v"+E])===C){if(null===N["n"+F]){var R=y["n"+M];N["n"+F]=R,R.add(N.faceNormal)}if(null===N["n"+E]){R=y["n"+L];N["n"+E]=R,R.add(N.faceNormal)}break}}}}}}for(i=0,d=h.length;i<d;i++)h[i].normalize()}(f.triangles,f.lineSegments);var o=!m.isFromParse;if(d.separateObjects&&!r(f.type)||o){var c=f.groupObject;f.triangles.length>0&&c.add(l(f.triangles,3)),f.lineSegments.length>0&&c.add(l(f.lineSegments,2)),f.conditionalSegments.length>0&&c.add(l(f.conditionalSegments,2,!0)),m.groupObject&&(c.name=f.fileName,c.userData.category=f.category,c.userData.keywords=f.keywords,f.matrix.decompose(c.position,c.quaternion,c.scale),m.groupObject.add(c))}else{for(var h=d.separateObjects,v=m.lineSegments,y=m.conditionalSegments,x=m.triangles,_=f.lineSegments,M=f.conditionalSegments,w=f.triangles,i=0,S=_.length;i<S;i++){var A=_[i];h&&(A.v0.applyMatrix4(f.matrix),A.v1.applyMatrix4(f.matrix)),v.push(A)}for(i=0,S=M.length;i<S;i++){var T=M[i];h&&(T.v0.applyMatrix4(f.matrix),T.v1.applyMatrix4(f.matrix),T.c0.applyMatrix4(f.matrix),T.c1.applyMatrix4(f.matrix)),y.push(T)}for(i=0,S=w.length;i<S;i++){var L=w[i];h&&(L.v0=L.v0.clone().applyMatrix4(f.matrix),L.v1=L.v1.clone().applyMatrix4(f.matrix),L.v2=L.v2.clone().applyMatrix4(f.matrix),e.subVectors(L.v1,L.v0),t.subVectors(L.v2,L.v1),L.faceNormal.crossVectors(e,t).normalize()),x.push(L)}}d.removeScopeLevel(),m.isFromParse||d.computeConstructionSteps(f.groupObject);n&&n(f.groupObject)}();else{var o=f.subobjects[f.subobjectIndex];Promise.resolve().then((function(){_(o)})),f.subobjectIndex++}}function _(e){f.mainColourCode=e.material.userData.code,f.mainEdgeColourCode=e.material.userData.edgeMaterial.userData.code,f.currentFileName=e.originalFileName;var t=d.subobjectCache[e.originalFileName.toLowerCase()];if(t)d.processObject(t,(function(t){M(t,e),x()}),e,h);else{var r=e.fileName,n=c.FILE_LOCATION_NOT_FOUND;switch(e.locationState){case c.FILE_LOCATION_AS_IS:n=e.locationState+1;break;case c.FILE_LOCATION_TRY_PARTS:r="parts/"+r,n=e.locationState+1;break;case c.FILE_LOCATION_TRY_P:r="p/"+r,n=e.locationState+1;break;case c.FILE_LOCATION_TRY_MODELS:r="models/"+r,n=e.locationState+1;break;case c.FILE_LOCATION_TRY_RELATIVE:r=h.substring(0,h.lastIndexOf("/")+1)+r,n=e.locationState+1;break;case c.FILE_LOCATION_TRY_ABSOLUTE:e.triedLowerCase?n=c.FILE_LOCATION_NOT_FOUND:(e.fileName=e.fileName.toLowerCase(),r=e.fileName,e.triedLowerCase=!0,n=c.FILE_LOCATION_AS_IS);break;case c.FILE_LOCATION_NOT_FOUND:return void console.warn('LDrawLoader: Subobject "'+e.originalFileName+'" could not be found.')}e.locationState=n,e.url=r;var o=new FileLoader(d.manager);o.setPath(d.path),o.load(r,(function(text){d.processObject(text,(function(t){M(t,e),x()}),e,h)}),void 0,(function(t){!function(e,t){_(t)}(0,e)}),e)}}function M(e,t){null!==e?d.fileMap[t.originalFileName]=t.url:_(t)}x()}}),c}(),lwoTree;function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function LWO2Parser(e){this.IFF=e}function LWO3Parser(e){this.IFF=e}function IFFParser(){this.debugger=new Debugger}function DataViewReader(e){this.dv=new DataView(e),this.offset=0}function Debugger(){this.active=!1,this.depth=0,this.formList=[]}function isEven(e){return e%2}function stringOffset(e){return e.length+1+(isEven(e.length+1)?1:0)}function printBuffer(e,t,r){console.log(LoaderUtils.decodeText(new Uint8Array(e,t,r)))}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(source){return MeshStandardMaterial.prototype.copy.call(this,source),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=source.reflectivity,this.clearcoat=source.clearcoat,this.clearcoatRoughness=source.clearcoatRoughness,source.sheen?this.sheen=(this.sheen||new Color).copy(source.sheen):this.sheen=null,this.clearcoatNormalMap=source.clearcoatNormalMap,this.clearcoatNormalScale.copy(source.clearcoatNormalScale),this.transparency=source.transparency,this},LWO2Parser.prototype={constructor:LWO2Parser,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},LWO3Parser.prototype={constructor:LWO3Parser,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},IFFParser.prototype={constructor:IFFParser,parse:function(e){if(this.reader=new DataViewReader(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new LWO2Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new LWO3Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm:function(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();("LWO2"===t||"LWO3"===t)&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm:function(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm:function(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm:function(e){this.reader.skip(e-4)},parseUnknownForm:function(e,t){console.warn("LWOLoader: unknown FORM encountered: "+e,t),printBuffer(this.reader.dv.buffer,this.reader.offset,t-4),this.reader.skip(t-4)},parseSurfaceForm:function(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2:function(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode:function(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections:function(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm:function(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm:function(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm:function(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap:function(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var map={};this.currentForm.maps.push(map),this.currentForm=map,this.reader.skip(10)},parseTextureNodeAttribute:function(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope:function(e){this.reader.skip(e-4)},parseClip:function(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2:function(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),n=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(n>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage:function(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL:function(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3:function(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag:function(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer:function(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+stringOffset(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints:function(e){this.currentPoints=[];for(var i=0;i<e/4;i+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping:function(e,t){var r=this.reader.offset+e,n=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-stringOffset(n));var o=this.reader.getIDTag();this.reader.getUint16();var l=this.reader.getString(),c=e-6-stringOffset(l);switch(o){case"TXUV":this.parseUVMapping(l,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(l,r,o);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(c);break;default:console.warn("LWOLoader: unknown vertex map type: "+o),this.reader.skip(c)}}else this.currentForm.UVChannel=n},parseUVMapping:function(e,t,r){for(var n=[],o=[],l=[];this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),r&&o.push(this.reader.getVariableLengthIndex()),l.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:n,polyIndices:o,uvs:l}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:n,uvs:l})},parseMorphTargets:function(e,t,r){var n=[],o=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),o.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:n,points:o,type:r}},parsePolygonList:function(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),n=[],o=[];this.reader.offset<t;){var l=this.reader.getUint16();l&=1023,o.push(l);for(var c=0;c<l;c++)n.push(this.reader.getVariableLengthIndex())}var h={type:r,vertexIndices:n,polygonDimensions:o,points:this.currentPoints};1===o[0]?h.type="points":2===o[0]&&(h.type="lines"),this.currentLayer.geometry=h},parseTagStrings:function(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping:function(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices:function(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK:function(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var data=this.reader.getString(t);this.currentForm[e]=data}},DataViewReader.prototype={constructor:DataViewReader,size:function(){return this.dv.buffer.byteLength},setOffset:function(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getFloat32());return a},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var a=[],i=0;i<e;i++)a.push(this.getFloat64());return a},getVariableLengthIndex:function(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag:function(){return this.getString(4)},getString:function(e){if(0!==e){var a=[];if(e)for(var i=0;i<e;i++)a[i]=this.getUint8();else{for(var t,r=0;0!==t;)0!==(t=this.getUint8())&&a.push(t),r++;isEven(r+1)||this.getUint8()}return LoaderUtils.decodeText(new Uint8Array(a))}},getStringArray:function(e){var a=this.getString(e);return(a=a.split("\0")).filter(Boolean)}},Debugger.prototype={constructor:Debugger,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,"( "+this.offset+" ) -> ( "+(this.dataOffset+this.length)+" )",0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(var i=this.formList.length-1;i>=0;i--)this.offset>=this.formList[i]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};var LWOLoader=function(e,t){Loader.call(this,e),t=t||{},this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""};function LWOTreeParser(e){this.textureLoader=e}function MaterialParser(e){this.textureLoader=e}function GeometryParser(){}function extractParentUrl(e,t){var r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}LWOLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:LWOLoader,load:function(e,t,r,n){var o=this,path=""===o.path?extractParentUrl(e,"Objects"):o.path,l=e.split(path).pop().split(".")[0],c=new FileLoader(this.manager);c.setPath(o.path),c.setResponseType("arraybuffer"),c.load(e,(function(e){t(o.parse(e,path,l))}),r,n)},parse:function(e,path,t){return lwoTree=(new IFFParser).parse(e),new LWOTreeParser(new TextureLoader(this.manager).setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin)).parse(t)}}),LWOTreeParser.prototype={constructor:LWOTreeParser,parse:function(e){return this.materials=new MaterialParser(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}},parseLayers:function(){var e=[],t=[],r=new GeometryParser,n=this;return lwoTree.layers.forEach((function(o){var l=r.parse(o.geometry,o),c=n.parseMesh(l,o);e[o.number]=c,-1===o.parent?t.push(c):e[o.parent].add(c)})),this.applyPivots(t),t},parseMesh:function(e,t){var r,n=this.getMaterials(e.userData.matNames,t.geometry.type);return this.duplicateUVs(e,n),r="points"===t.geometry.type?new Points(e,n):"lines"===t.geometry.type?new LineSegments(e,n):new Mesh(e,n),t.name?r.name=t.name:r.name=this.defaultLayerName+"_layer_"+t.number,r.userData.pivot=t.pivot,r},applyPivots:function(e){e.forEach((function(e){e.traverse((function(e){var t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){var r=e.parent.userData.pivot;e.position.x-=r[0],e.position.y-=r[1],e.position.z-=r[2]}}))}))},getMaterials:function(e,t){var r=[],n=this;e.forEach((function(e,i){r[i]=n.getMaterialByName(e)})),"points"!==t&&"lines"!==t||r.forEach((function(e,i){var n={color:e.color};"points"===t?(n.size=.1,n.map=e.map,n.morphTargets=e.morphTargets,r[i]=new PointsMaterial(n)):"lines"===t&&(r[i]=new LineBasicMaterial(n))}));var o=r.filter(Boolean);return 1===o.length?o[0]:r},getMaterialByName:function(e){return this.materials.filter((function(t){return t.name===e}))[0]},duplicateUVs:function(e,t){var r=!1;Array.isArray(t)?t.forEach((function(e){e.aoMap&&(r=!0)})):t.aoMap&&(r=!0),r&&e.setAttribute("uv2",new BufferAttribute(e.attributes.uv.array,2))}},MaterialParser.prototype={constructor:MaterialParser,parse:function(){var e=[];for(var t in this.textures={},lwoTree.materials)"LWO3"===lwoTree.format?e.push(this.parseMaterial(lwoTree.materials[t],t,lwoTree.textures)):"LWO2"===lwoTree.format&&e.push(this.parseMaterialLwo2(lwoTree.materials[t],t,lwoTree.textures));return e},parseMaterial:function(e,t,r){var n={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},o=this.parseConnections(e.connections,e.nodes),l=this.parseTextureNodes(o.maps);this.parseAttributeImageMaps(o.attributes,r,l,e.maps);var c=this.parseAttributes(o.attributes,l);return this.parseEnvMap(o,l,c),n=Object.assign(l,n),n=Object.assign(n,c),new(this.getMaterialType(o.attributes))(n)},parseMaterialLwo2:function(e,t){var r={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},n=this.parseAttributes(e.attributes,{});return new MeshPhongMaterial(r=Object.assign(r,n))},getSide:function(e){if(!e.side)return BackSide;switch(e.side){case 0:case 1:return BackSide;case 2:return FrontSide;case 3:return DoubleSide}},getSmooth:function(e){return!e.smooth||!e.smooth},parseConnections:function(e,t){var r={maps:{}},n=e.inputName,o=e.inputNodeName,l=e.nodeName,c=this;return n.forEach((function(e,n){if("Material"===e){var l=c.getNodeByRefName(o[n],t);r.attributes=l.attributes,r.envMap=l.fileName,r.name=o[n]}})),l.forEach((function(e,l){e===r.name&&(r.maps[n[l]]=c.getNodeByRefName(o[l],t))})),r},getNodeByRefName:function(e,t){for(var r in t)if(t[r].refName===e)return t[r]},parseTextureNodes:function(e){var t={};for(var r in e){var n=e[r],path=n.fileName;if(!path)return;var o=this.loadTexture(path);switch(void 0!==n.widthWrappingMode&&(o.wrapS=this.getWrappingType(n.widthWrappingMode)),void 0!==n.heightWrappingMode&&(o.wrapT=this.getWrappingType(n.heightWrappingMode)),r){case"Color":t.map=o;break;case"Roughness":t.roughnessMap=o,t.roughness=.5;break;case"Specular":t.specularMap=o,t.specular=16777215;break;case"Luminous":t.emissiveMap=o,t.emissive=8421504;break;case"Luminous Color":t.emissive=8421504;break;case"Metallic":t.metalnessMap=o,t.metalness=.5;break;case"Transparency":case"Alpha":t.alphaMap=o,t.transparent=!0;break;case"Normal":t.normalMap=o,void 0!==n.amplitude&&(t.normalScale=new Vector2(n.amplitude,n.amplitude));break;case"Bump":t.bumpMap=o}}return t.roughnessMap&&t.specularMap&&delete t.specularMap,t},parseAttributeImageMaps:function(e,t,r){for(var n in e){var o=e[n];if(o.maps){var l=o.maps[0],path=this.getTexturePathByIndex(l.imageIndex,t);if(!path)return;var c=this.loadTexture(path);switch(void 0!==l.wrap&&(c.wrapS=this.getWrappingType(l.wrap.w)),void 0!==l.wrap&&(c.wrapT=this.getWrappingType(l.wrap.h)),n){case"Color":r.map=c;break;case"Diffuse":r.aoMap=c;break;case"Roughness":r.roughnessMap=c,r.roughness=1;break;case"Specular":r.specularMap=c,r.specular=16777215;break;case"Luminosity":r.emissiveMap=c,r.emissive=8421504;break;case"Metallic":r.metalnessMap=c,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=c,r.transparent=!0;break;case"Normal":r.normalMap=c;break;case"Bump":r.bumpMap=c}}}},parseAttributes:function(e,t){var r={};return e.Color&&!t.map?r.color=(new Color).fromArray(e.Color.value):r.color=new Color,e.Transparency&&0!==e.Transparency.value&&(r.opacity=1-e.Transparency.value,r.transparent=!0),e["Bump Height"]&&(r.bumpScale=.1*e["Bump Height"].value),e["Refraction Index"]&&(r.refractionRatio=1/e["Refraction Index"].value),this.parsePhysicalAttributes(r,e,t),this.parseStandardAttributes(r,e,t),this.parsePhongAttributes(r,e,t),r},parsePhysicalAttributes:function(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))},parseStandardAttributes:function(e,t,r){t.Luminous&&(e.emissiveIntensity=t.Luminous.value,t["Luminous Color"]&&!r.emissive?e.emissive=(new Color).fromArray(t["Luminous Color"].value):e.emissive=new Color(8421504)),t.Roughness&&!r.roughnessMap&&(e.roughness=t.Roughness.value),t.Metallic&&!r.metalnessMap&&(e.metalness=t.Metallic.value)},parsePhongAttributes:function(e,t,r){t.Diffuse&&e.color.multiplyScalar(t.Diffuse.value),t.Reflection&&(e.reflectivity=t.Reflection.value,e.combine=AddOperation),t.Luminosity&&(e.emissiveIntensity=t.Luminosity.value,r.emissiveMap||r.map?e.emissive=new Color(8421504):e.emissive=e.color),t.Roughness||!t.Specular||r.specularMap||(t["Color Highlight"]?e.specular=(new Color).setScalar(t.Specular.value).lerp(e.color.clone().multiplyScalar(t.Specular.value),t["Color Highlight"].value):e.specular=(new Color).setScalar(t.Specular.value)),e.specular&&t.Glossiness&&(e.shininess=7+Math.pow(2,12*t.Glossiness.value+2))},parseEnvMap:function(e,t,r){if(e.envMap){var n=this.loadTexture(e.envMap);r.transparent&&r.opacity<.999?(n.mapping=EquirectangularRefractionMapping,void 0!==r.reflectivity&&(delete r.reflectivity,delete r.combine),void 0!==r.metalness&&delete r.metalness):n.mapping=EquirectangularReflectionMapping,t.envMap=n}},getTexturePathByIndex:function(e){var t="";return lwoTree.textures?(lwoTree.textures.forEach((function(r){r.index===e&&(t=r.fileName)})),t):t},loadTexture:function(path){return path?this.textureLoader.load(path,void 0,void 0,(function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")})):null},getWrappingType:function(e){switch(e){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),ClampToEdgeWrapping;case 1:return RepeatWrapping;case 2:return MirroredRepeatWrapping;case 3:return ClampToEdgeWrapping}},getMaterialType:function(e){return e.Clearcoat&&e.Clearcoat.value>0?MeshPhysicalMaterial:e.Roughness?MeshStandardMaterial:MeshPhongMaterial}},GeometryParser.prototype={constructor:GeometryParser,parse:function(e,t){var r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(e.points,3));var n=this.splitIndices(e.vertexIndices,e.polygonDimensions);return r.setIndex(n),this.parseGroups(r,e),r.computeVertexNormals(),this.parseUVs(r,t,n),this.parseMorphTargets(r,t,n),r.translate(-t.pivot[0],-t.pivot[1],-t.pivot[2]),r},splitIndices:function(e,t){var r=[],i=0;return t.forEach((function(t){if(t<4)for(var n=0;n<t;n++)r.push(e[i+n]);else if(4===t)r.push(e[i],e[i+1],e[i+2],e[i],e[i+2],e[i+3]);else if(t>4){for(n=1;n<t-1;n++)r.push(e[i],e[i+n],e[i+n+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}i+=t})),r},parseGroups:function(e,t){var r=lwoTree.tags,n=[],o=3;"lines"===t.type&&(o=2),"points"===t.type&&(o=1);for(var l,c=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices),h=0,d={},f=0,m=0,i=0;i<c.length;i+=2){var v,y=c[i+1];if(0===i&&(n[h]=r[y]),void 0===l&&(l=y),y!==l)d[r[l]]?v=d[r[l]]:(v=h,d[r[l]]=h,n[h]=r[l],h++),e.addGroup(f,m,v),f+=m,l=y,m=0;m+=o}e.groups.length>0&&(d[r[y]]?v=d[r[y]]:(v=h,d[r[y]]=h,n[h]=r[y]),e.addGroup(f,m,v));e.userData.matNames=n},splitMaterialIndices:function(e,t){var r=[];return e.forEach((function(e,i){if(e<=3)r.push(t[2*i],t[2*i+1]);else if(4===e)r.push(t[2*i],t[2*i+1],t[2*i],t[2*i+1]);else for(var n=0;n<e-2;n++)r.push(t[2*i],t[2*i+1])})),r},parseUVs:function(e,t){var r=Array.from(Array(2*e.attributes.position.count),(function(){return 0}));for(var n in t.uvs){var o=t.uvs[n].uvs;t.uvs[n].uvIndices.forEach((function(i,e){r[2*i]=o[2*e],r[2*i+1]=o[2*e+1]}))}e.setAttribute("uv",new Float32BufferAttribute(r,2))},parseMorphTargets:function(e,t){var r=0;for(var n in t.morphTargets){var o=e.attributes.position.array.slice();e.morphAttributes.position||(e.morphAttributes.position=[]);var l=t.morphTargets[n].points,c=t.morphTargets[n].indices,h=t.morphTargets[n].type;c.forEach((function(i,e){"relative"===h?(o[3*i]+=l[3*e],o[3*i+1]+=l[3*e+1],o[3*i+2]+=l[3*e+2]):(o[3*i]=l[3*e],o[3*i+1]=l[3*e+1],o[3*i+2]=l[3*e+2])})),e.morphAttributes.position[r]=new Float32BufferAttribute(o,3),e.morphAttributes.position[r].name=n,r++}e.morphTargetsRelative=!1}};var MD2Loader=function(e){Loader.call(this,e)},normalData;function MeshToonMaterial(e){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MD2Loader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MD2Loader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(e){t(o.parse(e))}),r,n)},parse:(normalData=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(e){for(var data=new DataView(e),header={},t=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],i=0;i<t.length;i++)header[t[i]]=data.getInt32(4*i,!0);if(844121161===header.ident&&8===header.version){if(header.offset_end===data.byteLength){for(var r=new BufferGeometry,n=[],o=header.offset_st,l=(i=0,header.num_st);i<l;i++){var u=data.getInt16(o+0,!0),c=data.getInt16(o+2,!0);n.push(u/header.skinwidth,1-c/header.skinheight),o+=4}o=header.offset_tris;var h=[],d=[];for(i=0,l=header.num_tris;i<l;i++)h.push(data.getUint16(o+0,!0),data.getUint16(o+2,!0),data.getUint16(o+4,!0)),d.push(data.getUint16(o+6,!0),data.getUint16(o+8,!0),data.getUint16(o+10,!0)),o+=12;var f=new Vector3,m=new Vector3,v=[],y=[];for(o=header.offset_frames,i=0,l=header.num_frames;i<l;i++){m.set(data.getFloat32(o+0,!0),data.getFloat32(o+4,!0),data.getFloat32(o+8,!0)),f.set(data.getFloat32(o+12,!0),data.getFloat32(o+16,!0),data.getFloat32(o+20,!0)),o+=24;for(var x=0;x<16;x++){var _=data.getUint8(o+x,!0);if(0===_)break;v[x]=_}var M={name:String.fromCharCode.apply(null,v),vertices:[],normals:[]};for(o+=16,x=0;x<header.num_vertices;x++){var w=data.getUint8(o++,!0),S=data.getUint8(o++,!0),A=data.getUint8(o++,!0),T=normalData[data.getUint8(o++,!0)];w=w*m.x+f.x,S=S*m.y+f.y,A=A*m.z+f.z,M.vertices.push(w,A,S),M.normals.push(T[0],T[2],T[1])}y.push(M)}var L=[],C=[],N=[],P=y[0].vertices,F=y[0].normals;for(i=0,l=h.length;i<l;i++){w=P[k=3*h[i]],S=P[k+1],A=P[k+2],L.push(w,S,A);var E=F[k],R=F[k+1],D=F[k+2];C.push(E,R,D),u=n[k=2*d[i]],c=n[k+1],N.push(u,c)}r.setAttribute("position",new Float32BufferAttribute(L,3)),r.setAttribute("normal",new Float32BufferAttribute(C,3)),r.setAttribute("uv",new Float32BufferAttribute(N,2));var O=[],I=[];for(i=0,l=y.length;i<l;i++){var B=(M=y[i]).name;if(M.vertices.length>0){L=[],x=0;for(var U=h.length;x<U;x++){var k=3*h[x];w=M.vertices[k],S=M.vertices[k+1],A=M.vertices[k+2],L.push(w,S,A)}var V=new Float32BufferAttribute(L,3);V.name=B,O.push(V)}if(M.normals.length>0){for(C=[],x=0,U=h.length;x<U;x++)k=3*h[x],E=M.normals[k],R=M.normals[k+1],D=M.normals[k+2],C.push(E,R,D);var G=new Float32BufferAttribute(C,3);G.name=B,I.push(G)}}return r.morphAttributes.position=O,r.morphAttributes.normal=I,r.morphTargetsRelative=!1,r.animations=AnimationClip.CreateClipsFromMorphTargetSequences(y,10),r}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})}),MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.specular.copy(source.specular),this.shininess=source.shininess,this.map=source.map,this.gradientMap=source.gradientMap,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this};var MMDLoader=function(){function e(e){Loader.call(this,e),this.loader=new FileLoader(this.manager),this.parser=null,this.meshBuilder=new r(this.manager),this.animationBuilder=new l}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,setAnimationPath:function(e){return this.animationPath=e,this},load:function(e,t,r,n){var o,l=this.meshBuilder.setCrossOrigin(this.crossOrigin);o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(e);var c=this._extractExtension(e).toLowerCase();"pmd"===c||"pmx"===c?this["pmd"===c?"loadPMD":"loadPMX"](e,(function(data){t(l.build(data,o,r,n))}),r,n):n&&n(new Error("MMDLoader: Unknown model file extension ."+c+"."))},loadAnimation:function(e,object,t,r,n){var o=this.animationBuilder;this.loadVMD(e,(function(e){t(object.isCamera?o.buildCameraAnimation(e):o.build(e,object))}),r,n)},loadWithAnimation:function(e,t,r,n,o){var l=this;this.load(e,(function(e){l.loadAnimation(t,e,(function(t){r({mesh:e,animation:t})}),n,o)}),n,o)},loadPMD:function(e,t,r,n){var o=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,(function(e){t(o.parsePmd(e,!0))}),r,n)},loadPMX:function(e,t,r,n){var o=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,(function(e){t(o.parsePmx(e,!0))}),r,n)},loadVMD:function(e,t,r,n){var o=Array.isArray(e)?e:[e],l=[],c=o.length,h=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer");for(var i=0,d=o.length;i<d;i++)this.loader.load(o[i],(function(e){l.push(h.parseVmd(e,!0)),l.length===c&&t(h.mergeVmds(l))}),r,n)},loadVPD:function(e,t,r,n,o){var l=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").load(e,(function(text){r(l.parseVpd(text,!0))}),n,o)},_extractExtension:function(e){var t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)},_getParser:function(){if(null===this.parser){if("undefined"==typeof MMDParser)throw new Error("MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new MMDParser.Parser}return this.parser}});var t=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function r(e){this.geometryBuilder=new n,this.materialBuilder=new o(e)}function n(){}function o(e){this.manager=e,this.textureLoader=new TextureLoader(this.manager),this.tgaLoader=null}function l(){}function c(e,t,r,n,o){Interpolant.call(this,e,t,r,n),this.interpolationParams=o}return r.prototype={constructor:r,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},build:function(data,e,t,r){var n=this.geometryBuilder.build(data),o=new SkinnedMesh(n,this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(e).build(data,n,t,r)),l=new Skeleton(function(e){var t,r,i,n,o=e.geometry,l=[];if(o&&void 0!==o.bones){for(i=0,n=o.bones.length;i<n;i++)r=o.bones[i],t=new Bone,l.push(t),t.name=r.name,t.position.fromArray(r.pos),t.quaternion.fromArray(r.rotq),void 0!==r.scl&&t.scale.fromArray(r.scl);for(i=0,n=o.bones.length;i<n;i++)-1!==(r=o.bones[i]).parent&&null!==r.parent&&void 0!==l[r.parent]?l[r.parent].add(l[i]):e.add(l[i])}return e.updateMatrixWorld(!0),l}(o));return o.bind(l),o}},n.prototype={constructor:n,build:function(data){for(var e=[],t=[],r=[],n=[],o=[],l=[],c=[],h=[],d=[],f=[],m=[],v=[],y=[],x=[],_=0,M={},i=0;i<data.metadata.vertexCount;i++){for(var w=data.vertices[i],S=0,A=w.position.length;S<A;S++)e.push(w.position[S]);for(S=0,A=w.normal.length;S<A;S++)r.push(w.normal[S]);for(S=0,A=w.uv.length;S<A;S++)t.push(w.uv[S]);for(S=0;S<4;S++)c.push(w.skinIndices.length-1>=S?w.skinIndices[S]:0);for(S=0;S<4;S++)h.push(w.skinWeights.length-1>=S?w.skinWeights[S]:0)}for(i=0;i<data.metadata.faceCount;i++){var T=data.faces[i];for(S=0,A=T.indices.length;S<A;S++)n.push(T.indices[S])}for(i=0;i<data.metadata.materialCount;i++){var L=data.materials[i];o.push({offset:3*_,count:3*L.faceCount}),_+=L.faceCount}for(i=0;i<data.metadata.rigidBodyCount;i++){var body=data.rigidBodies[i],C=M[body.boneIndex];C=void 0===C?body.type:Math.max(body.type,C),M[body.boneIndex]=C}for(i=0;i<data.metadata.boneCount;i++){-1!==(W={parent:(D=data.bones[i]).parentIndex,name:D.name,pos:D.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==M[i]?M[i]:-1}).parent&&(W.pos[0]-=data.bones[W.parent].position[0],W.pos[1]-=data.bones[W.parent].position[1],W.pos[2]-=data.bones[W.parent].position[2]),l.push(W)}if("pmd"===data.metadata.format)for(i=0;i<data.metadata.ikCount;i++){var param={target:(N=data.iks[i]).target,effector:N.effector,iteration:N.iteration,maxAngle:4*N.maxAngle,links:[]};for(S=0,A=N.links.length;S<A;S++){(link={}).index=N.links[S].index,link.enabled=!0,data.bones[link.index].name.indexOf("")>=0&&(link.limitation=new Vector3(1,0,0)),param.links.push(link)}m.push(param)}else for(i=0;i<data.metadata.boneCount;i++){var N;if(void 0!==(N=data.bones[i].ik)){for(param={target:i,effector:N.effector,iteration:N.iteration,maxAngle:N.maxAngle,links:[]},S=0,A=N.links.length;S<A;S++){var link;if((link={}).index=N.links[S].index,link.enabled=!0,1===N.links[S].angleLimitation){var P=N.links[S].lowerLimitationAngle,F=N.links[S].upperLimitationAngle,E=-F[0],R=-F[1];F[0]=-P[0],F[1]=-P[1],P[0]=E,P[1]=R,link.rotationMin=(new Vector3).fromArray(P),link.rotationMax=(new Vector3).fromArray(F)}param.links.push(link)}m.push(param)}}if("pmx"===data.metadata.format){for(i=0;i<data.metadata.boneCount;i++){var D,O=(D=data.bones[i]).grant;if(void 0!==O){param={index:i,parentIndex:O.parentIndex,ratio:O.ratio,isLocal:O.isLocal,affectRotation:O.affectRotation,affectPosition:O.affectPosition,transformationClass:D.transformationClass};v.push(param)}}v.sort((function(a,b){return a.transformationClass-b.transformationClass}))}function I(e,t,r){for(var i=0;i<t.elementCount;i++){var n,element=t.elements[i];n="pmd"===data.metadata.format?data.morphs[0].elements[element.index].index:element.index,e.array[3*n+0]+=element.position[0]*r,e.array[3*n+1]+=element.position[1]*r,e.array[3*n+2]+=element.position[2]*r}}for(i=0;i<data.metadata.morphCount;i++){var B=data.morphs[i],U={name:B.name},k=new Float32BufferAttribute(3*data.metadata.vertexCount,3);k.name=B.name;for(S=0;S<3*data.metadata.vertexCount;S++)k.array[S]=e[S];if("pmd"===data.metadata.format)0!==i&&I(k,B,1);else if(0===B.type)for(S=0;S<B.elementCount;S++){var V=data.morphs[B.elements[S].index],G=B.elements[S].ratio;1===V.type&&I(k,V,G)}else 1===B.type?I(k,B,1):2===B.type||3===B.type||4===B.type||5===B.type||6===B.type||7===B.type||B.type;d.push(U),f.push(k)}for(i=0;i<data.metadata.rigidBodyCount;i++){var z=data.rigidBodies[i];U={};for(var j in z)U[j]=z[j];if("pmx"===data.metadata.format&&-1!==U.boneIndex){var W=data.bones[U.boneIndex];U.position[0]-=W.position[0],U.position[1]-=W.position[1],U.position[2]-=W.position[2]}y.push(U)}for(i=0;i<data.metadata.constraintCount;i++){var H=data.constraints[i];U={};for(var j in H)U[j]=H[j];var X=y[U.rigidBodyIndex1],Y=y[U.rigidBodyIndex2];0!==X.type&&2===Y.type&&-1!==X.boneIndex&&-1!==Y.boneIndex&&data.bones[Y.boneIndex].parentIndex===X.boneIndex&&(Y.type=1),x.push(U)}var Q=new BufferGeometry;Q.setAttribute("position",new Float32BufferAttribute(e,3)),Q.setAttribute("normal",new Float32BufferAttribute(r,3)),Q.setAttribute("uv",new Float32BufferAttribute(t,2)),Q.setAttribute("skinIndex",new Uint16BufferAttribute(c,4)),Q.setAttribute("skinWeight",new Float32BufferAttribute(h,4)),Q.setIndex(n);i=0;for(var K=o.length;i<K;i++)Q.addGroup(o[i].offset,o[i].count,i);return Q.bones=l,Q.morphTargets=d,Q.morphAttributes.position=f,Q.morphTargetsRelative=!1,Q.userData.MMD={bones:l,iks:m,grants:v,rigidBodies:y,constraints:x,format:data.metadata.format},Q.computeBoundingSphere(),Q}},o.prototype={constructor:o,crossOrigin:"anonymous",resourcePath:void 0,setCrossOrigin:function(e){return this.crossOrigin=e,this},setResourcePath:function(e){return this.resourcePath=e,this},build:function(data,e){var t=[],r={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var i=0;i<data.metadata.materialCount;i++){var n=data.materials[i],o={userData:{}};if(void 0!==n.name&&(o.name=n.name),o.color=(new Color).fromArray(n.diffuse),o.opacity=n.diffuse[3],o.specular=(new Color).fromArray(n.specular),o.emissive=(new Color).fromArray(n.ambient),o.shininess=Math.max(n.shininess,1e-4),o.transparent=1!==o.opacity,o.skinning=e.bones.length>0,o.morphTargets=e.morphTargets.length>0,o.fog=!0,o.blending=CustomBlending,o.blendSrc=SrcAlphaFactor,o.blendDst=OneMinusSrcAlphaFactor,o.blendSrcAlpha=SrcAlphaFactor,o.blendDstAlpha=DstAlphaFactor,"pmx"===data.metadata.format&&1==(1&n.flag)?o.side=DoubleSide:o.side=1===o.opacity?FrontSide:DoubleSide,"pmd"===data.metadata.format){if(n.fileName){var l=n.fileName.split("*");if(o.map=this._loadTexture(l[0],r),l.length>1){var c=l[1].slice(-4).toLowerCase();o.envMap=this._loadTexture(l[1],r,{sphericalReflectionMapping:!0}),o.combine=".sph"===c?MultiplyOperation:AddOperation}}var h=-1===n.toonIndex?"toon00.bmp":data.toonTextures[n.toonIndex].fileName;o.gradientMap=this._loadTexture(h,r,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(h)}),o.userData.outlineParameters={thickness:1===n.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===n.edgeFlag}}else{var d;-1!==n.textureIndex&&(o.map=this._loadTexture(data.textures[n.textureIndex],r)),-1===n.envTextureIndex||1!==n.envFlag&&2!=n.envFlag||(o.envMap=this._loadTexture(data.textures[n.envTextureIndex],r,{sphericalReflectionMapping:!0}),o.combine=1===n.envFlag?MultiplyOperation:AddOperation),-1===n.toonIndex||0!==n.toonFlag?(h="toon"+("0"+(n.toonIndex+1)).slice(-2)+".bmp",d=!0):(h=data.textures[n.toonIndex],d=!1),o.gradientMap=this._loadTexture(h,r,{isToonTexture:!0,isDefaultToonTexture:d}),o.userData.outlineParameters={thickness:n.edgeSize/300,color:n.edgeColor.slice(0,3),alpha:n.edgeColor[3],visible:0!=(16&n.flag)&&n.edgeSize>0}}void 0!==o.map&&(o.transparent||this._checkImageTransparency(o.map,e,i),o.emissive.multiplyScalar(.2)),t.push(new MeshToonMaterial(o))}if("pmx"===data.metadata.format){function f(e,t){for(var i=0,r=e.length;i<r;i++){var element=e[i];if(-1!==element.index){var n=t[element.index];n.opacity!==element.diffuse[3]&&(n.transparent=!0)}}}i=0;for(var m=data.morphs.length;i<m;i++){var v=data.morphs[i],y=v.elements;if(0===v.type)for(var x=0,_=y.length;x<_;x++){var M=data.morphs[y[x].index];8===M.type&&f(M.elements,t)}else 8===v.type&&f(y,t)}}return t},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===TGALoader)throw new Error("MMDLoader: Import TGALoader");this.tgaLoader=new TGALoader(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)},_loadTexture:function(e,r,n,o,l){var c,h=this;if(!0===(n=n||{}).isDefaultToonTexture){var d;try{d=parseInt(e.match("toon([0-9]{2}).bmp$")[1])}catch(t){console.warn("MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),d=0}c=t[d]}else c=this.resourcePath+e;if(void 0!==r[c])return r[c];var f=this.manager.getHandler(c);null===f&&(f=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var m=f.load(c,(function(e){!0===n.isToonTexture&&(e.image=h._getRotatedImage(e.image),e.magFilter=NearestFilter,e.minFilter=NearestFilter),e.flipY=!1,e.wrapS=RepeatWrapping,e.wrapT=RepeatWrapping;for(var i=0;i<m.readyCallbacks.length;i++)m.readyCallbacks[i](m);delete m.readyCallbacks}),o,l);return!0===n.sphericalReflectionMapping&&(m.mapping=SphericalReflectionMapping),m.readyCallbacks=[],r[c]=m,m},_getRotatedImage:function(image){var canvas=document.createElement("canvas"),e=canvas.getContext("2d"),t=image.width,r=image.height;return canvas.width=t,canvas.height=r,e.clearRect(0,0,t,r),e.translate(t/2,r/2),e.rotate(.5*Math.PI),e.translate(-t/2,-r/2),e.drawImage(image,0,0),e.getImageData(0,0,t,r)},_checkImageTransparency:function(map,e,t){map.readyCallbacks.push((function(r){function n(image,e){var t=image.width,r=image.height,n=Math.round(e.x*t)%t,o=Math.round(e.y*r)%r;n<0&&(n+=t),o<0&&(o+=r);var l=o*t+n;return image.data[4*l+3]}var o=void 0!==r.image.data?r.image:function(image){var canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;var e=canvas.getContext("2d");return e.drawImage(image,0,0),e.getImageData(0,0,canvas.width,canvas.height)}(r.image),l=e.groups[t];(function(image,e,t){var r=image.width,o=image.height;if(image.data.length/(r*o)!=4)return!1;for(var i=0;i<t.length;i+=3){for(var l={x:0,y:0},c=0;c<3;c++){var h=t[3*i+c],d={x:e[2*h+0],y:e[2*h+1]};if(n(image,d)<253)return!0;l.x+=d.x,l.y+=d.y}if(l.x/=3,l.y/=3,n(image,l)<253)return!0}return!1})(o,e.attributes.uv.array,e.index.array.slice(l.start,l.start+l.count))&&(map.transparent=!0)}))}},l.prototype={constructor:l,build:function(e,t){for(var r=this.buildSkeletalAnimation(e,t).tracks,n=this.buildMorphAnimation(e,t).tracks,i=0,o=n.length;i<o;i++)r.push(n[i]);return new AnimationClip("",-1,r)},buildSkeletalAnimation:function(e,t){function r(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)}for(var n=[],o={},l=t.skeleton.bones,c={},i=0,h=l.length;i<h;i++)c[l[i].name]=!0;for(i=0;i<e.metadata.motionCount;i++){var d=e.motions[i],f=d.boneName;void 0!==c[f]&&(o[f]=o[f]||[],o[f].push(d))}for(var m in o){var v=o[m];v.sort((function(a,b){return a.frameNum-b.frameNum}));var y=[],x=[],_=[],M=[],w=[],S=t.skeleton.getBoneByName(m).position.toArray();for(i=0,h=v.length;i<h;i++){var time=v[i].frameNum/30,A=v[i].position,T=v[i].rotation,L=v[i].interpolation;y.push(time);for(var C=0;C<3;C++)x.push(S[C]+A[C]);for(C=0;C<4;C++)_.push(T[C]);for(C=0;C<3;C++)r(M,L,C);r(w,L,3)}var N=".bones["+m+"]";n.push(this._createTrack(N+".position",VectorKeyframeTrack,y,x,M)),n.push(this._createTrack(N+".quaternion",QuaternionKeyframeTrack,y,_,w))}return new AnimationClip("",-1,n)},buildMorphAnimation:function(e,t){for(var r=[],n={},o=t.morphTargetDictionary,i=0;i<e.metadata.morphCount;i++){var l=e.morphs[i],c=l.morphName;void 0!==o[c]&&(n[c]=n[c]||[],n[c].push(l))}for(var h in n){var d=n[h];d.sort((function(a,b){return a.frameNum-b.frameNum}));for(var f=[],m=[],v=(i=0,d.length);i<v;i++)f.push(d[i].frameNum/30),m.push(d[i].weight);r.push(new NumberKeyframeTrack(".morphTargetInfluences["+o[h]+"]",f,m))}return new AnimationClip("",-1,r)},buildCameraAnimation:function(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function r(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)}var n=[],o=void 0===e.cameras?[]:e.cameras.slice();o.sort((function(a,b){return a.frameNum-b.frameNum}));for(var l,q,c=[],h=[],d=[],f=[],m=[],v=[],y=[],x=[],_=[],M=new Quaternion,w=new Euler,S=new Vector3,A=new Vector3,i=0,T=o.length;i<T;i++){var L=o[i],time=L.frameNum/30,C=L.position,N=L.rotation,P=L.distance,F=L.fov,E=L.interpolation;c.push(time),S.set(0,0,-P),A.set(C[0],C[1],C[2]),w.set(-N[0],-N[1],-N[2]),M.setFromEuler(w),S.add(A),S.applyQuaternion(M),t(h,A),(l=d).push((q=M).x),l.push(q.y),l.push(q.z),l.push(q.w),t(f,S),m.push(F);for(var R=0;R<3;R++)r(v,E,R);r(y,E,3);for(R=0;R<3;R++)r(x,E,4);r(_,E,5)}return(n=[]).push(this._createTrack("target.position",VectorKeyframeTrack,c,h,v)),n.push(this._createTrack(".quaternion",QuaternionKeyframeTrack,c,d,y)),n.push(this._createTrack(".position",VectorKeyframeTrack,c,f,x)),n.push(this._createTrack(".fov",NumberKeyframeTrack,c,m,_)),new AnimationClip("",-1,n)},_createTrack:function(e,t,r,n,o){if(r.length>2){r=r.slice(),n=n.slice(),o=o.slice();for(var l=n.length/r.length,h=o.length/r.length,d=1,f=2,m=r.length;f<m;f++){for(var i=0;i<l;i++)if(n[d*l+i]!==n[(d-1)*l+i]||n[d*l+i]!==n[f*l+i]){d++;break}if(f>d){r[d]=r[f];for(i=0;i<l;i++)n[d*l+i]=n[f*l+i];for(i=0;i<h;i++)o[d*h+i]=o[f*h+i]}}r.length=d+1,n.length=(d+1)*l,o.length=(d+1)*h}var track=new t(e,r,n);return track.createInterpolant=function(e){return new c(this.times,this.values,this.getValueSize(),e,new Float32Array(o))},track}},c.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:c,interpolate_:function(e,t,r,n){var o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,h=this.interpolationParams,d=e*c,f=d-c,m=n-t<.05?0:(r-t)/(n-t);if(4===c){var v=h[4*e+0],y=h[4*e+1],x=h[4*e+2],_=h[4*e+3],M=this._calculate(v,y,x,_,m);Quaternion.slerpFlat(o,0,l,f,l,d,M)}else if(3===c)for(var i=0;i!==c;++i){v=h[12*e+4*i+0],y=h[12*e+4*i+1],x=h[12*e+4*i+2],_=h[12*e+4*i+3],M=this._calculate(v,y,x,_,m);o[i]=l[f+i]*(1-M)+l[d+i]*M}else{v=h[4*e+0],y=h[4*e+1],x=h[4*e+2],_=h[4*e+3],M=this._calculate(v,y,x,_,m);o[0]=l[f]*(1-M)+l[d]*M}return o},_calculate:function(e,t,r,n,o){for(var l,c,h,d=.5,f=d,s=1-f,m=Math,i=0;i<15;i++){var v=(l=3*s*s*f)*e+(c=3*s*f*f)*t+(h=f*f*f)-o;if(m.abs(v)<1e-5)break;d/=2,s=1-(f+=v<0?d:-d)}return l*r+c*n+h}}),e}(),MTLLoader=function(e){Loader.call(this,e)};function TempNode(e,t){Node.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}function InputNode(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,TempNode.call(this,e,t),this.readonly=!1}MTLLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MTLLoader,load:function(e,t,r,n){var o=this,path=""===this.path?LoaderUtils.extractUrlBase(e):this.path,l=new FileLoader(this.manager);l.setPath(this.path),l.load(e,(function(text){t(o.parse(text,path))}),r,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(text,path){for(var e=text.split("\n"),t={},r=/\s+/,n={},i=0;i<e.length;i++){var line=e[i];if(0!==(line=line.trim()).length&&"#"!==line.charAt(0)){var o=line.indexOf(" "),l=o>=0?line.substring(0,o):line;l=l.toLowerCase();var c=o>=0?line.substring(o+1):"";if(c=c.trim(),"newmtl"===l)t={name:c},n[c]=t;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var h=c.split(r,3);t[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else t[l]=c}}var d=new MTLLoader.MaterialCreator(this.resourcePath||path,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(n),d}}),MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:RepeatWrapping},MTLLoader.MaterialCreator.prototype={constructor:MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],o={};for(var l in t[r]=o,n){var c=!0,h=n[l],d=l.toLowerCase();switch(d){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===h[0]&&0===h[1]&&0===h[2]&&(c=!1)}c&&(o[d]=h)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function o(e,r){if(!n[e]){var o,l,c=t.getTextureParams(r,n),map=t.loadTexture((o=t.baseUrl,"string"!=typeof(l=c.url)||""===l?"":/^https?:\/\//i.test(l)?l:o+l));map.repeat.copy(c.scale),map.offset.copy(c.offset),map.wrapS=t.wrap,map.wrapT=t.wrap,n[e]=map}}for(var l in r){var c,h=r[l];if(""!==h)switch(l.toLowerCase()){case"kd":n.color=(new Color).fromArray(h);break;case"ks":n.specular=(new Color).fromArray(h);break;case"ke":n.emissive=(new Color).fromArray(h);break;case"map_kd":o("map",h);break;case"map_ks":o("specularMap",h);break;case"map_ke":o("emissiveMap",h);break;case"norm":o("normalMap",h);break;case"map_bump":case"bump":o("bumpMap",h);break;case"map_d":o("alphaMap",h),n.transparent=!0;break;case"ns":n.shininess=parseFloat(h);break;case"d":(c=parseFloat(h))<1&&(n.opacity=c,n.transparent=!0);break;case"tr":c=parseFloat(h),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(n.opacity=1-c,n.transparent=!0)}}return this.materials[e]=new MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new Vector2(1,1),offset:new Vector2(0,0)},o=e.split(/\s+/);return(r=o.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(o[r+1]),o.splice(r,2)),(r=o.indexOf("-s"))>=0&&(n.scale.set(parseFloat(o[r+1]),parseFloat(o[r+2])),o.splice(r,4)),(r=o.indexOf("-o"))>=0&&(n.offset.set(parseFloat(o[r+1]),parseFloat(o[r+2])),o.splice(r,4)),n.url=o.join(" ").trim(),n},loadTexture:function(e,t,r,n,o){var l,c=void 0!==this.manager?this.manager:DefaultLoadingManager,h=c.getHandler(e);return null===h&&(h=new TextureLoader(c)),h.setCrossOrigin&&h.setCrossOrigin(this.crossOrigin),l=h.load(e,r,n,o),void 0!==t&&(l.mapping=t),l}},TempNode.prototype=Object.create(Node.prototype),TempNode.prototype.constructor=TempNode,TempNode.prototype.build=function(e,output,t,r){if(output=output||this.getType(e),this.getShared(e,output)){var n=this.getUnique(e,output);n&&void 0===this.constructor.uuid&&(this.constructor.uuid=MathUtils.generateUUID()),t=e.getUuid(t||this.getUuid(),!n);var data=e.getNodeData(t),o=data.output||this.getType(e);if(e.analyzing)return(data.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,data,output),this.generate(e,output,t)):Node.prototype.build.call(this,e,output,t);if(n)return data.name=data.name||Node.prototype.build.call(this,e,output,t),data.name;if(!this.getLabel()&&(!this.getShared(e,o)||e.context.ignoreCache||1===data.deps))return Node.prototype.build.call(this,e,output,t);t=this.getUuid(!1);var l=this.getTemp(e,t);if(l)return e.format(l,o,output);l=TempNode.prototype.generate.call(this,e,output,t,data.output,r);var code=this.generate(e,o,t);return e.addNodeCode(l+" = "+code+";"),e.format(l,o,output)}return Node.prototype.build.call(this,e,output,t)},TempNode.prototype.getShared=function(e,output){return"sampler2D"!==output&&"samplerCube"!==output&&this.shared},TempNode.prototype.getUnique=function(){return this.unique},TempNode.prototype.setLabel=function(e){return this.label=e,this},TempNode.prototype.getLabel=function(){return this.label},TempNode.prototype.getUuid=function(e){var t=(e||null==e)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t},TempNode.prototype.getTemp=function(e,t){t=t||this.uuid;var r=e.getVars()[t];return r?r.name:void 0},TempNode.prototype.generate=function(e,output,t,r,n){return this.getShared(e,output)||console.error("TempNode is not shared!"),t=t||this.uuid,e.getTempVar(t,r||this.getType(e),n,this.getLabel()).name},InputNode.prototype=Object.create(TempNode.prototype),InputNode.prototype.constructor=InputNode,InputNode.prototype.setReadonly=function(e){return this.readonly=e,this},InputNode.prototype.getReadonly=function(){return this.readonly},InputNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),void 0!==source.readonly&&(this.readonly=source.readonly),this},InputNode.prototype.createJSONNode=function(meta){var data=TempNode.prototype.createJSONNode.call(this,meta);return!0===this.readonly&&(data.readonly=this.readonly),data},InputNode.prototype.generate=function(e,output,t,r,n,o){t=e.getUuid(t||this.getUuid()),r=r||this.getType(e);var data=e.getNodeData(t);return this.getReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,output,t,r,n,o):e.isShader("vertex")?(data.vertex||(data.vertex=e.createVertexUniform(r,this,n,o,this.getLabel())),e.format(data.vertex.name,r,output)):(data.fragment||(data.fragment=e.createFragmentUniform(r,this,n,o,this.getLabel())),e.format(data.fragment.name,r,output))};var declarationRegexp=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function ConstNode(e,t){TempNode.call(this),this.parse(e||ConstNode.PI,t)}function VarNode(e,t){Node.call(this,e),this.value=t}ConstNode.PI="PI",ConstNode.PI2="PI2",ConstNode.RECIPROCAL_PI="RECIPROCAL_PI",ConstNode.RECIPROCAL_PI2="RECIPROCAL_PI2",ConstNode.LOG2="LOG2",ConstNode.EPSILON="EPSILON",ConstNode.prototype=Object.create(TempNode.prototype),ConstNode.prototype.constructor=ConstNode,ConstNode.prototype.nodeType="Const",ConstNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},ConstNode.prototype.parse=function(e,t){this.src=e||"";var r,n,o="",l=this.src.match(declarationRegexp);this.useDefine=t||"#"===this.src.charAt(0),l&&l.length>1?(n=l[1],r=l[2],o=l[3]):(r=this.src,n="f"),this.name=r,this.type=n,this.value=o},ConstNode.prototype.build=function(e,output){return"source"!==output?(e.include(this),e.format(this.name,this.getType(e),output)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},ConstNode.prototype.generate=function(e,output){return e.format(this.name,this.getType(e),output)},ConstNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.parse(source.src,source.useDefine),this},ConstNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).src=this.src,!0===data.useDefine&&(data.useDefine=!0)),data},VarNode.prototype=Object.create(Node.prototype),VarNode.prototype.constructor=VarNode,VarNode.prototype.nodeType="Var",VarNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},VarNode.prototype.generate=function(e,output){var t=e.getVar(this.uuid,this.type);return this.value&&e.isShader("vertex")&&e.addNodeCode(t.name+" = "+this.value.build(e,this.getType(e))+";"),e.format(t.name,this.getType(e),output)},VarNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),this.type=source.type,this.value=source.value,this},VarNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).type=this.type,this.value&&(data.value=this.value.toJSON(meta).uuid)),data};var declarationRegexp$1=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,propertiesRegexp=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function StructNode(e){TempNode.call(this),this.parse(e)}function AttributeNode(e,t){Node.call(this,t),this.name=e}StructNode.prototype=Object.create(TempNode.prototype),StructNode.prototype.constructor=StructNode,StructNode.prototype.nodeType="Struct",StructNode.prototype.getType=function(e){return e.getTypeByFormat(this.name)},StructNode.prototype.getInputByName=function(e){for(var i=this.inputs.length;i--;)if(this.inputs[i].name===e)return this.inputs[i]},StructNode.prototype.generate=function(e,output){return"source"===output?this.src+";":e.format("( "+this.src+" )",this.getType(e),output)},StructNode.prototype.parse=function(e){this.src=e||"",this.inputs=[];var t=declarationRegexp$1.exec(this.src);if(t){for(var r,n=t[2];r=propertiesRegexp.exec(n);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name},StructNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).src=this.src),data},AttributeNode.prototype=Object.create(Node.prototype),AttributeNode.prototype.constructor=AttributeNode,AttributeNode.prototype.nodeType="Attribute",AttributeNode.prototype.getAttributeType=function(e){return"number"==typeof this.type?e.getConstructorFromLength(this.type):this.type},AttributeNode.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},AttributeNode.prototype.generate=function(e,output){var t=this.getAttributeType(e),r=e.getAttribute(this.name,t),n=e.isShader("vertex")?this.name:r.varying.name;return e.format(n,this.getType(e),output)},AttributeNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),this.type=source.type,this},AttributeNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).type=this.type),data};var NodeLib={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,r){r=void 0===r||r,this.keywords[e]={callback:t,cache:r}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return void 0!==this.nodes[e]},containsKeyword:function(e){return void 0!==this.keywords[e]}},declarationRegexp$2=/^([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,propertiesRegexp$1=/[a-z_0-9]+/gi;function FunctionNode(e,t,r,n,o){this.isMethod=void 0===o,this.isInterface=!1,TempNode.call(this,o),this.parse(e,t,r,n)}function ExpressionNode(e,t,r,n,o){FunctionNode.call(this,e,o,n,r,t)}function FunctionCallNode(e,t){TempNode.call(this),this.setFunction(e,t)}FunctionNode.prototype=Object.create(TempNode.prototype),FunctionNode.prototype.constructor=FunctionNode,FunctionNode.prototype.nodeType="Function",FunctionNode.prototype.useKeywords=!0,FunctionNode.prototype.getShared=function(){return!this.isMethod},FunctionNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},FunctionNode.prototype.getInputByName=function(e){for(var i=this.inputs.length;i--;)if(this.inputs[i].name===e)return this.inputs[i]},FunctionNode.prototype.getIncludeByName=function(e){for(var i=this.includes.length;i--;)if(this.includes[i].name===e)return this.includes[i]},FunctionNode.prototype.generate=function(e,output){for(var t=0,r=this.src,i=0;i<this.includes.length;i++)e.include(this.includes[i],this);for(var n in this.extensions)e.extensions[n]=!0;for(var o=[];l=propertiesRegexp$1.exec(this.src);)o.push(l);for(i=0;i<o.length;i++){var l,c=(l=o[i])[0],h=!this.isMethod||!this.getInputByName(c),d=c;if(this.keywords[c]||this.useKeywords&&h&&NodeLib.containsKeyword(c)){var f=this.keywords[c];if(!f){var m=NodeLib.getKeywordData(c);m.cache&&(f=e.keywords[c]),f=f||NodeLib.getKeyword(c,e),m.cache&&(e.keywords[c]=f)}d=f.build(e)}c!==d&&(r=r.substring(0,l.index+t)+d+r.substring(l.index+c.length+t),t+=d.length-c.length),void 0===this.getIncludeByName(d)&&NodeLib.contains(d)&&e.include(NodeLib.get(d))}return"source"===output?r:this.isMethod?(this.isInterface||e.include(this,!1,r),this.name):e.format("( "+r+" )",this.getType(e),output)},FunctionNode.prototype.parse=function(e,t,r,n){if(this.src=e||"",this.includes=t||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){var o=this.src.match(declarationRegexp$2);if(this.inputs=[],o&&4==o.length){this.type=o[1],this.name=o[2];var l=o[3].match(propertiesRegexp$1);if(l)for(var i=0;i<l.length;){var c,h,d=l[i++];"in"===d||"out"===d||"inout"===d?c=l[i++]:(c=d,d=""),h=l[i++],this.inputs.push({name:h,type:c,qualifier:d})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},FunctionNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.isMethod=source.isMethod,this.useKeywords=source.useKeywords,this.parse(source.src,source.includes,source.extensions,source.keywords),void 0!==source.type&&(this.type=source.type),this},FunctionNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);if(!data){for(var e in(data=this.createJSONNode(meta)).src=this.src,data.isMethod=this.isMethod,data.useKeywords=this.useKeywords,this.isMethod||(data.type=this.type),data.extensions=JSON.parse(JSON.stringify(this.extensions)),data.keywords={},this.keywords)data.keywords[e]=this.keywords[e].toJSON(meta).uuid;if(this.includes.length){data.includes=[];for(var i=0;i<this.includes.length;i++)data.includes.push(this.includes[i].toJSON(meta).uuid)}}return data},ExpressionNode.prototype=Object.create(FunctionNode.prototype),ExpressionNode.prototype.constructor=ExpressionNode,ExpressionNode.prototype.nodeType="Expression",FunctionCallNode.prototype=Object.create(TempNode.prototype),FunctionCallNode.prototype.constructor=FunctionCallNode,FunctionCallNode.prototype.nodeType="FunctionCall",FunctionCallNode.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},FunctionCallNode.prototype.getFunction=function(){return this.value},FunctionCallNode.prototype.getType=function(e){return this.value.getType(e)},FunctionCallNode.prototype.generate=function(e,output){for(var t=this.getType(e),r=this.value,code=r.build(e,output)+"( ",n=[],i=0;i<r.inputs.length;i++){var o=r.inputs[i],param=this.inputs[i]||this.inputs[o.name];n.push(param.build(e,e.getTypeByFormat(o.type)))}return code+=n.join(", ")+" )",e.format(code,t,output)},FunctionCallNode.prototype.copy=function(source){for(var e in TempNode.prototype.copy.call(this,source),source.inputs)this.inputs[e]=source.inputs[e];return this.value=source.value,this},FunctionCallNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);if(!data){var e=this.value;if((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid,e.inputs.length){data.inputs={};for(var i=0;i<e.inputs.length;i++){var t=e.inputs[i],r=this.inputs[i]||this.inputs[t.name];data.inputs[t.name]=r.toJSON(meta).uuid}}}return data};var NodeUtils={elements:["x","y","z","w"],addShortcuts:function(){function e(e,t,r){return r?{get:function(){return this[e][t][r]},set:function(n){this[e][t][r]=n}}:{get:function(){return this[e][t]},set:function(r){this[e][t]=r}}}return function(t,r,n){for(var o={},i=0;i<n.length;++i){var data=n[i].split("."),l=data[0],c=data[1];o[l]=e(r,l,c)}Object.defineProperties(t,o)}}()},LinearToLinear,GammaToLinear,LinearToGamma,sRGBToLinear,LinearTosRGB,RGBEToLinear,LinearToRGBE,RGBMToLinear,LinearToRGBM,RGBDToLinear,LinearToRGBD,cLogLuvM,LinearToLogLuv,cLogLuvInverseM;function NodeFrame(time){this.time=void 0!==time?time:0,this.id=0}function NodeUniform(e){e=e||{},this.name=e.name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}function Vector2Node(e,t){InputNode.call(this,"v2"),this.value=e instanceof Vector2?e:new Vector2(e,t)}function Vector3Node(e,t,r){InputNode.call(this,"v3"),this.value=e instanceof Vector3?e:new Vector3(e,t,r)}function Vector4Node(e,t,r,n){InputNode.call(this,"v4"),this.value=e instanceof Vector4?e:new Vector4(e,t,r,n)}function UVNode(e){TempNode.call(this,"v2",{shared:!1}),this.index=e||0}function FloatNode(e){InputNode.call(this,"f"),this.value=e||0}function ColorSpaceNode(input,e){TempNode.call(this,"v4"),this.input=input,this.method=e||ColorSpaceNode.LINEAR_TO_LINEAR}function TextureNode(e,t,r,n){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new UVNode,this.bias=r,this.project=void 0!==n&&n}function PositionNode(e){TempNode.call(this,"v3"),this.scope=e||PositionNode.LOCAL}function NormalNode(e){TempNode.call(this,"v3"),this.scope=e||NormalNode.VIEW}function ReflectNode(e){TempNode.call(this,"v3"),this.scope=e||ReflectNode.CUBE}function CubeTextureNode(e,t,r){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new ReflectNode,this.bias=r}function OperatorNode(a,b,e){TempNode.call(this),this.a=a,this.b=b,this.op=e}function MathNode(a,e,t,r){TempNode.call(this),this.a=a,"string"!=typeof e?this.b=e:r=e,"string"!=typeof t?this.c=t:r=t,this.method=r}function TextureCubeUVNode(e,t,r){TempNode.call(this,"v4"),this.value=e,this.uv=t,this.bias=r}function TextureCubeNode(e,t,r){TempNode.call(this,"v4"),this.value=e,this.radianceNode=new TextureCubeUVNode(this.value,t||new ReflectNode(ReflectNode.VECTOR),r),this.irradianceNode=new TextureCubeUVNode(this.value,new NormalNode(NormalNode.WORLD),new FloatNode(1).setReadonly(!0))}NodeFrame.prototype={constructor:NodeFrame,update:function(e){return++this.id,this.time+=e,this.delta=e,this},setRenderer:function(e){return this.renderer=e,this},setRenderTexture:function(e){return this.renderTexture=e,this},updateNode:function(e){return e.frameId===this.id||(e.updateFrame(this),e.frameId=this.id),this}},Object.defineProperties(NodeUniform.prototype,{value:{get:function(){return this.node.value},set:function(e){this.node.value=e}}}),Vector2Node.prototype=Object.create(InputNode.prototype),Vector2Node.prototype.constructor=Vector2Node,Vector2Node.prototype.nodeType="Vector2",NodeUtils.addShortcuts(Vector2Node.prototype,"value",["x","y"]),Vector2Node.prototype.generateReadonly=function(e,output,t,r){return e.format("vec2( "+this.x+", "+this.y+" )",r,output)},Vector2Node.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value.copy(source),this},Vector2Node.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).x=this.x,data.y=this.y,!0===this.readonly&&(data.readonly=!0)),data},Vector3Node.prototype=Object.create(InputNode.prototype),Vector3Node.prototype.constructor=Vector3Node,Vector3Node.prototype.nodeType="Vector3",NodeUtils.addShortcuts(Vector3Node.prototype,"value",["x","y","z"]),Vector3Node.prototype.generateReadonly=function(e,output,t,r){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,output)},Vector3Node.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value.copy(source),this},Vector3Node.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).x=this.x,data.y=this.y,data.z=this.z,!0===this.readonly&&(data.readonly=!0)),data},Vector4Node.prototype=Object.create(InputNode.prototype),Vector4Node.prototype.constructor=Vector4Node,Vector4Node.prototype.nodeType="Vector4",NodeUtils.addShortcuts(Vector4Node.prototype,"value",["x","y","z","w"]),Vector4Node.prototype.generateReadonly=function(e,output,t,r){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,output)},Vector4Node.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value.copy(source),this},Vector4Node.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).x=this.x,data.y=this.y,data.z=this.z,data.w=this.w,!0===this.readonly&&(data.readonly=!0)),data},UVNode.prototype=Object.create(TempNode.prototype),UVNode.prototype.constructor=UVNode,UVNode.prototype.nodeType="UV",UVNode.prototype.generate=function(e,output){e.requires.uv[this.index]=!0;var t=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+t:"vUv"+t;return e.format(r,this.getType(e),output)},UVNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.index=source.index,this},UVNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).index=this.index),data},NodeLib.addKeyword("uv",(function(){return new UVNode})),NodeLib.addKeyword("uv2",(function(){return new UVNode(1)})),FloatNode.prototype=Object.create(InputNode.prototype),FloatNode.prototype.constructor=FloatNode,FloatNode.prototype.nodeType="Float",FloatNode.prototype.generateReadonly=function(e,output,t,r){return e.format(this.value+(this.value%1?"":".0"),r,output)},FloatNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value=source.value,this},FloatNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value,!0===this.readonly&&(data.readonly=!0)),data},ColorSpaceNode.Nodes=(LinearToLinear=new FunctionNode(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),GammaToLinear=new FunctionNode(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),LinearToGamma=new FunctionNode(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),sRGBToLinear=new FunctionNode(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB=new FunctionNode(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),RGBEToLinear=new FunctionNode(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),LinearToRGBE=new FunctionNode(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),RGBMToLinear=new FunctionNode(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),LinearToRGBM=new FunctionNode(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),RGBDToLinear=new FunctionNode(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),LinearToRGBD=new FunctionNode(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),cLogLuvM=new ConstNode("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),LinearToLogLuv=new FunctionNode(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[cLogLuvM]),cLogLuvInverseM=new ConstNode("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:LinearToLinear,GammaToLinear:GammaToLinear,LinearToGamma:LinearToGamma,sRGBToLinear:sRGBToLinear,LinearTosRGB:LinearTosRGB,RGBEToLinear:RGBEToLinear,LinearToRGBE:LinearToRGBE,RGBMToLinear:RGBMToLinear,LinearToRGBM:LinearToRGBM,RGBDToLinear:RGBDToLinear,LinearToRGBD:LinearToRGBD,cLogLuvM:cLogLuvM,LinearToLogLuv:LinearToLogLuv,cLogLuvInverseM:cLogLuvInverseM,LogLuvToLinear:new FunctionNode(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[cLogLuvInverseM])}),ColorSpaceNode.LINEAR_TO_LINEAR="LinearToLinear",ColorSpaceNode.GAMMA_TO_LINEAR="GammaToLinear",ColorSpaceNode.LINEAR_TO_GAMMA="LinearToGamma",ColorSpaceNode.SRGB_TO_LINEAR="sRGBToLinear",ColorSpaceNode.LINEAR_TO_SRGB="LinearTosRGB",ColorSpaceNode.RGBE_TO_LINEAR="RGBEToLinear",ColorSpaceNode.LINEAR_TO_RGBE="LinearToRGBE",ColorSpaceNode.RGBM_TO_LINEAR="RGBMToLinear",ColorSpaceNode.LINEAR_TO_RGBM="LinearToRGBM",ColorSpaceNode.RGBD_TO_LINEAR="RGBDToLinear",ColorSpaceNode.LINEAR_TO_RGBD="LinearToRGBD",ColorSpaceNode.LINEAR_TO_LOG_LUV="LinearToLogLuv",ColorSpaceNode.LOG_LUV_TO_LINEAR="LogLuvToLinear",ColorSpaceNode.getEncodingComponents=function(e){switch(e){case LinearEncoding:return["Linear"];case sRGBEncoding:return["sRGB"];case RGBEEncoding:return["RGBE"];case RGBM7Encoding:return["RGBM",new FloatNode(7).setReadonly(!0)];case RGBM16Encoding:return["RGBM",new FloatNode(16).setReadonly(!0)];case RGBDEncoding:return["RGBD",new FloatNode(256).setReadonly(!0)];case GammaEncoding:return["Gamma",new ExpressionNode("float( GAMMA_FACTOR )","f")]}},ColorSpaceNode.prototype=Object.create(TempNode.prototype),ColorSpaceNode.prototype.constructor=ColorSpaceNode,ColorSpaceNode.prototype.nodeType="ColorSpace",ColorSpaceNode.prototype.generate=function(e,output){var input=this.input.build(e,"v4"),t=this.getType(e),r=ColorSpaceNode.Nodes[this.method],n=e.include(r);if(n===ColorSpaceNode.LINEAR_TO_LINEAR)return e.format(input,t,output);if(2===r.inputs.length){var o=this.factor.build(e,"f");return e.format(n+"( "+input+", "+o+" )",t,output)}return e.format(n+"( "+input+" )",t,output)},ColorSpaceNode.prototype.fromEncoding=function(e){var t=ColorSpaceNode.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]},ColorSpaceNode.prototype.fromDecoding=function(e){var t=ColorSpaceNode.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]},ColorSpaceNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.input=source.input,this.method=source.method,this},ColorSpaceNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).input=this.input.toJSON(meta).uuid,data.method=this.method),data},TextureNode.prototype=Object.create(InputNode.prototype),TextureNode.prototype.constructor=TextureNode,TextureNode.prototype.nodeType="Texture",TextureNode.prototype.getTexture=function(e,output){return InputNode.prototype.generate.call(this,e,output,this.value.uuid,"t")},TextureNode.prototype.generate=function(e,output){if("sampler2D"===output)return this.getTexture(e,output);var t,code,r=this.getTexture(e,output),n=this.uv.build(e,this.project?"v4":"v2"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),t=this.project?"texture2DProj":o?"tex2DBias":"tex2D",code=o?t+"( "+r+", "+n+", "+o+" )":t+"( "+r+", "+n+" )";var l={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(l),this.colorSpace=this.colorSpace||new ColorSpaceNode(new ExpressionNode("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(code),code=this.colorSpace.build(e,c),e.removeContext(),e.format(code,c,output)},TextureNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),source.value&&(this.value=source.value),this.uv=source.uv,source.bias&&(this.bias=source.bias),void 0!==source.project&&(this.project=source.project),this},TextureNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),this.value&&(data.value=this.value.uuid),data.uv=this.uv.toJSON(meta).uuid,data.project=this.project,this.bias&&(data.bias=this.bias.toJSON(meta).uuid)),data},PositionNode.LOCAL="local",PositionNode.WORLD="world",PositionNode.VIEW="view",PositionNode.PROJECTION="projection",PositionNode.prototype=Object.create(TempNode.prototype),PositionNode.prototype.constructor=PositionNode,PositionNode.prototype.nodeType="Position",PositionNode.prototype.getType=function(){switch(this.scope){case PositionNode.PROJECTION:return"v4"}return this.type},PositionNode.prototype.getShared=function(){switch(this.scope){case PositionNode.LOCAL:case PositionNode.WORLD:return!1}return!0},PositionNode.prototype.generate=function(e,output){var t;switch(this.scope){case PositionNode.LOCAL:e.isShader("vertex")?t="transformed":(e.requires.position=!0,t="vPosition");break;case PositionNode.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,t="vWPosition";break;case PositionNode.VIEW:t=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case PositionNode.PROJECTION:t=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(t,this.getType(e),output)},PositionNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.scope=source.scope,this},PositionNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).scope=this.scope),data},NodeLib.addKeyword("position",(function(){return new PositionNode})),NodeLib.addKeyword("worldPosition",(function(){return new PositionNode(PositionNode.WORLD)})),NodeLib.addKeyword("viewPosition",(function(){return new PositionNode(PositionNode.VIEW)})),NormalNode.LOCAL="local",NormalNode.WORLD="world",NormalNode.VIEW="view",NormalNode.prototype=Object.create(TempNode.prototype),NormalNode.prototype.constructor=NormalNode,NormalNode.prototype.nodeType="Normal",NormalNode.prototype.getShared=function(){return this.scope===NormalNode.WORLD},NormalNode.prototype.build=function(e,output,t,r){var n=e.context[this.scope+"Normal"];return n?n.build(e,output,t,r):TempNode.prototype.build.call(this,e,output,t)},NormalNode.prototype.generate=function(e,output){var t;switch(this.scope){case NormalNode.VIEW:t=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case NormalNode.LOCAL:e.isShader("vertex")?t="objectNormal":(e.requires.normal=!0,t="vObjectNormal");break;case NormalNode.WORLD:e.isShader("vertex")?t="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,t="vWNormal")}return e.format(t,this.getType(e),output)},NormalNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.scope=source.scope,this},NormalNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).scope=this.scope),data},NodeLib.addKeyword("viewNormal",(function(){return new NormalNode(NormalNode.VIEW)})),NodeLib.addKeyword("localNormal",(function(){return new NormalNode(NormalNode.NORMAL)})),NodeLib.addKeyword("worldNormal",(function(){return new NormalNode(NormalNode.WORLD)})),ReflectNode.CUBE="cube",ReflectNode.SPHERE="sphere",ReflectNode.VECTOR="vector",ReflectNode.prototype=Object.create(TempNode.prototype),ReflectNode.prototype.constructor=ReflectNode,ReflectNode.prototype.nodeType="Reflect",ReflectNode.prototype.getUnique=function(e){return!e.context.viewNormal},ReflectNode.prototype.getType=function(){switch(this.scope){case ReflectNode.SPHERE:return"v2"}return this.type},ReflectNode.prototype.generate=function(e,output){var t=this.getUnique(e);if(e.isShader("fragment")){var r;switch(this.scope){case ReflectNode.VECTOR:var n=new NormalNode(NormalNode.VIEW),o=e.context.roughness,l=n.build(e,"v3"),c=new PositionNode(PositionNode.VIEW).build(e,"v3"),h=o?o.build(e,"f"):void 0,d="reflect( -normalize( "+c+" ), "+l+" )";h&&(d="normalize( mix( "+d+", "+l+", "+h+" * "+h+" ) )");var code="inverseTransformDirection( "+d+", viewMatrix )";t?(e.addNodeCode("vec3 reflectVec = "+code+";"),r="reflectVec"):r=code;break;case ReflectNode.CUBE:code="vec3( -"+(f=new ReflectNode(ReflectNode.VECTOR).build(e,"v3"))+".x, "+f+".yz )";t?(e.addNodeCode("vec3 reflectCubeVec = "+code+";"),r="reflectCubeVec"):r=code;break;case ReflectNode.SPHERE:var f;code="normalize( ( viewMatrix * vec4( "+(f=new ReflectNode(ReflectNode.VECTOR).build(e,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";t?(e.addNodeCode("vec2 reflectSphereVec = "+code+";"),r="reflectSphereVec"):r=code}return e.format(r,this.getType(e),output)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,output)},ReflectNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).scope=this.scope),data},CubeTextureNode.prototype=Object.create(InputNode.prototype),CubeTextureNode.prototype.constructor=CubeTextureNode,CubeTextureNode.prototype.nodeType="CubeTexture",CubeTextureNode.prototype.getTexture=function(e,output){return InputNode.prototype.generate.call(this,e,output,this.value.uuid,"tc")},CubeTextureNode.prototype.generate=function(e,output){if("samplerCube"===output)return this.getTexture(e,output);var code,t=this.getTexture(e,output),r=this.uv.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;void 0===n&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f")),code=n?"texCubeBias( "+t+", "+r+", "+n+" )":"texCube( "+t+", "+r+" )";var o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace||new ColorSpaceNode(new ExpressionNode("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(code),code=this.colorSpace.build(e,l),e.removeContext(),e.format(code,l,output)},CubeTextureNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),source.value&&(this.value=source.value),this.uv=source.uv,source.bias&&(this.bias=source.bias),this},CubeTextureNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.uuid,data.uv=this.uv.toJSON(meta).uuid,this.bias&&(data.bias=this.bias.toJSON(meta).uuid)),data},OperatorNode.ADD="+",OperatorNode.SUB="-",OperatorNode.MUL="*",OperatorNode.DIV="/",OperatorNode.prototype=Object.create(TempNode.prototype),OperatorNode.prototype.constructor=OperatorNode,OperatorNode.prototype.nodeType="Operator",OperatorNode.prototype.getType=function(e){var a=this.a.getType(e),b=this.b.getType(e);return e.isTypeMatrix(a)?"v4":e.getTypeLength(b)>e.getTypeLength(a)?b:a},OperatorNode.prototype.generate=function(e,output){var t=this.getType(e),a=this.a.build(e,t),b=this.b.build(e,t);return e.format("( "+a+" "+this.op+" "+b+" )",t,output)},OperatorNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.a=source.a,this.b=source.b,this.op=source.op,this},OperatorNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).a=this.a.toJSON(meta).uuid,data.b=this.b.toJSON(meta).uuid,data.op=this.op),data},MathNode.RAD="radians",MathNode.DEG="degrees",MathNode.EXP="exp",MathNode.EXP2="exp2",MathNode.LOG="log",MathNode.LOG2="log2",MathNode.SQRT="sqrt",MathNode.INV_SQRT="inversesqrt",MathNode.FLOOR="floor",MathNode.CEIL="ceil",MathNode.NORMALIZE="normalize",MathNode.FRACT="fract",MathNode.SATURATE="saturate",MathNode.SIN="sin",MathNode.COS="cos",MathNode.TAN="tan",MathNode.ASIN="asin",MathNode.ACOS="acos",MathNode.ARCTAN="atan",MathNode.ABS="abs",MathNode.SIGN="sign",MathNode.LENGTH="length",MathNode.NEGATE="negate",MathNode.INVERT="invert",MathNode.MIN="min",MathNode.MAX="max",MathNode.MOD="mod",MathNode.STEP="step",MathNode.REFLECT="reflect",MathNode.DISTANCE="distance",MathNode.DOT="dot",MathNode.CROSS="cross",MathNode.POW="pow",MathNode.MIX="mix",MathNode.CLAMP="clamp",MathNode.REFRACT="refract",MathNode.SMOOTHSTEP="smoothstep",MathNode.FACEFORWARD="faceforward",MathNode.prototype=Object.create(TempNode.prototype),MathNode.prototype.constructor=MathNode,MathNode.prototype.nodeType="Math",MathNode.prototype.getNumInputs=function(){switch(this.method){case MathNode.MIX:case MathNode.CLAMP:case MathNode.REFRACT:case MathNode.SMOOTHSTEP:case MathNode.FACEFORWARD:return 3;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:case MathNode.STEP:case MathNode.REFLECT:case MathNode.DISTANCE:case MathNode.DOT:case MathNode.CROSS:case MathNode.POW:return 2;default:return 1}},MathNode.prototype.getInputType=function(e){var a=e.getTypeLength(this.a.getType(e)),b=this.b?e.getTypeLength(this.b.getType(e)):0,t=this.c?e.getTypeLength(this.c.getType(e)):0;return a>b&&a>t?this.a.getType(e):b>t?this.b.getType(e):this.c.getType(e)},MathNode.prototype.getType=function(e){switch(this.method){case MathNode.LENGTH:case MathNode.DISTANCE:case MathNode.DOT:return"f";case MathNode.CROSS:return"v3"}return this.getInputType(e)},MathNode.prototype.generate=function(e,output){var a,b,t,r=this.a?e.getTypeLength(this.a.getType(e)):0,n=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.method){case MathNode.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,output);case MathNode.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,output);case MathNode.CROSS:a=this.a.build(e,"v3"),b=this.b.build(e,"v3");break;case MathNode.STEP:a=this.a.build(e,1===r?"f":l),b=this.b.build(e,l);break;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:a=this.a.build(e,l),b=this.b.build(e,1===n?"f":l);break;case MathNode.REFRACT:a=this.a.build(e,l),b=this.b.build(e,l),t=this.c.build(e,"f");break;case MathNode.MIX:a=this.a.build(e,l),b=this.b.build(e,l),t=this.c.build(e,1===o?"f":l);break;default:a=this.a.build(e,l),this.b&&(b=this.b.build(e,l)),this.c&&(t=this.c.build(e,l))}var h=[];h.push(a),b&&h.push(b),t&&h.push(t);var d=this.getNumInputs(e);if(h.length!==d)throw Error('Arguments not match used in "'+this.method+'". Require '+d+", currently "+h.length+".");return e.format(this.method+"( "+h.join(", ")+" )",c,output)},MathNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.a=source.a,this.b=source.b,this.c=source.c,this.method=source.method,this},MathNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).a=this.a.toJSON(meta).uuid,this.b&&(data.b=this.b.toJSON(meta).uuid),this.c&&(data.c=this.c.toJSON(meta).uuid),data.method=this.method),data},TextureCubeUVNode.Nodes=function(){var e=new StructNode("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new ConstNode("float cubeUV_maxMipLevel 8.0",!0),r=new ConstNode("float cubeUV_minMipLevel 4.0",!0),n=new ConstNode("float cubeUV_maxTileSize 256.0",!0),o=new ConstNode("float cubeUV_minTileSize 16.0",!0),l=new FunctionNode("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");l.useKeywords=!1;var c=new FunctionNode("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x);\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(direction.x, -direction.z) / abs(direction.y);\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = direction.xy / abs(direction.z);\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x);\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = direction.xz / abs(direction.y);\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z);\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");c.useKeywords=!1;var h=new FunctionNode("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n \n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,l,c,t,r,n,o]);h.useKeywords=!1;var d=new ConstNode("float r0 1.0",!0),f=new ConstNode("float v0 0.339",!0),m=new ConstNode("float m0 -2.0",!0);return{bilinearCubeUV:h,roughnessToMip:new FunctionNode("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[d,f,m,new ConstNode("float r1 0.8",!0),new ConstNode("float v1 0.276",!0),new ConstNode("float m1 -1.0",!0),new ConstNode("float r4 0.4",!0),new ConstNode("float v4 0.046",!0),new ConstNode("float m4 2.0",!0),new ConstNode("float r5 0.305",!0),new ConstNode("float v5 0.016",!0),new ConstNode("float m5 3.0",!0),new ConstNode("float r6 0.21",!0),new ConstNode("float v6 0.0038",!0),new ConstNode("float m6 4.0",!0)]),m0:m,cubeUV_maxMipLevel:t}}(),TextureCubeUVNode.prototype=Object.create(TempNode.prototype),TextureCubeUVNode.prototype.constructor=TextureCubeUVNode,TextureCubeUVNode.prototype.nodeType="TextureCubeUV",TextureCubeUVNode.prototype.bilinearCubeUV=function(e,t,r,n){var o=new FunctionCallNode(TextureCubeUVNode.Nodes.bilinearCubeUV,[t,r,n]);this.colorSpaceTL=this.colorSpaceTL||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(o.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(o.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(o.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(o.build(e)+".br");var l={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(l),this.colorSpaceTLExp=new ExpressionNode(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new ExpressionNode(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new ExpressionNode(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new ExpressionNode(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();var output=new ExpressionNode("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return output.keywords.cubeUV_TL=this.colorSpaceTLExp,output.keywords.cubeUV_TR=this.colorSpaceTRExp,output.keywords.cubeUV_BL=this.colorSpaceBLExp,output.keywords.cubeUV_BR=this.colorSpaceBRExp,output.keywords.cubeUV=o,output},TextureCubeUVNode.prototype.generate=function(e,output){if(e.isShader("fragment")){var t=this.uv,r=this.bias||e.context.roughness,n=new MathNode(new FunctionCallNode(TextureCubeUVNode.Nodes.roughnessToMip,[r]),TextureCubeUVNode.Nodes.m0,TextureCubeUVNode.Nodes.cubeUV_maxMipLevel,MathNode.CLAMP),o=new MathNode(n,MathNode.FLOOR),l=new MathNode(n,MathNode.FRACT),c=new MathNode(this.bilinearCubeUV(e,this.value,t,o),this.bilinearCubeUV(e,this.value,t,new OperatorNode(o,new FloatNode(1).setReadonly(!0),OperatorNode.ADD)),l,MathNode.MIX);return e.format(c.build(e),"v4",output)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),output)},TextureCubeUVNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid,data.uv=this.uv.toJSON(meta).uuid,data.bias=this.bias.toJSON(meta).uuid),data},TextureCubeNode.prototype=Object.create(TempNode.prototype),TextureCubeNode.prototype.constructor=TextureCubeNode,TextureCubeNode.prototype.nodeType="TextureCube",TextureCubeNode.prototype.generate=function(e,output){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,output)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),output))},TextureCubeNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.value=source.value,this},TextureCubeNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid),data};var elements=NodeUtils.elements,constructors=["float","vec2","vec3","vec4"],convertFormatToType={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},convertTypeToFormat={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function NodeBuilder(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}function BoolNode(e){InputNode.call(this,"b"),this.value=Boolean(e)}function IntNode(e){InputNode.call(this,"i"),this.value=Math.floor(e||0)}function ColorNode(e,g,b){InputNode.call(this,"c"),this.value=e instanceof Color?e:new Color(e||0,g,b)}function Matrix3Node(e){InputNode.call(this,"m3"),this.value=e||new Matrix3}function Matrix4Node(e){InputNode.call(this,"m4"),this.value=e||new Matrix4}function ScreenNode(e){TextureNode.call(this,void 0,e)}function ReflectorNode(e){TempNode.call(this,"v4"),e&&this.setMirror(e)}function PropertyNode(object,e,t){InputNode.call(this,t),this.object=object,this.property=e}function RawNode(e){Node.call(this,"v4"),this.value=e}function NodeMaterial(e,t){ShaderMaterial.call(this);var r=this;this.vertex=e||new RawNode(new PositionNode(PositionNode.PROJECTION)),this.fragment=t||new RawNode(new ColorNode(16711680)),this.updaters=[],this.onBeforeCompile=function(e,t){var r=t.properties.get(this);this.version!==r.__version&&(this.build({renderer:t}),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader)},this.onBeforeCompile.toString=function(){return r.needsCompile}}function RTTNode(e,t,input,r){r=r||{},this.input=input,this.clear=void 0===r.clear||r.clear,this.renderTarget=new WebGLRenderTarget(e,t,r),this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,TextureNode.call(this,this.renderTarget.texture)}NodeBuilder.prototype={constructor:NodeBuilder,build:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(var i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){var r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")},setMaterial:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this},addFlow:function(slot,e,t){return this.addSlot(slot).addCache(e).addContext(t)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(e){return this.cache=e||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(e){return this.slot=e||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(code){this.addCode(code,"vertex")},addFragmentCode:function(code){this.addCode(code,"fragment")},addCode:function(code,e){this.code[e||this.shader]+=code+"\n"},addVertexNodeCode:function(code){this.addNodeCode(code,"vertex")},addFragmentNodeCode:function(code){this.addNodeCode(code,"fragment")},addNodeCode:function(code,e){this.nodeCode[e||this.shader]+=code+"\n"},clearNodeCode:function(e){e=e||this.shader;var code=this.nodeCode[e];return this.nodeCode[e]="",code},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(code){this.addFinalCode(code,"vertex")},addFragmentFinalCode:function(code){this.addFinalCode(code,"fragment")},addFinalCode:function(code,e){this.finalCode[e||this.shader]+=code+"\n"},addVertexParsCode:function(code){this.addParsCode(code,"vertex")},addFragmentParsCode:function(code){this.addParsCode(code,"fragment")},addParsCode:function(code,e){this.parsCode[e||this.shader]+=code+"\n"},addVaryCode:function(code){this.addVertexParsCode(code),this.addFragmentParsCode(code)},isCache:function(e){return-1!==this.caches.indexOf(e)},isSlot:function(e){return-1!==this.slots.indexOf(e)},define:function(e,t){this.defines[e]=void 0===t?1:t},require:function(e){this.requires[e]=!0},isDefined:function(e){return void 0!==this.defines[e]},getVar:function(e,t,r,n,o,label){void 0===n&&(n="varying"),void 0===o&&(o="V"),void 0===label&&(label="");var l=this.getVars(n),data=l[e];if(!data){var c=l.length;data={name:r||"node"+o+c+(label?"_"+label:""),type:t},l.push(data),l[e]=data}return data},getTempVar:function(e,t,r,label){return this.getVar(e,t,r,this.shader,"T",label)},getAttribute:function(e,t){if(!this.attributes[e]){var r=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]},getCode:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")},getVarListCode:function(e,t){t=t||"";for(var code="",i=0,r=e.length;i<r;++i){var n=e[i],o=n.type,l=n.name,c=this.getFormatByType(o);if(void 0===c)throw new Error("Node pars "+c+" not found.");code+=t+" "+c+" "+l+";\n"}return code},getVars:function(e){return this.inputs.vars[e||this.shader]},getNodeData:function(e){var t=e.isNode?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}},createUniform:function(e,t,r,n,o,label){var l=this.inputs.uniforms,c=l.list.length,h=new NodeUniform({type:t,name:n||"nodeU"+c+(label?"_"+label:""),node:r,needsUpdate:o});return l.list.push(h),l[e].push(h),l[e][h.name]=h,this.uniforms[h.name]=h,h},createVertexUniform:function(e,t,r,n,label){return this.createUniform("vertex",e,t,r,n,label)},createFragmentUniform:function(e,t,r,n,label){return this.createUniform("fragment",e,t,r,n,label)},include:function(e,t,source){var r;if(e="string"==typeof e?NodeLib.get(e):e,!1===this.context.include)return e.name;e instanceof FunctionNode?r=this.includes.functions:e instanceof ConstNode?r=this.includes.consts:e instanceof StructNode&&(r=this.includes.structs);var n=r[this.shader]=r[this.shader]||[];if(e){var o=n[e.name];if(o||(o=n[e.name]={node:e,deps:[]},n.push(o),o.src=e.build(this,"source")),e instanceof FunctionNode&&t&&n[t.name]&&-1==n[t.name].deps.indexOf(e)&&(n[t.name].deps.push(e),e.includes&&e.includes.length)){var i=0;do{this.include(e.includes[i++],t)}while(i<e.includes.length)}return source&&(o.src=source),e.name}throw new Error("Include not found.")},colorToVectorProperties:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(e){return e.replace(/c/g,"v3")},getIncludes:function(e,t){return this.includes[e][t||this.shader]},getIncludesCode:function(){function e(a,b){return a.deps.length-b.deps.length}return function(t,r){if(!(n=this.getIncludes(t,r)))return"";for(var code="",n=n.sort(e),i=0;i<n.length;i++)n[i].src&&(code+=n[i].src+"\n");return code}}(),getConstructorFromLength:function(e){return constructors[e-1]},isTypeMatrix:function(e){return/^m/.test(e)},getTypeLength:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))},getTypeFromLength:function(e){return 1===e?"f":"v"+e},findNode:function(){for(var e=arguments,i=0;i<arguments.length;i++){var t=e[i];if(void 0!==t&&t.isNode)return t}},resolve:function(){for(var e=arguments,i=0;i<arguments.length;i++){var t=e[i];if(void 0!==t){if(t.isNode)return t;if(t.isTexture)switch(t.mapping){case CubeReflectionMapping:case CubeRefractionMapping:return new CubeTextureNode(t);case CubeUVReflectionMapping:case CubeUVRefractionMapping:return new TextureCubeNode(new TextureNode(t));default:return new TextureNode(t)}else{if(t.isVector2)return new Vector2Node(t);if(t.isVector3)return new Vector3Node(t);if(t.isVector4)return new Vector4Node(t)}}}},format:function(code,e,t){switch(this.colorToVector(t+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return code+".x";case"f <- i":case"f <- b":return"float( "+code+" )";case"v2 <- f":return"vec2( "+code+" )";case"v2 <- v3":case"v2 <- v4":return code+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+code+" ) )";case"v3 <- f":return"vec3( "+code+" )";case"v3 <- v2":return"vec3( "+code+", 0.0 )";case"v3 <- v4":return code+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+code+" ) )";case"v4 <- f":return"vec4( "+code+" )";case"v4 <- v2":return"vec4( "+code+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+code+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+code+" ) )";case"i <- f":case"i <- b":return"int( "+code+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+code+".x )";case"b <- f":return"( "+code+" != 0.0 )";case"b <- v2":return"( "+code+" != vec2( 0.0 ) )";case"b <- v3":return"( "+code+" != vec3( 0.0 ) )";case"b <- v4":return"( "+code+" != vec4( 0.0 ) )";case"b <- i":return"( "+code+" != 0 )"}return code},getTypeByFormat:function(e){return convertFormatToType[e]||e},getFormatByType:function(e){return convertTypeToFormat[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return elements[e]},getIndexByElement:function(e){return elements.indexOf(e)},isShader:function(e){return this.shader===e},setShader:function(e){return this.shader=e,this},mergeDefines:function(e){for(var t in e)this.defines[t]=e[t];return this.defines},mergeUniform:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms},getTextureEncodingFromMap:function(map){var e;return map?map.isTexture?e=map.encoding:map.isWebGLRenderTarget&&(console.warn("WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=map.texture.encoding):e=LinearEncoding,e===LinearEncoding&&this.context.gamma&&(e=GammaEncoding),e}},BoolNode.prototype=Object.create(InputNode.prototype),BoolNode.prototype.constructor=BoolNode,BoolNode.prototype.nodeType="Bool",BoolNode.prototype.generateReadonly=function(e,output,t,r){return e.format(this.value,r,output)},BoolNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value=source.value,this},BoolNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value,!0===this.readonly&&(data.readonly=!0)),data},IntNode.prototype=Object.create(InputNode.prototype),IntNode.prototype.constructor=IntNode,IntNode.prototype.nodeType="Int",IntNode.prototype.generateReadonly=function(e,output,t,r){return e.format(this.value,r,output)},IntNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value=source.value,this},IntNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value,!0===this.readonly&&(data.readonly=!0)),data},ColorNode.prototype=Object.create(InputNode.prototype),ColorNode.prototype.constructor=ColorNode,ColorNode.prototype.nodeType="Color",NodeUtils.addShortcuts(ColorNode.prototype,"value",["r","g","b"]),ColorNode.prototype.generateReadonly=function(e,output,t,r){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,output)},ColorNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value.copy(source),this},ColorNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).r=this.r,data.g=this.g,data.b=this.b,!0===this.readonly&&(data.readonly=!0)),data},Matrix3Node.prototype=Object.create(InputNode.prototype),Matrix3Node.prototype.constructor=Matrix3Node,Matrix3Node.prototype.nodeType="Matrix3",Object.defineProperties(Matrix3Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix3Node.prototype.generateReadonly=function(e,output,t,r){return e.format("mat3( "+this.value.elements.join(", ")+" )",r,output)},Matrix3Node.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.value.fromArray(source.elements),this},Matrix3Node.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).elements=this.value.elements.concat()),data},Matrix4Node.prototype=Object.create(InputNode.prototype),Matrix4Node.prototype.constructor=Matrix4Node,Matrix4Node.prototype.nodeType="Matrix4",Object.defineProperties(Matrix4Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix4Node.prototype.generateReadonly=function(e,output,t,r){return e.format("mat4( "+this.value.elements.join(", ")+" )",r,output)},Matrix4Node.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.scope.value.fromArray(source.elements),this},Matrix4Node.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).elements=this.value.elements.concat()),data},ScreenNode.prototype=Object.create(TextureNode.prototype),ScreenNode.prototype.constructor=ScreenNode,ScreenNode.prototype.nodeType="Screen",ScreenNode.prototype.getUnique=function(){return!0},ScreenNode.prototype.getTexture=function(e,output){return InputNode.prototype.generate.call(this,e,output,this.getUuid(),"t","renderTexture")},ReflectorNode.prototype=Object.create(TempNode.prototype),ReflectorNode.prototype.constructor=ReflectorNode,ReflectorNode.prototype.nodeType="Reflector",ReflectorNode.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new PositionNode(PositionNode.LOCAL),this.uv=new OperatorNode(this.textureMatrix,this.localPosition,OperatorNode.MUL),this.uvResult=new OperatorNode(null,this.uv,OperatorNode.ADD),this.texture=new TextureNode(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},ReflectorNode.prototype.generate=function(e,output){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===output?this.texture.build(e,output):e.format(this.texture.build(e,this.type),this.type,output)):(console.warn("ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,output))},ReflectorNode.prototype.copy=function(source){return InputNode.prototype.copy.call(this,source),this.scope.mirror=source.mirror,this},ReflectorNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).mirror=this.mirror.uuid,this.offset&&(data.offset=this.offset.toJSON(meta).uuid)),data},PropertyNode.prototype=Object.create(InputNode.prototype),PropertyNode.prototype.constructor=PropertyNode,PropertyNode.prototype.nodeType="Property",Object.defineProperties(PropertyNode.prototype,{value:{get:function(){return this.object[this.property]},set:function(e){this.object[this.property]=e}}}),PropertyNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value,data.property=this.property),data},RawNode.prototype=Object.create(Node.prototype),RawNode.prototype.constructor=RawNode,RawNode.prototype.nodeType="Raw",RawNode.prototype.generate=function(e){var data=this.value.analyzeAndFlow(e,this.type),code=data.code+"\n";return e.isShader("vertex")?code+="gl_Position = "+data.result+";":code+="gl_FragColor = "+data.result+";",code},RawNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),this.value=source.value,this},RawNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid),data},NodeMaterial.prototype=Object.create(ShaderMaterial.prototype),NodeMaterial.prototype.constructor=NodeMaterial,NodeMaterial.prototype.type="NodeMaterial",NodeMaterial.prototype.isNodeMaterial=!0,Object.defineProperties(NodeMaterial.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),NodeMaterial.prototype.updateFrame=function(e){for(var i=0;i<this.updaters.length;++i)e.updateNode(this.updaters[i])},NodeMaterial.prototype.build=function(e){var t=(e=e||{}).builder||new NodeBuilder;return t.setMaterial(this,e.renderer),t.build(this.vertex,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.fog=t.requires.fog,this.lights=t.requires.lights,this.transparent=t.requires.transparent||this.blending>NormalBlending,this},NodeMaterial.prototype.copy=function(source){var e=this.uuid;for(var t in source)this[t]=source[t];return this.uuid=e,void 0!==source.userData&&(this.userData=JSON.parse(JSON.stringify(source.userData))),this},NodeMaterial.prototype.toJSON=function(meta){if((void 0===meta||"string"==typeof meta)&&(meta={nodes:{}}),meta&&!meta.materials&&(meta.materials={}),!meta.materials[this.uuid]){var data={};data.uuid=this.uuid,data.type=this.type,meta.materials[data.uuid]=data,""!==this.name&&(data.name=this.name),void 0!==this.size&&(data.size=this.size),void 0!==this.sizeAttenuation&&(data.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(data.blending=this.blending),!0===this.flatShading&&(data.flatShading=this.flatShading),this.side!==FrontSide&&(data.side=this.side),this.vertexColors!==NoColors&&(data.vertexColors=this.vertexColors),this.depthFunc!==LessEqualDepth&&(data.depthFunc=this.depthFunc),!1===this.depthTest&&(data.depthTest=this.depthTest),!1===this.depthWrite&&(data.depthWrite=this.depthWrite),1!==this.linewidth&&(data.linewidth=this.linewidth),void 0!==this.dashSize&&(data.dashSize=this.dashSize),void 0!==this.gapSize&&(data.gapSize=this.gapSize),void 0!==this.scale&&(data.scale=this.scale),!0===this.dithering&&(data.dithering=!0),!0===this.wireframe&&(data.wireframe=this.wireframe),this.wireframeLinewidth>1&&(data.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(data.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(data.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(data.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(data.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(data.morphTargets=!0),!0===this.skinning&&(data.skinning=!0),!1===this.visible&&(data.visible=!1),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),data.fog=this.fog,data.lights=this.lights,data.vertex=this.vertex.toJSON(meta).uuid,data.fragment=this.fragment.toJSON(meta).uuid}return meta.material=this.uuid,meta},RTTNode.prototype=Object.create(TextureNode.prototype),RTTNode.prototype.constructor=RTTNode,RTTNode.prototype.nodeType="RTT",RTTNode.prototype.build=function(e,output,t){var r=new NodeBuilder;return r.nodes=e.nodes,r.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:r}),TextureNode.prototype.build.call(this,e,output,t)},RTTNode.prototype.updateFramesaveTo=function(e){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var t=new NodeMaterial;t.fragment.value=this,t.build();var r=new Scene,n=new Mesh(new PlaneBufferGeometry(2,2),t);n.frustumCulled=!1,r.add(n),this.saveToScene=r,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)},RTTNode.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},RTTNode.prototype.copy=function(source){return TextureNode.prototype.copy.call(this,source),this.saveTo=source.saveTo,this},RTTNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=TextureNode.prototype.toJSON.call(this,meta),this.saveTo&&(data.saveTo=this.saveTo.toJSON(meta).uuid)),data};var vertexDict=["color","color2"],fragmentDict=["vColor","vColor2"],dHdxy_fwd;function ColorsNode(e){TempNode.call(this,"v4",{shared:!1}),this.index=e||0}function CameraNode(e,t){TempNode.call(this,"v3"),this.setScope(e||CameraNode.POSITION),this.setCamera(t)}function LightNode(e){TempNode.call(this,"v3",{shared:!1}),this.scope=e||LightNode.TOTAL}function ResolutionNode(){Vector2Node.call(this),this.size=new Vector2}function ScreenUVNode(e){TempNode.call(this,"v2"),this.resolution=e||new ResolutionNode}function CondNode(a,b,e,t,r){TempNode.call(this),this.a=a,this.b=b,this.op=e,this.ifNode=t,this.elseNode=r}function NoiseNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function CheckerNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function NormalMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new Vector2Node(1,1)}function BumpMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new FloatNode(1),this.toNormalMap=!1}function BypassNode(code,e){Node.call(this),this.code=code,this.value=e}ColorsNode.prototype=Object.create(TempNode.prototype),ColorsNode.prototype.constructor=ColorsNode,ColorsNode.prototype.nodeType="Colors",ColorsNode.prototype.generate=function(e,output){e.requires.color[this.index]=!0;var t=e.isShader("vertex")?vertexDict[this.index]:fragmentDict[this.index];return e.format(t,this.getType(e),output)},ColorsNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.index=source.index,this},ColorsNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).index=this.index),data},CameraNode.Nodes={depthColor:new FunctionNode(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},CameraNode.POSITION="position",CameraNode.DEPTH="depth",CameraNode.TO_VERTEX="toVertex",CameraNode.prototype=Object.create(TempNode.prototype),CameraNode.prototype.constructor=CameraNode,CameraNode.prototype.nodeType="Camera",CameraNode.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},CameraNode.prototype.setScope=function(e){switch(this.scope){case CameraNode.DEPTH:delete this.near,delete this.far}switch(this.scope=e,e){case CameraNode.DEPTH:var t=this.camera;this.near=new FloatNode(t?t.near:1),this.far=new FloatNode(t?t.far:1200)}},CameraNode.prototype.getType=function(){switch(this.scope){case CameraNode.DEPTH:return"f"}return this.type},CameraNode.prototype.getUnique=function(){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return!0}return!1},CameraNode.prototype.getShared=function(){switch(this.scope){case CameraNode.POSITION:return!1}return!0},CameraNode.prototype.generate=function(e,output){var t;switch(this.scope){case CameraNode.POSITION:t="cameraPosition";break;case CameraNode.DEPTH:t=e.include(CameraNode.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case CameraNode.TO_VERTEX:t="normalize( "+new PositionNode(PositionNode.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(t,this.getType(e),output)},CameraNode.prototype.onUpdateFrame=function(){switch(this.scope){case CameraNode.DEPTH:var e=this.camera;this.near.value=e.near,this.far.value=e.far}},CameraNode.prototype.copy=function(source){switch(TempNode.prototype.copy.call(this,source),this.setScope(source.scope),source.camera&&this.setCamera(source.camera),source.scope){case CameraNode.DEPTH:this.near.number=source.near,this.far.number=source.far}return this},CameraNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);if(!data)switch((data=this.createJSONNode(meta)).scope=this.scope,this.camera&&(data.camera=this.camera.uuid),this.scope){case CameraNode.DEPTH:data.near=this.near.value,data.far=this.far.value}return data},LightNode.TOTAL="total",LightNode.prototype=Object.create(TempNode.prototype),LightNode.prototype.constructor=LightNode,LightNode.prototype.nodeType="Light",LightNode.prototype.generate=function(e,output){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.type,output):(console.warn('LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.type,output))},LightNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.scope=source.scope,this},LightNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).scope=this.scope),data},ResolutionNode.prototype=Object.create(Vector2Node.prototype),ResolutionNode.prototype.constructor=ResolutionNode,ResolutionNode.prototype.nodeType="Resolution",ResolutionNode.prototype.updateFrame=function(e){if(e.renderer){e.renderer.getSize(this.size);var t=e.renderer.getPixelRatio();this.x=this.size.width*t,this.y=this.size.height*t}else console.warn("ResolutionNode need a renderer in NodeFrame")},ResolutionNode.prototype.copy=function(source){return Vector2Node.prototype.copy.call(this,source),this.renderer=source.renderer,this},ResolutionNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).renderer=this.renderer.uuid),data},ScreenUVNode.prototype=Object.create(TempNode.prototype),ScreenUVNode.prototype.constructor=ScreenUVNode,ScreenUVNode.prototype.nodeType="ScreenUV",ScreenUVNode.prototype.generate=function(e,output){var t;return e.isShader("fragment")?t="( gl_FragCoord.xy / "+this.resolution.build(e,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+e.shader+" shader."),t="vec2( 0.0 )"),e.format(t,this.getType(e),output)},ScreenUVNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.resolution=source.resolution,this},ScreenUVNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).resolution=this.resolution.toJSON(meta).uuid),data},CondNode.EQUAL="==",CondNode.NOT_EQUAL="!=",CondNode.GREATER=">",CondNode.GREATER_EQUAL=">=",CondNode.LESS="<",CondNode.LESS_EQUAL="<=",CondNode.prototype=Object.create(TempNode.prototype),CondNode.prototype.constructor=CondNode,CondNode.prototype.nodeType="Cond",CondNode.prototype.getType=function(e){if(this.ifNode){var t=this.ifNode.getType(e),r=this.elseNode.getType(e);return e.getTypeLength(r)>e.getTypeLength(t)?r:t}return"b"},CondNode.prototype.getCondType=function(e){return e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},CondNode.prototype.generate=function(e,output){var code,t=this.getType(e),r=this.getCondType(e),a=this.a.build(e,r),b=this.b.build(e,r);if(this.ifNode){var n=this.ifNode.build(e,t),o=this.elseNode.build(e,t);code="( "+[a,this.op,b,"?",n,":",o].join(" ")+" )"}else code="( "+a+" "+this.op+" "+b+" )";return e.format(code,this.getType(e),output)},CondNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.a=source.a,this.b=source.b,this.op=source.op,this.ifNode=source.ifNode,this.elseNode=source.elseNode,this},CondNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).a=this.a.toJSON(meta).uuid,data.b=this.b.toJSON(meta).uuid,data.op=this.op,data.ifNode&&(data.ifNode=this.ifNode.toJSON(meta).uuid),data.elseNode&&(data.elseNode=this.elseNode.toJSON(meta).uuid)),data},NoiseNode.prototype=Object.create(TempNode.prototype),NoiseNode.prototype.constructor=NoiseNode,NoiseNode.prototype.nodeType="Noise",NoiseNode.Nodes={snoise:new FunctionNode(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},NoiseNode.prototype.generate=function(e,output){var t=e.include(NoiseNode.Nodes.snoise);return e.format(t+"( "+this.uv.build(e,"v2")+" )",this.getType(e),output)},NoiseNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.uv=source.uv,this},NoiseNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).uv=this.uv.toJSON(meta).uuid),data},CheckerNode.prototype=Object.create(TempNode.prototype),CheckerNode.prototype.constructor=CheckerNode,CheckerNode.prototype.nodeType="Noise",CheckerNode.Nodes={checker:new FunctionNode(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},CheckerNode.prototype.generate=function(e,output){var t=e.include(CheckerNode.Nodes.checker);return e.format(t+"( "+this.uv.build(e,"v2")+" )",this.getType(e),output)},CheckerNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.uv=source.uv,this},CheckerNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).uv=this.uv.toJSON(meta).uuid),data},NormalMapNode.Nodes={perturbNormal2Arb:new FunctionNode("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},NormalMapNode.prototype=Object.create(TempNode.prototype),NormalMapNode.prototype.constructor=NormalMapNode,NormalMapNode.prototype.nodeType="NormalMap",NormalMapNode.prototype.generate=function(e,output){if(e.isShader("fragment")){var t=e.include(NormalMapNode.Nodes.perturbNormal2Arb);this.normal=this.normal||new NormalNode,this.position=this.position||new PositionNode(PositionNode.VIEW),this.uv=this.uv||new UVNode;var r=this.scale.build(e,"v2");return e.material.side===BackSide&&(r="-"+r),e.format(t+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+r+" )",this.getType(e),output)}return console.warn("NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),output)},NormalMapNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.value=source.value,this.scale=source.scale,this},NormalMapNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid,data.scale=this.scale.toJSON(meta).uuid),data},BumpMapNode.Nodes=(dHdxy_fwd=new FunctionNode(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0}),{dHdxy_fwd:dHdxy_fwd,perturbNormalArb:new FunctionNode(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[dHdxy_fwd],{derivatives:!0}),bumpToNormal:new FunctionNode(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})}),BumpMapNode.prototype=Object.create(TempNode.prototype),BumpMapNode.prototype.constructor=BumpMapNode,BumpMapNode.prototype.nodeType="BumpMap",BumpMapNode.prototype.generate=function(e,output){if(e.isShader("fragment")){if(this.toNormalMap){var t=e.include(BumpMapNode.Nodes.bumpToNormal);return e.format(t+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )",this.getType(e),output)}var r=e.include(BumpMapNode.Nodes.dHdxy_fwd),n=e.include(BumpMapNode.Nodes.perturbNormalArb);this.normal=this.normal||new NormalNode,this.position=this.position||new PositionNode(PositionNode.VIEW);var o=r+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )";return e.format(n+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+o+" )",this.getType(e),output)}return console.warn("BumpMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),output)},BumpMapNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.value=source.value,this.scale=source.scale,this},BumpMapNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid,data.scale=this.scale.toJSON(meta).uuid),data},BypassNode.prototype=Object.create(Node.prototype),BypassNode.prototype.constructor=BypassNode,BypassNode.prototype.nodeType="Bypass",BypassNode.prototype.getType=function(e){return this.value?this.value.getType(e):e.isShader("fragment")?"f":"void"},BypassNode.prototype.generate=function(e,output){var code=this.code.build(e,output)+";";return e.addNodeCode(code),e.isShader("vertex")?this.value?this.value.build(e,output):void 0:this.value?this.value.build(e,output):e.format("0.0","f",output)},BypassNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),this.code=source.code,this.value=source.value,this},BypassNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).code=this.code.toJSON(meta).uuid,this.value&&(data.value=this.value.toJSON(meta).uuid)),data};var inputs=NodeUtils.elements,LUMA;function JoinNode(e,t,r,n){TempNode.call(this,"f"),this.x=e,this.y=t,this.z=r,this.w=n}function SwitchNode(e,t){Node.call(this),this.node=e,this.components=t||"x"}function TimerNode(e,t,r){FloatNode.call(this),this.scale=void 0!==e?e:1,this.scope=t||TimerNode.GLOBAL,this.timeScale=void 0!==r?r:void 0!==e}function VelocityNode(e,t){Vector3Node.call(this),this.params={},this.velocity=new Vector3,this.setTarget(e),this.setParams(t)}function UVTransformNode(e,t){ExpressionNode.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=e||new UVNode,this.position=t||new Matrix3Node}function MaxMIPLevelNode(e){FloatNode.call(this),this.texture=e,this.maxMIPLevel=0}function SpecularMIPLevelNode(e,t){TempNode.call(this,"f"),this.roughness=e,this.texture=t,this.maxMIPLevel=void 0}function SubSlotNode(e){TempNode.call(this),this.slots=e||{}}function BlurNode(e,t,r,n){TempNode.call(this,"v4"),this.value=e,this.uv=t||new UVNode,this.radius=r||new Vector2Node(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new FloatNode(1/64),this.vertical=new FloatNode(1/64)}function LuminanceNode(e){TempNode.call(this,"f"),this.rgb=e}function ColorAdjustmentNode(e,t,r){TempNode.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=r||ColorAdjustmentNode.SATURATION}function SpriteNode(){Node.call(this),this.color=new ColorNode(15658734),this.spherical=!0}function PhongNode(){Node.call(this),this.color=new ColorNode(15658734),this.specular=new ColorNode(1118481),this.shininess=new FloatNode(30)}function StandardNode(){Node.call(this),this.color=new ColorNode(16777215),this.roughness=new FloatNode(1),this.metalness=new FloatNode(0)}function MeshStandardNode(){StandardNode.call(this),this.properties={color:new Color(16777215),roughness:.5,metalness:.5,normalScale:new Vector2(1,1)},this.inputs={color:new PropertyNode(this.properties,"color","c"),roughness:new PropertyNode(this.properties,"roughness","f"),metalness:new PropertyNode(this.properties,"metalness","f"),normalScale:new PropertyNode(this.properties,"normalScale","v2")}}function SpriteNodeMaterial(){var e=new SpriteNode;NodeMaterial.call(this,e,e),this.type="SpriteNodeMaterial"}function PhongNodeMaterial(){var e=new PhongNode;NodeMaterial.call(this,e,e),this.type="PhongNodeMaterial"}function StandardNodeMaterial(){var e=new StandardNode;NodeMaterial.call(this,e,e),this.type="StandardNodeMaterial"}function MeshStandardNodeMaterial(){var e=new MeshStandardNode;NodeMaterial.call(this,e,e),this.type="MeshStandardNodeMaterial"}function NodePostProcessing(e,t){if(void 0===t){var r={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1},n=e.getDrawingBufferSize(new Vector2);t=new WebGLRenderTarget(n.width,n.height,r)}this.renderer=e,this.renderTarget=t,this.output=new ScreenNode,this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}JoinNode.prototype=Object.create(TempNode.prototype),JoinNode.prototype.constructor=JoinNode,JoinNode.prototype.nodeType="Join",JoinNode.prototype.getNumElements=function(){for(var i=inputs.length;i--;)if(void 0!==this[inputs[i]]){++i;break}return Math.max(i,2)},JoinNode.prototype.getType=function(e){return e.getTypeFromLength(this.getNumElements())},JoinNode.prototype.generate=function(e,output){for(var t=this.getType(e),r=this.getNumElements(),n=[],i=0;i<r;i++){var o=this[inputs[i]];n.push(o?o.build(e,"f"):"0.0")}var code=(r>1?e.getConstructorFromLength(r):"")+"( "+n.join(", ")+" )";return e.format(code,t,output)},JoinNode.prototype.copy=function(source){for(var e in TempNode.prototype.copy.call(this,source),source.inputs)this[e]=source.inputs[e];return this},JoinNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);if(!data){(data=this.createJSONNode(meta)).inputs={};for(var e=this.getNumElements(),i=0;i<e;i++){var t=this[inputs[i]];t&&(data.inputs[inputs[i]]=t.toJSON(meta).uuid)}}return data},SwitchNode.prototype=Object.create(Node.prototype),SwitchNode.prototype.constructor=SwitchNode,SwitchNode.prototype.nodeType="Switch",SwitchNode.prototype.getType=function(e){return e.getTypeFromLength(this.components.length)},SwitchNode.prototype.generate=function(e,output){var t=this.node.getType(e),r=this.node.build(e,t),n=e.getTypeLength(t)-1;if(n>0){var i,o=0,l=e.colorToVectorProperties(this.components),c=l.length;for(i=0;i<c;i++)o=Math.max(o,e.getIndexByElement(l.charAt(i)));for(o>n&&(o=n),r+=".",i=0;i<c;i++){l.charAt(i);var h=e.getIndexByElement(l.charAt(i));h>o&&(h=o),r+=e.getElementByIndex(h)}return e.format(r,this.getType(e),output)}return e.format(r,t,output)},SwitchNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),this.node=source.node,this.components=source.components,this},SwitchNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).node=this.node.toJSON(meta).uuid,data.components=this.components),data},TimerNode.GLOBAL="global",TimerNode.LOCAL="local",TimerNode.DELTA="delta",TimerNode.prototype=Object.create(FloatNode.prototype),TimerNode.prototype.constructor=TimerNode,TimerNode.prototype.nodeType="Timer",TimerNode.prototype.getReadonly=function(){return!1},TimerNode.prototype.getUnique=function(){return this.timeScale&&(this.scope===TimerNode.GLOBAL||this.scope===TimerNode.DELTA)},TimerNode.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case TimerNode.LOCAL:this.value+=e.delta*t;break;case TimerNode.DELTA:this.value=e.delta*t;break;default:this.value=e.time*t}},TimerNode.prototype.copy=function(source){return FloatNode.prototype.copy.call(this,source),this.scope=source.scope,this.scale=source.scale,this.timeScale=source.timeScale,this},TimerNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).scope=this.scope,data.scale=this.scale,data.timeScale=this.timeScale),data},NodeLib.addKeyword("time",(function(){return new TimerNode})),VelocityNode.prototype=Object.create(Vector3Node.prototype),VelocityNode.prototype.constructor=VelocityNode,VelocityNode.prototype.nodeType="Velocity",VelocityNode.prototype.getReadonly=function(){return!1},VelocityNode.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new Vector3,this.speed=new Vector3,this.springVelocity=new Vector3,this.lastVelocity=new Vector3}},VelocityNode.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new Vector3),this.oldPosition=this.position.clone())},VelocityNode.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},VelocityNode.prototype.updateFrame=function(e){switch(this.updateFrameVelocity(e),this.params.type){case"elastic":var t=e.delta*(this.params.fps||60),r=Math.pow(this.params.spring,t),n=Math.pow(this.params.damping,t);this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(n).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(n),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},VelocityNode.prototype.copy=function(source){return Vector3Node.prototype.copy.call(this,source),source.target&&this.setTarget(source.target),this.setParams(source.params),this},VelocityNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),this.target&&(data.target=this.target.uuid),data.params=JSON.parse(JSON.stringify(this.params))),data},UVTransformNode.prototype=Object.create(ExpressionNode.prototype),UVTransformNode.prototype.constructor=UVTransformNode,UVTransformNode.prototype.nodeType="UVTransform",UVTransformNode.prototype.generate=function(e,output){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,ExpressionNode.prototype.generate.call(this,e,output)},UVTransformNode.prototype.setUvTransform=function(e,t,r,n,o,l,c){l=void 0!==l?l:.5,c=void 0!==c?c:.5,this.position.value.setUvTransform(e,t,r,n,o,l,c)},UVTransformNode.prototype.copy=function(source){return ExpressionNode.prototype.copy.call(this,source),this.uv=source.uv,this.position=source.position,this},UVTransformNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).uv=this.uv.toJSON(meta).uuid,data.position=this.position.toJSON(meta).uuid),data},MaxMIPLevelNode.prototype=Object.create(FloatNode.prototype),MaxMIPLevelNode.prototype.constructor=MaxMIPLevelNode,MaxMIPLevelNode.prototype.nodeType="MaxMIPLevel",Object.defineProperties(MaxMIPLevelNode.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var image=this.texture.value.image;Array.isArray(image)&&(image=image[0]),this.maxMIPLevel=void 0!==image?Math.log(Math.max(image.width,image.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),MaxMIPLevelNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).texture=this.texture.uuid),data},SpecularMIPLevelNode.Nodes={getSpecularMIPLevel:new FunctionNode(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},SpecularMIPLevelNode.prototype=Object.create(TempNode.prototype),SpecularMIPLevelNode.prototype.constructor=SpecularMIPLevelNode,SpecularMIPLevelNode.prototype.nodeType="SpecularMIPLevel",SpecularMIPLevelNode.prototype.setTexture=function(e){return this.texture=e,this},SpecularMIPLevelNode.prototype.generate=function(e,output){if(e.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new MaxMIPLevelNode,this.maxMIPLevel.texture=this.texture;var t=e.include(SpecularMIPLevelNode.Nodes.getSpecularMIPLevel);return e.format(t+"( "+this.roughness.build(e,"f")+", "+this.maxMIPLevel.build(e,"f")+" )",this.type,output)}return console.warn("SpecularMIPLevelNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,output)},SpecularMIPLevelNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.texture=source.texture,this.roughness=source.roughness,this},SpecularMIPLevelNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).texture=this.texture,data.roughness=this.roughness),data},SubSlotNode.prototype=Object.create(TempNode.prototype),SubSlotNode.prototype.constructor=SubSlotNode,SubSlotNode.prototype.nodeType="SubSlot",SubSlotNode.prototype.getType=function(e,output){return output},SubSlotNode.prototype.generate=function(e,output){return this.slots[e.slot]?this.slots[e.slot].build(e,output):e.format("0.0","f",output)},SubSlotNode.prototype.copy=function(source){for(var e in TempNode.prototype.copy.call(this,source),source.slots)this.slots[e]=source.slots[e];return this},SubSlotNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);if(!data)for(var e in(data=this.createJSONNode(meta)).slots={},this.slots){var slot=this.slots[e];slot&&(data.slots[e]=slot.toJSON(meta).uuid)}return data},BlurNode.Nodes={blurX:new FunctionNode(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new FunctionNode(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},BlurNode.prototype=Object.create(TempNode.prototype),BlurNode.prototype.constructor=BlurNode,BlurNode.prototype.nodeType="Blur",BlurNode.prototype.updateFrame=function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var image=this.value.value.image;this.horizontal.value=this.radius.x/image.width,this.vertical.value=this.radius.y/image.height}},BlurNode.prototype.generate=function(e,output){if(e.isShader("fragment")){var code,t=[],r=e.include(BlurNode.Nodes.blurX),n=e.include(BlurNode.Nodes.blurY);return this.blurX&&t.push(r+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.horizontal.build(e,"f")+" )"),this.blurY&&t.push(n+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.vertical.build(e,"f")+" )"),code=2==t.length?"( "+t.join(" + ")+" / 2.0 )":t.length?"( "+t[0]+" )":"vec4( 0.0 )",e.format(code,this.getType(e),output)}return console.warn("BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),output)},BlurNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.value=source.value,this.uv=source.uv,this.radius=source.radius,void 0!==source.size&&(this.size=new Vector2(source.size.x,source.size.y)),this.blurX=source.blurX,this.blurY=source.blurY,this},BlurNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).value=this.value.toJSON(meta).uuid,data.uv=this.uv.toJSON(meta).uuid,data.radius=this.radius.toJSON(meta).uuid,this.size&&(data.size={x:this.size.x,y:this.size.y}),data.blurX=this.blurX,data.blurY=this.blurY),data},LuminanceNode.Nodes=(LUMA=new ConstNode("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),{LUMA:LUMA,luminance:new FunctionNode(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[LUMA])}),LuminanceNode.prototype=Object.create(TempNode.prototype),LuminanceNode.prototype.constructor=LuminanceNode,LuminanceNode.prototype.nodeType="Luminance",LuminanceNode.prototype.generate=function(e,output){var t=e.include(LuminanceNode.Nodes.luminance);return e.format(t+"( "+this.rgb.build(e,"v3")+" )",this.getType(e),output)},LuminanceNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.rgb=source.rgb,this},LuminanceNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).rgb=this.rgb.toJSON(meta).uuid),data},ColorAdjustmentNode.Nodes={hue:new FunctionNode(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new FunctionNode(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[LuminanceNode.Nodes.luminance]),vibrance:new FunctionNode(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.HUE="hue",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.BRIGHTNESS="brightness",ColorAdjustmentNode.CONTRAST="contrast",ColorAdjustmentNode.prototype=Object.create(TempNode.prototype),ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode,ColorAdjustmentNode.prototype.nodeType="ColorAdjustment",ColorAdjustmentNode.prototype.generate=function(e,output){var t=this.rgb.build(e,"v3"),r=this.adjustment.build(e,"f");switch(this.method){case ColorAdjustmentNode.BRIGHTNESS:return e.format("( "+t+" + "+r+" )",this.getType(e),output);case ColorAdjustmentNode.CONTRAST:return e.format("( "+t+" * "+r+" )",this.getType(e),output)}var n=e.include(ColorAdjustmentNode.Nodes[this.method]);return e.format(n+"( "+t+", "+r+" )",this.getType(e),output)},ColorAdjustmentNode.prototype.copy=function(source){return TempNode.prototype.copy.call(this,source),this.rgb=source.rgb,this.adjustment=source.adjustment,this.method=source.method,this},ColorAdjustmentNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||((data=this.createJSONNode(meta)).rgb=this.rgb.toJSON(meta).uuid,data.adjustment=this.adjustment.toJSON(meta).uuid,data.method=this.method),data},SpriteNode.prototype=Object.create(Node.prototype),SpriteNode.prototype.constructor=SpriteNode,SpriteNode.prototype.nodeType="Sprite",SpriteNode.prototype.build=function(e){if(e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")){var t=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog])),e.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),output=["#include <clipping_planes_fragment>","#include <begin_vertex>"],t&&output.push(t.code,t.result?"transformed = "+t.result+";":""),output.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||output.push("modelMtx[1][1] = 1.0;"),output.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&output.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),output.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{e.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),e.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(e),this.alpha&&this.alpha.analyze(e),this.color.analyze(e,{slot:"color"});var mask=this.mask?this.mask.flow(e,"b"):void 0,r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.color.flow(e,"c",{slot:"color"}),output=[];mask&&output.push(mask.code,"if ( ! "+mask.result+" ) discard;"),r?output.push(r.code,"#ifdef ALPHATEST","if ( "+r.result+" <= ALPHATEST ) discard;","#endif",n.code,"gl_FragColor = vec4( "+n.result+", "+r.result+" );"):output.push(n.code,"gl_FragColor = vec4( "+n.result+", 1.0 );"),output.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return output.join("\n")},SpriteNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),source.position&&(this.position=source.position),this.color=source.color,void 0!==source.spherical&&(this.spherical=source.spherical),source.mask&&(this.mask=source.mask),source.alpha&&(this.alpha=source.alpha),this},SpriteNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),this.position&&(data.position=this.position.toJSON(meta).uuid),data.color=this.color.toJSON(meta).uuid,!1===this.spherical&&(data.spherical=!1),this.mask&&(data.mask=this.mask.toJSON(meta).uuid),this.alpha&&(data.alpha=this.alpha.toJSON(meta).uuid)),data},PhongNode.prototype=Object.create(Node.prototype),PhongNode.prototype.constructor=PhongNode,PhongNode.prototype.nodeType="Phong",PhongNode.prototype.build=function(e){var code;if(e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")){var t=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var output=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];t&&output.push(t.code,t.result?"transformed = "+t.result+";":""),output.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),code=output.join("\n")}else{this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&this.environment.analyze(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(e);var mask=this.mask?this.mask.flow(e,"b"):void 0,r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.normal?this.normal.flow(e,"v3"):void 0,h=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.flow(e,"f"):void 0,f=this.ambient?this.ambient.flow(e,"c"):void 0,shadow=this.shadow?this.shadow.flow(e,"c"):void 0,m=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.flow(e,"c",{slot:"environment"}):void 0,y=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));output=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];mask&&output.push(mask.code,"if ( ! "+mask.result+" ) discard;"),output.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",n.code,"\tvec3 specular = "+n.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),l&&output.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),c&&output.push(c.code,"normal = "+c.result+";"),output.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),output.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(output.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),output.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&output.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),f&&output.push(f.code,"reflectedLight.indirectDiffuse += "+f.result+";"),shadow&&output.push(shadow.code,"reflectedLight.directDiffuse *= "+shadow.result+";","reflectedLight.directSpecular *= "+shadow.result+";"),m&&output.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),output.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(output.push(v.code),y?output.push(y.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+y.result+" );"):output.push("outgoingLight = "+v.result+";")),l?output.push("gl_FragColor = vec4( outgoingLight, "+l.result+" );"):output.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),output.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),code=output.join("\n")}return code},PhongNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),source.position&&(this.position=source.position),this.color=source.color,this.specular=source.specular,this.shininess=source.shininess,source.mask&&(this.mask=source.mask),source.alpha&&(this.alpha=source.alpha),source.normal&&(this.normal=source.normal),source.light&&(this.light=source.light),source.shadow&&(this.shadow=source.shadow),source.ao&&(this.ao=source.ao),source.emissive&&(this.emissive=source.emissive),source.ambient&&(this.ambient=source.ambient),source.environment&&(this.environment=source.environment),source.environmentAlpha&&(this.environmentAlpha=source.environmentAlpha),this},PhongNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),this.position&&(data.position=this.position.toJSON(meta).uuid),data.color=this.color.toJSON(meta).uuid,data.specular=this.specular.toJSON(meta).uuid,data.shininess=this.shininess.toJSON(meta).uuid,this.mask&&(data.mask=this.mask.toJSON(meta).uuid),this.alpha&&(data.alpha=this.alpha.toJSON(meta).uuid),this.normal&&(data.normal=this.normal.toJSON(meta).uuid),this.light&&(data.light=this.light.toJSON(meta).uuid),this.ao&&(data.ao=this.ao.toJSON(meta).uuid),this.ambient&&(data.ambient=this.ambient.toJSON(meta).uuid),this.shadow&&(data.shadow=this.shadow.toJSON(meta).uuid),this.emissive&&(data.emissive=this.emissive.toJSON(meta).uuid),this.environment&&(data.environment=this.environment.toJSON(meta).uuid),this.environmentAlpha&&(data.environmentAlpha=this.environmentAlpha.toJSON(meta).uuid)),data},StandardNode.prototype=Object.create(Node.prototype),StandardNode.prototype.constructor=StandardNode,StandardNode.prototype.nodeType="Standard",StandardNode.prototype.build=function(e){var code;e.define("STANDARD");var t=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(t&&e.define("CLEARCOAT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var output=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&output.push(r.code,r.result?"transformed = "+r.result+";":""),output.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),code=output.join("\n")}else{var n=new ExpressionNode("material.specularRoughness","f"),o=new ExpressionNode("material.clearcoatRoughness","f"),l={roughness:n,bias:new SpecularMIPLevelNode(n),viewNormal:new ExpressionNode("normal","v3"),worldNormal:new ExpressionNode("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},c={gamma:!0},h={roughness:o,bias:new SpecularMIPLevelNode(o),viewNormal:new ExpressionNode("clearcoatNormal","v3"),worldNormal:new ExpressionNode("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color",context:c}),this.roughness.analyze(e),this.metalness.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.clearcoat&&this.clearcoat.analyze(e),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(e),this.clearcoatNormal&&this.clearcoatNormal.analyze(e),this.reflectivity&&this.reflectivity.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&(this.environment.analyze(e,{cache:"radiance",context:l,slot:"radiance"}),e.requires.irradiance&&this.environment.analyze(e,{cache:"irradiance",context:l,slot:"irradiance"})),this.sheen&&this.sheen.analyze(e);var d,mask=this.mask?this.mask.flow(e,"b"):void 0,f=this.color.flow(e,"c",{slot:"color",context:c}),m=this.roughness.flow(e,"f"),v=this.metalness.flow(e,"f"),y=this.alpha?this.alpha.flow(e,"f"):void 0,x=this.normal?this.normal.flow(e,"v3"):void 0,_=this.clearcoat?this.clearcoat.flow(e,"f"):void 0,M=(o=this.clearcoatRoughness?this.clearcoatRoughness.flow(e,"f"):void 0,this.clearcoatNormal?this.clearcoatNormal.flow(e,"v3"):void 0),w=this.reflectivity?this.reflectivity.flow(e,"f"):void 0,S=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,A=this.ao?this.ao.flow(e,"f"):void 0,T=this.ambient?this.ambient.flow(e,"c"):void 0,shadow=this.shadow?this.shadow.flow(e,"c"):void 0,L=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0;this.environment&&(d={radiance:this.environment.flow(e,"c",{cache:"radiance",context:l,slot:"radiance"})},e.requires.irradiance&&(d.irradiance=this.environment.flow(e,"c",{cache:"irradiance",context:l,slot:"irradiance"})));var C=t&&d?this.environment.flow(e,"c",{cache:"clearcoat",context:h,slot:"environment"}):void 0,N=this.sheen?this.sheen.flow(e,"c"):void 0;e.requires.transparent=void 0!==y,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));output=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];mask&&output.push(mask.code,"if ( ! "+mask.result+" ) discard;"),output.push(f.code,"\tvec3 diffuseColor = "+f.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",m.code,"\tfloat roughnessFactor = "+m.result+";",v.code,"\tfloat metalnessFactor = "+v.result+";"),y&&output.push(y.code,"#ifdef ALPHATEST","\tif ( "+y.result+" <= ALPHATEST ) discard;","#endif"),x&&output.push(x.code,"normal = "+x.result+";"),M&&output.push(M.code,"clearcoatNormal = "+M.result+";"),output.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),output.push("material.diffuseColor = "+(S?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),_?output.push(_.code,"material.clearcoat = saturate( "+_.result+" );"):t&&output.push("material.clearcoat = 0.0;"),o?output.push(o.code,"material.clearcoatRoughness = max( "+o.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):t&&output.push("material.clearcoatRoughness = 0.0;"),N&&output.push("material.sheenColor = "+N.result+";"),w?output.push(w.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+w.result+" ) ), diffuseColor, metalnessFactor );"):output.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),output.push("#include <lights_fragment_begin>"),S&&(output.push(S.code,"reflectedLight.directDiffuse = "+S.result+";"),output.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),A&&output.push(A.code,"reflectedLight.indirectDiffuse *= "+A.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+A.result+", material.specularRoughness );"),T&&output.push(T.code,"reflectedLight.indirectDiffuse += "+T.result+";"),shadow&&output.push(shadow.code,"reflectedLight.directDiffuse *= "+shadow.result+";","reflectedLight.directSpecular *= "+shadow.result+";"),L&&output.push(L.code,"reflectedLight.directDiffuse += "+L.result+";"),d&&(output.push(d.radiance.code),e.requires.irradiance&&output.push(d.irradiance.code),C&&output.push(C.code,"clearcoatRadiance += "+C.result+";"),output.push("radiance += "+d.radiance.result+";"),e.requires.irradiance&&output.push("iblIrradiance += PI * "+d.irradiance.result+";")),output.push("#include <lights_fragment_end>"),output.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),y?output.push("gl_FragColor = vec4( outgoingLight, "+y.result+" );"):output.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),output.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),code=output.join("\n")}return code},StandardNode.prototype.copy=function(source){return Node.prototype.copy.call(this,source),source.position&&(this.position=source.position),this.color=source.color,this.roughness=source.roughness,this.metalness=source.metalness,source.mask&&(this.mask=source.mask),source.alpha&&(this.alpha=source.alpha),source.normal&&(this.normal=source.normal),source.clearcoat&&(this.clearcoat=source.clearcoat),source.clearcoatRoughness&&(this.clearcoatRoughness=source.clearcoatRoughness),source.clearcoatNormal&&(this.clearcoatNormal=source.clearcoatNormal),source.reflectivity&&(this.reflectivity=source.reflectivity),source.light&&(this.light=source.light),source.shadow&&(this.shadow=source.shadow),source.ao&&(this.ao=source.ao),source.emissive&&(this.emissive=source.emissive),source.ambient&&(this.ambient=source.ambient),source.environment&&(this.environment=source.environment),source.sheen&&(this.sheen=source.sheen),this},StandardNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),this.position&&(data.position=this.position.toJSON(meta).uuid),data.color=this.color.toJSON(meta).uuid,data.roughness=this.roughness.toJSON(meta).uuid,data.metalness=this.metalness.toJSON(meta).uuid,this.mask&&(data.mask=this.mask.toJSON(meta).uuid),this.alpha&&(data.alpha=this.alpha.toJSON(meta).uuid),this.normal&&(data.normal=this.normal.toJSON(meta).uuid),this.clearcoat&&(data.clearcoat=this.clearcoat.toJSON(meta).uuid),this.clearcoatRoughness&&(data.clearcoatRoughness=this.clearcoatRoughness.toJSON(meta).uuid),this.clearcoatNormal&&(data.clearcoatNormal=this.clearcoatNormal.toJSON(meta).uuid),this.reflectivity&&(data.reflectivity=this.reflectivity.toJSON(meta).uuid),this.light&&(data.light=this.light.toJSON(meta).uuid),this.shadow&&(data.shadow=this.shadow.toJSON(meta).uuid),this.ao&&(data.ao=this.ao.toJSON(meta).uuid),this.emissive&&(data.emissive=this.emissive.toJSON(meta).uuid),this.ambient&&(data.ambient=this.ambient.toJSON(meta).uuid),this.environment&&(data.environment=this.environment.toJSON(meta).uuid),this.sheen&&(data.sheen=this.sheen.toJSON(meta).uuid)),data},MeshStandardNode.prototype=Object.create(StandardNode.prototype),MeshStandardNode.prototype.constructor=MeshStandardNode,MeshStandardNode.prototype.nodeType="MeshStandard",MeshStandardNode.prototype.build=function(e){var t=this.properties,r=this.inputs;if(e.isShader("fragment")){var n=e.findNode(t.color,r.color),map=e.resolve(t.map);this.color=map?new OperatorNode(n,map,OperatorNode.MUL):n;var o=e.findNode(t.roughness,r.roughness),l=e.resolve(t.roughnessMap);this.roughness=l?new OperatorNode(o,new SwitchNode(l,"g"),OperatorNode.MUL):o;var c=e.findNode(t.metalness,r.metalness),h=e.resolve(t.metalnessMap);this.metalness=h?new OperatorNode(c,new SwitchNode(h,"b"),OperatorNode.MUL):c,t.normalMap?(this.normal=new NormalMapNode(e.resolve(t.normalMap)),this.normal.scale=e.findNode(t.normalScale,r.normalScale)):this.normal=void 0,this.environment=e.resolve(t.envMap)}return StandardNode.prototype.build.call(this,e)},MeshStandardNode.prototype.toJSON=function(meta){var data=this.getJSONNode(meta);return data||(data=this.createJSONNode(meta),console.warn(".toJSON not implemented in",this)),data},SpriteNodeMaterial.prototype=Object.create(NodeMaterial.prototype),SpriteNodeMaterial.prototype.constructor=SpriteNodeMaterial,NodeUtils.addShortcuts(SpriteNodeMaterial.prototype,"fragment",["color","alpha","mask","position","spherical"]),PhongNodeMaterial.prototype=Object.create(NodeMaterial.prototype),PhongNodeMaterial.prototype.constructor=PhongNodeMaterial,NodeUtils.addShortcuts(PhongNodeMaterial.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),StandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),StandardNodeMaterial.prototype.constructor=StandardNodeMaterial,NodeUtils.addShortcuts(StandardNodeMaterial.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),MeshStandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),MeshStandardNodeMaterial.prototype.constructor=MeshStandardNodeMaterial,NodeUtils.addShortcuts(MeshStandardNodeMaterial.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),NodePostProcessing.prototype={constructor:NodePostProcessing,render:function(e,t,r){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),r.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(e,t),r.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(e){this.renderer.setPixelRatio(e);var t=this.renderer.getSize(new Vector2);this.setSize(t.width,t.height)},setSize:function(e,t){var r=this.renderer.getPixelRatio();this.renderTarget.setSize(e*r,t*r),this.renderer.setSize(e,t)},copy:function(source){return this.output=source.output,this},toJSON:function(meta){if((void 0===meta||"string"==typeof meta)&&(meta={nodes:{}}),meta&&!meta.post&&(meta.post={}),!meta.post[this.uuid]){var data={};data.uuid=this.uuid,data.type="NodePostProcessing",meta.post[this.uuid]=data,""!==this.name&&(data.name=this.name),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),data.output=this.output.toJSON(meta).uuid}return meta.post=this.uuid,meta}};var Nodes={Node:Node,TempNode:TempNode,InputNode:InputNode,ConstNode:ConstNode,VarNode:VarNode,StructNode:StructNode,AttributeNode:AttributeNode,FunctionNode:FunctionNode,ExpressionNode:ExpressionNode,FunctionCallNode:FunctionCallNode,NodeLib:NodeLib,NodeUtils:NodeUtils,NodeFrame:NodeFrame,NodeUniform:NodeUniform,NodeBuilder:NodeBuilder,BoolNode:BoolNode,IntNode:IntNode,FloatNode:FloatNode,Vector2Node:Vector2Node,Vector3Node:Vector3Node,Vector4Node:Vector4Node,ColorNode:ColorNode,Matrix3Node:Matrix3Node,Matrix4Node:Matrix4Node,TextureNode:TextureNode,CubeTextureNode:CubeTextureNode,ScreenNode:ScreenNode,ReflectorNode:ReflectorNode,PropertyNode:PropertyNode,RTTNode:RTTNode,UVNode:UVNode,ColorsNode:ColorsNode,PositionNode:PositionNode,NormalNode:NormalNode,CameraNode:CameraNode,LightNode:LightNode,ReflectNode:ReflectNode,ScreenUVNode:ScreenUVNode,ResolutionNode:ResolutionNode,MathNode:MathNode,OperatorNode:OperatorNode,CondNode:CondNode,NoiseNode:NoiseNode,CheckerNode:CheckerNode,TextureCubeUVNode:TextureCubeUVNode,TextureCubeNode:TextureCubeNode,NormalMapNode:NormalMapNode,BumpMapNode:BumpMapNode,BypassNode:BypassNode,JoinNode:JoinNode,SwitchNode:SwitchNode,TimerNode:TimerNode,VelocityNode:VelocityNode,UVTransformNode:UVTransformNode,MaxMIPLevelNode:MaxMIPLevelNode,SpecularMIPLevelNode:SpecularMIPLevelNode,ColorSpaceNode:ColorSpaceNode,SubSlotNode:SubSlotNode,BlurNode:BlurNode,ColorAdjustmentNode:ColorAdjustmentNode,LuminanceNode:LuminanceNode,RawNode:RawNode,SpriteNode:SpriteNode,PhongNode:PhongNode,StandardNode:StandardNode,MeshStandardNode:MeshStandardNode,NodeMaterial:NodeMaterial,SpriteNodeMaterial:SpriteNodeMaterial,PhongNodeMaterial:PhongNodeMaterial,StandardNodeMaterial:StandardNodeMaterial,MeshStandardNodeMaterial:MeshStandardNodeMaterial,NodePostProcessing:NodePostProcessing},NodeMaterialLoader=function(e,t){this.manager=void 0!==e?e:DefaultLoadingManager,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}},NodeMaterialLoaderUtils={replaceUUIDObject:function(object,e,t,r){if(r=void 0===r||r,"object"==typeof e&&(e=e.uuid),"object"==typeof object)for(var n=Object.keys(object),i=0;i<n.length;i++){var o=n[i];r&&(object[o]=this.replaceUUIDObject(object[o],e,t)),o===e&&(object[e]=object[o],delete object[o])}return object===e?t:object},replaceUUID:function(e,t,r){return this.replaceUUIDObject(e,t,r,!1),this.replaceUUIDObject(e.nodes,t,r),this.replaceUUIDObject(e.materials,t,r),this.replaceUUIDObject(e.passes,t,r),this.replaceUUIDObject(e.library,t,r,!1),e}};Object.assign(NodeMaterialLoader.prototype,{load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);return l.setPath(o.path),l.load(e,(function(text){t(o.parse(JSON.parse(text)))}),r,n),this},setPath:function(e){return this.path=e,this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.materials[e]||this.passes[e]||this.names[e]},getNode:function(e){var object=this.getObjectById(e);return object||console.warn('Node "'+e+'" not found.'),object},resolve:function(e){switch(typeof e){case"boolean":case"number":return e;case"string":return/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i.test(e)||this.library[e]?this.getNode(e):e;default:if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i]=this.resolve(e[i]);else for(var t in e)"uuid"!==t&&(e[t]=this.resolve(e[t]))}return e},declare:function(e){var t,r,object;for(t in e.nodes)r=e.nodes[t],object=new Nodes[r.nodeType+"Node"],r.name&&(object.name=r.name,this.names[object.name]=object),this.nodes[t]=object;for(t in e.materials)r=e.materials[t],object=new Nodes[r.type],r.name&&(object.name=r.name,this.names[object.name]=object),this.materials[t]=object;for(t in e.passes)r=e.passes[t],object=new Nodes[r.type],r.name&&(object.name=r.name,this.names[object.name]=object),this.passes[t]=object;return e.material&&(this.material=this.materials[e.material]),e.pass&&(this.pass=this.passes[e.pass]),e},parse:function(e){var t;for(t in(e=this.resolve(this.declare(e))).nodes)this.nodes[t].copy(e.nodes[t]);for(t in e.materials)this.materials[t].copy(e.materials[t]);for(t in e.passes)this.passes[t].copy(e.passes[t]);return this.material||this.pass||this}});var VolumeSlice=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var o=new Texture(this.canvas);o.minFilter=LinearFilter,o.wrapS=o.wrapT=ClampToEdgeWrapping;var l=new MeshBasicMaterial({map:o,side:DoubleSide,transparent:!0});this.mesh=new Mesh(this.geometry,l),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()};VolumeSlice.prototype={constructor:VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,canvas=this.canvasBuffer,o=this.ctxBuffer,l=o.getImageData(0,0,e,t),data=l.data,c=n.data,h=n.upperThreshold,d=n.lowerThreshold,f=n.windowLow,m=n.windowHigh,v=0;if("label"===n.dataType)for(var y=0;y<t;y++)for(var i=0;i<e;i++){var label=c[r(i,y)];label=label>=this.colorMap.length?label%this.colorMap.length+1:label;var x=this.colorMap[label];data[4*v]=x>>24&255,data[4*v+1]=x>>16&255,data[4*v+2]=x>>8&255,data[4*v+3]=255&x,v++}else for(y=0;y<t;y++)for(i=0;i<e;i++){var _=c[r(i,y)],M=255;M=h>=_&&d<=_?M:0,_=(_=Math.floor(255*(_-f)/(m-f)))>255?255:_<0?0:0|_,data[4*v]=_,data[4*v+1]=_,data[4*v+2]=_,data[4*v+3]=M,v++}o.putImageData(l,0,0),this.ctx.drawImage(canvas,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}};var Volume=function(e,t,r,n,o){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(o);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(o);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(o);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(o);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(o);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(o);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(o);break;case"Float64":case"float64":case"double":this.data=new Float64Array(o);break;default:this.data=new Uint8Array(o)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new Matrix3,this.matrix.identity();var l=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return l},set:function(e){l=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}});var c=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return c},set:function(e){c=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}}),this.sliceList=[]};Volume.prototype={constructor:Volume,getData:function(i,e,t){return this.data[t*this.xLength*this.yLength+e*this.xLength+i]},access:function(i,e,t){return t*this.xLength*this.yLength+e*this.xLength+i},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(var i=0;i<r;i++)this.data[i]=e.call(t,this.data[i],i,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,axisInIJK=new Vector3,firstDirection=new Vector3,secondDirection=new Vector3,dimensions=new Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new Vector3(RASIndex,0,0),planeMatrix.multiply((new Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new Vector3(RASIndex-positionOffset,0,0));break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new Vector3(0,RASIndex,0),planeMatrix.multiply((new Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new Vector3(0,RASIndex-positionOffset,0));break;case"z":default:axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new Vector3(0,0,RASIndex-positionOffset))}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new Vector3(1,0,0),new Vector3(0,1,0),new Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[0]))>.9})),jDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[1]))>.9})),kDirection=[firstDirection,secondDirection,axisInIJK].find((function(e){return Math.abs(e.dot(base[2]))>.9})),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],argArray=[iDirection,jDirection,kDirection].map((function(e,t){return(e.dot(base[t])>0?"":argumentsWithInversion[t])+(e===axisInIJK?"IJKIndex":e.argVar)})),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight}},extractSlice:function(e,t){var r=new VolumeSlice(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach((function(e){e.repaint()})),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,i=0;for(i=0;i<r;i++)if(!isNaN(this.data[i])){var n=this.data[i];e=Math.min(e,n),t=Math.max(t,n)}return this.min=e,this.max=t,[e,t]}};var NRRDLoader=function(e){Loader.call(this,e)};NRRDLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:NRRDLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(data){t(o.parse(data))}),r,n)},parse:function(data){var e=data,t=0,r=new Int8Array(new Int16Array([1]).buffer)[0]>0,n={};var o=function(n,o){null==o&&(o=1);var l=1,c=Uint8Array;switch(n){case"uchar":break;case"schar":c=Int8Array;break;case"ushort":c=Uint16Array,l=2;break;case"sshort":c=Int16Array,l=2;break;case"uint":c=Uint32Array,l=4;break;case"sint":c=Int32Array,l=4;break;case"float":c=Float32Array,l=4;break;case"complex":case"double":c=Float64Array,l=8}var h=new c(e.slice(t,t+=o*l));return 1!=r&&(h=function(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=0;i<e.byteLength;i+=t)for(var n=i+t-1,o=i;n>o;n--,o++){var l=r[o];r[o]=r[n],r[n]=l}return e}(h,l)),1==o?h[0]:h}("uchar",data.byteLength),l=o.length,c=null,h=0;for(i=1;i<l;i++)if(10==o[i-1]&&10==o[i]){c=this.parseChars(o,0,i-2),h=i+1;break}!function(header){var data,e,t,i,r,o,l,c,h;for(c=0,h=(o=header.split(/\r?\n/)).length;c<h;c++)(r=o[c]).match(/NRRD\d+/)?n.isNrrd=!0:r.match(/^#/)||(l=r.match(/(.*):(.*)/))&&(e=l[1].trim(),data=l[2].trim(),(t=NRRDLoader.prototype.fieldFunctions[e])?t.call(n,data):n[e]=data);if(!n.isNrrd)throw new Error("Not an NRRD file");if("bz2"===n.encoding||"bzip2"===n.encoding)throw new Error("Bzip is not supported");if(!n.vectors&&(n.vectors=[new Vector3(1,0,0),new Vector3(0,1,0),new Vector3(0,0,1)],n.spacings))for(i=0;i<=2;i++)isNaN(n.spacings[i])||n.vectors[i].multiplyScalar(n.spacings[i])}(c);e=o.subarray(h);if("gzip"===n.encoding||"gz"===n.encoding){var d=new Zlib.Gunzip(new Uint8Array(e));e=d.decompress()}else if("ascii"===n.encoding||"text"===n.encoding||"txt"===n.encoding||"hex"===n.encoding)e=function(data,e,t){var r,o="";e=e||0,t=t||data.length;var l=n.sizes.reduce((function(e,t){return e*t}),1),base=10;"hex"===n.encoding&&(base=16);var c=new n.__array(l),h=0,d=parseInt;n.__array!==Float32Array&&n.__array!==Float64Array||(d=parseFloat);for(var i=e;i<t;i++)((r=data[i])<9||r>13)&&32!==r?o+=String.fromCharCode(r):(""!==o&&(c[h]=d(o,base),h++),o="");return""!==o&&(c[h]=d(o,base),h++),c}(e);else if("raw"===n.encoding){for(var f=new Uint8Array(e.length),i=0;i<e.length;i++)f[i]=e[i];e=f}e=e.buffer;var m=new Volume;m.header=n,m.data=new n.__array(e);var v=m.computeMinMax(),y=v[0],x=v[1];m.windowLow=y,m.windowHigh=x,m.dimensions=[n.sizes[0],n.sizes[1],n.sizes[2]],m.xLength=m.dimensions[0],m.yLength=m.dimensions[1],m.zLength=m.dimensions[2];var _=new Vector3(n.vectors[0][0],n.vectors[0][1],n.vectors[0][2]).length(),M=new Vector3(n.vectors[1][0],n.vectors[1][1],n.vectors[1][2]).length(),w=new Vector3(n.vectors[2][0],n.vectors[2][1],n.vectors[2][2]).length();m.spacing=[_,M,w],m.matrix=new Matrix4;var S=1,A=1;if("left-posterior-superior"==n.space?(S=-1,A=-1):"left-anterior-superior"===n.space&&(S=-1),n.vectors){var T=n.vectors;m.matrix.set(S*T[0][0],S*T[1][0],S*T[2][0],0,A*T[0][1],A*T[1][1],A*T[2][1],0,1*T[0][2],1*T[1][2],1*T[2][2],0,0,0,0,1)}else m.matrix.set(S,0,0,0,0,A,0,0,0,0,1,0,0,0,0,1);return m.inverseMatrix=new Matrix4,m.inverseMatrix.getInverse(m.matrix),m.RASDimensions=new Vector3(m.xLength,m.yLength,m.zLength).applyMatrix4(m.matrix).round().toArray().map(Math.abs),m.lowerThreshold===-1/0&&(m.lowerThreshold=y),m.upperThreshold===1/0&&(m.upperThreshold=x),m},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var output="",i=0;for(i=t;i<r;++i)output+=String.fromCharCode(e[i]);return output},fieldFunctions:{type:function(data){switch(data){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+data)}return this.type=data},endian:function(data){return this.endian=data},encoding:function(data){return this.encoding=data},dimension:function(data){return this.dim=parseInt(data,10)},sizes:function(data){var i;return this.sizes=function(){var e,t,r,n;for(n=[],e=0,t=(r=data.split(/\s+/)).length;e<t;e++)i=r[e],n.push(parseInt(i,10));return n}()},space:function(data){return this.space=data},"space origin":function(data){return this.space_origin=data.split("(")[1].split(")")[0].split(",")},"space directions":function(data){var e,t,r;return t=data.match(/\(.*?\)/g),this.vectors=function(){var n,o,l;for(l=[],n=0,o=t.length;n<o;n++)r=t[n],l.push(function(){var t,n,o,l;for(l=[],t=0,n=(o=r.slice(1,-1).split(/,/)).length;t<n;t++)e=o[t],l.push(parseFloat(e));return l}());return l}()},spacings:function(data){var e,t;return t=data.split(/\s+/),this.spacings=function(){var r,n,o=[];for(r=0,n=t.length;r<n;r++)e=t[r],o.push(parseFloat(e));return o}()}}});var MtlObjBridge={link:function(e,t){"function"==typeof t.addMaterials&&t.addMaterials(this.addMaterialsFromMtlLoader(e),!0)},addMaterialsFromMtlLoader:function(e){var t={};return e instanceof MTLLoader.MaterialCreator&&(e.preload(),t=e.materials),t}};function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(source){return LineBasicMaterial.prototype.copy.call(this,source),this.scale=source.scale,this.dashSize=source.dashSize,this.gapSize=source.gapSize,this},MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.depthPacking=source.depthPacking,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.referencePosition.copy(source.referencePosition),this.nearDistance=source.nearDistance,this.farDistance=source.farDistance,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this},SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.alphaMap=source.alphaMap,this.rotation=source.rotation,this.sizeAttenuation=source.sizeAttenuation,this};var Materials={LineBasicMaterial:LineBasicMaterial,LineDashedMaterial:LineDashedMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,PointsMaterial:PointsMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial};function MaterialLoader(e){Loader.call(this,e),this.textures={}}MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(JSON.parse(text)))}),r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("MaterialLoader: Undefined texture",e),t[e]}var n=new Materials[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new Color).setHex(e.sheen)),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var o in e.uniforms){var l=e.uniforms[o];switch(n.uniforms[o]={},l.type){case"t":n.uniforms[o].value=r(l.value);break;case"c":n.uniforms[o].value=(new Color).setHex(l.value);break;case"v2":n.uniforms[o].value=(new Vector2).fromArray(l.value);break;case"v3":n.uniforms[o].value=(new Vector3).fromArray(l.value);break;case"v4":n.uniforms[o].value=(new Vector4).fromArray(l.value);break;case"m3":n.uniforms[o].value=(new Matrix3).fromArray(l.value);case"m4":n.uniforms[o].value=(new Matrix4).fromArray(l.value);break;default:n.uniforms[o].value=l.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var c in e.extensions)n.extensions[c]=e.extensions[c];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var h=e.normalScale;!1===Array.isArray(h)&&(h=[h,h]),n.normalScale=(new Vector2).fromArray(h)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var MaterialHandler=function(){this.logging={enabled:!1,debug:!1},this.callbacks={onLoadMaterials:null},this.materials={}};MaterialHandler.prototype={constructor:MaterialHandler,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},_setCallbacks:function(e){null!=e&&e instanceof Function&&(this.callbacks.onLoadMaterials=e)},createDefaultMaterials:function(e){var t=new MeshStandardMaterial({color:14479871});t.name="defaultMaterial";var r=new MeshStandardMaterial({color:14479871});r.name="defaultVertexColorMaterial",r.vertexColors=VertexColors;var n=new LineBasicMaterial;n.name="defaultLineMaterial";var o=new PointsMaterial({size:.1});o.name="defaultPointMaterial";var l={};l[t.name]=t,l[r.name]=r,l[n.name]=n,l[o.name]=o,this.addMaterials(l,e)},addPayloadMaterials:function(e){var t,r,n=e.materials.materialCloneInstructions,o={};if(null!=n){var l=n.materialNameOrg;l=null!=l?l:"";var c=this.materials[l];c?(t=c.clone(),r=n.materialName,t.name=r,Object.assign(t,n.materialProperties),this.materials[r]=t,o[r]=t):this.logging.enabled&&console.info('Requested material "'+l+'" is not available!')}var h=e.materials.serializedMaterials;if(null!=h&&Object.keys(h).length>0){var d,f=new MaterialLoader;for(r in h)null!=(d=h[r])&&(t=f.parse(d),this.logging.enabled&&console.info('De-serialized material with name "'+r+'" will be added.'),this.materials[r]=t,o[r]=t)}return h=e.materials.runtimeMaterials,o=this.addMaterials(h,!0,o)},addMaterials:function(e,t,r){var n,o;if(null==r&&(r={}),null!=e&&Object.keys(e).length>0)for(var l in e)n=e[l],(o=!0===t)||(o=null==this.materials[l]),o&&(this.materials[l]=n,r[l]=n),this.logging.enabled&&this.logging.debug&&console.info('Material with name "'+l+'" was added.');return this.callbacks.onLoadMaterials&&this.callbacks.onLoadMaterials(r),r},getMaterials:function(){return this.materials},getMaterial:function(e){return this.materials[e]},getMaterialsJSON:function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},clearMaterials:function(){this.materials={}}};var MeshReceiver=function(e){this.logging={enabled:!1,debug:!1},this.callbacks={onProgress:null,onMeshAlter:null},this.materialHandler=e};MeshReceiver.prototype={constructor:MeshReceiver,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},_setCallbacks:function(e,t){null!=e&&e instanceof Function&&(this.callbacks.onProgress=e),null!=t&&t instanceof Function&&(this.callbacks.onMeshAlter=t)},buildMeshes:function(e){var t,r,n,o=e.params.meshName,l=e.buffers,c=new BufferGeometry;void 0!==l.vertices&&null!==l.vertices&&c.setAttribute("position",new BufferAttribute(new Float32Array(l.vertices),3)),void 0!==l.indices&&null!==l.indices&&c.setIndex(new BufferAttribute(new Uint32Array(l.indices),1)),void 0!==l.colors&&null!==l.colors&&c.setAttribute("color",new BufferAttribute(new Float32Array(l.colors),3)),void 0!==l.normals&&null!==l.normals?c.setAttribute("normal",new BufferAttribute(new Float32Array(l.normals),3)):c.computeVertexNormals(),void 0!==l.uvs&&null!==l.uvs&&c.setAttribute("uv",new BufferAttribute(new Float32Array(l.uvs),2)),void 0!==l.skinIndex&&null!==l.skinIndex&&c.setAttribute("skinIndex",new BufferAttribute(new Uint16Array(l.skinIndex),4)),void 0!==l.skinWeight&&null!==l.skinWeight&&c.setAttribute("skinWeight",new BufferAttribute(new Float32Array(l.skinWeight),4));var h=e.materials.materialNames,d=e.materials.multiMaterial,f=[];for(n in h)r=h[n],t=this.materialHandler.getMaterial(r),d&&f.push(t);if(d){t=f;var m,v=e.materials.materialGroups;for(n in v)m=v[n],c.addGroup(m.start,m.count,m.index)}var y,x,_=[],M=!0,w=null===e.geometryType?0:e.geometryType;if(this.callbacks.onMeshAlter&&(x=this.callbacks.onMeshAlter({detail:{meshName:o,bufferGeometry:c,material:t,geometryType:w}})),x)if(x.isDisregardMesh())M=!1;else if(x.providesAlteredMeshes()){for(var i in x.meshes)_.push(x.meshes[i]);M=!1}M&&(e.computeBoundingSphere&&c.computeBoundingSphere(),(y=0===w?new Mesh(c,t):1===w?new LineSegments(c,t):new Points(c,t)).name=o,_.push(y));var S=e.params.meshName;if(_.length>0){var A=[];for(var T in _)y=_[T],A[T]=y.name;S+=": Adding mesh(es) ("+A.length+": "+A+") from input mesh: "+o,S+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else S+=": Not adding mesh: "+o,S+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";return this.callbacks.onProgress&&this.callbacks.onProgress("progress",S,e.progress.numericalValue),_}};var LoadedMeshUserOverride=function(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]};LoadedMeshUserOverride.prototype={constructor:LoadedMeshUserOverride,addMesh:function(e){this.meshes.push(e),this.alteredMesh=!0},isDisregardMesh:function(){return this.disregardMesh},providesAlteredMeshes:function(){return this.alteredMesh}};var CodeSerializer={serializeClass:function(e,t,r,n){var o,l,i,c,h,d=t.constructor.name,f=[],m=[],v=[],y=null!=r;for(var x in Array.isArray(n)||(n=[]),e.prototype)o=e.prototype[x],(c=new CodeSerializationInstruction(x,d+".prototype."+x)).setCode(o.toString()),"constructor"===x?c.isRemoveCode()||(l=d+" = "+c.getCode()+";\n\n"):"function"==typeof o&&((h=n[x])instanceof CodeSerializationInstruction&&h.getName()===c.getName()&&(c=h),c.isRemoveCode()||(y?f.push(c.getFullName()+" = "+c.getCode()+";\n\n"):f.push("\t"+c.getName()+": "+c.getCode()+",\n\n")));for(var _ in e)o=e[_],c=new CodeSerializationInstruction(_,d+"."+_),"function"==typeof o?((h=n[_])instanceof CodeSerializationInstruction&&h.getName()===c.getName()?c=h:c.setCode(o.toString()),c.isRemoveCode()||v.push(c.getFullName()+" = "+c.getCode()+";\n\n")):("string"==typeof o||o instanceof String?c.setCode('"'+o.toString()+'"'):"object"==typeof o?(console.log('Omitting object "'+c.getName()+'" and replace it with empty object.'),c.setCode("{}")):c.setCode(o),c.isRemoveCode()||m.push(c.getFullName()+" = "+c.getCode()+";\n"));var M=l+"\n\n";for(y&&(M+=d+".prototype = Object.create( "+r+".prototype );\n"),M+=d+".prototype.constructor = "+d+";\n",M+="\n\n",i=0;i<m.length;i++)M+=m[i];for(M+="\n\n",i=0;i<v.length;i++)M+=v[i];if(M+="\n\n",y)for(i=0;i<f.length;i++)M+=f[i];else{for(M+=d+".prototype = {\n\n",i=0;i<f.length;i++)M+=f[i];M+="\n};"}return M+="\n\n"}},CodeSerializationInstruction=function(e,t){this.name=e,this.fullName=t,this.code=null,this.removeCode=!1};CodeSerializationInstruction.prototype={constructor:CodeSerializationInstruction,getName:function(){return this.name},getFullName:function(){return this.fullName},setCode:function(code){return this.code=code,this},getCode:function(){return this.code},setRemoveCode:function(e){return this.removeCode=e,this},isRemoveCode:function(){return this.removeCode}};var CodeBuilderInstructions=function(e,t,r){this.supportsStandardWorker=e,this.supportsJsmWorker=t,this.preferJsmWorker=r,this.startCode="",this.codeFragments=[],this.importStatements=[],this.jsmWorkerFile=null,this.defaultGeometryType=0};CodeBuilderInstructions.prototype={constructor:CodeBuilderInstructions,isSupportsStandardWorker:function(){return this.supportsStandardWorker},isSupportsJsmWorker:function(){return this.supportsJsmWorker},isPreferJsmWorker:function(){return this.preferJsmWorker},setJsmWorkerFile:function(e){null!=e&&(this.jsmWorkerFile=e)},addStartCode:function(e){this.startCode=e},addCodeFragment:function(code){this.codeFragments.push(code)},addLibraryImport:function(e){var code='importScripts( "'+new URL(e,window.location.href).href+'" );';this.importStatements.push(code)},getImportStatements:function(){return this.importStatements},getCodeFragments:function(){return this.codeFragments},getStartCode:function(){return this.startCode}};var WorkerExecutionSupport=function(){if(void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this._reset()};WorkerExecutionSupport.WORKER_SUPPORT_VERSION="3.1.0",console.info("Using WorkerSupport version: "+WorkerExecutionSupport.WORKER_SUPPORT_VERSION),WorkerExecutionSupport.prototype={constructor:WorkerExecutionSupport,_reset:function(){this.logging={enabled:!1,debug:!1};var e=this;this.worker={native:null,jsmWorker:!1,logging:!0,workerRunner:{name:"WorkerRunner",usesMeshDisassembler:!1,defaultGeometryType:0},terminateWorkerOnLoad:!0,forceWorkerDataCopy:!1,started:!1,queuedMessage:null,callbacks:{onAssetAvailable:null,onLoad:null,terminate:function(){e._terminate()}}}},setLogging:function(e,t){return this.logging.enabled=!0===e,this.logging.debug=!0===t,this.worker.logging=!0===e,this},setForceWorkerDataCopy:function(e){return this.worker.forceWorkerDataCopy=!0===e,this},setTerminateWorkerOnLoad:function(e){return this.worker.terminateWorkerOnLoad=!0===e,this.worker.terminateWorkerOnLoad&&this.isWorkerLoaded(this.worker.jsmWorker)&&null===this.worker.queuedMessage&&this.worker.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate()),this},updateCallbacks:function(e,t){null!=e&&(this.worker.callbacks.onAssetAvailable=e),null!=t&&(this.worker.callbacks.onLoad=t),this._verifyCallbacks()},_verifyCallbacks:function(){if(void 0===this.worker.callbacks.onAssetAvailable||null===this.worker.callbacks.onAssetAvailable)throw'Unable to run as no "onAssetAvailable" callback is set.'},buildWorker:function(e){var t=!1;e.isSupportsJsmWorker()&&e.isPreferJsmWorker()&&(t=this._buildWorkerJsm(e)),!t&&e.isSupportsStandardWorker()&&this._buildWorkerStandard(e)},_buildWorkerJsm:function(e){var t=!0;if(!this._buildWorkerCheckPreconditions(!0,"buildWorkerJsm")){var r=new URL(e.jsmWorkerFile,window.location.href).href;try{var n=new Worker(r,{type:"module"});this._configureWorkerCommunication(n,!0,e.defaultGeometryType,"buildWorkerJsm")}catch(e){t=!1,(e instanceof TypeError||e instanceof SyntaxError)&&console.error("Modules are not supported in workers.")}}return t},_buildWorkerStandard:function(e){if(!this._buildWorkerCheckPreconditions(!1,"buildWorkerStandard")){var t="";e.getImportStatements().forEach((function(element){t+=element+"\n"})),t+="\n",e.getCodeFragments().forEach((function(element){t+=element+"\n"})),t+="\n",t+=e.getStartCode();var r=new Blob([t],{type:"application/javascript"}),n=new Worker(window.URL.createObjectURL(r));this._configureWorkerCommunication(n,!1,e.defaultGeometryType,"buildWorkerStandard")}},_buildWorkerCheckPreconditions:function(e,t){var r=!1;return this.isWorkerLoaded(e)?r=!0:this.logging.enabled&&(console.info("WorkerExecutionSupport: Building "+(e?"jsm":"standard")+" worker code..."),console.time(t)),r},_configureWorkerCommunication:function(e,t,r,n){this.worker.native=e,this.worker.jsmWorker=t;var o=this;this.worker.native.onmessage=function(e){o._receiveWorkerMessage(e)},null!=r&&(this.worker.workerRunner.defaultGeometryType=r),this.logging.enabled&&console.timeEnd(n)},isWorkerLoaded:function(e){return null!==this.worker.native&&(e&&this.worker.jsmWorker||!e&&!this.worker.jsmWorker)},_receiveWorkerMessage:function(e){var t=e.data,r=this.worker.workerRunner.name;switch(t.cmd){case"assetAvailable":this.worker.callbacks.onAssetAvailable(t);break;case"completeOverall":this.worker.queuedMessage=null,this.worker.started=!1,null!==this.worker.callbacks.onLoad&&this.worker.callbacks.onLoad(t.msg),this.worker.terminateWorkerOnLoad&&(this.worker.logging.enabled&&console.info("WorkerSupport ["+r+"]: Run is complete. Terminating application on request!"),this.worker.callbacks.terminate());break;case"error":console.error("WorkerSupport ["+r+"]: Reported error: "+t.msg),this.worker.queuedMessage=null,this.worker.started=!1,null!==this.worker.callbacks.onLoad&&this.worker.callbacks.onLoad(t.msg),this.worker.terminateWorkerOnLoad&&(this.worker.logging.enabled&&console.info("WorkerSupport ["+r+"]: Run reported error. Terminating application on request!"),this.worker.callbacks.terminate());break;default:console.error("WorkerSupport ["+r+"]: Received unknown command: "+t.cmd)}},executeParallel:function(e,t){e.cmd="parse",e.usesMeshDisassembler=this.worker.workerRunner.usesMeshDisassembler,e.defaultGeometryType=this.worker.workerRunner.defaultGeometryType,this._verifyWorkerIsAvailable(e,t)&&this._postMessage()},_verifyWorkerIsAvailable:function(e,t){this._verifyCallbacks();var r=!0;return null!==this.worker.queuedMessage?(console.warn("Already processing message. Rejecting new run instruction"),r=!1):(this.worker.queuedMessage={payload:e,transferables:null==t?[]:t},this.worker.started=!0),r},_postMessage:function(){if(null!==this.worker.queuedMessage)if(this.worker.queuedMessage.payload.data.input instanceof ArrayBuffer){var e=[];this.worker.forceWorkerDataCopy?e.push(this.worker.queuedMessage.payload.data.input.slice(0)):e.push(this.worker.queuedMessage.payload.data.input),this.worker.queuedMessage.transferables.length>0&&(e=e.concat(this.worker.queuedMessage.transferables)),this.worker.native.postMessage(this.worker.queuedMessage.payload,e)}else this.worker.native.postMessage(this.worker.queuedMessage.payload)},_terminate:function(){this.worker.native.terminate(),this._reset()}};var OBJLoader2Parser=function(){this.logging={enabled:!1,debug:!1};var e=this;this.callbacks={onProgress:function(text){e._onProgress(text)},onAssetAvailable:function(t){e._onAssetAvailable(t)},onError:function(t){e._onError(t)},onLoad:function(t,r){e._onLoad(t,r)}},this.contentRef=null,this.legacyMode=!1,this.materials={},this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0}};OBJLoader2Parser.prototype={constructor:OBJLoader2Parser,_resetRawMesh:function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this._pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},setMaterialPerSmoothingGroup:function(e){return this.materialPerSmoothingGroup=!0===e,this},setUseOAsMesh:function(e){return this.useOAsMesh=!0===e,this},setUseIndices:function(e){return this.useIndices=!0===e,this},setDisregardNormals:function(e){return this.disregardNormals=!0===e,this},setMaterials:function(e){this.materials=Object.assign({},e)},setCallbackOnAssetAvailable:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onAssetAvailable=e),this},setCallbackOnProgress:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onProgress=e),this},setCallbackOnError:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onError=e),this},setCallbackOnLoad:function(e){return null!=e&&e instanceof Function&&(this.callbacks.onLoad=e),this},_onProgress:function(text){var e=text||"";this.logging.enabled&&this.logging.debug&&console.log(e)},_onError:function(e){this.logging.enabled&&this.logging.debug&&console.error(e)},_onAssetAvailable:function(e){var t="OBJLoader2Parser does not provide implementation for onAssetAvailable. Aborting...";throw this.callbacks.onError(t),t},_onLoad:function(e,t){console.log("You reached parser default onLoad callback: "+t)},setLogging:function(e,t){return this.logging.enabled=!0===e,this.logging.debug=!0===t,this},_configure:function(){if(this._pushSmoothingGroup(1),this.logging.enabled){var e=Object.keys(this.materials),t="OBJLoader.Parser configuration:"+(e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseOAsMesh: "+this.useOAsMesh+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals;t+="\n\tcallbacks.onProgress: "+this.callbacks.onProgress.name,t+="\n\tcallbacks.onAssetAvailable: "+this.callbacks.onAssetAvailable.name,t+="\n\tcallbacks.onError: "+this.callbacks.onError.name,console.info(t)}},execute:function(e){this.logging.enabled&&console.time("OBJLoader2Parser.execute"),this._configure();var t=new Uint8Array(e);this.contentRef=t;var r=t.byteLength;this.globalCounts.totalBytes=r;for(var n=new Array(128),code=void 0,o="",l=0,c=0,i=0;i<r;i++)switch(code=t[i]){case 32:o.length>0&&(n[l++]=o),o="";break;case 47:o.length>0&&(n[l++]=o),c++,o="";break;case 10:o.length>0&&(n[l++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=i,this._processLine(n,l,c),l=0,c=0;break;case 13:break;default:o+=String.fromCharCode(code)}this._finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2Parser.execute")},executeLegacy:function(text){this.logging.enabled&&console.time("OBJLoader2Parser.executeLegacy"),this._configure(),this.legacyMode=!0,this.contentRef=text;var e=text.length;this.globalCounts.totalBytes=e;for(var t=new Array(128),r=void 0,n="",o=0,l=0,i=0;i<e;i++)switch(r=text[i]){case" ":n.length>0&&(t[o++]=n),n="";break;case"/":n.length>0&&(t[o++]=n),l++,n="";break;case"\n":n.length>0&&(t[o++]=n),n="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=i,this._processLine(t,o,l),o=0,l=0;break;case"\r":break;default:n+=r}this._finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2Parser.executeLegacy")},_processLine:function(e,t,r){if(!(t<1)){var n,o,i,l,c=function(content,e,t,r){var line="";if(r>t){var i;if(e)for(i=t;i<r;i++)line+=content[i];else for(i=t;i<r;i++)line+=String.fromCharCode(content[i]);line=line.trim()}return line};switch(l=e[0]){case"v":this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t>4&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])));break;case"vt":this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]));break;case"vn":this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]));break;case"f":if(n=t-1,0===r)for(this._checkFaceType(0),i=2,o=n;i<o;i++)this._buildFace(e[1]),this._buildFace(e[i]),this._buildFace(e[i+1]);else if(n===2*r)for(this._checkFaceType(1),i=3,o=n-2;i<o;i+=2)this._buildFace(e[1],e[2]),this._buildFace(e[i],e[i+1]),this._buildFace(e[i+2],e[i+3]);else if(2*n==3*r)for(this._checkFaceType(2),i=4,o=n-3;i<o;i+=3)this._buildFace(e[1],e[2],e[3]),this._buildFace(e[i],e[i+1],e[i+2]),this._buildFace(e[i+3],e[i+4],e[i+5]);else for(this._checkFaceType(3),i=3,o=n-2;i<o;i+=2)this._buildFace(e[1],void 0,e[2]),this._buildFace(e[i],void 0,e[i+1]),this._buildFace(e[i+2],void 0,e[i+3]);break;case"l":case"p":if((n=t-1)===2*r)for(this._checkFaceType(4),i=1,o=n+1;i<o;i+=2)this._buildFace(e[i],e[i+1]);else for(this._checkFaceType("l"===l?5:6),i=1,o=n+1;i<o;i++)this._buildFace(e[i]);break;case"s":this._pushSmoothingGroup(e[1]);break;case"g":this._processCompletedMesh(),this.rawMesh.groupName=c(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.useOAsMesh&&this._processCompletedMesh(),this.rawMesh.objectName=c(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=c(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var h=c(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==h&&this.rawMesh.activeMtlName!==h&&(this.rawMesh.activeMtlName=h,this.rawMesh.counts.mtlCount++,this._checkSubGroup())}}},_pushSmoothingGroup:function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var r=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?t:0===t?0:1,this.rawMesh.smoothingGroup.real=t,r!==t&&(this.rawMesh.counts.smoothingGroupCount++,this._checkSubGroup())},_checkFaceType:function(e){this.rawMesh.faceType!==e&&(this._processCompletedMesh(),this.rawMesh.faceType=e,this._checkSubGroup())},_checkSubGroup:function(){var e=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[e],void 0!==this.rawMesh.subGroupInUse&&null!==this.rawMesh.subGroupInUse||(this.rawMesh.subGroupInUse={index:e,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[e]=this.rawMesh.subGroupInUse)},_buildFace:function(e,t,r){var n=this.rawMesh.subGroupInUse,o=this,l=function(){var l=parseInt(e),c=3*(l>0?l-1:l+o.vertices.length/3),h=o.colors.length>0?c:null,d=n.vertices;if(d.push(o.vertices[c++]),d.push(o.vertices[c++]),d.push(o.vertices[c]),null!==h){var f=n.colors;f.push(o.colors[h++]),f.push(o.colors[h++]),f.push(o.colors[h])}if(t){var m=parseInt(t),v=2*(m>0?m-1:m+o.uvs.length/2),y=n.uvs;y.push(o.uvs[v++]),y.push(o.uvs[v])}if(r&&!o.disregardNormals){var x=parseInt(r),_=3*(x>0?x-1:x+o.normals.length/3),M=n.normals;M.push(o.normals[_++]),M.push(o.normals[_++]),M.push(o.normals[_])}};if(this.useIndices){this.disregardNormals&&(r=void 0);var c=e+(t?"_"+t:"_n")+(r?"_"+r:"_n"),h=n.indexMappings[c];null==h?(h=this.rawMesh.subGroupInUse.vertices.length/3,l(),n.indexMappings[c]=h,n.indexMappingsCount++):this.rawMesh.counts.doubleIndicesCount++,n.indices.push(h)}else l();this.rawMesh.counts.faceCount++},_createRawMeshReport:function(e){return"Input Object number: "+e+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},_finalizeRawMesh:function(){var e,t,r=[],n=0,o=0,l=0,c=0,h=0,d=0;for(var f in this.rawMesh.subGroups)if((e=this.rawMesh.subGroups[f]).vertices.length>0){if((t=e.indices).length>0&&o>0)for(var i=0;i<t.length;i++)t[i]=t[i]+o;r.push(e),n+=e.vertices.length,o+=e.indexMappingsCount,l+=e.indices.length,c+=e.colors.length,d+=e.uvs.length,h+=e.normals.length}var m=null;return r.length>0&&(m={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:r,absoluteVertexCount:n,absoluteIndexCount:l,absoluteColorCount:c,absoluteNormalCount:h,absoluteUvCount:d,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),m},_processCompletedMesh:function(){var e=this._finalizeRawMesh(),t=null!==e;if(t){this.colors.length>0&&this.colors.length!==this.vertices.length&&this.callbacks.onError("Vertex Colors were detected, but vertex count and color count do not match!"),this.logging.enabled&&this.logging.debug&&console.debug(this._createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this._buildMesh(e);var r=this.globalCounts.currentByte/this.globalCounts.totalBytes;this._onProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*r).toFixed(2)+"%"),this._resetRawMesh()}return t},_buildMesh:function(e){var t=e.subGroups,r=new Float32Array(e.absoluteVertexCount);this.globalCounts.vertices+=e.absoluteVertexCount/3,this.globalCounts.faces+=e.faceCount,this.globalCounts.doubleIndicesCount+=e.doubleIndicesCount;var n,o,l,c,h,d,f,m=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,v=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,y=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,x=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,_=null!==v,M=[],w=t.length>1,S=0,A=[],T=[],L=0,C=0,N=0,P=0,F=0,E=0,R=0;for(var D in t)if(t.hasOwnProperty(D)){if(f=(n=t[D]).materialName,d=this.rawMesh.faceType<4?f+(_?"_vertexColor":"")+(0===n.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial",c=this.materials[f],h=this.materials[d],null==c&&null==h&&(d=_?"defaultVertexColorMaterial":"defaultMaterial",h=this.materials[d],this.logging.enabled&&console.info('object_group "'+n.objectName+"_"+n.groupName+'" was defined with unresolvable material "'+f+'"! Assigning "'+d+'".')),null==h){var O={materialNameOrg:f,materialName:d,materialProperties:{vertexColors:_?2:0,flatShading:0===n.smoothingGroup}},I={cmd:"assetAvailable",type:"material",materials:{materialCloneInstructions:O}};this.callbacks.onAssetAvailable(I);var B=this.materials[d];null==B&&(this.materials[d]=O)}if(w?((o=A[d])||(o=S,A[d]=S,M.push(d),S++),l={start:E,count:R=this.useIndices?n.indices.length:n.vertices.length/3,index:o},T.push(l),E+=R):M.push(d),r.set(n.vertices,L),L+=n.vertices.length,m&&(m.set(n.indices,C),C+=n.indices.length),v&&(v.set(n.colors,N),N+=n.colors.length),y&&(y.set(n.normals,P),P+=n.normals.length),x&&(x.set(n.uvs,F),F+=n.uvs.length),this.logging.enabled&&this.logging.debug){var U=null==o?"":"\n\t\tmaterialIndex: "+o,k="\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+n.groupName+"\n\t\tIndex: "+n.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+n.materialName+"\n\t\tsmoothingGroup: "+n.smoothingGroup+U+"\n\t\tobjectName: "+n.objectName+"\n\t\t#vertices: "+n.vertices.length/3+"\n\t\t#indices: "+n.indices.length+"\n\t\t#colors: "+n.colors.length/3+"\n\t\t#uvs: "+n.uvs.length/2+"\n\t\t#normals: "+n.normals.length/3;console.debug(k)}}this.outputObjectCount++,this.callbacks.onAssetAvailable({cmd:"assetAvailable",type:"mesh",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:e.name},materials:{multiMaterial:w,materialNames:M,materialGroups:T},buffers:{vertices:r,indices:m,colors:v,normals:y,uvs:x},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[r.buffer],null!==m?[m.buffer]:null,null!==v?[v.buffer]:null,null!==y?[y.buffer]:null,null!==x?[x.buffer]:null)},_finalizeParsing:function(){if(this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this._processCompletedMesh()&&this.logging.enabled){var e="Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount;console.info(e)}}};var ObjectManipulator=function(){};ObjectManipulator.prototype={constructor:ObjectManipulator,applyProperties:function(e,t,r){var n,o,l;if(null!=e&&null!=t)for(n in t)o="set"+n.substring(0,1).toLocaleUpperCase()+n.substring(1),l=t[n],"function"==typeof e[o]?e[o](l):(e.hasOwnProperty(n)||r)&&(e[n]=l)}};var DefaultWorkerPayloadHandler=function(e){this.parser=e,this.logging={enabled:!1,debug:!1}};DefaultWorkerPayloadHandler.prototype={constructor:DefaultWorkerPayloadHandler,handlePayload:function(e){if(e.logging&&(this.logging.enabled=!0===e.logging.enabled,this.logging.debug=!0===e.logging.debug),"parse"===e.cmd){var t=this,r={callbackOnAssetAvailable:function(e){self.postMessage(e)},callbackOnProgress:function(text){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+text)}},n=this.parser;"function"==typeof n.setLogging&&n.setLogging(this.logging.enabled,this.logging.debug);var o=new ObjectManipulator;o.applyProperties(n,e.params,!1),o.applyProperties(n,r,!1);var l=e.data.input,c="execute";"function"==typeof n.getParseFunctionName&&(c=n.getParseFunctionName()),e.usesMeshDisassembler||n[c](l,e.data.options),this.logging.enabled&&console.log("WorkerRunner: Run complete!"),self.postMessage({cmd:"completeOverall",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)}};var WorkerRunner=function(e){this.payloadHandler=e;var t=this;self.addEventListener("message",(function(e){t.processMessage(e.data)}),!1)};WorkerRunner.prototype={constructor:WorkerRunner,processMessage:function(e){this.payloadHandler.handlePayload(e)}};var OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /,n=/^usemap /;function o(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(a,b,e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[a+0],t[a+1],t[a+2]),r.push(t[b+0],t[b+1],t[b+2]),r.push(t[e+0],t[e+1],t[e+2])},addVertexPoint:function(a){var e=this.vertices;this.object.geometry.vertices.push(e[a+0],e[a+1],e[a+2])},addVertexLine:function(a){var e=this.vertices;this.object.geometry.vertices.push(e[a+0],e[a+1],e[a+2])},addNormal:function(a,b,e){var t=this.normals,r=this.object.geometry.normals;r.push(t[a+0],t[a+1],t[a+2]),r.push(t[b+0],t[b+1],t[b+2]),r.push(t[e+0],t[e+1],t[e+2])},addColor:function(a,b,e){var t=this.colors,r=this.object.geometry.colors;r.push(t[a+0],t[a+1],t[a+2]),r.push(t[b+0],t[b+1],t[b+2]),r.push(t[e+0],t[e+1],t[e+2])},addUV:function(a,b,e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[a+0],t[a+1]),r.push(t[b+0],t[b+1]),r.push(t[e+0],t[e+1])},addUVLine:function(a){var e=this.uvs;this.object.geometry.uvs.push(e[a+0],e[a+1])},addFace:function(a,b,e,t,r,n,o,l,c){var h=this.vertices.length,d=this.parseVertexIndex(a,h),f=this.parseVertexIndex(b,h),m=this.parseVertexIndex(e,h);if(this.addVertex(d,f,m),this.colors.length>0&&this.addColor(d,f,m),void 0!==t&&""!==t){var v=this.uvs.length;d=this.parseUVIndex(t,v),f=this.parseUVIndex(r,v),m=this.parseUVIndex(n,v),this.addUV(d,f,m)}if(void 0!==o&&""!==o){var y=this.normals.length;d=this.parseNormalIndex(o,y),f=o===l?d:this.parseNormalIndex(l,y),m=o===c?d:this.parseNormalIndex(c,y),this.addNormal(d,f,m)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,o=0,l=e.length;o<l;o++)this.addVertexLine(this.parseVertexIndex(e[o],r));var c=0;for(l=t.length;c<l;c++)this.addUVLine(this.parseUVIndex(t[c],n))}};return e.startObject("",!1),e}function l(e){Loader.call(this,e),this.materials=null}return l.prototype=Object.assign(Object.create(Loader.prototype),{constructor:l,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(this.path),l.load(e,(function(text){t(o.parse(text))}),r,n)},setMaterials:function(e){return this.materials=e,this},parse:function(text){var l=new o;-1!==text.indexOf("\r\n")&&(text=text.replace(/\r\n/g,"\n")),-1!==text.indexOf("\\\n")&&(text=text.replace(/\\\n/g,""));for(var c=text.split("\n"),line="",h="",d=[],f="function"==typeof"".trimLeft,i=0,m=c.length;i<m;i++)if(line=c[i],0!==(line=f?line.trimLeft():line.trim()).length&&"#"!==(h=line.charAt(0)))if("v"===h){var data=line.split(/\s+/);switch(data[0]){case"v":l.vertices.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3])),data.length>=7&&l.colors.push(parseFloat(data[4]),parseFloat(data[5]),parseFloat(data[6]));break;case"vn":l.normals.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]));break;case"vt":l.uvs.push(parseFloat(data[1]),parseFloat(data[2]))}}else if("f"===h){for(var v=line.substr(1).trim().split(/\s+/),y=[],x=0,_=v.length;x<_;x++){var M=v[x];if(M.length>0){var w=M.split("/");y.push(w)}}var S=y[0];for(x=1,_=y.length-1;x<_;x++){var A=y[x],T=y[x+1];l.addFace(S[0],A[0],T[0],S[1],A[1],T[1],S[2],A[2],T[2])}}else if("l"===h){var L=line.substring(1).trim().split(" "),C=[],N=[];if(-1===line.indexOf("/"))C=L;else for(var li=0,P=L.length;li<P;li++){var F=L[li].split("/");""!==F[0]&&C.push(F[0]),""!==F[1]&&N.push(F[1])}l.addLineGeometry(C,N)}else if("p"===h){var E=line.substr(1).trim().split(" ");l.addPointGeometry(E)}else if(null!==(d=e.exec(line))){var R=(" "+d[0].substr(1).trim()).substr(1);l.startObject(R)}else if(r.test(line))l.object.startMaterial(line.substring(7).trim(),l.materialLibraries);else if(t.test(line))l.materialLibraries.push(line.substring(7).trim());else if(n.test(line))console.warn('OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===h){if((d=line.split(" ")).length>1){var D=d[1].trim().toLowerCase();l.object.smooth="0"!==D&&"off"!==D}else l.object.smooth=!0;(Y=l.object.currentMaterial())&&(Y.smooth=l.object.smooth)}else{if("\0"===line)continue;console.warn('OBJLoader: Unexpected line: "'+line+'"')}l.finalize();var O=new Group;O.materialLibraries=[].concat(l.materialLibraries);for(i=0,m=l.objects.length;i<m;i++){var object=l.objects[i],I=object.geometry,B=object.materials,U="Line"===I.type,k="Points"===I.type,V=!1;if(0!==I.vertices.length){var G=new BufferGeometry;G.setAttribute("position",new Float32BufferAttribute(I.vertices,3)),I.normals.length>0?G.setAttribute("normal",new Float32BufferAttribute(I.normals,3)):G.computeVertexNormals(),I.colors.length>0&&(V=!0,G.setAttribute("color",new Float32BufferAttribute(I.colors,3))),I.uvs.length>0&&G.setAttribute("uv",new Float32BufferAttribute(I.uvs,2));for(var z,j=[],W=0,H=B.length;W<H;W++){var X=(J=B[W]).name+"_"+J.smooth+"_"+V,Y=l.materials[X];if(null!==this.materials)if(Y=this.materials.create(J.name),!U||!Y||Y instanceof LineBasicMaterial){if(k&&Y&&!(Y instanceof PointsMaterial)){var Q=new PointsMaterial({size:10,sizeAttenuation:!1});Material.prototype.copy.call(Q,Y),Q.color.copy(Y.color),Q.map=Y.map,Y=Q}}else{var K=new LineBasicMaterial;Material.prototype.copy.call(K,Y),K.color.copy(Y.color),Y=K}void 0===Y&&((Y=U?new LineBasicMaterial:k?new PointsMaterial({size:1,sizeAttenuation:!1}):new MeshPhongMaterial).name=J.name,Y.flatShading=!J.smooth,Y.vertexColors=V?VertexColors:NoColors,l.materials[X]=Y),j.push(Y)}if(j.length>1){for(W=0,H=B.length;W<H;W++){var J=B[W];G.addGroup(J.groupStart,J.groupCount,W)}z=U?new LineSegments(G,j):k?new Points(G,j):new Mesh(G,j)}else z=U?new LineSegments(G,j[0]):k?new Points(G,j[0]):new Mesh(G,j[0]);z.name=object.name,O.add(z)}}return O}}),l}(),OBJLoader2=function(e){Loader.call(this,e),this.parser=new OBJLoader2Parser,this.modelName="",this.instanceNo=0,this.baseObject3d=new Object3D,this.materialHandler=new MaterialHandler,this.meshReceiver=new MeshReceiver(this.materialHandler);var t=this;this.parser.setCallbackOnAssetAvailable((function(e){t._onAssetAvailable(e)}))};OBJLoader2.OBJLOADER2_VERSION="3.1.1",console.info("Using OBJLoader2 version: "+OBJLoader2.OBJLOADER2_VERSION),OBJLoader2.prototype=Object.assign(Object.create(Loader.prototype),{constructor:OBJLoader2,setLogging:function(e,t){return this.parser.setLogging(e,t),this},setMaterialPerSmoothingGroup:function(e){return this.parser.setMaterialPerSmoothingGroup(e),this},setUseOAsMesh:function(e){return this.parser.setUseOAsMesh(e),this},setUseIndices:function(e){return this.parser.setUseIndices(e),this},setDisregardNormals:function(e){return this.parser.setDisregardNormals(e),this},setModelName:function(e){return this.modelName=e||this.modelName,this},setBaseObject3d:function(e){return this.baseObject3d=null==e?this.baseObject3d:e,this},addMaterials:function(e,t){return this.materialHandler.addMaterials(e,t),this},setCallbackOnAssetAvailable:function(e){return this.parser.setCallbackOnAssetAvailable(e),this},setCallbackOnProgress:function(e){return this.parser.setCallbackOnProgress(e),this},setCallbackOnError:function(e){return this.parser.setCallbackOnError(e),this},setCallbackOnLoad:function(e){return this.parser.setCallbackOnLoad(e),this},setCallbackOnMeshAlter:function(e){return this.meshReceiver._setCallbacks(this.parser.callbacks.onProgress,e),this},setCallbackOnLoadMaterials:function(e){return this.materialHandler._setCallbacks(e),this},load:function(e,t,r,n,o){var l=this;if(!(null!=t&&t instanceof Function)){var c="onLoad is not a function! Aborting...";throw l.parser.callbacks.onError(c),c}this.parser.setCallbackOnLoad(t),null!=n&&n instanceof Function||(n=function(e){var t=e;e.currentTarget&&null!==e.currentTarget.statusText&&(t="Error occurred while downloading!\nurl: "+e.currentTarget.responseURL+"\nstatus: "+e.currentTarget.statusText),l.parser.callbacks.onError(t)}),e||n("An invalid url was provided. Unable to continue!");var h=new URL(e,window.location.href).href,d=h,f=h.split("/");if(f.length>2){d=f[f.length-1];var m=f.slice(0,f.length-1).join("/")+"/";null!=m&&(this.path=m)}if(null==r||!(r instanceof Function)){var v=0,y=0;r=function(t){if(t.lengthComputable&&(y=t.loaded/t.total)>v){v=y;var output='Download of "'+e+'": '+(100*y).toFixed(2)+"%";l.parser.callbacks.onProgress("progressLoad",output,y)}}}this.setCallbackOnMeshAlter(o);var x=new FileLoader(this.manager);x.setPath(this.path||this.resourcePath),x.setResponseType("arraybuffer"),x.load(d,(function(content){l.parser.callbacks.onLoad(l.parse(content),"OBJLoader2#load: Parsing completed")}),r,n)},parse:function(content){if(null==content)throw"Provided content is not a valid ArrayBuffer or String. Unable to continue parsing";return this.parser.logging.enabled&&console.time("OBJLoader parse: "+this.modelName),this.materialHandler.createDefaultMaterials(!1),this.parser.setMaterials(this.materialHandler.getMaterials()),content instanceof ArrayBuffer||content instanceof Uint8Array?(this.parser.logging.enabled&&console.info("Parsing arrayBuffer..."),this.parser.execute(content)):"string"==typeof content||content instanceof String?(this.parser.logging.enabled&&console.info("Parsing text..."),this.parser.executeLegacy(content)):this.parser.callbacks.onError("Provided content was neither of type String nor Uint8Array! Aborting..."),this.parser.logging.enabled&&console.timeEnd("OBJLoader parse: "+this.modelName),this.baseObject3d},_onAssetAvailable:function(e){if("assetAvailable"===e.cmd)if("mesh"===e.type)for(var t=this.meshReceiver.buildMeshes(e),i=0,r=t.length;i<r;i++){var n=t[i];this.baseObject3d.add(n)}else"material"===e.type&&this.materialHandler.addPayloadMaterials(e)}});var OBJLoader2Parallel=function(e){OBJLoader2.call(this,e),this.preferJsmWorker=!1,this.executeParallel=!0,this.workerExecutionSupport=new WorkerExecutionSupport};OBJLoader2Parallel.OBJLOADER2_PARALLEL_VERSION="3.1.2",console.info("Using OBJLoader2Parallel version: "+OBJLoader2Parallel.OBJLOADER2_PARALLEL_VERSION),OBJLoader2Parallel.prototype=Object.assign(Object.create(OBJLoader2.prototype),{constructor:OBJLoader2Parallel,setExecuteParallel:function(e){return this.executeParallel=!0===e,this},setPreferJsmWorker:function(e){return this.preferJsmWorker=!0===e,this},getWorkerExecutionSupport:function(){return this.workerExecutionSupport},buildWorkerCode:function(){var e=new CodeBuilderInstructions(!0,!0,this.preferJsmWorker);if(e.isSupportsJsmWorker()&&e.setJsmWorkerFile("../sources/loaders/obj2/worker/parallel/jsm/OBJLoader2Worker.js"),e.isSupportsStandardWorker()){var t=new ObjectManipulator,r=new DefaultWorkerPayloadHandler(this.parser),n=new WorkerRunner({});e.addCodeFragment(CodeSerializer.serializeClass(OBJLoader2Parser,this.parser)),e.addCodeFragment(CodeSerializer.serializeClass(ObjectManipulator,t)),e.addCodeFragment(CodeSerializer.serializeClass(DefaultWorkerPayloadHandler,r)),e.addCodeFragment(CodeSerializer.serializeClass(WorkerRunner,n));var o="new "+n.constructor.name+"( new "+r.constructor.name+"( new "+this.parser.constructor.name+"() ) );";e.addStartCode(o)}return e},load:function(content,e,t,r,n){var o=this;OBJLoader2.prototype.load.call(this,content,(function(t,r){"OBJLoader2ParallelDummy"===t.name?o.parser.logging.enabled&&o.parser.logging.debug&&console.debug("Received dummy answer from OBJLoader2Parallel#parse"):e(t,r)}),t,r,n)},parse:function(content){if(this.executeParallel){if(this.parser.callbacks.onLoad===this.parser._onLoad)throw"No callback other than the default callback was provided! Aborting!";if(!this.workerExecutionSupport.isWorkerLoaded(this.preferJsmWorker)){this.workerExecutionSupport.buildWorker(this.buildWorkerCode());var e=this;this.workerExecutionSupport.updateCallbacks((function(t){e._onAssetAvailable(t)}),(function(t){e.parser.callbacks.onLoad(e.baseObject3d,t)}))}this.materialHandler.createDefaultMaterials(!1),this.workerExecutionSupport.executeParallel({params:{modelName:this.modelName,instanceNo:this.instanceNo,useIndices:this.parser.useIndices,disregardNormals:this.parser.disregardNormals,materialPerSmoothingGroup:this.parser.materialPerSmoothingGroup,useOAsMesh:this.parser.useOAsMesh,materials:this.materialHandler.getMaterialsJSON()},data:{input:content,options:null},logging:{enabled:this.parser.logging.enabled,debug:this.parser.logging.debug}});var t=new Object3D;return t.name="OBJLoader2ParallelDummy",t}return OBJLoader2.prototype.parse.call(this,content)}});var PCDLoader=function(e){Loader.call(this,e),this.littleEndian=!0};PCDLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:PCDLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(data){try{t(o.parse(data,e))}catch(e){if(!n)throw e;n(e)}}),r,n)},parse:function(data,e){var t=LoaderUtils.decodeText(new Uint8Array(data)),r=function(data){var e={},t=data.search(/[\r\n]DATA\s(\S*)\s/i),r=/[\r\n]DATA\s(\S*)\s/i.exec(data.substr(t-1));if(e.data=r[1],e.headerLen=r[0].length+t,e.str=data.substr(0,e.headerLen),e.str=e.str.replace(/\#.*/gi,""),e.version=/VERSION (.*)/i.exec(e.str),e.fields=/FIELDS (.*)/i.exec(e.str),e.size=/SIZE (.*)/i.exec(e.str),e.type=/TYPE (.*)/i.exec(e.str),e.count=/COUNT (.*)/i.exec(e.str),e.width=/WIDTH (.*)/i.exec(e.str),e.height=/HEIGHT (.*)/i.exec(e.str),e.viewpoint=/VIEWPOINT (.*)/i.exec(e.str),e.points=/POINTS (.*)/i.exec(e.str),null!==e.version&&(e.version=parseFloat(e.version[1])),null!==e.fields&&(e.fields=e.fields[1].split(" ")),null!==e.type&&(e.type=e.type[1].split(" ")),null!==e.width&&(e.width=parseInt(e.width[1])),null!==e.height&&(e.height=parseInt(e.height[1])),null!==e.viewpoint&&(e.viewpoint=e.viewpoint[1]),null!==e.points&&(e.points=parseInt(e.points[1],10)),null===e.points&&(e.points=e.width*e.height),null!==e.size&&(e.size=e.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==e.count)e.count=e.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{e.count=[];for(var i=0,n=e.fields.length;i<n;i++)e.count.push(1)}e.offset={};var o=0;for(i=0,n=e.fields.length;i<n;i++)"ascii"===e.data?e.offset[e.fields[i]]=i:(e.offset[e.fields[i]]=o,o+=e.size[i]);return e.rowSize=o,e}(t),n=[],o=[],l=[];if("ascii"===r.data)for(var c=r.offset,h=t.substr(r.headerLen).split("\n"),i=0,d=h.length;i<d;i++)if(""!==h[i]){var line=h[i].split(" ");if(void 0!==c.x&&(n.push(parseFloat(line[c.x])),n.push(parseFloat(line[c.y])),n.push(parseFloat(line[c.z]))),void 0!==c.rgb){var f=parseFloat(line[c.rgb]),m=f>>16&255,g=f>>8&255,b=f>>0&255;l.push(m/255,g/255,b/255)}void 0!==c.normal_x&&(o.push(parseFloat(line[c.normal_x])),o.push(parseFloat(line[c.normal_y])),o.push(parseFloat(line[c.normal_z])))}if("binary_compressed"===r.data){var v=new Uint32Array(data.slice(r.headerLen,r.headerLen+8)),y=v[0],x=v[1],_=function(e,t){var r,n,o,l=e.length,c=new Uint8Array(t),h=0,d=0;do{if((r=e[h++])<32){if(d+ ++r>t)throw new Error("Output buffer is not large enough");if(h+r>l)throw new Error("Invalid compressed data");do{c[d++]=e[h++]}while(--r)}else{if(n=r>>5,o=d-((31&r)<<8)-1,h>=l)throw new Error("Invalid compressed data");if(7===n&&(n+=e[h++],h>=l))throw new Error("Invalid compressed data");if(o-=e[h++],d+n+2>t)throw new Error("Output buffer is not large enough");if(o<0)throw new Error("Invalid compressed data");if(o>=d)throw new Error("Invalid compressed data");do{c[d++]=c[o++]}while(2+--n)}}while(h<l);return c}(new Uint8Array(data,r.headerLen+8,y),x),M=new DataView(_.buffer);for(c=r.offset,i=0;i<r.points;i++)void 0!==c.x&&(n.push(M.getFloat32(r.points*c.x+r.size[0]*i,this.littleEndian)),n.push(M.getFloat32(r.points*c.y+r.size[1]*i,this.littleEndian)),n.push(M.getFloat32(r.points*c.z+r.size[2]*i,this.littleEndian))),void 0!==c.rgb&&(l.push(M.getUint8(r.points*c.rgb+r.size[3]*i+0)/255),l.push(M.getUint8(r.points*c.rgb+r.size[3]*i+1)/255),l.push(M.getUint8(r.points*c.rgb+r.size[3]*i+2)/255)),void 0!==c.normal_x&&(o.push(M.getFloat32(r.points*c.normal_x+r.size[4]*i,this.littleEndian)),o.push(M.getFloat32(r.points*c.normal_y+r.size[5]*i,this.littleEndian)),o.push(M.getFloat32(r.points*c.normal_z+r.size[6]*i,this.littleEndian)))}if("binary"===r.data){M=new DataView(data,r.headerLen),c=r.offset,i=0;for(var w=0;i<r.points;i++,w+=r.rowSize)void 0!==c.x&&(n.push(M.getFloat32(w+c.x,this.littleEndian)),n.push(M.getFloat32(w+c.y,this.littleEndian)),n.push(M.getFloat32(w+c.z,this.littleEndian))),void 0!==c.rgb&&(l.push(M.getUint8(w+c.rgb+2)/255),l.push(M.getUint8(w+c.rgb+1)/255),l.push(M.getUint8(w+c.rgb+0)/255)),void 0!==c.normal_x&&(o.push(M.getFloat32(w+c.normal_x,this.littleEndian)),o.push(M.getFloat32(w+c.normal_y,this.littleEndian)),o.push(M.getFloat32(w+c.normal_z,this.littleEndian)))}var S=new BufferGeometry;n.length>0&&S.setAttribute("position",new Float32BufferAttribute(n,3)),o.length>0&&S.setAttribute("normal",new Float32BufferAttribute(o,3)),l.length>0&&S.setAttribute("color",new Float32BufferAttribute(l,3)),S.computeBoundingSphere();var A=new PointsMaterial({size:.005});l.length>0?A.vertexColors=VertexColors:A.color.setHex(16777215*Math.random());var T=new Points(S,A),L=e.split("").reverse().join("");return L=(L=/([^\/]*)/.exec(L))[1].split("").reverse().join(""),T.name=L,T}});var PDBLoader=function(e){Loader.call(this,e)};PDBLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:PDBLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(text){function e(text){return text.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function t(text){return text.charAt(0).toUpperCase()+text.substr(1).toLowerCase()}function r(e,t){var r=parseInt(y[i].substr(e,t));if(r){var n=function(s,e){return"s"+Math.min(s,e)+"e"+Math.max(s,e)}(_,r);void 0===v[n]&&(m.push([_-1,r-1,1]),v[n]=m.length-1)}}for(var n,o,l,c,h,d={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},f=[],m=[],v={},y=text.split("\n"),i=0,x=y.length;i<x;i++)if("ATOM"===y[i].substr(0,4)||"HETATM"===y[i].substr(0,6))n=parseFloat(y[i].substr(30,7)),o=parseFloat(y[i].substr(38,7)),l=parseFloat(y[i].substr(46,7)),c=parseInt(y[i].substr(6,5))-1,""===(h=e(y[i].substr(76,2)).toLowerCase())&&(h=e(y[i].substr(12,2)).toLowerCase()),f[c]=[n,o,l,d[h],t(h)];else if("CONECT"===y[i].substr(0,6)){var _=parseInt(y[i].substr(6,5));r(11,5),r(16,5),r(21,5),r(26,5)}return function(){var i,e,t={geometryAtoms:new BufferGeometry,geometryBonds:new BufferGeometry,json:{atoms:f,bonds:m}},r=t.geometryAtoms,n=t.geometryBonds,o=[],l=[],c=[];for(i=0,e=f.length;i<e;i++){var h=f[i],d=h[0],v=h[1],y=h[2];o.push(d,v,y);var x=h[3][0]/255,g=h[3][1]/255,b=h[3][2]/255;l.push(x,g,b)}for(i=0,e=m.length;i<e;i++){var _=m[i],M=_[0],w=_[1];c.push(o[3*M+0]),c.push(o[3*M+1]),c.push(o[3*M+2]),c.push(o[3*w+0]),c.push(o[3*w+1]),c.push(o[3*w+2])}return r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(l,3)),n.setAttribute("position",new Float32BufferAttribute(c,3)),t}()}});var PLYLoader=function(e){Loader.call(this,e),this.propertyNameMapping={}};PLYLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:PLYLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){t(o.parse(text))}),r,n)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(data){function e(data){var e="",t=0,r=/ply([\s\S]*)end_header\r?\n/.exec(data);null!==r&&(e=r[1],t=r[0].length);var n,o,l,c,h,d,header={comments:[],elements:[],headerLength:t},m=e.split("\n");for(var i=0;i<m.length;i++){var line=m[i];if(""!==(line=line.trim()))switch(o=(l=line.split(/\s+/)).shift(),line=l.join(" "),o){case"format":header.format=l[0],header.version=l[1];break;case"comment":header.comments.push(line);break;case"element":void 0!==n&&header.elements.push(n),(n={}).name=l[0],n.count=parseInt(l[1]),n.properties=[];break;case"property":n.properties.push((c=l,h=f.propertyNameMapping,d=void 0,"list"===(d={type:c[0]}).type?(d.name=c[3],d.countType=c[1],d.itemType=c[2]):d.name=c[1],d.name in h&&(d.name=h[d.name]),d));break;default:console.log("unhandled",o,l)}}return void 0!==n&&header.elements.push(n),header}function t(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,line){for(var r=line.split(/\s+/),element={},i=0;i<e.length;i++)if("list"===e[i].type){for(var n=[],o=t(r.shift(),e[i].countType),l=0;l<o;l++)n.push(t(r.shift(),e[i].itemType));element[e[i].name]=n}else element[e[i].name]=t(r.shift(),e[i].type);return element}function n(data,header){var e,t={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},body="";null!==(e=/end_header\s([\s\S]*)$/.exec(data))&&(body=e[1]);for(var n=body.split("\n"),c=0,h=0,i=0;i<n.length;i++){var line=n[i];if(""!==(line=line.trim())){h>=header.elements[c].count&&(c++,h=0);var element=r(header.elements[c].properties,line);l(t,header.elements[c].name,element),h++}}return o(t)}function o(e){var t=new BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function l(e,t,element){if("vertex"===t)e.vertices.push(element.x,element.y,element.z),"nx"in element&&"ny"in element&&"nz"in element&&e.normals.push(element.nx,element.ny,element.nz),"s"in element&&"t"in element&&e.uvs.push(element.s,element.t),"red"in element&&"green"in element&&"blue"in element&&e.colors.push(element.red/255,element.green/255,element.blue/255);else if("face"===t){var r=element.vertex_indices||element.vertex_index,n=element.texcoord;3===r.length?(e.indices.push(r[0],r[1],r[2]),n&&6===n.length&&(e.faceVertexUvs.push(n[0],n[1]),e.faceVertexUvs.push(n[2],n[3]),e.faceVertexUvs.push(n[4],n[5]))):4===r.length&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3]))}}function c(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function h(e,t,r,n){for(var o,element={},l=0,i=0;i<r.length;i++)if("list"===r[i].type){var h=[],d=(o=c(e,t+l,r[i].countType,n))[0];l+=o[1];for(var f=0;f<d;f++)o=c(e,t+l,r[i].itemType,n),h.push(o[0]),l+=o[1];element[r[i].name]=h}else o=c(e,t+l,r[i].type,n),element[r[i].name]=o[0],l+=o[1];return[element,l]}var d,f=this;if(data instanceof ArrayBuffer){var text=LoaderUtils.decodeText(new Uint8Array(data)),header=e(text);d="ascii"===header.format?n(text,header):function(data,header){for(var e,t={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},r="binary_little_endian"===header.format,body=new DataView(data,header.headerLength),n=0,c=0;c<header.elements.length;c++)for(var d=0;d<header.elements[c].count;d++){n+=(e=h(body,n,header.elements[c].properties,r))[1];var element=e[0];l(t,header.elements[c].name,element)}return o(t)}(data,header)}else d=n(data,e(data));return d}});var PRWMLoader=function(){var e=null;function t(){if(null===e){var t=new ArrayBuffer(2),r=new Uint8Array(t),n=new Uint16Array(t);r[0]=170,r[1]=187,e=43707===n[0]}return e}var r=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],n={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function o(e,r,o,l,c){var h,d=r.BYTES_PER_ELEMENT;if(c===t()||1===d)h=new r(e,o,l);else{var f=new DataView(e,o,l*d),m=n[r.name],v=!c,i=0;for(h=new r(l);i<l;i++)h[i]=f[m](i*d,v)}return h}function l(e){Loader.call(this,e)}return l.prototype=Object.assign(Object.create(Loader.prototype),{constructor:l,load:function(e,r,n,o){var l=this,c=new FileLoader(l.manager);c.setPath(l.path),c.setResponseType("arraybuffer"),e=e.replace(/\*/g,t()?"be":"le"),c.load(e,(function(e){r(l.parse(e))}),n,o)},parse:function(e){var t,i,data=function(e){var t=new Uint8Array(e),n=t[0],l=t[1],c=!!(l>>7&1),h=l>>6&1,d=1==(l>>5&1),f=31&l,m=0,v=0;if(d?(m=(t[2]<<16)+(t[3]<<8)+t[4],v=(t[5]<<16)+(t[6]<<8)+t[7]):(m=t[2]+(t[3]<<8)+(t[4]<<16),v=t[5]+(t[6]<<8)+(t[7]<<16)),0===n)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==n)throw new Error("PRWM decoder: Unsupported format version: "+n);if(!c){if(0!==h)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==v)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var y,x,_,M,w,S,A,i,T=8,L={};for(i=0;i<f;i++){for(y="";T<t.length&&(x=t[T],T++,0!==x);)y+=String.fromCharCode(x);_=(l=t[T])>>7&1,M=1+(l>>4&3),T++,S=o(e,w=r[15&l],T=4*Math.ceil(T/4),M*m,d),T+=w.BYTES_PER_ELEMENT*M*m,L[y]={type:_,cardinality:M,values:S}}return T=4*Math.ceil(T/4),A=null,c&&(A=o(e,1===h?Uint32Array:Uint16Array,T,v,d)),{version:n,attributes:L,indices:A}}(e),n=Object.keys(data.attributes),l=new BufferGeometry;for(i=0;i<n.length;i++)t=data.attributes[n[i]],l.setAttribute(n[i],new BufferAttribute(t.values,t.cardinality,t.normalized));return null!==data.indices&&l.setIndex(new BufferAttribute(data.indices,1)),l}}),l.isBigEndianPlatform=function(){return t()},l}(),PVRLoader=function(e){CompressedTextureLoader.call(this,e)};PVRLoader.prototype=Object.assign(Object.create(CompressedTextureLoader.prototype),{constructor:PVRLoader,parse:function(e,t){var header=new Uint32Array(e,0,13),r={buffer:e,header:header,loadMipmaps:t};return 55727696===header[0]?PVRLoader._parseV3(r):559044176===header[11]?PVRLoader._parseV2(r):void console.error("PVRLoader: Unknown PVR format.")}}),PVRLoader._parseV3=function(e){var t,r,header=e.header,n=header[12],o=header[2],l=header[6],c=header[7],h=header[10],d=header[11];switch(o){case 0:t=2,r=RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,r=RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,r=RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,r=RGBA_PVRTC_4BPPV1_Format;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return e.dataPtr=52+n,e.bpp=t,e.format=r,e.width=c,e.height=l,e.numSurfaces=h,e.numMipmaps=d,e.isCubemap=6===h,PVRLoader._extract(e)},PVRLoader._parseV2=function(e){var t,r,header=e.header,n=header[0],o=header[1],l=header[2],c=header[3],h=header[4],d=header[10],f=header[12],m=255&h,v=d>0;return 25===m?(r=v?RGBA_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,t=4):24===m?(r=v?RGBA_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,t=2):console.error("PVRLoader: Unknown PVR format:",m),e.dataPtr=n,e.bpp=t,e.format=r,e.width=l,e.height=o,e.numSurfaces=f,e.numMipmaps=c+1,e.isCubemap=6===f,PVRLoader._extract(e)},PVRLoader._extract=function(e){var t,r={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},n=e.buffer,o=e.dataPtr,l=e.bpp,c=e.numSurfaces,h=0,d=0,f=0,m=0,v=0;2===l?(d=8,f=4):(d=4,f=4),t=d*f*l/8,r.mipmaps.length=e.numMipmaps*c;for(var y=0;y<e.numMipmaps;){var x=e.width>>y,_=e.height>>y;(m=x/d)<2&&(m=2),(v=_/f)<2&&(v=2),h=m*v*t;for(var M=0;M<c;M++){var w={data:new Uint8Array(n,o,h),width:x,height:_};r.mipmaps[M*e.numMipmaps+y]=w,o+=h}y++}return r};var STLLoader=function(e){Loader.call(this,e)};function EllipseCurve(e,t,r,n,o,l,c,h){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=o||0,this.aEndAngle=l||2*Math.PI,this.aClockwise=c||!1,this.aRotation=h||0}function ArcCurve(e,t,r,n,o,l){EllipseCurve.call(this,e,t,r,r,n,o,l),this.type="ArcCurve"}function CubicPoly(){var e=0,t=0,r=0,n=0;function o(o,l,c,h){e=o,t=c,r=-3*o+3*l-2*c-h,n=2*o-2*l+c+h}return{initCatmullRom:function(e,t,r,n,l){o(t,r,l*(r-e),l*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,l,c,h){var d=(t-e)/l-(r-e)/(l+c)+(r-t)/c,f=(r-t)/c-(n-t)/(c+h)+(n-r)/h;o(t,r,d*=c,f*=c)},calc:function(o){var l=o*o;return e+t*o+r*l+n*(l*o)}}}STLLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:STLLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){try{t(o.parse(text))}catch(e){n&&n(e)}}),r,n)},parse:function(data){function e(e,t,r){for(var i=0,n=e.length;i<n;i++)if(e[i]!==t.getUint8(r+i,!1))return!1;return!0}var t,r=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}(data);return function(data){var t;if(50,84+50*(t=new DataView(data)).getUint32(80,!0)===t.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(e(r,t,n))return!1;return!0}(r)?function(data){for(var e,g,b,t,r,n,o,l,c=new DataView(data),h=c.getUint32(80,!0),d=!1,f=0;f<70;f++)1129270351==c.getUint32(f,!1)&&82==c.getUint8(f+4)&&61==c.getUint8(f+5)&&(d=!0,t=new Float32Array(3*h*3),r=c.getUint8(f+6)/255,n=c.getUint8(f+7)/255,o=c.getUint8(f+8)/255,l=c.getUint8(f+9)/255);for(var m=new BufferGeometry,v=new Float32Array(3*h*3),y=new Float32Array(3*h*3),x=0;x<h;x++){var _=84+50*x,M=c.getFloat32(_,!0),w=c.getFloat32(_+4,!0),S=c.getFloat32(_+8,!0);if(d){var A=c.getUint16(_+48,!0);0==(32768&A)?(e=(31&A)/31,g=(A>>5&31)/31,b=(A>>10&31)/31):(e=r,g=n,b=o)}for(var i=1;i<=3;i++){var T=_+12*i,L=3*x*3+3*(i-1);v[L]=c.getFloat32(T,!0),v[L+1]=c.getFloat32(T+4,!0),v[L+2]=c.getFloat32(T+8,!0),y[L]=M,y[L+1]=w,y[L+2]=S,d&&(t[L]=e,t[L+1]=g,t[L+2]=b)}}return m.setAttribute("position",new BufferAttribute(v,3)),m.setAttribute("normal",new BufferAttribute(y,3)),d&&(m.setAttribute("color",new BufferAttribute(t,3)),m.hasColors=!0,m.alpha=l),m}(r):function(data){for(var e,t=new BufferGeometry,r=/solid([\s\S]*?)endsolid/g,n=/facet([\s\S]*?)endfacet/g,o=0,l=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,c=new RegExp("vertex"+l+l+l,"g"),h=new RegExp("normal"+l+l+l,"g"),d=[],f=[],m=new Vector3,v=0,y=0,x=0;null!==(e=r.exec(data));){y=x;for(var _=e[0];null!==(e=n.exec(_));){for(var M=0,w=0,text=e[0];null!==(e=h.exec(text));)m.x=parseFloat(e[1]),m.y=parseFloat(e[2]),m.z=parseFloat(e[3]),w++;for(;null!==(e=c.exec(text));)d.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),f.push(m.x,m.y,m.z),M++,x++;1!==w&&console.error("STLLoader: Something isn't right with the normal of face number "+o),3!==M&&console.error("STLLoader: Something isn't right with the vertices of face number "+o),o++}var S=y,A=x-y;t.addGroup(S,A,v),v++}return t.setAttribute("position",new Float32BufferAttribute(d,3)),t.setAttribute("normal",new Float32BufferAttribute(f,3)),t}("string"!=typeof(t=data)?LoaderUtils.decodeText(new Uint8Array(t)):t)}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){for(var r=t||new Vector2,n=2*Math.PI,o=this.aEndAngle-this.aStartAngle,l=Math.abs(o)<Number.EPSILON;o<0;)o+=n;for(;o>n;)o-=n;o<Number.EPSILON&&(o=l?0:n),!0!==this.aClockwise||l||(o===n?o=-n:o-=n);var c=this.aStartAngle+e*o,h=this.aX+this.xRadius*Math.cos(c),d=this.aY+this.yRadius*Math.sin(c);if(0!==this.aRotation){var f=Math.cos(this.aRotation),m=Math.sin(this.aRotation),v=h-this.aX,y=d-this.aY;h=v*f-y*m+this.aX,d=v*m+y*f+this.aY}return r.set(h,d)},EllipseCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.aX=source.aX,this.aY=source.aY,this.xRadius=source.xRadius,this.yRadius=source.yRadius,this.aStartAngle=source.aStartAngle,this.aEndAngle=source.aEndAngle,this.aClockwise=source.aClockwise,this.aRotation=source.aRotation,this},EllipseCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.aX=this.aX,data.aY=this.aY,data.xRadius=this.xRadius,data.yRadius=this.yRadius,data.aStartAngle=this.aStartAngle,data.aEndAngle=this.aEndAngle,data.aClockwise=this.aClockwise,data.aRotation=this.aRotation,data},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e,t,r,n){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function CatmullRom(e,t,r,n,o){var l=.5*(n-t),c=.5*(o-r),h=e*e;return(2*r-2*n+l+c)*(e*h)+(-3*r+3*n-2*l-c)*h+l*e+r}function QuadraticBezierP0(e,p){var t=1-e;return t*t*p}function QuadraticBezierP1(e,p){return 2*(1-e)*e*p}function QuadraticBezierP2(e,p){return e*e*p}function QuadraticBezier(e,t,r,n){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,r)+QuadraticBezierP2(e,n)}function CubicBezierP0(e,p){var t=1-e;return t*t*t*p}function CubicBezierP1(e,p){var t=1-e;return 3*t*t*e*p}function CubicBezierP2(e,p){return 3*(1-e)*e*e*p}function CubicBezierP3(e,p){return e*e*e*p}function CubicBezier(e,t,r,n,o){return CubicBezierP0(e,t)+CubicBezierP1(e,r)+CubicBezierP2(e,n)+CubicBezierP3(e,o)}function CubicBezierCurve(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2,this.v3=n||new Vector2}function CubicBezierCurve3(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3,this.v3=n||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2}function QuadraticBezierCurve3(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3}function SplineCurve(e){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var r,n,o,l,c=t||new Vector3,h=this.points,d=h.length,p=(d-(this.closed?0:1))*e,f=Math.floor(p),m=p-f;if(this.closed?f+=f>0?0:(Math.floor(Math.abs(f)/d)+1)*d:0===m&&f===d-1&&(f=d-2,m=1),this.closed||f>0?r=h[(f-1)%d]:(tmp.subVectors(h[0],h[1]).add(h[0]),r=tmp),n=h[f%d],o=h[(f+1)%d],this.closed||f+2<d?l=h[(f+2)%d]:(tmp.subVectors(h[d-1],h[d-2]).add(h[d-1]),l=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){var v="chordal"===this.curveType?.5:.25,y=Math.pow(r.distanceToSquared(n),v),x=Math.pow(n.distanceToSquared(o),v),_=Math.pow(o.distanceToSquared(l),v);x<1e-4&&(x=1),y<1e-4&&(y=x),_<1e-4&&(_=x),px.initNonuniformCatmullRom(r.x,n.x,o.x,l.x,y,x,_),py.initNonuniformCatmullRom(r.y,n.y,o.y,l.y,y,x,_),pz.initNonuniformCatmullRom(r.z,n.z,o.z,l.z,y,x,_)}else"catmullrom"===this.curveType&&(px.initCatmullRom(r.x,n.x,o.x,l.x,this.tension),py.initCatmullRom(r.y,n.y,o.y,l.y,this.tension),pz.initCatmullRom(r.z,n.z,o.z,l.z,this.tension));return c.set(px.calc(m),py.calc(m),pz.calc(m)),c},CatmullRomCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source),this.points=[];for(var i=0,e=source.points.length;i<e;i++){var t=source.points[i];this.points.push(t.clone())}return this.closed=source.closed,this.curveType=source.curveType,this.tension=source.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,e=this.points.length;i<e;i++){var t=this.points[i];data.points.push(t.toArray())}return data.closed=this.closed,data.curveType=this.curveType,data.tension=this.tension,data},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var i=0,t=e.points.length;i<t;i++){var r=e.points[i];this.points.push((new Vector3).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,o=this.v1,l=this.v2,c=this.v3;return r.set(CubicBezier(e,n.x,o.x,l.x,c.x),CubicBezier(e,n.y,o.y,l.y,c.y)),r},CubicBezierCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},CubicBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,o=this.v1,l=this.v2,c=this.v3;return r.set(CubicBezier(e,n.x,o.x,l.x,c.x),CubicBezier(e,n.y,o.y,l.y,c.y),CubicBezier(e,n.z,o.z,l.z,c.z)),r},CubicBezierCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},LineCurve.prototype.getPointAt=function(u,e){return this.getPoint(u,e)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},LineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},LineCurve3.prototype.getPointAt=function(u,e){return this.getPoint(u,e)},LineCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},LineCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,o=this.v1,l=this.v2;return r.set(QuadraticBezier(e,n.x,o.x,l.x),QuadraticBezier(e,n.y,o.y,l.y)),r},QuadraticBezierCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,o=this.v1,l=this.v2;return r.set(QuadraticBezier(e,n.x,o.x,l.x),QuadraticBezier(e,n.y,o.y,l.y),QuadraticBezier(e,n.z,o.z,l.z)),r},QuadraticBezierCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.points,p=(n.length-1)*e,o=Math.floor(p),l=p-o,c=n[0===o?o:o-1],h=n[o],d=n[o>n.length-2?n.length-1:o+1],f=n[o>n.length-3?n.length-1:o+2];return r.set(CatmullRom(l,c.x,h.x,d.x,f.x),CatmullRom(l,c.y,h.y,d.y,f.y)),r},SplineCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source),this.points=[];for(var i=0,e=source.points.length;i<e;i++){var t=source.points[i];this.points.push(t.clone())}return this},SplineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,e=this.points.length;i<e;i++){var t=this.points[i];data.points.push(t.toArray())}return data},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var i=0,t=e.points.length;i<t;i++){var r=e.points[i];this.points.push((new Vector2).fromArray(r))}return this};var Curves={ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve,GrannyKnot:GrannyKnot,HeartCurve:HeartCurve,VivianiCurve:VivianiCurve,KnotCurve:KnotCurve,HelixCurve:HelixCurve,TrefoilKnot:TrefoilKnot,TorusKnot:TorusKnot,CinquefoilKnot:CinquefoilKnot,TrefoilPolynomialKnot:TrefoilPolynomialKnot,FigureEightPolynomialKnot:FigureEightPolynomialKnot,DecoratedTorusKnot4a:DecoratedTorusKnot4a,DecoratedTorusKnot4b:DecoratedTorusKnot4b,DecoratedTorusKnot5a:DecoratedTorusKnot5a,DecoratedTorusKnot5c:DecoratedTorusKnot5c};function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}function Shape(e){Path.call(this,e),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Curves.LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,o=this.curves[i],l=o.getLength(),u=0===l?0:1-n/l;return o.getPointAt(u)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,n=this.curves;i<n.length;i++)for(var o=n[i],l=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,c=o.getPoints(l),h=0;h<c.length;h++){var d=c[h];t&&t.equals(d)||(r.push(d),t=d)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(source){Curve.prototype.copy.call(this,source),this.curves=[];for(var i=0,e=source.curves.length;i<e;i++){var t=source.curves[i];this.curves.push(t.clone())}return this.autoClose=source.autoClose,this},toJSON:function(){var data=Curve.prototype.toJSON.call(this);data.autoClose=this.autoClose,data.curves=[];for(var i=0,e=this.curves.length;i<e;i++){var t=this.curves[i];data.curves.push(t.toJSON())}return data},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var i=0,t=e.curves.length;i<t;i++){var r=e.curves[i];this.curves.push((new Curves[r.type]).fromJSON(r))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var i=1,t=e.length;i<t;i++)this.lineTo(e[i].x,e[i].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,n){var o=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n));return this.curves.push(o),this.currentPoint.set(r,n),this},bezierCurveTo:function(e,t,r,n,o,l){var c=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n),new Vector2(o,l));return this.curves.push(c),this.currentPoint.set(o,l),this},splineThru:function(e){var t=new SplineCurve([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,n,o,l){var c=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(e+c,t+h,r,n,o,l),this},absarc:function(e,t,r,n,o,l){return this.absellipse(e,t,r,r,n,o,l),this},ellipse:function(e,t,r,n,o,l,c,h){var d=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+d,t+f,r,n,o,l,c,h),this},absellipse:function(e,t,r,n,o,l,c,h){var d=new EllipseCurve(e,t,r,n,o,l,c,h);if(this.curves.length>0){var f=d.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(d);var m=d.getPoint(1);return this.currentPoint.copy(m),this},copy:function(source){return CurvePath.prototype.copy.call(this,source),this.currentPoint.copy(source.currentPoint),this},toJSON:function(){var data=CurvePath.prototype.toJSON.call(this);return data.currentPoint=this.currentPoint.toArray(),data},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(source){Path.prototype.copy.call(this,source),this.holes=[];for(var i=0,e=source.holes.length;i<e;i++){var t=source.holes[i];this.holes.push(t.clone())}return this},toJSON:function(){var data=Path.prototype.toJSON.call(this);data.uuid=this.uuid,data.holes=[];for(var i=0,e=this.holes.length;i<e;i++){var t=this.holes[i];data.holes.push(t.toJSON())}return data},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var i=0,t=e.holes.length;i<t;i++){var r=e.holes[i];this.holes.push((new Path).fromJSON(r))}return this}});var Earcut={triangulate:function(data,e,t){t=t||2;var r,n,o,l,c,h,d,f=e&&e.length,m=f?e[0]*t:data.length,v=linkedList(data,0,m,t,!0),y=[];if(!v||v.next===v.prev)return y;if(f&&(v=eliminateHoles(data,e,v,t)),data.length>80*t){r=o=data[0],n=l=data[1];for(var i=t;i<m;i+=t)(c=data[i])<r&&(r=c),(h=data[i+1])<n&&(n=h),c>o&&(o=c),h>l&&(l=h);d=0!==(d=Math.max(o-r,l-n))?1/d:0}return earcutLinked(v,y,t,r,n,d),y}};function linkedList(data,e,t,r,n){var i,o;if(n===signedArea(data,e,t,r)>0)for(i=e;i<t;i+=r)o=insertNode(i,data[i],data[i+1],o);else for(i=t-r;i>=e;i-=r)o=insertNode(i,data[i],data[i+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,p=e;do{if(r=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=t=p.prev)===p.next)break;r=!0}}while(r||p!==t);return t}function earcutLinked(e,t,r,n,o,l,c){if(e){!c&&l&&indexCurve(e,n,o,l);for(var h,d,f=e;e.prev!==e.next;)if(h=e.prev,d=e.next,l?isEarHashed(e,n,o,l):isEar(e))t.push(h.i/r),t.push(e.i/r),t.push(d.i/r),removeNode(e),e=d.next,f=d.next;else if((e=d)===f){c?1===c?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,n,o,l,2):2===c&&splitEarcut(e,t,r,n,o,l):earcutLinked(filterPoints(e),t,r,n,o,l,1);break}}}function isEar(e){var a=e.prev,b=e,t=e.next;if(area(a,b,t)>=0)return!1;for(var p=e.next.next;p!==e.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,t.x,t.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(e,t,r,n){var a=e.prev,b=e,o=e.next;if(area(a,b,o)>=0)return!1;for(var l=a.x<b.x?a.x<o.x?a.x:o.x:b.x<o.x?b.x:o.x,c=a.y<b.y?a.y<o.y?a.y:o.y:b.y<o.y?b.y:o.y,h=a.x>b.x?a.x>o.x?a.x:o.x:b.x>o.x?b.x:o.x,d=a.y>b.y?a.y>o.y?a.y:o.y:b.y>o.y?b.y:o.y,f=zOrder(l,c,t,r,n),m=zOrder(h,d,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=f&&v&&v.z<=m;){if(p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,b.x,b.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&pointInTriangle(a.x,a.y,b.x,b.y,o.x,o.y,v.x,v.y)&&area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=f;){if(p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,b.x,b.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=m;){if(v!==e.prev&&v!==e.next&&pointInTriangle(a.x,a.y,b.x,b.y,o.x,o.y,v.x,v.y)&&area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function cureLocalIntersections(e,t,r){var p=e;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(t.push(a.i/r),t.push(p.i/r),t.push(b.i/r),removeNode(p),removeNode(p.next),p=e=b),p=p.next}while(p!==e);return p}function splitEarcut(e,t,r,n,o,l){var a=e;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,t,r,n,o,l),void earcutLinked(c,t,r,n,o,l)}b=b.next}a=a.next}while(a!==e)}function eliminateHoles(data,e,t,r){var i,n,o,l=[];for(i=0,n=e.length;i<n;i++)(o=linkedList(data,e[i]*r,i<n-1?e[i+1]*r:data.length,r,!1))===o.next&&(o.steiner=!0),l.push(getLeftmost(o));for(l.sort(compareX),i=0;i<l.length;i++)eliminateHole(l[i],t),t=filterPoints(t,t.next);return t}function compareX(a,b){return a.x-b.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var b=splitPolygon(t,e);filterPoints(b,b.next)}}function findHoleBridge(e,t){var r,p=t,n=e.x,o=e.y,l=-1/0;do{if(o<=p.y&&o>=p.next.y&&p.next.y!==p.y){var c=p.x+(o-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(c<=n&&c>l){if(l=c,c===n){if(o===p.y)return p;if(o===p.next.y)return p.next}r=p.x<p.next.x?p:p.next}}p=p.next}while(p!==t);if(!r)return null;if(n===l)return r.prev;var h,d=r,f=r.x,m=r.y,v=1/0;for(p=r.next;p!==d;)n>=p.x&&p.x>=f&&n!==p.x&&pointInTriangle(o<m?n:l,o,f,m,o<m?l:n,o,p.x,p.y)&&((h=Math.abs(o-p.y)/(n-p.x))<v||h===v&&p.x>r.x)&&locallyInside(p,e)&&(r=p,v=h),p=p.next;return r}function indexCurve(e,t,r,n){var p=e;do{null===p.z&&(p.z=zOrder(p.x,p.y,t,r,n)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==e);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(e){var i,p,q,t,r,n,o,l,c=1;do{for(p=e,e=null,r=null,n=0;p;){for(n++,q=p,o=0,i=0;i<c&&(o++,q=q.nextZ);i++);for(l=c;o>0||l>0&&q;)0!==o&&(0===l||!q||p.z<=q.z)?(t=p,p=p.nextZ,o--):(t=q,q=q.nextZ,l--),r?r.nextZ=t:e=t,t.prevZ=r,r=t;p=q}r.nextZ=null,c*=2}while(n>1);return e}function zOrder(e,t,r,n,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var p=e,t=e;do{(p.x<t.x||p.x===t.x&&p.y<t.y)&&(t=p),p=p.next}while(p!==e);return t}function pointInTriangle(e,t,r,n,o,l,c,h){return(o-c)*(t-h)-(e-c)*(l-h)>=0&&(e-c)*(n-h)-(r-c)*(t-h)>=0&&(r-c)*(l-h)-(o-c)*(n-h)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,e){return(q.y-p.y)*(e.x-q.x)-(q.x-p.x)*(e.y-q.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){return!!(equals(e,r)&&equals(t,n)||equals(e,n)&&equals(r,t))||area(e,t,r)>0!=area(e,t,n)>0&&area(r,n,e)>0!=area(r,n,t)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,e=!1,t=(a.x+b.x)/2,r=(a.y+b.y)/2;do{p.y>r!=p.next.y>r&&p.next.y!==p.y&&t<(p.next.x-p.x)*(r-p.y)/(p.next.y-p.y)+p.x&&(e=!e),p=p.next}while(p!==a);return e}function splitPolygon(a,b){var e=new Node$1(a.i,a.x,a.y),t=new Node$1(b.i,b.x,b.y),r=a.next,n=b.prev;return a.next=b,b.prev=a,e.next=r,r.prev=e,t.next=e,e.prev=t,n.next=t,t.prev=n,t}function insertNode(i,e,t,r){var p=new Node$1(i,e,t);return r?(p.next=r.next,p.prev=r,r.next.prev=p,r.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node$1(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,e,t,r){for(var n=0,i=e,o=t-r;i<t;i+=r)n+=(data[o]-data[i])*(data[i+1]+data[o+1]),o=i;return n}var ShapeUtils={area:function(e){for(var t=e.length,a=0,p=t-1,q=0;q<t;p=q++)a+=e[p].x*e[q].y-e[q].x*e[p].y;return.5*a},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],o=[];removeDupEndPts(e),addContour(r,e);var l=e.length;t.forEach(removeDupEndPts);for(var i=0;i<t.length;i++)n.push(l),l+=t[i].length,addContour(r,t[i]);var c=Earcut.triangulate(r,n);for(i=0;i<c.length;i+=3)o.push(c.slice(i,i+3));return o}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this},bezierCurveTo:function(e,t,r,n,o,l){return this.currentPath.bezierCurveTo(e,t,r,n,o,l),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new Shape;o.curves=n.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,p=r-1,q=0;q<r;p=q++){var o=t[p],l=t[q],c=l.x-o.x,h=l.y-o.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(o=t[q],c=-c,l=t[p],h=-h),e.y<o.y||e.y>l.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var d=h*(e.x-o.x)-c*(e.y-o.y);if(0===d)return!0;if(d<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(l.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=l.x)return!0}}return n}var o=ShapeUtils.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return r(l);var c,h,d,f=[];if(1===l.length)return h=l[0],(d=new Shape).curves=h.curves,f.push(d),f;var m=!o(l[0].getPoints());m=e?!m:m;var v,y,x=[],_=[],M=[],w=0;_[w]=void 0,M[w]=[];for(var i=0,S=l.length;i<S;i++)c=o(v=(h=l[i]).getPoints()),(c=e?!c:c)?(!m&&_[w]&&w++,_[w]={s:new Shape,p:v},_[w].s.curves=h.curves,m&&w++,M[w]=[]):M[w].push({h:h,p:v[0]});if(!_[0])return r(l);if(_.length>1){for(var A=!1,T=[],L=0,C=_.length;L<C;L++)x[L]=[];for(L=0,C=_.length;L<C;L++)for(var N=M[L],P=0;P<N.length;P++){for(var F=N[P],E=!0,R=0;R<_.length;R++)n(F.p,_[R].p)&&(L!==R&&T.push({froms:L,tos:R,hole:P}),E?(E=!1,x[R].push(F)):A=!0);E&&x[L].push(F)}T.length>0&&(A||(M=x))}i=0;for(var D=_.length;i<D;i++){d=_[i].s,f.push(d);for(var O=0,I=(y=M[i]).length;O<I;O++)d.holes.push(y[O].h)}return f}});var SVGLoader=function(e){Loader.call(this,e),this.defaultDPI=90,this.defaultUnit="px"},tempV2_1,tempV2_2,tempV2_3,tempV2_4,tempV2_5,tempV2_6,tempV2_7,lastPointL,lastPointR,point0L,point0R,currentPointL,currentPointR,nextPointL,nextPointR,innerPoint,outerPoint;SVGLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:SVGLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(text){var e=this;function t(path,e,t,n,o,l,c,h){n=n*Math.PI/180,e=Math.abs(e),t=Math.abs(t);var d=(c.x-h.x)/2,f=(c.y-h.y)/2,m=Math.cos(n)*d+Math.sin(n)*f,v=-Math.sin(n)*d+Math.cos(n)*f,y=e*e,x=t*t,_=m*m,M=v*v,w=_/y+M/x;if(w>1){var s=Math.sqrt(w);y=(e*=s)*e,x=(t*=s)*t}var S=y*M+x*_,A=(y*x-S)/S,q=Math.sqrt(Math.max(0,A));o===l&&(q=-q);var T=q*e*v/t,L=-q*t*m/e,C=Math.cos(n)*T-Math.sin(n)*L+(c.x+h.x)/2,N=Math.sin(n)*T+Math.cos(n)*L+(c.y+h.y)/2,P=r(1,0,(m-T)/e,(v-L)/t),F=r((m-T)/e,(v-L)/t,(-m-T)/e,(-v-L)/t)%(2*Math.PI);path.currentPath.absellipse(C,N,e,t,P,P+F,0===l,n)}function r(e,t,r,n){var o=e*r+t*n,l=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n),c=Math.acos(Math.max(-1,Math.min(1,o/l)));return e*n-t*r<0&&(c=-c),c}function n(e,style){function t(t,r,n){void 0===n&&(n=function(e){return e}),e.hasAttribute(t)&&(style[r]=n(e.getAttribute(t))),e.style&&""!==e.style[t]&&(style[r]=n(e.style[t]))}function r(e){return Math.max(0,Math.min(1,d(e)))}function n(e){return Math.max(0,d(e))}return style=Object.assign({},style),t("fill","fill"),t("fill-opacity","fillOpacity",r),t("stroke","stroke"),t("stroke-opacity","strokeOpacity",r),t("stroke-width","strokeWidth",n),t("stroke-linejoin","strokeLineJoin"),t("stroke-linecap","strokeLineCap"),t("stroke-miterlimit","strokeMiterLimit",n),style}function o(a,b){return a-(b-a)}function l(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),i=0;i<t.length;i++){var r=t[i];if(r.indexOf(".")!==r.lastIndexOf("."))for(var n=r.split("."),s=2;s<n.length;s++)t.splice(i+s-1,0,"0."+n[s]);t[i]=d(r)}return t}var c=["mm","cm","in","pt","pc","px"],h={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function d(t){var r="px";if("string"==typeof t||t instanceof String)for(var i=0,n=c.length;i<n;i++){var u=c[i];if(t.endsWith(u)){r=u,t=t.substring(0,t.length-u.length);break}}var o=void 0;return"px"===r&&"px"!==e.defaultUnit?o=h.in[e.defaultUnit]/e.defaultDPI:(o=h[r][e.defaultUnit])<0&&(o=h[r].in*e.defaultDPI),o*parseFloat(t)}function f(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function m(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var v=[],y=[],x=new Matrix3,_=new Matrix3,M=new Matrix3,w=new Matrix3,S=new Vector2,A=new Vector3,T=new Matrix3,L=(new DOMParser).parseFromString(text,"image/svg+xml");return function e(r,style){if(1===r.nodeType){var c=function(e){if(!e.hasAttribute("transform"))return null;var t=function(e){for(var t=new Matrix3,r=x,n=e.getAttribute("transform").split(")"),o=n.length-1;o>=0;o--){var c=n[o].trim();if(""!==c){var h=c.indexOf("("),d=c.length;if(h>0&&h<d){var f=c.substr(0,h),m=l(c.substr(h+1,d-h-1));switch(r.identity(),f){case"translate":if(m.length>=1){var v=m[0],y=v;m.length>=2&&(y=m[1]),r.translate(v,y)}break;case"rotate":if(m.length>=1){var S,A=0,T=0;S=-m[0]*Math.PI/180,m.length>=3&&(A=m[1],T=m[2]),_.identity().translate(-A,-T),M.identity().rotate(S),w.multiplyMatrices(M,_),_.identity().translate(A,T),r.multiplyMatrices(_,w)}break;case"scale":if(m.length>=1){var L=m[0],C=L;m.length>=2&&(C=m[1]),r.scale(L,C)}break;case"skewX":1===m.length&&r.set(1,Math.tan(m[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===m.length&&r.set(1,0,0,Math.tan(m[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===m.length&&r.set(m[0],m[2],m[4],m[1],m[3],m[5],0,0,1)}}t.premultiply(r)}}return t}(e);y.length>0&&t.premultiply(y[y.length-1]);return T.copy(t),y.push(t),t}(r),path=null;switch(r.nodeName){case"svg":break;case"g":style=n(r,style);break;case"path":style=n(r,style),r.hasAttribute("d")&&(path=function(e){for(var path=new ShapePath,r=new Vector2,n=new Vector2,c=new Vector2,h=!0,d=!1,f=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),i=0,m=f.length;i<m;i++){var v=f[i],y=v.charAt(0),data=v.substr(1).trim();switch(!0===h&&(d=!0,h=!1),y){case"M":for(var x=l(data),_=0,M=x.length;_<M;_+=2)r.x=x[_+0],r.y=x[_+1],n.x=r.x,n.y=r.y,0===_?path.moveTo(r.x,r.y):path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"H":for(x=l(data),_=0,M=x.length;_<M;_++)r.x=x[_],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"V":for(x=l(data),_=0,M=x.length;_<M;_++)r.y=x[_],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"L":for(x=l(data),_=0,M=x.length;_<M;_+=2)r.x=x[_+0],r.y=x[_+1],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"C":for(x=l(data),_=0,M=x.length;_<M;_+=6)path.bezierCurveTo(x[_+0],x[_+1],x[_+2],x[_+3],x[_+4],x[_+5]),n.x=x[_+2],n.y=x[_+3],r.x=x[_+4],r.y=x[_+5],0===_&&!0===d&&c.copy(r);break;case"S":for(x=l(data),_=0,M=x.length;_<M;_+=4)path.bezierCurveTo(o(r.x,n.x),o(r.y,n.y),x[_+0],x[_+1],x[_+2],x[_+3]),n.x=x[_+0],n.y=x[_+1],r.x=x[_+2],r.y=x[_+3],0===_&&!0===d&&c.copy(r);break;case"Q":for(x=l(data),_=0,M=x.length;_<M;_+=4)path.quadraticCurveTo(x[_+0],x[_+1],x[_+2],x[_+3]),n.x=x[_+0],n.y=x[_+1],r.x=x[_+2],r.y=x[_+3],0===_&&!0===d&&c.copy(r);break;case"T":for(x=l(data),_=0,M=x.length;_<M;_+=2){var w=o(r.x,n.x),S=o(r.y,n.y);path.quadraticCurveTo(w,S,x[_+0],x[_+1]),n.x=w,n.y=S,r.x=x[_+0],r.y=x[_+1],0===_&&!0===d&&c.copy(r)}break;case"A":for(x=l(data),_=0,M=x.length;_<M;_+=7){var A=r.clone();r.x=x[_+5],r.y=x[_+6],n.x=r.x,n.y=r.y,t(path,x[_],x[_+1],x[_+2],x[_+3],x[_+4],A,r),0===_&&!0===d&&c.copy(r)}break;case"m":for(x=l(data),_=0,M=x.length;_<M;_+=2)r.x+=x[_+0],r.y+=x[_+1],n.x=r.x,n.y=r.y,0===_?path.moveTo(r.x,r.y):path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"h":for(x=l(data),_=0,M=x.length;_<M;_++)r.x+=x[_],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"v":for(x=l(data),_=0,M=x.length;_<M;_++)r.y+=x[_],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"l":for(x=l(data),_=0,M=x.length;_<M;_+=2)r.x+=x[_+0],r.y+=x[_+1],n.x=r.x,n.y=r.y,path.lineTo(r.x,r.y),0===_&&!0===d&&c.copy(r);break;case"c":for(x=l(data),_=0,M=x.length;_<M;_+=6)path.bezierCurveTo(r.x+x[_+0],r.y+x[_+1],r.x+x[_+2],r.y+x[_+3],r.x+x[_+4],r.y+x[_+5]),n.x=r.x+x[_+2],n.y=r.y+x[_+3],r.x+=x[_+4],r.y+=x[_+5],0===_&&!0===d&&c.copy(r);break;case"s":for(x=l(data),_=0,M=x.length;_<M;_+=4)path.bezierCurveTo(o(r.x,n.x),o(r.y,n.y),r.x+x[_+0],r.y+x[_+1],r.x+x[_+2],r.y+x[_+3]),n.x=r.x+x[_+0],n.y=r.y+x[_+1],r.x+=x[_+2],r.y+=x[_+3],0===_&&!0===d&&c.copy(r);break;case"q":for(x=l(data),_=0,M=x.length;_<M;_+=4)path.quadraticCurveTo(r.x+x[_+0],r.y+x[_+1],r.x+x[_+2],r.y+x[_+3]),n.x=r.x+x[_+0],n.y=r.y+x[_+1],r.x+=x[_+2],r.y+=x[_+3],0===_&&!0===d&&c.copy(r);break;case"t":for(x=l(data),_=0,M=x.length;_<M;_+=2){w=o(r.x,n.x),S=o(r.y,n.y);path.quadraticCurveTo(w,S,r.x+x[_+0],r.y+x[_+1]),n.x=w,n.y=S,r.x=r.x+x[_+0],r.y=r.y+x[_+1],0===_&&!0===d&&c.copy(r)}break;case"a":for(x=l(data),_=0,M=x.length;_<M;_+=7){A=r.clone();r.x+=x[_+5],r.y+=x[_+6],n.x=r.x,n.y=r.y,t(path,x[_],x[_+1],x[_+2],x[_+3],x[_+4],A,r),0===_&&!0===d&&c.copy(r)}break;case"Z":case"z":path.currentPath.autoClose=!0,path.currentPath.curves.length>0&&(r.copy(c),path.currentPath.currentPoint.copy(r),h=!0);break;default:console.warn(v)}d=!1}return path}(r));break;case"rect":style=n(r,style),path=function(e){var t=d(e.getAttribute("x")||0),r=d(e.getAttribute("y")||0),n=d(e.getAttribute("rx")||0),o=d(e.getAttribute("ry")||0),l=d(e.getAttribute("width")),c=d(e.getAttribute("height")),path=new ShapePath;path.moveTo(t+2*n,r),path.lineTo(t+l-2*n,r),(0!==n||0!==o)&&path.bezierCurveTo(t+l,r,t+l,r,t+l,r+2*o);path.lineTo(t+l,r+c-2*o),(0!==n||0!==o)&&path.bezierCurveTo(t+l,r+c,t+l,r+c,t+l-2*n,r+c);path.lineTo(t+2*n,r+c),(0!==n||0!==o)&&path.bezierCurveTo(t,r+c,t,r+c,t,r+c-2*o);path.lineTo(t,r+2*o),(0!==n||0!==o)&&path.bezierCurveTo(t,r,t,r,t+2*n,r);return path}(r);break;case"polygon":style=n(r,style),path=function(e){function t(e,a,b){var t=d(a),n=d(b);0===r?path.moveTo(t,n):path.lineTo(t,n),r++}var path=new ShapePath,r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,t),path.currentPath.autoClose=!0,path}(r);break;case"polyline":style=n(r,style),path=function(e){function t(e,a,b){var t=d(a),n=d(b);0===r?path.moveTo(t,n):path.lineTo(t,n),r++}var path=new ShapePath,r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,t),path.currentPath.autoClose=!1,path}(r);break;case"circle":style=n(r,style),path=function(e){var t=d(e.getAttribute("cx")),r=d(e.getAttribute("cy")),n=d(e.getAttribute("r")),o=new Path;o.absarc(t,r,n,0,2*Math.PI);var path=new ShapePath;return path.subPaths.push(o),path}(r);break;case"ellipse":style=n(r,style),path=function(e){var t=d(e.getAttribute("cx")),r=d(e.getAttribute("cy")),n=d(e.getAttribute("rx")),o=d(e.getAttribute("ry")),l=new Path;l.absellipse(t,r,n,o,0,2*Math.PI);var path=new ShapePath;return path.subPaths.push(l),path}(r);break;case"line":style=n(r,style),path=function(e){var t=d(e.getAttribute("x1")),r=d(e.getAttribute("y1")),n=d(e.getAttribute("x2")),o=d(e.getAttribute("y2")),path=new ShapePath;return path.moveTo(t,r),path.lineTo(n,o),path.currentPath.autoClose=!1,path}(r);break;default:console.log(r)}path&&(void 0!==style.fill&&"none"!==style.fill&&path.color.setStyle(style.fill),function(path,e){function t(t){A.set(t.x,t.y,1).applyMatrix3(e),t.set(A.x,A.y)}for(var r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(e),n=path.subPaths,i=0,o=n.length;i<o;i++)for(var l=n[i].curves,c=0;c<l.length;c++){var h=l[c];h.isLineCurve?(t(h.v1),t(h.v2)):h.isCubicBezierCurve?(t(h.v0),t(h.v1),t(h.v2),t(h.v3)):h.isQuadraticBezierCurve?(t(h.v0),t(h.v1),t(h.v2)):h.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),S.set(h.aX,h.aY),t(S),h.aX=S.x,h.aY=S.y,h.xRadius*=f(e),h.yRadius*=m(e))}}(path,T),v.push(path),path.userData={node:r,style:style});for(var h=r.childNodes,i=0;i<h.length;i++)e(h[i],style);c&&(y.pop(),y.length>0?T.copy(y[y.length-1]):T.identity())}}(L.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:v,xml:L.documentElement}}}),SVGLoader.getStrokeStyle=function(e,t,r,n,o){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:o=void 0!==o?o:4}},SVGLoader.pointsToStroke=function(e,style,t,r){var n=[],o=[],l=[];if(0===SVGLoader.pointsToStrokeWithBuffers(e,style,t,r,n,o,l))return null;var c=new BufferGeometry;return c.setAttribute("position",new Float32BufferAttribute(n,3)),c.setAttribute("normal",new Float32BufferAttribute(o,3)),c.setAttribute("uv",new Float32BufferAttribute(l,2)),c},SVGLoader.pointsToStrokeWithBuffers=(tempV2_1=new Vector2,tempV2_2=new Vector2,tempV2_3=new Vector2,tempV2_4=new Vector2,tempV2_5=new Vector2,tempV2_6=new Vector2,tempV2_7=new Vector2,lastPointL=new Vector2,lastPointR=new Vector2,point0L=new Vector2,point0R=new Vector2,currentPointL=new Vector2,currentPointR=new Vector2,nextPointL=new Vector2,nextPointR=new Vector2,innerPoint=new Vector2,outerPoint=new Vector2,function(e,style,t,r,n,o,l,c){t=void 0!==t?t:12,r=void 0!==r?r:.001,c=void 0!==c?c:0;var h=(e=function(e){for(var t=!1,i=1,n=e.length-1;i<n;i++)if(e[i].distanceTo(e[i+1])<r){t=!0;break}if(!t)return e;var o=[];for(o.push(e[0]),i=1,n=e.length-1;i<n;i++)e[i].distanceTo(e[i+1])>=r&&o.push(e[i]);return o.push(e[e.length-1]),o}(e)).length;if(h<2)return 0;var d,f,m,v,y,x=e[0].equals(e[h-1]),_=e[0],M=style.strokeWidth/2,w=1/(h-1),S=0,A=!1,T=0,L=3*c,C=2*c;V(e[0],e[1],tempV2_1).multiplyScalar(M),lastPointL.copy(e[0]).sub(tempV2_1),lastPointR.copy(e[0]).add(tempV2_1),point0L.copy(lastPointL),point0R.copy(lastPointR);for(var N=1;N<h;N++){d=e[N],f=N===h-1?x?e[1]:void 0:e[N+1];var P=tempV2_1;V(_,d,P),tempV2_3.copy(P).multiplyScalar(M),currentPointL.copy(d).sub(tempV2_3),currentPointR.copy(d).add(tempV2_3);var F=S+w;if(m=!1,void 0!==f){V(d,f,tempV2_2),tempV2_3.copy(tempV2_2).multiplyScalar(M),nextPointL.copy(d).sub(tempV2_3),nextPointR.copy(d).add(tempV2_3),v=!0,tempV2_3.subVectors(f,_),P.dot(tempV2_3)<0&&(v=!1),1===N&&(A=v),tempV2_3.subVectors(f,d),tempV2_3.normalize();var E=Math.abs(P.dot(tempV2_3));if(0!==E){var R=M/E;tempV2_3.multiplyScalar(-R),tempV2_4.subVectors(d,_),tempV2_5.copy(tempV2_4).setLength(R).add(tempV2_3),innerPoint.copy(tempV2_5).negate();var D=tempV2_5.length(),O=tempV2_4.length();tempV2_4.divideScalar(O),tempV2_6.subVectors(f,d);var I=tempV2_6.length();switch(tempV2_6.divideScalar(I),tempV2_4.dot(innerPoint)<O&&tempV2_6.dot(innerPoint)<I&&(m=!0),outerPoint.copy(tempV2_5).add(d),innerPoint.add(d),y=!1,m?v?(nextPointR.copy(innerPoint),currentPointR.copy(innerPoint)):(nextPointL.copy(innerPoint),currentPointL.copy(innerPoint)):j(),style.strokeLineJoin){case"bevel":W(v,m,F);break;case"round":H(v,m),v?z(d,currentPointL,nextPointL,F,0):z(d,nextPointR,currentPointR,F,1);break;case"miter":case"miter-clip":default:var B=M*style.strokeMiterLimit/D;if(B<1){if("miter-clip"!==style.strokeLineJoin){W(v,m,F);break}H(v,m),v?(tempV2_6.subVectors(outerPoint,currentPointL).multiplyScalar(B).add(currentPointL),tempV2_7.subVectors(outerPoint,nextPointL).multiplyScalar(B).add(nextPointL),G(currentPointL,F,0),G(tempV2_6,F,0),G(d,F,.5),G(d,F,.5),G(tempV2_6,F,0),G(tempV2_7,F,0),G(d,F,.5),G(tempV2_7,F,0),G(nextPointL,F,0)):(tempV2_6.subVectors(outerPoint,currentPointR).multiplyScalar(B).add(currentPointR),tempV2_7.subVectors(outerPoint,nextPointR).multiplyScalar(B).add(nextPointR),G(currentPointR,F,1),G(tempV2_6,F,1),G(d,F,.5),G(d,F,.5),G(tempV2_6,F,1),G(tempV2_7,F,1),G(d,F,.5),G(tempV2_7,F,1),G(nextPointR,F,1))}else m?(v?(G(lastPointR,S,1),G(lastPointL,S,0),G(outerPoint,F,0),G(lastPointR,S,1),G(outerPoint,F,0),G(innerPoint,F,1)):(G(lastPointR,S,1),G(lastPointL,S,0),G(outerPoint,F,1),G(lastPointL,S,0),G(innerPoint,F,0),G(outerPoint,F,1)),v?nextPointL.copy(outerPoint):nextPointR.copy(outerPoint)):v?(G(currentPointL,F,0),G(outerPoint,F,0),G(d,F,.5),G(d,F,.5),G(outerPoint,F,0),G(nextPointL,F,0)):(G(currentPointR,F,1),G(outerPoint,F,1),G(d,F,.5),G(d,F,.5),G(outerPoint,F,1),G(nextPointR,F,1)),y=!0}}else j()}else j();x||N!==h-1||X(e[0],point0L,point0R,v,!0,S),S=F,_=d,lastPointL.copy(nextPointL),lastPointR.copy(nextPointR)}if(x){if(m&&n){var U=outerPoint,k=innerPoint;A!==v&&(U=innerPoint,k=outerPoint),v?(y||A)&&(k.toArray(n,0),k.toArray(n,9),y&&U.toArray(n,3)):!y&&A||(k.toArray(n,3),k.toArray(n,9),y&&U.toArray(n,0))}}else X(d,currentPointL,currentPointR,v,!1,F);return T;function V(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function G(e,u,t){n&&(n[L]=e.x,n[L+1]=e.y,n[L+2]=0,o&&(o[L]=0,o[L+1]=0,o[L+2]=1),L+=3,l&&(l[C]=u,l[C+1]=t,C+=2)),T+=3}function z(e,r,n,u,o){tempV2_1.copy(r).sub(e).normalize(),tempV2_2.copy(n).sub(e).normalize();var l=Math.PI,c=tempV2_1.dot(tempV2_2);Math.abs(c)<1&&(l=Math.abs(Math.acos(c))),l/=t,tempV2_3.copy(r);for(var i=0,h=t-1;i<h;i++)tempV2_4.copy(tempV2_3).rotateAround(e,l),G(tempV2_3,u,o),G(tempV2_4,u,o),G(e,u,.5),tempV2_3.copy(tempV2_4);G(tempV2_4,u,o),G(n,u,o),G(e,u,.5)}function j(){G(lastPointR,S,1),G(lastPointL,S,0),G(currentPointL,F,0),G(lastPointR,S,1),G(currentPointL,F,1),G(currentPointR,F,0)}function W(e,t,u){t?e?(G(lastPointR,S,1),G(lastPointL,S,0),G(currentPointL,F,0),G(lastPointR,S,1),G(currentPointL,F,0),G(innerPoint,F,1),G(currentPointL,u,0),G(nextPointL,u,0),G(innerPoint,u,.5)):(G(lastPointR,S,1),G(lastPointL,S,0),G(currentPointR,F,1),G(lastPointL,S,0),G(innerPoint,F,0),G(currentPointR,F,1),G(currentPointR,u,1),G(nextPointR,u,0),G(innerPoint,u,.5)):e?(G(currentPointL,u,0),G(nextPointL,u,0),G(d,u,.5)):(G(currentPointR,u,1),G(nextPointR,u,0),G(d,u,.5))}function H(e,t){t&&(e?(G(lastPointR,S,1),G(lastPointL,S,0),G(currentPointL,F,0),G(lastPointR,S,1),G(currentPointL,F,0),G(innerPoint,F,1),G(currentPointL,S,0),G(d,F,.5),G(innerPoint,F,1),G(d,F,.5),G(nextPointL,S,0),G(innerPoint,F,1)):(G(lastPointR,S,1),G(lastPointL,S,0),G(currentPointR,F,1),G(lastPointL,S,0),G(innerPoint,F,0),G(currentPointR,F,1),G(currentPointR,S,1),G(innerPoint,F,0),G(d,F,.5),G(d,F,.5),G(innerPoint,F,0),G(nextPointR,S,1)))}function X(e,t,r,o,l,u){switch(style.strokeLineCap){case"round":l?z(e,r,t,u,.5):z(e,t,r,u,.5);break;case"square":if(l)tempV2_1.subVectors(t,e),tempV2_2.set(tempV2_1.y,-tempV2_1.x),tempV2_3.addVectors(tempV2_1,tempV2_2).add(e),tempV2_4.subVectors(tempV2_2,tempV2_1).add(e),o?(tempV2_3.toArray(n,3),tempV2_4.toArray(n,0),tempV2_4.toArray(n,9)):(tempV2_3.toArray(n,3),tempV2_3.toArray(n,9),tempV2_4.toArray(n,0));else{tempV2_1.subVectors(r,e),tempV2_2.set(tempV2_1.y,-tempV2_1.x),tempV2_3.addVectors(tempV2_1,tempV2_2).add(e),tempV2_4.subVectors(tempV2_2,tempV2_1).add(e);var c=n.length;o?(tempV2_3.toArray(n,c-3),tempV2_4.toArray(n,c-6),tempV2_4.toArray(n,c-12)):(tempV2_3.toArray(n,c-6),tempV2_4.toArray(n,c-3),tempV2_4.toArray(n,c-12))}}}});var TDSLoader=function(e){Loader.call(this,e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};TDSLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TDSLoader,load:function(e,t,r,n){var o=this,path=""===o.path?LoaderUtils.extractUrlBase(e):o.path,l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(e,(function(data){t(o.parse(data,path))}),r,n)},parse:function(e,path){this.group=new Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,path);for(var i=0;i<this.meshes.length;i++)this.group.add(this.meshes[i]);return this.group},readFile:function(e,path){var data=new DataView(e),t=this.readChunk(data);if(t.id===MLIBMAGIC||t.id===CMAGIC||t.id===M3DMAGIC)for(var r=this.nextChunk(data,t);0!==r;){if(r===M3D_VERSION){var n=this.readDWord(data);this.debugMessage("3DS file version: "+n)}else r===MDATA?(this.resetPosition(data),this.readMeshData(data,path)):this.debugMessage("Unknown main chunk: "+r.toString(16));r=this.nextChunk(data,t)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(data,path){for(var e=this.readChunk(data),t=this.nextChunk(data,e);0!==t;){if(t===MESH_VERSION){var r=+this.readDWord(data);this.debugMessage("Mesh Version: "+r)}else if(t===MASTER_SCALE){var n=this.readFloat(data);this.debugMessage("Master scale: "+n),this.group.scale.set(n,n,n)}else t===NAMED_OBJECT?(this.debugMessage("Named Object"),this.resetPosition(data),this.readNamedObject(data)):t===MAT_ENTRY?(this.debugMessage("Material"),this.resetPosition(data),this.readMaterialEntry(data,path)):this.debugMessage("Unknown MDATA chunk: "+t.toString(16));t=this.nextChunk(data,e)}},readNamedObject:function(data){var e=this.readChunk(data),t=this.readString(data,64);e.cur=this.position;for(var r=this.nextChunk(data,e);0!==r;){if(r===N_TRI_OBJECT){this.resetPosition(data);var n=this.readMesh(data);n.name=t,this.meshes.push(n)}else this.debugMessage("Unknown named object chunk: "+r.toString(16));r=this.nextChunk(data,e)}this.endChunk(e)},readMaterialEntry:function(data,path){for(var e=this.readChunk(data),t=this.nextChunk(data,e),r=new MeshPhongMaterial;0!==t;){if(t===MAT_NAME)r.name=this.readString(data,64),this.debugMessage("   Name: "+r.name);else if(t===MAT_WIRE)this.debugMessage("   Wireframe"),r.wireframe=!0;else if(t===MAT_WIRE_SIZE){var n=this.readByte(data);r.wireframeLinewidth=n,this.debugMessage("   Wireframe Thickness: "+n)}else if(t===MAT_TWO_SIDE)r.side=DoubleSide,this.debugMessage("   DoubleSided");else if(t===MAT_ADDITIVE)this.debugMessage("   Additive Blending"),r.blending=AdditiveBlending;else if(t===MAT_DIFFUSE)this.debugMessage("   Diffuse Color"),r.color=this.readColor(data);else if(t===MAT_SPECULAR)this.debugMessage("   Specular Color"),r.specular=this.readColor(data);else if(t===MAT_AMBIENT)this.debugMessage("   Ambient color"),r.color=this.readColor(data);else if(t===MAT_SHININESS){var o=this.readWord(data);r.shininess=o,this.debugMessage("   Shininess : "+o)}else if(t===MAT_TRANSPARENCY){var l=this.readWord(data);r.opacity=.01*l,this.debugMessage("  Opacity : "+l),r.transparent=l<100}else t===MAT_TEXMAP?(this.debugMessage("   ColorMap"),this.resetPosition(data),r.map=this.readMap(data,path)):t===MAT_BUMPMAP?(this.debugMessage("   BumpMap"),this.resetPosition(data),r.bumpMap=this.readMap(data,path)):t===MAT_OPACMAP?(this.debugMessage("   OpacityMap"),this.resetPosition(data),r.alphaMap=this.readMap(data,path)):t===MAT_SPECMAP?(this.debugMessage("   SpecularMap"),this.resetPosition(data),r.specularMap=this.readMap(data,path)):this.debugMessage("   Unknown material chunk: "+t.toString(16));t=this.nextChunk(data,e)}this.endChunk(e),this.materials[r.name]=r},readMesh:function(data){var e=this.readChunk(data),t=this.nextChunk(data,e),r=new BufferGeometry,n=[],o=new Mesh(r,new MeshPhongMaterial);for(o.name="mesh";0!==t;){if(t===POINT_ARRAY){var l=this.readWord(data);this.debugMessage("   Vertex: "+l);for(var c=[],i=0;i<l;i++)c.push(this.readFloat(data)),c.push(this.readFloat(data)),c.push(this.readFloat(data));r.setAttribute("position",new Float32BufferAttribute(c,3))}else if(t===FACE_ARRAY)this.resetPosition(data),this.readFaceArray(data,o);else if(t===TEX_VERTS){var h=this.readWord(data);this.debugMessage("   UV: "+h);for(n=[],i=0;i<h;i++)n.push(this.readFloat(data)),n.push(this.readFloat(data));r.setAttribute("uv",new Float32BufferAttribute(n,2))}else if(t===MESH_MATRIX){this.debugMessage("   Tranformation Matrix (TODO)");var d=[];for(i=0;i<12;i++)d[i]=this.readFloat(data);var f=new Matrix4;f.elements[0]=d[0],f.elements[1]=d[6],f.elements[2]=d[3],f.elements[3]=d[9],f.elements[4]=d[2],f.elements[5]=d[8],f.elements[6]=d[5],f.elements[7]=d[11],f.elements[8]=d[1],f.elements[9]=d[7],f.elements[10]=d[4],f.elements[11]=d[10],f.elements[12]=0,f.elements[13]=0,f.elements[14]=0,f.elements[15]=1,f.transpose();var m=new Matrix4;m.getInverse(f,!0),r.applyMatrix4(m),f.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+t.toString(16));t=this.nextChunk(data,e)}return this.endChunk(e),r.computeVertexNormals(),o},readFaceArray:function(data,e){var t=this.readChunk(data),r=this.readWord(data);this.debugMessage("   Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(data),this.readWord(data),this.readWord(data)),this.readWord(data);for(e.geometry.setIndex(n);this.position<t.end;){if((t=this.readChunk(data)).id===MSH_MAT_GROUP){this.debugMessage("      Material Group"),this.resetPosition(data);var o=this.readMaterialGroup(data),l=this.materials[o.name];void 0!==l&&(e.material=l,""===l.name&&(l.name=e.name))}else this.debugMessage("      Unknown face array chunk: "+t.toString(16));this.endChunk(t)}this.endChunk(t)},readMap:function(data,path){var e=this.readChunk(data),t=this.nextChunk(data,e),r={},n=new TextureLoader(this.manager);for(n.setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin);0!==t;){if(t===MAT_MAPNAME){var o=this.readString(data,128);r=n.load(o),this.debugMessage("      File: "+path+o)}else t===MAT_MAP_UOFFSET?(r.offset.x=this.readFloat(data),this.debugMessage("      OffsetX: "+r.offset.x)):t===MAT_MAP_VOFFSET?(r.offset.y=this.readFloat(data),this.debugMessage("      OffsetY: "+r.offset.y)):t===MAT_MAP_USCALE?(r.repeat.x=this.readFloat(data),this.debugMessage("      RepeatX: "+r.repeat.x)):t===MAT_MAP_VSCALE?(r.repeat.y=this.readFloat(data),this.debugMessage("      RepeatY: "+r.repeat.y)):this.debugMessage("      Unknown map chunk: "+t.toString(16));t=this.nextChunk(data,e)}return this.endChunk(e),r},readMaterialGroup:function(data){this.readChunk(data);var e=this.readString(data,64),t=this.readWord(data);this.debugMessage("         Name: "+e),this.debugMessage("         Faces: "+t);for(var r=[],i=0;i<t;++i)r.push(this.readWord(data));return{name:e,index:r}},readColor:function(data){var e=this.readChunk(data),t=new Color;if(e.id===COLOR_24||e.id===LIN_COLOR_24){var r=this.readByte(data),g=this.readByte(data),b=this.readByte(data);t.setRGB(r/255,g/255,b/255),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else if(e.id===COLOR_F||e.id===LIN_COLOR_F){r=this.readFloat(data),g=this.readFloat(data),b=this.readFloat(data);t.setRGB(r,g,b),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else this.debugMessage("      Unknown color chunk: "+e.toString(16));return this.endChunk(e),t},readChunk:function(data){var e={};return e.cur=this.position,e.id=this.readWord(data),e.size=this.readDWord(data),e.end=e.cur+e.size,e.cur+=6,e},endChunk:function(e){this.position=e.end},nextChunk:function(data,e){if(e.cur>=e.end)return 0;this.position=e.cur;try{var t=this.readChunk(data);return e.cur+=t.size,t.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(data){var e=data.getUint8(this.position,!0);return this.position+=1,e},readFloat:function(data){try{var e=data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){this.debugMessage(e+" "+this.position+" "+data.byteLength)}},readInt:function(data){var e=data.getInt32(this.position,!0);return this.position+=4,e},readShort:function(data){var e=data.getInt16(this.position,!0);return this.position+=2,e},readDWord:function(data){var e=data.getUint32(this.position,!0);return this.position+=4,e},readWord:function(data){var e=data.getUint16(this.position,!0);return this.position+=2,e},readString:function(data,e){for(var s="",i=0;i<e;i++){var t=this.readByte(data);if(!t)break;s+=String.fromCharCode(t)}return s},debugMessage:function(e){this.debug&&console.log(e)}});var M3DMAGIC=19789,MLIBMAGIC=15786,CMAGIC=49725,M3D_VERSION=2,COLOR_F=16,COLOR_24=17,LIN_COLOR_24=18,LIN_COLOR_F=19,MDATA=15677,MESH_VERSION=15678,MASTER_SCALE=256,MAT_ENTRY=45055,MAT_NAME=40960,MAT_AMBIENT=40976,MAT_DIFFUSE=40992,MAT_SPECULAR=41008,MAT_SHININESS=41024,MAT_TRANSPARENCY=41040,MAT_TWO_SIDE=41089,MAT_ADDITIVE=41091,MAT_WIRE=41093,MAT_WIRE_SIZE=41095,MAT_TEXMAP=41472,MAT_OPACMAP=41488,MAT_BUMPMAP=41520,MAT_SPECMAP=41476,MAT_MAPNAME=41728,MAT_MAP_USCALE=41812,MAT_MAP_VSCALE=41814,MAT_MAP_UOFFSET=41816,MAT_MAP_VOFFSET=41818,NAMED_OBJECT=16384,N_TRI_OBJECT=16640,POINT_ARRAY=16656,FACE_ARRAY=16672,MSH_MAT_GROUP=16688,TEX_VERTS=16704,MESH_MATRIX=16736,TTFLoader=function(e){Loader.call(this,e),this.reversed=!1};TTFLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TTFLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(e,(function(e){t(o.parse(e))}),r,n)},parse:function(e){function t(e){var path,t=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(path=[e],t.push(path)):"z"!==e.type.toLowerCase()&&path.push(e)}));var r=[];return t.forEach((function(p){var e={type:"m",x:p[p.length-1].x,y:p[p.length-1].y};r.push(e);for(var i=p.length-1;i>0;i--){var t=p[i];e={type:t.type};void 0!==t.x2&&void 0!==t.y2?(e.x1=t.x2,e.y1=t.y2,e.x2=t.x1,e.y2=t.y1):void 0!==t.x1&&void 0!==t.y1&&(e.x1=t.x1,e.y1=t.y1),e.x=p[i-1].x,e.y=p[i-1].y,r.push(e)}})),r}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){for(var n=Math.round,o={},l=1e5/(72*(e.unitsPerEm||2048)),c=e.encoding.cmap.glyphIndexMap,h=Object.keys(c),i=0;i<h.length;i++){var d=h[i],glyph=e.glyphs.glyphs[c[d]];if(void 0!==d){var f={ha:n(glyph.advanceWidth*l),x_min:n(glyph.xMin*l),x_max:n(glyph.xMax*l),o:""};r&&(glyph.path.commands=t(glyph.path.commands)),glyph.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),f.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(f.o+=n(e.x*l)+" "+n(e.y*l)+" "),void 0!==e.x1&&void 0!==e.y1&&(f.o+=n(e.x1*l)+" "+n(e.y1*l)+" "),void 0!==e.x2&&void 0!==e.y2&&(f.o+=n(e.x2*l)+" "+n(e.y2*l)+" ")})),o[String.fromCodePoint(glyph.unicode)]=f}}return{glyphs:o,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*l),descender:n(e.descender*l),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}});var VRMLoader=function(){function e(e){if(void 0===GLTFLoader)throw new Error("VRMLoader: Import GLTFLoader.");Loader.call(this,e),this.gltfLoader=new GLTFLoader(this.manager)}return e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(e,t,r,n){var o=this;this.gltfLoader.load(e,(function(e){o.parse(e,t)}),r,n)},setDRACOLoader:function(e){return this.glTFLoader.setDRACOLoader(e),this},parse:function(e,t){t(e)}}),e}(),VTKLoader=function(e){Loader.call(this,e)};VTKLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:VTKLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.load(e,(function(text){t(o.parse(text))}),r,n)},parse:function(data){function e(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}function t(data){for(var e="",t=new Uint8Array(data),i=0,r=t.length;r--;)e+=String.fromCharCode(t[i++]);return e}var meta=LoaderUtils.decodeText(new Uint8Array(data,0,250)).split("\n");return-1!==meta[0].indexOf("xml")?function(t){function r(e){var i,t,r,n,o,l,c="undefined"!=typeof Uint8Array?Uint8Array:Array,h=[],d=[],code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=code.length;for(i=0;i<f;i++)h[i]=code[i];for(i=0;i<f;++i)d[code.charCodeAt(i)]=i;if(d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63,(f=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");l=new c(3*f/4-(o="="===e[f-2]?2:"="===e[f-1]?1:0)),r=o>0?f-4:f;var m=0;for(i=0,t=0;i<r;i+=4,t+=3)n=d[e.charCodeAt(i)]<<18|d[e.charCodeAt(i+1)]<<12|d[e.charCodeAt(i+2)]<<6|d[e.charCodeAt(i+3)],l[m++]=(16711680&n)>>16,l[m++]=(65280&n)>>8,l[m++]=255&n;return 2===o?(n=d[e.charCodeAt(i)]<<2|d[e.charCodeAt(i+1)]>>4,l[m++]=255&n):1===o&&(n=d[e.charCodeAt(i)]<<10|d[e.charCodeAt(i+1)]<<4|d[e.charCodeAt(i+2)]>>2,l[m++]=n>>8&255,l[m++]=255&n),l}function n(t,n){var o,c,h,d,f=0;if("UInt64"===l.attributes.header_type?f=8:"UInt32"===l.attributes.header_type&&(f=4),"binary"===t.attributes.format&&n){var m,v,y,x,_,M;if("Float32"===t.attributes.type)var w=new Float32Array;else if("Int64"===t.attributes.type)w=new Int32Array;v=(m=r(t["#text"]))[0];for(var i=1;i<f-1;i++)v|=m[i]<<i*f;x=(v+3)*f,M=x+=x%3>0?3-x%3:0,(_=[]).push(M),y=3*f;for(i=0;i<v;i++){for(var S=m[i*f+y],A=1;A<f-1;A++)S|=m[i*f+y+A]<<8*A;M+=S,_.push(M)}for(i=0;i<_.length-1;i++){content=(content=new Zlib.Inflate(m.slice(_[i],_[i+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?(content=new Float32Array(content),c=content,h=void 0,d=void 0,h=(o=w).length,(d=new Float32Array(h+c.length)).set(o),d.set(c,h),w=d):"Int64"===t.attributes.type&&(w=e(w,content=new Int32Array(content)))}delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(w=w.filter((function(e,t){if(t%2!=1)return!0})))}else{if("binary"!==t.attributes.format||n)if(t["#text"])var content=t["#text"].split(/\s+/).filter((function(e){if(""!==e)return e}));else content=new Int32Array(0).buffer;else content=(content=r(t["#text"])).slice(f).buffer;if(delete t["#text"],"Float32"===t.attributes.type)w=new Float32Array(content);else if("Int32"===t.attributes.type)w=new Int32Array(content);else if("Int64"===t.attributes.type){w=new Int32Array(content);"binary"===t.attributes.format&&(w=w.filter((function(e,t){if(t%2!=1)return!0})))}}return w}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(t,"text/xml")}catch(e){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(e){o=null}}var l=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var o=t.attributes.item(n);r.attributes[o.nodeName]=o.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var i=0;i<t.childNodes.length;i++){var l=t.childNodes.item(i),c=l.nodeName;if(void 0===r[c]){""!==(d=e(l))&&(r[c]=d)}else{if(void 0===r[c].push){var h=r[c];r[c]=[h]}var d;""!==(d=e(l))&&r[c].push(d)}}return r}(o.documentElement),c=[],h=[],d=[];if(l.PolyData){for(var f=l.PolyData.Piece,m=l.attributes.hasOwnProperty("compressor"),v=["PointData","Points","Strips","Polys"],y=0,x=v.length;y<x;){var section=f[v[y]];if(section&&section.DataArray){if("[object Array]"===Object.prototype.toString.call(section.DataArray))var _=section.DataArray;else _=[section.DataArray];for(var M=0,w=_.length;M<w;)"#text"in _[M]&&_[M]["#text"].length>0&&(_[M].text=n(_[M],m)),M++;switch(v[y]){case"PointData":var S=parseInt(f.attributes.NumberOfPoints),A=section.attributes.Normals;if(S>0)for(var i=0,T=_.length;i<T;i++)if(A===_[i].attributes.Name){var L=_[i].attributes.NumberOfComponents;(h=new Float32Array(S*L)).set(_[i].text,0)}break;case"Points":if((S=parseInt(f.attributes.NumberOfPoints))>0){L=section.DataArray.attributes.NumberOfComponents;(c=new Float32Array(S*L)).set(section.DataArray.text,0)}break;case"Strips":var C=parseInt(f.attributes.NumberOfStrips);if(C>0){var N=new Int32Array(section.DataArray[0].text.length),P=new Int32Array(section.DataArray[1].text.length);N.set(section.DataArray[0].text,0),P.set(section.DataArray[1].text,0);var F=C+N.length;d=new Uint32Array(3*F-9*C);var E=0;for(i=0,T=C;i<T;i++){for(var R=[],s=0,D=P[i],O=0;s<D-O;s++)R.push(N[s]),i>0&&(O=P[i-1]);var I=0;for(D=P[i],O=0;I<D-O-2;I++)I%2?(d[E++]=R[I],d[E++]=R[I+2],d[E++]=R[I+1]):(d[E++]=R[I],d[E++]=R[I+1],d[E++]=R[I+2]),i>0&&(O=P[i-1])}}break;case"Polys":var B=parseInt(f.attributes.NumberOfPolys);if(B>0){N=new Int32Array(section.DataArray[0].text.length),P=new Int32Array(section.DataArray[1].text.length);N.set(section.DataArray[0].text,0),P.set(section.DataArray[1].text,0);F=B+N.length;d=new Uint32Array(3*F-9*B);E=0;var U=0;for(i=0,T=B,O=0;i<T;){var k=[];for(s=0,D=P[i];s<D-O;)k.push(N[U++]),s++;for(I=1;I<D-O-1;)d[E++]=k[0],d[E++]=k[I],d[E++]=k[I+1],I++;O=P[++i-1]}}}}y++}var V=new BufferGeometry;return V.setIndex(new BufferAttribute(d,1)),V.setAttribute("position",new BufferAttribute(c,3)),h.length===c.length&&V.setAttribute("normal",new BufferAttribute(h,3)),V}throw new Error("Unsupported DATASET type")}(t(data)):meta[2].includes("ASCII")?function(data){var e,t=[],r=[],n=[],o=[],l=/^[^\d.\s-]+/,c=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,h=/^(\d+)\s+([\s\d]*)/,d=/^POINTS /,f=/^POLYGONS /,m=/^TRIANGLE_STRIPS /,v=/^POINT_DATA[ ]+(\d+)/,y=/^CELL_DATA[ ]+(\d+)/,x=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,_=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,M=!1,w=!1,S=!1,A=!1,T=!1,L=!1,C=!1,N=data.split("\n");for(var i in N){var line=N[i].trim();if(0===line.indexOf("DATASET")){var P=line.split(" ")[1];if("POLYDATA"!==P)throw new Error("Unsupported DATASET type: "+P)}else if(M)for(;null!==(e=c.exec(line))&&null===l.exec(line);){var F=parseFloat(e[1]),E=parseFloat(e[2]),R=parseFloat(e[3]);r.push(F,E,R)}else if(w){if(null!==(e=h.exec(line))){var D=parseInt(e[1]),O=e[2].split(/\s+/);if(D>=3)for(var I=parseInt(O[0]),B=1,U=0;U<D-2;++U)k=parseInt(O[B]),V=parseInt(O[B+1]),t.push(I,k,V),B++}}else if(S){if(null!==(e=h.exec(line))){D=parseInt(e[1]),O=e[2].split(/\s+/);if(D>=3){var k,V;for(U=0;U<D-2;U++)U%2==1?(I=parseInt(O[U]),k=parseInt(O[U+2]),V=parseInt(O[U+1]),t.push(I,k,V)):(I=parseInt(O[U]),k=parseInt(O[U+1]),V=parseInt(O[U+2]),t.push(I,k,V))}}}else if(A||T)if(L)for(;null!==(e=c.exec(line))&&null===l.exec(line);){var G=parseFloat(e[1]),g=parseFloat(e[2]),b=parseFloat(e[3]);n.push(G,g,b)}else if(C)for(;null!==(e=c.exec(line))&&null===l.exec(line);){var z=parseFloat(e[1]),j=parseFloat(e[2]),W=parseFloat(e[3]);o.push(z,j,W)}null!==f.exec(line)?(w=!0,M=!1,S=!1):null!==d.exec(line)?(w=!1,M=!0,S=!1):null!==m.exec(line)?(w=!1,M=!1,S=!0):null!==v.exec(line)?(A=!0,M=!1,w=!1,S=!1):null!==y.exec(line)?(T=!0,M=!1,w=!1,S=!1):null!==x.exec(line)?(L=!0,C=!1,M=!1,w=!1,S=!1):null!==_.exec(line)&&(C=!0,L=!1,M=!1,w=!1,S=!1)}var H=new BufferGeometry;if(H.setIndex(t),H.setAttribute("position",new Float32BufferAttribute(r,3)),o.length===r.length&&H.setAttribute("normal",new Float32BufferAttribute(o,3)),n.length!==t.length)n.length===r.length&&H.setAttribute("color",new Float32BufferAttribute(n,3));else{var X=(H=H.toNonIndexed()).attributes.position.count/3;if(n.length===3*X){var Y=[];for(i=0;i<X;i++){G=n[3*i+0],g=n[3*i+1],b=n[3*i+2];Y.push(G,g,b),Y.push(G,g,b),Y.push(G,g,b)}H.setAttribute("color",new Float32BufferAttribute(Y,3))}}return H}(t(data)):function(data){var e,t,i,r,s,n,line,o=new Uint8Array(data),l=new DataView(data),c=[],h=[],d=[],f=0;function m(e,t){for(var r=t,n=e[r],s=[];10!==n;)s.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:s.join("")}}for(;;){if(0===(line=(n=m(o,f)).parsedString).indexOf("DATASET")){var v=line.split(" ")[1];if("POLYDATA"!==v)throw new Error("Unsupported DATASET type: "+v)}else if(0===line.indexOf("POINTS")){for(e=4*(r=parseInt(line.split(" ")[1],10))*3,c=new Float32Array(3*r),t=n.next,i=0;i<r;i++)c[3*i]=l.getFloat32(t,!1),c[3*i+1]=l.getFloat32(t+4,!1),c[3*i+2]=l.getFloat32(t+8,!1),t+=12;n.next=n.next+e+1}else if(0===line.indexOf("TRIANGLE_STRIPS")){var y=parseInt(line.split(" ")[1],10);e=4*(S=parseInt(line.split(" ")[2],10)),d=new Uint32Array(3*S-9*y);var x=0;for(t=n.next,i=0;i<y;i++){var _=l.getInt32(t,!1),M=[];for(t+=4,s=0;s<_;s++)M.push(l.getInt32(t,!1)),t+=4;for(var w=0;w<_-2;w++)w%2?(d[x++]=M[w],d[x++]=M[w+2],d[x++]=M[w+1]):(d[x++]=M[w],d[x++]=M[w+1],d[x++]=M[w+2])}n.next=n.next+e+1}else if(0===line.indexOf("POLYGONS")){var S;y=parseInt(line.split(" ")[1],10);e=4*(S=parseInt(line.split(" ")[2],10)),d=new Uint32Array(3*S-9*y);x=0;for(t=n.next,i=0;i<y;i++){_=l.getInt32(t,!1),M=[];for(t+=4,s=0;s<_;s++)M.push(l.getInt32(t,!1)),t+=4;for(w=1;w<_-1;w++)d[x++]=M[0],d[x++]=M[w],d[x++]=M[w+1]}n.next=n.next+e+1}else if(0===line.indexOf("POINT_DATA")){for(r=parseInt(line.split(" ")[1],10),n=m(o,n.next),e=4*r*3,h=new Float32Array(3*r),t=n.next,i=0;i<r;i++)h[3*i]=l.getFloat32(t,!1),h[3*i+1]=l.getFloat32(t+4,!1),h[3*i+2]=l.getFloat32(t+8,!1),t+=12;n.next=n.next+e}if((f=n.next)>=o.byteLength)break}var A=new BufferGeometry;return A.setIndex(new BufferAttribute(d,1)),A.setAttribute("position",new BufferAttribute(c,3)),h.length===c.length&&A.setAttribute("normal",new BufferAttribute(h,3)),A}(data)}});var XLoader=(classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),XboneInf=function e(){classCallCheck(this,e),this.boneName="",this.BoneIndex=0,this.Indeces=[],this.Weights=[],this.initMatrix=null,this.OffsetMatrix=null},XAnimationInfo=function e(){classCallCheck(this,e),this.animeName="",this.boneName="",this.targetBone=null,this.keyType=4,this.frameStartLv=0,this.keyFrames=[],this.InverseMx=null},XAnimationObj=function(){function e(t){classCallCheck(this,e),this.fps=30,this.name="xanimation",this.length=0,this.hierarchy=[],this.putFlags=t,void 0===this.putFlags.putPos&&(this.putFlags.putPos=!0),void 0===this.putFlags.putRot&&(this.putFlags.putRot=!0),void 0===this.putFlags.putScl&&(this.putFlags.putScl=!0)}return createClass(e,[{key:"make",value:function(e){for(var i=0;i<e.length;i++)this.hierarchy.push(this.makeBonekeys(e[i]));this.length=this.hierarchy[0].keys[this.hierarchy[0].keys.length-1].time}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"makeBonekeys",value:function(e){var t={};return t.name=e.boneName,t.parent="",t.keys=this.keyFrameRefactor(e),t.copy=function(){return Object.assign({},this)},t}},{key:"keyFrameRefactor",value:function(e){for(var t=[],i=0;i<e.keyFrames.length;i++){var r={};r.time=e.keyFrames[i].time*this.fps,e.keyFrames[i].pos&&this.putFlags.putPos&&(r.pos=e.keyFrames[i].pos),e.keyFrames[i].rot&&this.putFlags.putRot&&(r.rot=e.keyFrames[i].rot),e.keyFrames[i].scl&&this.putFlags.putScl&&(r.scl=e.keyFrames[i].scl),e.keyFrames[i].matrix&&(r.matrix=e.keyFrames[i].matrix,this.putFlags.putPos&&(r.pos=(new Vector3).setFromMatrixPosition(r.matrix)),this.putFlags.putRot&&(r.rot=(new Quaternion).setFromRotationMatrix(r.matrix)),this.putFlags.putScl&&(r.scl=(new Vector3).setFromMatrixScale(r.matrix))),t.push(r)}return t}}]),e}(),XKeyFrameInfo=function e(){classCallCheck(this,e),this.index=0,this.Frame=0,this.time=0,this.matrix=null},function(){function e(t){Loader.call(this,t),classCallCheck(this,e),this.debug=!1,this.texloader=new TextureLoader(this.manager),this.url="",this._putMatLength=0,this._nowMat=null,this._nowFrameName="",this.frameHierarchie=[],this.Hierarchies={},this.HieStack=[],this._currentObject={},this._currentFrame={},this._data=null,this.onLoad=null,this.IsUvYReverse=!0,this.Meshes=[],this.animations=[],this.animTicksPerSecond=30,this._currentGeo=null,this._currentAnime=null,this._currentAnimeFrames=null}return createClass(e,[{key:"_setArgOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){for(var i=t;i<e.length;i++)switch(i){case 0:this.url=e[i];break;case 1:this.options=e[i]}void 0===this.options&&(this.options={})}}},{key:"load",value:function(e,t,r,n){var o=this;this._setArgOption(e);var l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(this.url,(function(e){o.parse(e,t)}),r,n)}},{key:"_readLine",value:function(line){for(var e=0;;){var t=-1;if(-1===(t=line.indexOf("//",e))&&(t=line.indexOf("#",e)),!(t>-1&&t<2))break;var r=-1;e=(r=line.indexOf("\r\n",e))>0?r+2:(r=line.indexOf("\r",e))>0?r+1:line.indexOf("\n",e)+1}return line.substr(e)}},{key:"_readLine",value:function(line){for(var e=0;;){var t=-1;if(-1===(t=line.indexOf("//",e))&&(t=line.indexOf("#",e)),!(t>-1&&t<2))break;var r=-1;e=(r=line.indexOf("\r\n",e))>0?r+2:(r=line.indexOf("\r",e))>0?r+1:line.indexOf("\n",e)+1}return line.substr(e)}},{key:"_isBinary",value:function(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=t.byteLength,n=0;n<r;n++)if(t.getUint8(n,!1)>127)return!0;return!1}},{key:"_ensureBinary",value:function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}},{key:"_ensureString",value:function(e){return"string"!=typeof e?LoaderUtils.decodeText(new Uint8Array(e)):e}},{key:"parse",value:function(data,e){var t=this._ensureBinary(data);return this._data=this._ensureString(data),this.onLoad=e,this._isBinary(t)?this._parseBinary(t):this._parseASCII()}},{key:"_parseBinary",value:function(data){return this._parseASCII(LoaderUtils.decodeText(new Uint8Array(data)))}},{key:"_parseASCII",value:function(){var path;path=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(this.url),this.texloader.setPath(path).setCrossOrigin(this.crossOrigin),this.Hierarchies.children=[],this._hierarchieParse(this.Hierarchies,16),this._changeRoot(),this._currentObject=this.Hierarchies.children.shift(),this._mainloop()}},{key:"_hierarchieParse",value:function(e,t){for(var r=t;;){var n=this._data.indexOf("{",r)+1,o=this._data.indexOf("}",r),l=this._data.indexOf("{",n)+1;if(!(n>0&&o>n)){r=-1===n?this._data.length:o+1;break}var c={children:[]},h=this._readLine(this._data.substr(r,n-r-1)).trim(),d=h.split(/ /g);if(d.length>0?(c.type=d[0],d.length>=2?c.name=d[1]:c.name=d[0]+this.Hierarchies.children.length):(c.name=h,c.type=""),"Animation"===c.type){c.data=this._data.substr(l,o-l).trim();var f=this._hierarchieParse(c,o+1);r=f.end,c.children=f.parent.children}else{var m=this._data.lastIndexOf(";",l>0?Math.min(l,o):o);if(c.data=this._data.substr(n,m-n).trim(),l<=0||o<l)r=o+1;else{var v=Math.max(m+1,n),y=this._hierarchieParse(c,v);r=y.end,c.children=y.parent.children}}c.parent=e,"template"!=c.type&&e.children.push(c)}return{parent:e,end:r}}},{key:"_mainloop",value:function(){var e=this;this._mainProc(),this._currentObject.parent||this._currentObject.children.length>0||!this._currentObject.worked?setTimeout((function(){e._mainloop()}),1):setTimeout((function(){e.onLoad({models:e.Meshes,animations:e.animations})}),1)}},{key:"_mainProc",value:function(){for(var e=!1;;){if(!this._currentObject.worked){switch(this._currentObject.type){case"template":break;case"AnimTicksPerSecond":this.animTicksPerSecond=parseInt(this._currentObject.data);break;case"Frame":this._setFrame();break;case"FrameTransformMatrix":this._setFrameTransformMatrix();break;case"Mesh":this._changeRoot(),this._currentGeo={},this._currentGeo.name=this._currentObject.name.trim(),this._currentGeo.parentName=this._getParentName(this._currentObject).trim(),this._currentGeo.VertexSetedBoneCount=[],this._currentGeo.GeometryData={vertices:[],normals:[],uvs:[],skinIndices:[],skinWeights:[],indices:[],materialIndices:[]},this._currentGeo.Materials=[],this._currentGeo.normalVectors=[],this._currentGeo.BoneInfs=[],this._currentGeo.baseFrame=this._currentFrame,this._makeBoneFrom_CurrentFrame(),this._readVertexDatas(),e=!0;break;case"MeshNormals":this._readVertexDatas();break;case"MeshTextureCoords":this._setMeshTextureCoords();break;case"VertexDuplicationIndices":break;case"MeshMaterialList":this._setMeshMaterialList();break;case"Material":this._setMaterial();break;case"SkinWeights":this._setSkinWeights();break;case"AnimationSet":this._changeRoot(),this._currentAnime={},this._currentAnime.name=this._currentObject.name.trim(),this._currentAnime.AnimeFrames=[];break;case"Animation":this._currentAnimeFrames&&this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=new XAnimationInfo,this._currentAnimeFrames.boneName=this._currentObject.data.trim();break;case"AnimationKey":this._readAnimationKey(),e=!0}this._currentObject.worked=!0}if(this._currentObject.children.length>0){if(this._currentObject=this._currentObject.children.shift(),this.debug&&console.log("processing "+this._currentObject.name),e)break}else if(this._currentObject.worked&&this._currentObject.parent&&!this._currentObject.parent.parent&&this._changeRoot(),this._currentObject.parent?this._currentObject=this._currentObject.parent:e=!0,e)break}}},{key:"_changeRoot",value:function(){null!=this._currentGeo&&this._currentGeo.name&&this._makeOutputGeometry(),this._currentGeo={},null!=this._currentAnime&&this._currentAnime.name&&(this._currentAnimeFrames&&(this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=null),this._makeOutputAnimation()),this._currentAnime={}}},{key:"_getParentName",value:function(e){return e.parent?e.parent.name?e.parent.name:this._getParentName(e.parent):""}},{key:"_setFrame",value:function(){this._nowFrameName=this._currentObject.name.trim(),this._currentFrame={},this._currentFrame.name=this._nowFrameName,this._currentFrame.children=[],this._currentObject.parent&&this._currentObject.parent.name&&(this._currentFrame.parentName=this._currentObject.parent.name),this.frameHierarchie.push(this._nowFrameName),this.HieStack[this._nowFrameName]=this._currentFrame}},{key:"_setFrameTransformMatrix",value:function(){this._currentFrame.FrameTransformMatrix=new Matrix4;var data=this._currentObject.data.split(",");this._ParseMatrixData(this._currentFrame.FrameTransformMatrix,data),this._makeBoneFrom_CurrentFrame()}},{key:"_makeBoneFrom_CurrentFrame",value:function(){if(this._currentFrame.FrameTransformMatrix){var b=new Bone;if(b.name=this._currentFrame.name,b.applyMatrix4(this._currentFrame.FrameTransformMatrix),b.matrixWorld=b.matrix,b.FrameTransformMatrix=this._currentFrame.FrameTransformMatrix,this._currentFrame.putBone=b,this._currentFrame.parentName)for(var e in this.HieStack)this.HieStack[e].name===this._currentFrame.parentName&&this.HieStack[e].putBone.add(this._currentFrame.putBone)}}},{key:"_readVertexDatas",value:function(){for(var e=0,t=0,r=0,n=0;;){var o=!1;if(0===r)e=this._readInt1(e).endRead,r=1,(n=this._currentObject.data.indexOf(";",e)+1)<=0&&(n=this._currentObject.data.length);else{var l=0;switch(t){case 0:l=this._currentObject.data.indexOf(",",e)+1;break;case 1:l=this._currentObject.data.indexOf(";,",e)+1}switch((0===l||l>n)&&(l=n,r=0,o=!0),this._currentObject.type){case"Mesh":switch(t){case 0:this._readVertex1(this._currentObject.data.substr(e,l-e));break;case 1:this._readFace1(this._currentObject.data.substr(e,l-e))}break;case"MeshNormals":switch(t){case 0:this._readNormalVector1(this._currentObject.data.substr(e,l-e))}}e=l+1,o&&t++}if(e>=this._currentObject.data.length)break}}},{key:"_readInt1",value:function(e){var t=this._currentObject.data.indexOf(";",e);return{refI:parseInt(this._currentObject.data.substr(e,t-e)),endRead:t+1}}},{key:"_readVertex1",value:function(line){var data=this._readLine(line.trim()).substr(0,line.length-2).split(";");this._currentGeo.GeometryData.vertices.push(parseFloat(data[0]),parseFloat(data[1]),parseFloat(data[2])),this._currentGeo.GeometryData.skinIndices.push(0,0,0,0),this._currentGeo.GeometryData.skinWeights.push(1,0,0,0),this._currentGeo.VertexSetedBoneCount.push(0)}},{key:"_readFace1",value:function(line){var data=this._readLine(line.trim()).substr(2,line.length-4).split(",");this._currentGeo.GeometryData.indices.push(parseInt(data[0],10),parseInt(data[1],10),parseInt(data[2],10))}},{key:"_readNormalVector1",value:function(line){var data=this._readLine(line.trim()).substr(0,line.length-2).split(";");this._currentGeo.GeometryData.normals.push(parseFloat(data[0]),parseFloat(data[1]),parseFloat(data[2]))}},{key:"_buildGeometry",value:function(){for(var e=new BufferGeometry,t=[],r=[],n=[],o=[],l=[],data=this._currentGeo.GeometryData,i=0,c=data.indices.length;i<c;i++){var h=2*data.indices[i],d=3*data.indices[i],f=4*data.indices[i];t.push(data.vertices[d],data.vertices[d+1],data.vertices[d+2]),r.push(data.normals[d],data.normals[d+1],data.normals[d+2]),o.push(data.skinIndices[f],data.skinIndices[f+1],data.skinIndices[f+2],data.skinIndices[f+3]),l.push(data.skinWeights[f],data.skinWeights[f+1],data.skinWeights[f+2],data.skinWeights[f+3]),n.push(data.uvs[h],data.uvs[h+1])}return e.setAttribute("position",new Float32BufferAttribute(t,3)),e.setAttribute("normal",new Float32BufferAttribute(r,3)),e.setAttribute("uv",new Float32BufferAttribute(n,2)),e.setAttribute("skinIndex",new Uint16BufferAttribute(o,4)),e.setAttribute("skinWeight",new Float32BufferAttribute(l,4)),this._computeGroups(e,data.materialIndices),e}},{key:"_computeGroups",value:function(e,t){for(var r,n=[],o=void 0,i=0;i<t.length;i++){var l=t[i];l!==o&&(o=l,void 0!==r&&(r.count=3*i-r.start,n.push(r)),r={start:3*i,materialIndex:o})}void 0!==r&&(r.count=3*i-r.start,n.push(r)),e.groups=n}},{key:"_setMeshTextureCoords",value:function(){for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r)e=this._readInt1(0).endRead,r=1;else{var n=this._currentObject.data.indexOf(",",e)+1;0===n&&(n=this._currentObject.data.length,t=2,r=0);var line=this._currentObject.data.substr(e,n-e),data=this._readLine(line.trim()).split(";");this.IsUvYReverse?this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]),1-parseFloat(data[1])):this._currentGeo.GeometryData.uvs.push(parseFloat(data[0]),parseFloat(data[1])),e=n+1}}if(e>=this._currentObject.data.length)break}}},{key:"_setMeshMaterialList",value:function(){for(var e=0,t=0,r=0;;){if(r<2)e=this._readInt1(e).endRead,r++;else{var n=this._currentObject.data.indexOf(";",e);-1===n&&(n=this._currentObject.data.length,t=3,r=0);for(var line=this._currentObject.data.substr(e,n-e),data=this._readLine(line.trim()).split(","),i=0;i<data.length;i++)this._currentGeo.GeometryData.materialIndices[i]=parseInt(data[i]);e=this._currentObject.data.length}if(e>=this._currentObject.data.length||t>=3)break}}},{key:"_setMaterial",value:function(){var e=new MeshPhongMaterial({color:16777215*Math.random()});e.side=FrontSide,e.name=this._currentObject.name;var t=0,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t),data=this._readLine(line.trim()).split(";");e.color.r=parseFloat(data[0]),e.color.g=parseFloat(data[1]),e.color.b=parseFloat(data[2]),t=r+2,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t),e.shininess=parseFloat(this._readLine(line)),t=r+1,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t);var n=this._readLine(line.trim()).split(";");e.specular.r=parseFloat(n[0]),e.specular.g=parseFloat(n[1]),e.specular.b=parseFloat(n[2]),t=r+2,-1===(r=this._currentObject.data.indexOf(";",t))&&(r=this._currentObject.data.length),line=this._currentObject.data.substr(t,r-t);var o=this._readLine(line.trim()).split(";");e.emissive.r=parseFloat(o[0]),e.emissive.g=parseFloat(o[1]),e.emissive.b=parseFloat(o[2]);for(var l=null;this._currentObject.children.length>0;){l=this._currentObject.children.shift(),this.debug&&console.log("processing "+l.name);var c=l.data.substr(1,l.data.length-2);switch(l.type){case"TextureFilename":e.map=this.texloader.load(c);break;case"BumpMapFilename":e.bumpMap=this.texloader.load(c),e.bumpScale=.05;break;case"NormalMapFilename":e.normalMap=this.texloader.load(c),e.normalScale=new Vector2(2,2);break;case"EmissiveMapFilename":e.emissiveMap=this.texloader.load(c);break;case"LightMapFilename":e.lightMap=this.texloader.load(c)}}this._currentGeo.Materials.push(e)}},{key:"_setSkinWeights",value:function(){var e=new XboneInf,t=0,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t);t=r+1,e.boneName=line.substr(1,line.length-2),e.BoneIndex=this._currentGeo.BoneInfs.length,t=(r=this._currentObject.data.indexOf(";",t))+1,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t);for(var data=this._readLine(line.trim()).split(","),i=0;i<data.length;i++)e.Indeces.push(parseInt(data[i]));t=r+1,r=this._currentObject.data.indexOf(";",t),line=this._currentObject.data.substr(t,r-t);for(var n=this._readLine(line.trim()).split(","),o=0;o<n.length;o++)e.Weights.push(parseFloat(n[o]));t=r+1,(r=this._currentObject.data.indexOf(";",t))<=0&&(r=this._currentObject.data.length),line=this._currentObject.data.substr(t,r-t);var l=this._readLine(line.trim()).split(",");e.OffsetMatrix=new Matrix4,this._ParseMatrixData(e.OffsetMatrix,l),this._currentGeo.BoneInfs.push(e)}},{key:"_makePutBoneList",value:function(e,t){var r=!1;for(var n in this.HieStack)if(this.HieStack[n].name===e||r){r=!0;var b=new Bone;if(b.name=this.HieStack[n].name,b.applyMatrix4(this.HieStack[n].FrameTransformMatrix),b.matrixWorld=b.matrix,b.FrameTransformMatrix=this.HieStack[n].FrameTransformMatrix,b.pos=(new Vector3).setFromMatrixPosition(b.FrameTransformMatrix).toArray(),b.rotq=(new Quaternion).setFromRotationMatrix(b.FrameTransformMatrix).toArray(),b.scl=(new Vector3).setFromMatrixScale(b.FrameTransformMatrix).toArray(),this.HieStack[n].parentName&&this.HieStack[n].parentName.length>0)for(var i=0;i<t.length;i++)if(this.HieStack[n].parentName===t[i].name){t[i].add(b),b.parent=i;break}t.push(b)}}},{key:"_makeOutputGeometry",value:function(){var e=null;if(this._currentGeo.BoneInfs.length>0){var t=[];this._makePutBoneList(this._currentGeo.baseFrame.parentName,t);for(var r=0;r<this._currentGeo.BoneInfs.length;r++){for(var n=0,o=0;o<t.length;o++)if(t[o].name===this._currentGeo.BoneInfs[r].boneName){n=o,t[o].OffsetMatrix=new Matrix4,t[o].OffsetMatrix.copy(this._currentGeo.BoneInfs[r].OffsetMatrix);break}for(var l=0;l<this._currentGeo.BoneInfs[r].Indeces.length;l++){var c=this._currentGeo.BoneInfs[r].Indeces[l],h=this._currentGeo.BoneInfs[r].Weights[l],d=4*c;switch(this._currentGeo.VertexSetedBoneCount[c]){case 0:this._currentGeo.GeometryData.skinIndices[d]=n,this._currentGeo.GeometryData.skinWeights[d]=h;break;case 1:this._currentGeo.GeometryData.skinIndices[d+1]=n,this._currentGeo.GeometryData.skinWeights[d+1]=h;break;case 2:this._currentGeo.GeometryData.skinIndices[d+2]=n,this._currentGeo.GeometryData.skinWeights[d+2]=h;break;case 3:this._currentGeo.GeometryData.skinIndices[d+3]=n,this._currentGeo.GeometryData.skinWeights[d+3]=h}this._currentGeo.VertexSetedBoneCount[c]++,this._currentGeo.VertexSetedBoneCount[c]>4&&console.log("warn! over 4 bone weight! :"+c)}}for(var f=0;f<this._currentGeo.Materials.length;f++)this._currentGeo.Materials[f].skinning=!0;for(var m=[],v=0;v<t.length;v++)t[v].OffsetMatrix?m.push(t[v].OffsetMatrix):m.push(new Matrix4);e=new SkinnedMesh(this._buildGeometry(),1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials),this._initSkeleton(e,t,m)}else e=new Mesh(this._buildGeometry(),1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials);e.name=this._currentGeo.name;var y=new Matrix4,x=this._currentGeo.baseFrame.putBone;if(x&&x.parent){for(;x=x.parent;)y.multiply(x.FrameTransformMatrix);e.applyMatrix4(y)}this.Meshes.push(e)}},{key:"_initSkeleton",value:function(e,t,r){var n,o,i,l,c=[];for(i=0,l=t.length;i<l;i++)o=t[i],n=new Bone,c.push(n),n.name=o.name,n.position.fromArray(o.pos),n.quaternion.fromArray(o.rotq),void 0!==o.scl&&n.scale.fromArray(o.scl);for(i=0,l=t.length;i<l;i++)-1!==(o=t[i]).parent&&null!==o.parent&&void 0!==c[o.parent]?c[o.parent].add(c[i]):e.add(c[i]);e.updateMatrixWorld(!0);var h=new Skeleton(c,r);e.bind(h,e.matrixWorld)}},{key:"_readAnimationKey",value:function(){var e=0,t=this._currentObject.data.indexOf(";",e),line=this._currentObject.data.substr(e,t-e);e=t+1;var r=parseInt(this._readLine(line));e=(t=this._currentObject.data.indexOf(";",e))+1,line=this._currentObject.data.substr(e);for(var data=this._readLine(line.trim()).split(";,"),i=0;i<data.length;i++){var n=data[i].split(";"),o=new XKeyFrameInfo;if(o.type=r,o.Frame=parseInt(n[0]),o.index=this._currentAnimeFrames.keyFrames.length,o.time=o.Frame,4!=r){for(var l=!1,c=0;c<this._currentAnimeFrames.keyFrames.length;c++)if(this._currentAnimeFrames.keyFrames[c].Frame===o.Frame){o=this._currentAnimeFrames.keyFrames[c],l=!0;break}var h=n[2].split(",");switch(r){case 0:o.rot=new Quaternion(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),-1*parseFloat(h[0]));break;case 1:o.scl=new Vector3(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]));break;case 2:o.pos=new Vector3(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))}l||this._currentAnimeFrames.keyFrames.push(o)}else o.matrix=new Matrix4,this._ParseMatrixData(o.matrix,n[2].split(",")),this._currentAnimeFrames.keyFrames.push(o)}}},{key:"_makeOutputAnimation",value:function(){var e=new XAnimationObj(this.options);e.fps=this.animTicksPerSecond,e.name=this._currentAnime.name,e.make(this._currentAnime.AnimeFrames),this.animations.push(e)}},{key:"assignAnimation",value:function(e,t){var r=e,n=t;if(r||(r=this.Meshes[0]),n||(n=this.animations[0]),!r||!n)return null;var o={};o.fps=n.fps,o.name=n.name,o.length=n.length,o.hierarchy=[];for(var b=0;b<r.skeleton.bones.length;b++){for(var l=!1,i=0;i<n.hierarchy.length;i++)if(r.skeleton.bones[b].name===n.hierarchy[i].name){l=!0;var c=n.hierarchy[i].copy();if(c.parent=-1,r.skeleton.bones[b].parent&&"Bone"===r.skeleton.bones[b].parent.type)for(var h=0;h<o.hierarchy.length;h++)o.hierarchy[h].name===r.skeleton.bones[b].parent.name&&(c.parent=h,c.parentName=r.skeleton.bones[b].parent.name);o.hierarchy.push(c);break}if(!l){var d=n.hierarchy[0].copy();d.name=r.skeleton.bones[b].name,d.parent=-1;for(var f=0;f<d.keys.length;f++)d.keys[f].pos&&d.keys[f].pos.set(0,0,0),d.keys[f].scl&&d.keys[f].scl.set(1,1,1),d.keys[f].rot&&d.keys[f].rot.set(0,0,0,1);o.hierarchy.push(d)}}return r.geometry.animations||(r.geometry.animations=[]),r.geometry.animations.push(AnimationClip.parseAnimation(o,r.skeleton.bones)),r.animationMixer||(r.animationMixer=new AnimationMixer(r)),o}},{key:"_ParseMatrixData",value:function(e,data){e.set(parseFloat(data[0]),parseFloat(data[4]),parseFloat(data[8]),parseFloat(data[12]),parseFloat(data[1]),parseFloat(data[5]),parseFloat(data[9]),parseFloat(data[13]),parseFloat(data[2]),parseFloat(data[6]),parseFloat(data[10]),parseFloat(data[14]),parseFloat(data[3]),parseFloat(data[7]),parseFloat(data[11]),parseFloat(data[15]))}}]),e}()),classCallCheck,createClass,XboneInf,XAnimationInfo,XAnimationObj,XKeyFrameInfo,ColorConverter={setHSV:function(e,t,s,r){return t=MathUtils.euclideanModulo(t,1),s=MathUtils.clamp(s,0,1),r=MathUtils.clamp(r,0,1),e.setHSL(t,s*r/((t=(2-s)*r)<1?t:2-t),.5*t)},getHSV:(hsl={},function(e,t){return void 0===t&&(console.warn("ColorConverter: .getHSV() target is now required"),t={h:0,s:0,l:0}),e.getHSL(hsl),hsl.s*=hsl.l<.5?hsl.l:1-hsl.l,t.h=hsl.h,t.s=2*hsl.s/(hsl.l+hsl.s),t.v=hsl.l+hsl.s,t}),setCMYK:function(e,t,r,n,o){var l=(1-t)*(1-o),g=(1-r)*(1-o),b=(1-n)*(1-o);return e.setRGB(l,g,b)},getCMYK:function(e,t){void 0===t&&(console.warn("ColorConverter: .getCMYK() target is now required"),t={c:0,m:0,y:0,k:0});var r=e.r,g=e.g,b=e.b,n=1-Math.max(r,g,b),o=(1-r-n)/(1-n),l=(1-g-n)/(1-n),c=(1-b-n)/(1-n);return t.c=o,t.m=l,t.y=c,t.k=n,t}},hsl,ImprovedNoise=function(){for(var p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=0;i<256;i++)p[256+i]=p[i];function e(e){return e*e*e*(e*(6*e-15)+10)}function t(e,a,b){return a+e*(b-a)}function r(e,t,r,n){var o=15&e,u=o<8?t:r,l=o<4?r:12==o||14==o?t:n;return(0==(1&o)?u:-u)+(0==(2&o)?l:-l)}return{noise:function(n,o,l){var c=Math.floor(n),h=Math.floor(o),d=Math.floor(l),f=255&c,m=255&h,v=255&d,y=(n-=c)-1,x=(o-=h)-1,_=(l-=d)-1,u=e(n),M=e(o),w=e(l),S=p[f]+m,A=p[S]+v,T=p[S+1]+v,L=p[f+1]+m,C=p[L]+v,N=p[L+1]+v;return t(w,t(M,t(u,r(p[A],n,o,l),r(p[C],y,o,l)),t(u,r(p[T],n,x,l),r(p[N],y,x,l))),t(M,t(u,r(p[A+1],n,o,_),r(p[C+1],y,o,l-1)),t(u,r(p[T+1],n,x,_),r(p[N+1],y,x,_))))}}},Lut=function(e,t){return this.lut=[],this.setColorMap(e,t),this};Lut.prototype={constructor:Lut,lut:[],map:[],n:256,minV:0,maxV:1,set:function(e){return e instanceof Lut&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},setColorMap:function(e,t){this.map=ColorMapKeywords[e]||ColorMapKeywords.rainbow,this.n=t||32;var r=1/this.n;this.lut.length=0;for(var i=0;i<=1;i+=r)for(var n=0;n<this.map.length-1;n++)if(i>=this.map[n][0]&&i<this.map[n+1][0]){var o=this.map[n][0],l=this.map[n+1][0],c=new Color(this.map[n][1]),h=new Color(this.map[n+1][1]),d=c.lerp(h,(i-o)/(l-o));this.lut.push(d)}return this},copy:function(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){ColorMapKeywords[e]=t},createCanvas:function(){var canvas=document.createElement("canvas");return canvas.width=1,canvas.height=this.n,this.updateCanvas(canvas),canvas},updateCanvas:function(canvas){for(var e=canvas.getContext("2d",{alpha:!1}),t=e.getImageData(0,0,1,this.n),data=t.data,r=0,n=1/this.n,i=1;i>=0;i-=n)for(var o=this.map.length-1;o>=0;o--)if(i<this.map[o][0]&&i>=this.map[o-1][0]){var l=this.map[o-1][0],c=this.map[o][0],h=new Color(this.map[o-1][1]),d=new Color(this.map[o][1]),f=h.lerp(d,(i-l)/(c-l));data[4*r]=Math.round(255*f.r),data[4*r+1]=Math.round(255*f.g),data[4*r+2]=Math.round(255*f.b),data[4*r+3]=255,r+=1}return e.putImageData(t,0,0),canvas}};var ColorMapKeywords={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]},MeshSurfaceSampler=function(){var e=new Triangle;function t(e){var t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.positionAttribute=this.geometry.getAttribute("position"),this.weightAttribute=null,this.distribution=null}return t.prototype={constructor:t,setWeightAttribute:function(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this},build:function(){for(var t=this.positionAttribute,r=this.weightAttribute,n=new Float32Array(t.count/3),i=0;i<t.count;i+=3){var o=1;r&&(o=r.getX(i)+r.getX(i+1)+r.getX(i+2)),e.a.fromBufferAttribute(t,i),e.b.fromBufferAttribute(t,i+1),e.c.fromBufferAttribute(t,i+2),o*=e.getArea(),n[i/3]=o}this.distribution=new Float32Array(t.count/3);var l=0;for(i=0;i<n.length;i++)l+=n[i],this.distribution[i]=l;return this},sample:function(e,t){var r=this.distribution[this.distribution.length-1],n=this.binarySearch(Math.random()*r);return this.sampleFace(n,e,t)},binarySearch:function(e){for(var t=this.distribution,r=0,n=t.length-1,o=-1;r<=n;){var l=Math.floor((r+n)/2);if(0===l||t[l-1]<=e&&t[l]>e){o=l;break}e<t[l]?n=l-1:r=l+1}return o},sampleFace:function(t,r,n){var u=Math.random(),o=Math.random();return u+o>1&&(u=1-u,o=1-o),e.a.fromBufferAttribute(this.positionAttribute,3*t),e.b.fromBufferAttribute(this.positionAttribute,3*t+1),e.c.fromBufferAttribute(this.positionAttribute,3*t+2),r.set(0,0,0).addScaledVector(e.a,u).addScaledVector(e.b,o).addScaledVector(e.c,1-(u+o)),e.getNormal(n),this}},t}(),ConvexObjectBreaker=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3,this.tempCM2=new Vector3,this.tempVector3=new Vector3,this.tempVector3_2=new Vector3,this.tempVector3_3=new Vector3,this.tempVector3_P0=new Vector3,this.tempVector3_P1=new Vector3,this.tempVector3_P2=new Vector3,this.tempVector3_N0=new Vector3,this.tempVector3_N1=new Vector3,this.tempVector3_AB=new Vector3,this.tempVector3_CB=new Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var i=0;i<900;i++)this.segments[i]=!1},v1;ConvexObjectBreaker.prototype={constructor:ConvexObjectBreaker,prepareBreakableObject:function(object,e,t,r,n){object.geometry.isBufferGeometry||console.error("ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var o=object.userData;o.mass=e,o.velocity=t.clone(),o.angularVelocity=r.clone(),o.breakable=n},subdivideByImpact:function(object,e,t,r,n){var o=[],l=this.tempPlane1,c=this.tempPlane2;this.tempVector3.addVectors(e,t),l.setFromCoplanarPoints(e,object.position,this.tempVector3);var h=n+r,d=this;return function n(f,m,v,y){if(Math.random()<.05*y||y>h)o.push(f);else{var x=Math.PI;0===y?(c.normal.copy(l.normal),c.constant=l.constant):y<=r?(x=(v-m)*(.2+.6*Math.random())+m,d.tempVector3_2.copy(object.position).sub(e).applyAxisAngle(t,x).add(e),c.setFromCoplanarPoints(e,d.tempVector3,d.tempVector3_2)):(x=(.5*(1&y)+.2*(2-Math.random()))*Math.PI,d.tempVector3_2.copy(e).sub(f.position).applyAxisAngle(t,x).add(f.position),d.tempVector3_3.copy(t).add(f.position),c.setFromCoplanarPoints(f.position,d.tempVector3_3,d.tempVector3_2)),d.cutByPlane(f,c,d.tempResultObjects);var _=d.tempResultObjects.object1,M=d.tempResultObjects.object2;_&&n(_,m,x,y+1),M&&n(M,x,v,y+1)}}(object,0,2*Math.PI,0),o},cutByPlane:function(object,e,output){var t=object.geometry,r=t.attributes.position.array,n=t.attributes.normal.array,o=r.length/3,l=o/3,c=t.getIndex();function h(e,t){var r=3*e+t;return c?c[r]:r}c&&(l=(c=c.array).length/3);for(var d=[],f=[],m=this.smallDelta,v=o*o,i=0;i<v;i++)this.segments[i]=!1;var y=this.tempVector3_P0,x=this.tempVector3_P1,_=this.tempVector3_N0,M=this.tempVector3_N1;for(i=0;i<l-1;i++){var w=h(i,0),S=h(i,1),A=h(i,2);_.set(n[w],n[w]+1,n[w]+2);for(var T=i+1;T<l;T++){var L=h(T,0),C=h(T,1),N=h(T,2);M.set(n[L],n[L]+1,n[L]+2),1-_.dot(M)<m&&(w===L||w===C||w===N?S===L||S===C||S===N?(this.segments[w*o+S]=!0,this.segments[S*o+w]=!0):(this.segments[A*o+w]=!0,this.segments[w*o+A]=!0):S!==L&&S!==C&&S!==N||(this.segments[A*o+S]=!0,this.segments[S*o+A]=!0))}}var P=this.tempPlane_Cut;object.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(e,object.matrix,P);for(i=0;i<l;i++)for(var F=h(i,0),E=h(i,1),R=h(i,2),D=0;D<3;D++){var O=0===D?F:1===D?E:R,I=0===D?E:1===D?R:F;if(!this.segments[O*o+I]){this.segments[O*o+I]=!0,this.segments[I*o+O]=!0,y.set(r[3*O],r[3*O+1],r[3*O+2]),x.set(r[3*I],r[3*I+1],r[3*I+2]);var B=0;(U=P.distanceToPoint(y))>m?(B=2,f.push(y.clone())):U<-m?(B=1,d.push(y.clone())):(B=3,d.push(y.clone()),f.push(y.clone()));var U,k=0;if((U=P.distanceToPoint(x))>m?(k=2,f.push(x.clone())):U<-m?(k=1,d.push(x.clone())):(k=3,d.push(x.clone()),f.push(x.clone())),1===B&&2===k||2===B&&1===k){this.tempLine1.start.copy(y),this.tempLine1.end.copy(x);var V=new Vector3;if(void 0===(V=P.intersectLine(this.tempLine1,V)))return console.error("Internal error: segment does not intersect plane."),output.segmentedObject1=null,output.segmentedObject2=null,0;d.push(V),f.push(V.clone())}}}var G=.5*object.userData.mass;this.tempCM1.set(0,0,0);var z=0,j=d.length;if(j>0){for(i=0;i<j;i++)this.tempCM1.add(d[i]);this.tempCM1.divideScalar(j);for(i=0;i<j;i++){(p=d[i]).sub(this.tempCM1),z=Math.max(z,p.x,p.y,p.z)}this.tempCM1.add(object.position)}this.tempCM2.set(0,0,0);var W=0,H=f.length;if(H>0){for(i=0;i<H;i++)this.tempCM2.add(f[i]);this.tempCM2.divideScalar(H);for(i=0;i<H;i++){var p;(p=f[i]).sub(this.tempCM2),W=Math.max(W,p.x,p.y,p.z)}this.tempCM2.add(object.position)}var X=null,Y=null,Q=0;return j>4&&((X=new Mesh(new ConvexBufferGeometry(d),object.material)).position.copy(this.tempCM1),X.quaternion.copy(object.quaternion),this.prepareBreakableObject(X,G,object.userData.velocity,object.userData.angularVelocity,2*z>this.minSizeForBreak),Q++),H>4&&((Y=new Mesh(new ConvexBufferGeometry(f),object.material)).position.copy(this.tempCM2),Y.quaternion.copy(object.quaternion),this.prepareBreakableObject(Y,G,object.userData.velocity,object.userData.angularVelocity,2*W>this.minSizeForBreak),Q++),output.object1=X,output.object2=Y,Q}},ConvexObjectBreaker.transformFreeVector=function(e,t){var r=e.x,n=e.y,o=e.z,l=t.elements;return e.x=l[0]*r+l[4]*n+l[8]*o,e.y=l[1]*r+l[5]*n+l[9]*o,e.z=l[2]*r+l[6]*n+l[10]*o,e},ConvexObjectBreaker.transformFreeVectorInverse=function(e,t){var r=e.x,n=e.y,o=e.z,l=t.elements;return e.x=l[0]*r+l[1]*n+l[2]*o,e.y=l[4]*r+l[5]*n+l[6]*o,e.z=l[8]*r+l[9]*n+l[10]*o,e},ConvexObjectBreaker.transformTiedVectorInverse=function(e,t){var r=e.x,n=e.y,o=e.z,l=t.elements;return e.x=l[0]*r+l[1]*n+l[2]*o-l[12],e.y=l[4]*r+l[5]*n+l[6]*o-l[13],e.z=l[8]*r+l[9]*n+l[10]*o-l[14],e},ConvexObjectBreaker.transformPlaneToLocalSpace=(v1=new Vector3,function(e,t,r){r.normal.copy(e.normal),r.constant=e.constant;var n=ConvexObjectBreaker.transformTiedVectorInverse(e.coplanarPoint(v1),t);ConvexObjectBreaker.transformFreeVectorInverse(r.normal,t),r.constant=-n.dot(r.normal)});var GPUComputationRenderer=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new Scene,o=new Camera;o.position.z=1;var l={passThruTexture:{value:null}},c=f("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",l),h=new Mesh(new PlaneBufferGeometry(2,2),c);function d(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function f(e,t){var r=new ShaderMaterial({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return d(r),r}n.add(h),this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:NearestFilter,magFilter:NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!r.capabilities.isWebGL2&&!r.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var i=0;i<this.variables.length;i++){var n=this.variables[i];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);var o=n.material,l=o.uniforms;if(null!==n.dependencies)for(var c=0;c<n.dependencies.length;c++){var h=n.dependencies[c];if(h.name!==n.name){for(var d=!1,f=0;f<this.variables.length;f++)if(h.name===this.variables[f].name){d=!0;break}if(!d)return"Variable dependency not found. Variable="+n.name+", dependency="+h.name}l[h.name]={value:null},o.fragmentShader="\nuniform sampler2D "+h.name+";\n"+o.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,i=0,r=this.variables.length;i<r;i++){var n=this.variables[i];if(null!==n.dependencies)for(var o=n.material.uniforms,l=0,dl=n.dependencies.length;l<dl;l++){var c=n.dependencies[l];o[c.name].value=c.renderTargets[e].texture}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=d,this.createShaderMaterial=f,this.createRenderTarget=function(r,n,o,l,c,h){return new WebGLRenderTarget(r=r||e,n=n||t,{wrapS:o=o||ClampToEdgeWrapping,wrapT:l=l||ClampToEdgeWrapping,minFilter:c=c||NearestFilter,magFilter:h=h||NearestFilter,format:RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){return new DataTexture(new Float32Array(e*t*4),e,t,RGBAFormat,FloatType)},this.renderTexture=function(input,output){l.passThruTexture.value=input,this.doRenderTarget(c,output),l.passThruTexture.value=null},this.doRenderTarget=function(e,output){var t=r.getRenderTarget();h.material=e,r.setRenderTarget(output),r.render(n,o),h.material=c,r.setRenderTarget(t)}},Gyroscope=function(){Object3D.call(this)},translationObject,quaternionObject,scaleObject,translationWorld,quaternionWorld,scaleWorld;Gyroscope.prototype=Object.create(Object3D.prototype),Gyroscope.prototype.constructor=Gyroscope,Gyroscope.prototype.updateMatrixWorld=(translationObject=new Vector3,quaternionObject=new Quaternion,scaleObject=new Vector3,translationWorld=new Vector3,quaternionWorld=new Quaternion,scaleWorld=new Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld),this.matrix.decompose(translationObject,quaternionObject,scaleObject),this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var i=0,t=this.children.length;i<t;i++)this.children[i].updateMatrixWorld(e)});var MD2Character=function(){var e=this;function t(e,t){for(var r=new TextureLoader,o=[],i=0;i<t.length;i++)o[i]=r.load(e+t[i],n),o[i].mapping=UVMapping,o[i].name=t[i],o[i].encoding=sRGBEncoding;return o}function r(e,t){var r=new MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),n=new MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),o=new Mesh(e,n);return o.rotation.y=-Math.PI/2,o.castShadow=!0,o.receiveShadow=!0,o.materialTexture=n,o.materialWireframe=r,o}function n(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(o){this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var l=[],i=0;i<o.weapons.length;i++)l[i]=o.weapons[i][1];this.skinsBody=t(o.baseUrl+"skins/",o.skins),this.skinsWeapon=t(o.baseUrl+"skins/",l);var c=new MD2Loader;c.load(o.baseUrl+o.body,(function(t){var o=new Box3;o.setFromBufferAttribute(t.attributes.position),e.root.position.y=-e.scale*o.min.y;var l=r(t,e.skinsBody[0]);l.scale.set(e.scale,e.scale,e.scale),e.root.add(l),e.meshBody=l,e.meshBody.clipOffset=0,e.activeAnimationClipName=l.geometry.animations[0].name,e.mixer=new AnimationMixer(l),n()}));var h=function(t,o){return function(l){var c=r(l,e.skinsWeapon[t]);c.scale.set(e.scale,e.scale,e.scale),c.visible=!1,c.name=o,e.root.add(c),e.weapons[t]=c,e.meshWeapon=c,n()}};for(i=0;i<o.weapons.length;i++)c.load(o.baseUrl+o.weapons[i][0],h(i,o.weapons[i][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(t){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var r=this.weapons[t];r&&(r.visible=!0,this.meshWeapon=r,e.syncWeaponAnimation())},this.setAnimation=function(t){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var r=this.mixer.clipAction(t,this.meshBody);r&&(this.meshBody.activeAction=r.play())}e.activeClipName=t,e.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var t=e.activeClipName;if(e.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var r=this.mixer.clipAction(t,this.meshWeapon);r&&(this.meshWeapon.activeAction=r.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}},MorphBlendMesh=function(e,t){Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=Object.keys(this.morphTargetDictionary).length,n=r-1,o=r/1;this.createAnimation("__default",0,n,o),this.setAnimationWeight("__default",1)};MorphBlendMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:MorphBlendMesh,createAnimation:function(e,t,r,n){var o={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=o,this.animationsList.push(o)},autoCreateAnimations:function(e){var t,pattern=/([a-z]+)_?(\d+)/i,r={},i=0;for(var n in this.morphTargetDictionary){var o=n.match(pattern);if(o&&o.length>1)r[l=o[1]]||(r[l]={start:1/0,end:-1/0}),i<(c=r[l]).start&&(c.start=i),i>c.end&&(c.end=i),t||(t=l);i++}for(var l in r){var c=r[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},setAnimationDirectionForward:function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},setAnimationDirectionBackward:function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},setAnimationFPS:function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},setAnimationDuration:function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},setAnimationWeight:function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},setAnimationTime:function(e,time){var t=this.animationsMap[e];t&&(t.time=time)},getAnimationTime:function(e){var time=0,t=this.animationsMap[e];return t&&(time=t.time),time},getAnimationDuration:function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},playAnimation:function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},stopAnimation:function(e){var t=this.animationsMap[e];t&&(t.active=!1)},update:function(e){for(var i=0,t=this.animationsList.length;i<t;i++){var r=this.animationsList[i];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+MathUtils.clamp(Math.floor(r.time/n),0,r.length-1),l=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*l,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var c=r.time%n/n;r.directionBackwards&&(c=1-c),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=c*l,this.morphTargetInfluences[r.lastFrame]=(1-c)*l):this.morphTargetInfluences[r.currentFrame]=l}}}});var MD2CharacterComplex=function(){var e=this;function t(e,t){for(var r=new TextureLoader,o=[],i=0;i<t.length;i++)o[i]=r.load(e+t[i],n),o[i].mapping=UVMapping,o[i].name=t[i],o[i].encoding=sRGBEncoding;return o}function r(t,r){var n=new MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),o=new MeshLambertMaterial({color:16777215,wireframe:!1,map:r,morphTargets:!0,morphNormals:!0}),l=new MorphBlendMesh(t,o);return l.rotation.y=-Math.PI/2,l.materialTexture=o,l.materialWireframe=n,l.autoCreateAnimations(e.animationFPS),l}function n(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}function o(e){return 1===e?1:1-Math.pow(2,-10*e)}this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null,this.enableShadows=function(e){for(var i=0;i<this.meshes.length;i++)this.meshes[i].castShadow=e,this.meshes[i].receiveShadow=e},this.setVisible=function(e){for(var i=0;i<this.meshes.length;i++)this.meshes[i].visible=e,this.meshes[i].visible=e},this.shareParts=function(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;var t=r(e.meshBody.geometry,this.skinsBody[0]);t.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(t),this.meshBody=t,this.meshes.push(t);for(var i=0;i<e.weapons.length;i++){var n=r(e.weapons[i].geometry,this.skinsWeapon[i]);n.scale.set(this.scale,this.scale,this.scale),n.visible=!1,n.name=e.weapons[i].name,this.root.add(n),this.weapons[i]=n,this.meshWeapon=n,this.meshes.push(n)}},this.loadParts=function(o){this.animations=o.animations,this.walkSpeed=o.walkSpeed,this.crouchSpeed=o.crouchSpeed,this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var l=[],i=0;i<o.weapons.length;i++)l[i]=o.weapons[i][1];this.skinsBody=t(o.baseUrl+"skins/",o.skins),this.skinsWeapon=t(o.baseUrl+"skins/",l);var c=new MD2Loader;c.load(o.baseUrl+o.body,(function(t){var o=new Box3;o.setFromBufferAttribute(t.attributes.position),e.root.position.y=-e.scale*o.min.y;var l=r(t,e.skinsBody[0]);l.scale.set(e.scale,e.scale,e.scale),e.root.add(l),e.meshBody=l,e.meshes.push(l),n()}));var h=function(t,o){return function(l){var c=r(l,e.skinsWeapon[t]);c.scale.set(e.scale,e.scale,e.scale),c.visible=!1,c.name=o,e.root.add(c),e.weapons[t]=c,e.meshWeapon=c,e.meshes.push(c),n()}};for(i=0;i<o.weapons.length;i++)c.load(o.baseUrl+o.weapons[i][0],h(i,o.weapons[i][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)},this.setWeapon=function(e){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.activeAnimation&&(t.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))},this.setAnimation=function(e){e!==this.activeAnimation&&e&&(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))},this.update=function(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(),this.updateAnimations(e))},this.updateAnimations=function(e){var t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))},this.updateBehaviors=function(){var e,t,r=this.controls,n=this.animations;r.crouch?(e=n.crouchMove,t=n.crouchIdle):(e=n.move,t=n.idle),r.jump&&(e=n.jump,t=n.jump),r.attack&&(r.crouch?(e=n.crouchAttack,t=n.crouchAttack):(e=n.attack,t=n.attack)),(r.moveForward||r.moveBackward||r.moveLeft||r.moveRight)&&this.activeAnimation!==e&&this.setAnimation(e),Math.abs(this.speed)<.2*this.maxSpeed&&!(r.moveLeft||r.moveRight||r.moveForward||r.moveBackward)&&this.activeAnimation!==t&&this.setAnimation(t),r.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),r.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))},this.updateMovementModel=function(e){var t=this.controls;t.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,t.moveForward&&(this.speed=MathUtils.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveBackward&&(this.speed=MathUtils.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));if(t.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!t.moveForward&&!t.moveBackward)if(this.speed>0){var r=o(this.speed/this.maxSpeed);this.speed=MathUtils.clamp(this.speed-r*e*this.frontDecceleration,0,this.maxSpeed)}else{r=o(this.speed/this.maxReverseSpeed);this.speed=MathUtils.clamp(this.speed+r*e*this.backAcceleration,this.maxReverseSpeed,0)}var n=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*n,this.root.position.z+=Math.cos(this.bodyOrientation)*n,this.root.rotation.y=this.bodyOrientation}},MorphAnimMesh=function(e,t){Mesh.call(this,e,t),this.type="MorphAnimMesh",this.mixer=new AnimationMixer(this),this.activeAction=null};MorphAnimMesh.prototype=Object.create(Mesh.prototype),MorphAnimMesh.prototype.constructor=MorphAnimMesh,MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1},MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},MorphAnimMesh.prototype.playAnimation=function(label,e){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var t=AnimationClip.findByName(this,label);if(!t)throw new Error("MorphAnimMesh: animations["+label+"] undefined in .playAnimation()");var r=this.mixer.clipAction(t);r.timeScale=t.tracks.length*e/t.duration,this.activeAction=r.play()},MorphAnimMesh.prototype.updateAnimation=function(e){this.mixer.update(e)},MorphAnimMesh.prototype.copy=function(source){return Mesh.prototype.copy.call(this,source),this.mixer=new AnimationMixer(this),this};var OceanShaders={};OceanShaders.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","\tvUV = position.xy * 0.5 + 0.5;","\tgl_Position = vec4(position, 1.0 );","}"].join("\n")},OceanShaders.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","#include <common>","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","\treturn vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","\t#ifdef HORIZONTAL","\tfloat index = vUV.x * u_transformSize - 0.5;","\t#else","\tfloat index = vUV.y * u_transformSize - 0.5;","\t#endif","\tfloat evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","\t#ifdef HORIZONTAL","\tvec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","\tvec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","\t#else","\tvec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","\tvec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","\t#endif","\tfloat twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","\tvec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","\tvec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","\tvec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","\tgl_FragColor = vec4(outputA, outputB);","}"].join("\n")},OceanShaders.ocean_initial_spectrum={uniforms:{u_wind:{value:new Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},vertexShader:["void main (void) {","\tgl_Position = vec4(position, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","#include <common>","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","\treturn sqrt(G * k * (1.0 + pow2(k / KM)));","}","#if __VERSION__ == 100","float tanh (float x) {","\treturn (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","#endif","void main (void) {","\tvec2 coordinates = gl_FragCoord.xy - 0.5;","\tfloat n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","\tfloat m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","\tvec2 K = (2.0 * PI * vec2(n, m)) / u_size;","\tfloat k = length(K);","\tfloat l_wind = length(u_wind);","\tfloat Omega = 0.84;","\tfloat kp = G * pow2(Omega / l_wind);","\tfloat c = omega(k) / k;","\tfloat cp = omega(kp) / kp;","\tfloat Lpm = exp(-1.25 * pow2(kp / k));","\tfloat gamma = 1.7;","\tfloat sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","\tfloat Gamma = exp(-pow2(sqrt(k / kp) - 1.0) / 2.0 * pow2(sigma));","\tfloat Jp = pow(gamma, Gamma);","\tfloat Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","\tfloat alphap = 0.006 * sqrt(Omega);","\tfloat Bl = 0.5 * alphap * cp / c * Fp;","\tfloat z0 = 0.000037 * pow2(l_wind) / G * pow(l_wind / cp, 0.9);","\tfloat uStar = 0.41 * l_wind / log(10.0 / z0);","\tfloat alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","\tfloat Fm = exp(-0.25 * pow2(k / KM - 1.0));","\tfloat Bh = 0.5 * alpham * CM / c * Fm * Lpm;","\tfloat a0 = log(2.0) / 4.0;","\tfloat am = 0.13 * uStar / CM;","\tfloat Delta = tanh(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","\tfloat cosPhi = dot(normalize(u_wind), normalize(K));","\tfloat S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","\tfloat dk = 2.0 * PI / u_size;","\tfloat h = sqrt(S / 2.0) * dk;","\tif (K.x == 0.0 && K.y == 0.0) {","\t\th = 0.0;","\t}","\tgl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},OceanShaders.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","#include <common>","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","\treturn sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","\tfloat deltaTime = 1.0 / 60.0;","\tvec2 coordinates = gl_FragCoord.xy - 0.5;","\tfloat n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","\tfloat m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","\tvec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","\tfloat phase = texture2D(u_phases, vUV).r;","\tfloat deltaPhase = omega(length(waveVector)) * u_deltaTime;","\tphase = mod(phase + deltaPhase, 2.0 * PI);","\tgl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},OceanShaders.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","#include <common>","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","\treturn vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","\treturn vec2(-z[1], z[0]);","}","float omega (float k) {","\treturn sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","\tvec2 coordinates = gl_FragCoord.xy - 0.5;","\tfloat n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","\tfloat m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","\tvec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","\tfloat phase = texture2D(u_phases, vUV).r;","\tvec2 phaseVector = vec2(cos(phase), sin(phase));","\tvec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","\tvec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","\th0Star.y *= -1.0;","\tvec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","\tvec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","\tvec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","\tif (waveVector.x == 0.0 && waveVector.y == 0.0) {","\t\th = vec2(0.0);","\t\thX = vec2(0.0);","\t\thZ = vec2(0.0);","\t}","\tgl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},OceanShaders.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","\tfloat texel = 1.0 / u_resolution;","\tfloat texelSize = u_size / u_resolution;","\tvec3 center = texture2D(u_displacementMap, vUV).rgb;","\tvec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","\tvec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","\tvec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","\tvec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","\tvec3 topRight = cross(right, top);","\tvec3 topLeft = cross(top, left);","\tvec3 bottomLeft = cross(left, bottom);","\tvec3 bottomRight = cross(bottom, right);","\tgl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},OceanShaders.ocean_main={uniforms:{u_displacementMap:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_projectionMatrix:{value:null},u_viewMatrix:{value:null},u_cameraPosition:{value:null},u_skyColor:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null}},vertexShader:["precision highp float;","varying vec3 vPos;","varying vec2 vUV;","uniform mat4 u_projectionMatrix;","uniform mat4 u_viewMatrix;","uniform float u_size;","uniform float u_geometrySize;","uniform sampler2D u_displacementMap;","void main (void) {","\tvec3 newPos = position + texture2D(u_displacementMap, uv).rgb * (u_geometrySize / u_size);","\tvPos = newPos;","\tvUV = uv;","\tgl_Position = u_projectionMatrix * u_viewMatrix * vec4(newPos, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","varying vec3 vPos;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform sampler2D u_normalMap;","uniform vec3 u_cameraPosition;","uniform vec3 u_oceanColor;","uniform vec3 u_skyColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","\treturn 1.0 - exp(-color * exposure);","}","void main (void) {","\tvec3 normal = texture2D(u_normalMap, vUV).rgb;","\tvec3 view = normalize(u_cameraPosition - vPos);","\tfloat fresnel = 0.02 + 0.98 * pow(1.0 - dot(normal, view), 5.0);","\tvec3 sky = fresnel * u_skyColor;","\tfloat diffuse = clamp(dot(normal, normalize(u_sunDirection)), 0.0, 1.0);","\tvec3 water = (1.0 - fresnel) * u_oceanColor * u_skyColor * diffuse;","\tvec3 color = sky + water;","\tgl_FragColor = vec4(hdr(color, u_exposure), 1.0);","}"].join("\n")};var Ocean=function(e,t,r,n){function o(e,t){return void 0!==e?e:t}this.changed=!0,this.initial=!0,this.oceanCamera=new OrthographicCamera,this.oceanCamera.position.z=1,this.renderer=e,this.renderer.clearColor(16777215),this.scene=new Scene,n=n||{},this.clearColor=o(n.CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=o(n.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=o(n.SUN_DIRECTION[0],-1),this.sunDirectionY=o(n.SUN_DIRECTION[1],1),this.sunDirectionZ=o(n.SUN_DIRECTION[2],1),this.oceanColor=o(n.OCEAN_COLOR,new Vector3(.004,.016,.047)),this.skyColor=o(n.SKY_COLOR,new Vector3(3.2,9.6,12.8)),this.exposure=o(n.EXPOSURE,.35),this.geometryResolution=o(n.GEOMETRY_RESOLUTION,32),this.geometrySize=o(n.GEOMETRY_SIZE,2e3),this.resolution=o(n.RESOLUTION,64),this.floatSize=o(n.SIZE_OF_FLOAT,4),this.windX=o(n.INITIAL_WIND[0],10),this.windY=o(n.INITIAL_WIND[1],10),this.size=o(n.INITIAL_SIZE,250),this.choppiness=o(n.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var l=o(n.USE_HALF_FLOAT,!1)?HalfFloatType:FloatType,c={minFilter:LinearFilter,magFilter:LinearFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:l},h={minFilter:NearestFilter,magFilter:NearestFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:l},d={minFilter:NearestFilter,magFilter:NearestFilter,wrapS:RepeatWrapping,wrapT:RepeatWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:l};this.initialSpectrumFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,d),this.spectrumFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,h),this.pingPhaseFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,h),this.pongPhaseFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,h),this.pingTransformFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,h),this.pongTransformFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,h),this.displacementMapFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,c),this.normalMapFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,c);var f=OceanShaders.ocean_sim_vertex,m=OceanShaders.ocean_subtransform,v=UniformsUtils.clone(m.uniforms);this.materialOceanHorizontal=new ShaderMaterial({uniforms:v,vertexShader:f.vertexShader,fragmentShader:"#define HORIZONTAL \n"+m.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var y=OceanShaders.ocean_subtransform,x=UniformsUtils.clone(y.uniforms);this.materialOceanVertical=new ShaderMaterial({uniforms:x,vertexShader:f.vertexShader,fragmentShader:y.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var _=OceanShaders.ocean_initial_spectrum,M=UniformsUtils.clone(_.uniforms);this.materialInitialSpectrum=new ShaderMaterial({uniforms:M,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new Vector2},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var w=OceanShaders.ocean_phase,S=UniformsUtils.clone(w.uniforms);this.materialPhase=new ShaderMaterial({uniforms:S,vertexShader:f.vertexShader,fragmentShader:w.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var A=OceanShaders.ocean_spectrum,T=UniformsUtils.clone(A.uniforms);this.materialSpectrum=new ShaderMaterial({uniforms:T,vertexShader:f.vertexShader,fragmentShader:A.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var L=OceanShaders.ocean_normals,C=UniformsUtils.clone(L.uniforms);this.materialNormal=new ShaderMaterial({uniforms:C,vertexShader:f.vertexShader,fragmentShader:L.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var N=OceanShaders.ocean_main,P=UniformsUtils.clone(N.uniforms);this.materialOcean=new ShaderMaterial({uniforms:P,vertexShader:N.vertexShader,fragmentShader:N.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new Vector3(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new Mesh(new PlaneBufferGeometry(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};Ocean.prototype.generateMesh=function(){var e=new PlaneBufferGeometry(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);e.rotateX(-Math.PI/2),this.oceanMesh=new Mesh(e,this.materialOcean)},Ocean.prototype.render=function(){var e=this.renderer.getRenderTarget();this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null,this.renderer.setRenderTarget(e)},Ocean.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var e=new window.Float32Array(this.resolution*this.resolution*4),i=0;i<this.resolution;i++)for(var t=0;t<this.resolution;t++)e[i*this.resolution*4+4*t]=2*Math.random()*Math.PI,e[i*this.resolution*4+4*t+1]=0,e[i*this.resolution*4+4*t+2]=0,e[i*this.resolution*4+4*t+3]=0;this.pingPhaseTexture=new DataTexture(e,this.resolution,this.resolution,RGBAFormat),this.pingPhaseTexture.wrapS=ClampToEdgeWrapping,this.pingPhaseTexture.wrapT=ClampToEdgeWrapping,this.pingPhaseTexture.type=FloatType},Ocean.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.initialSpectrumFramebuffer),this.renderer.clear(),this.renderer.render(this.scene,this.oceanCamera)},Ocean.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.renderer.render(this.scene,this.oceanCamera),this.pingPhase=!this.pingPhase},Ocean.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.spectrumFramebuffer),this.renderer.render(this.scene,this.oceanCamera)},Ocean.prototype.renderSpectrumFFT=function(){var e=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var i=0;i<e;i++)0===i?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):i%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.pongTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera));this.scene.overrideMaterial=this.materialOceanVertical;for(i=e;i<2*e;i++)i===2*e-1?(this.materialOceanVertical.uniforms.u_input.value=e%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.displacementMapFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):i%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.pongTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,i%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera))},Ocean.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.setRenderTarget(this.normalMapFramebuffer),this.renderer.clear(),this.renderer.render(this.scene,this.oceanCamera)};var RollerCoasterGeometry=function(e,t){BufferGeometry.call(this);var r=[],n=[],o=[],l=[1,1,1],c=[1,1,0],h=new Vector3(0,1,0),d=new Vector3,f=new Vector3,m=new Quaternion,v=new Quaternion;v.setFromAxisAngle(h,Math.PI/2);var y=new Vector3,x=new Vector3;x.copy(e.getPointAt(0));for(var _=[new Vector3(-.225,0,0),new Vector3(0,-.05,0),new Vector3(0,-.175,0),new Vector3(0,-.05,0),new Vector3(.225,0,0),new Vector3(0,-.175,0)],M=2*Math.PI,w=5,S=[],i=0;i<w;i++){var A=i/w*M;S.push(new Vector3(.06*Math.sin(A),.06*Math.cos(A),0))}w=6;var T=[];for(i=0;i<w;i++){A=i/w*M;T.push(new Vector3(.025*Math.sin(A),.025*Math.cos(A),0))}var L=new Vector3,C=new Vector3;function N(e,t){C.set(0,0,-1).applyQuaternion(m);for(var l=0;l<e.length;l++)L.copy(e[l]),L.applyQuaternion(m),L.add(y),r.push(L.x,L.y,L.z),n.push(C.x,C.y,C.z),o.push(t[0],t[1],t[2]);C.set(0,0,1).applyQuaternion(m);for(l=e.length-1;l>=0;l--)L.copy(e[l]),L.applyQuaternion(m),L.add(y),r.push(L.x,L.y,L.z),n.push(C.x,C.y,C.z),o.push(t[0],t[1],t[2])}var P=new Vector3,F=new Vector3,E=new Vector3,R=new Vector3,D=new Vector3,O=new Vector3,I=new Vector3,B=new Vector3;function U(e,t,l){for(var c=0,h=e.length;c<h;c++){var d=e[c],f=e[(c+1)%h];P.copy(d).add(t),P.applyQuaternion(m),P.add(y),F.copy(f).add(t),F.applyQuaternion(m),F.add(y),E.copy(f).add(t),E.applyQuaternion(v),E.add(x),R.copy(d).add(t),R.applyQuaternion(v),R.add(x),r.push(P.x,P.y,P.z),r.push(F.x,F.y,F.z),r.push(R.x,R.y,R.z),r.push(F.x,F.y,F.z),r.push(E.x,E.y,E.z),r.push(R.x,R.y,R.z),D.copy(d),D.applyQuaternion(m),D.normalize(),O.copy(f),O.applyQuaternion(m),O.normalize(),I.copy(f),I.applyQuaternion(v),I.normalize(),B.copy(d),B.applyQuaternion(v),B.normalize(),n.push(D.x,D.y,D.z),n.push(O.x,O.y,O.z),n.push(B.x,B.y,B.z),n.push(O.x,O.y,O.z),n.push(I.x,I.y,I.z),n.push(B.x,B.y,B.z),o.push(l[0],l[1],l[2]),o.push(l[0],l[1],l[2]),o.push(l[0],l[1],l[2]),o.push(l[0],l[1],l[2]),o.push(l[0],l[1],l[2]),o.push(l[0],l[1],l[2])}}var k=new Vector3;for(i=1;i<=t;i++){y.copy(e.getPointAt(i/t)),h.set(0,1,0),d.subVectors(y,x).normalize(),f.crossVectors(h,d).normalize(),h.crossVectors(d,f);A=Math.atan2(d.x,d.z);m.setFromAxisAngle(h,A),i%2==0&&N(_,c),U(S,k.set(0,-.125,0),c),U(T,k.set(.2,0,0),l),U(T,k.set(-.2,0,0),l),x.copy(y),v.copy(m)}this.setAttribute("position",new BufferAttribute(new Float32Array(r),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(n),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(o),3))};RollerCoasterGeometry.prototype=Object.create(BufferGeometry.prototype);var RollerCoasterLiftersGeometry=function(e,t){BufferGeometry.call(this);var r=[],n=[],o=new Quaternion,l=new Vector3(0,1,0),c=new Vector3,h=new Vector3,d=[new Vector3(0,.05,-.05),new Vector3(0,.05,.05),new Vector3(0,-.05,0)],f=[new Vector3(-.05,0,.05),new Vector3(-.05,0,-.05),new Vector3(.05,0,0)],m=[new Vector3(.05,0,-.05),new Vector3(.05,0,.05),new Vector3(-.05,0,0)],v=new Vector3,y=new Vector3,x=new Vector3,_=new Vector3,M=new Vector3,w=new Vector3,S=new Vector3,A=new Vector3;function T(e,t,l){for(var c=0,h=e.length;c<h;c++){var d=e[c],f=e[(c+1)%h];v.copy(d),v.applyQuaternion(o),v.add(t),y.copy(f),y.applyQuaternion(o),y.add(t),x.copy(f),x.applyQuaternion(o),x.add(l),_.copy(d),_.applyQuaternion(o),_.add(l),r.push(v.x,v.y,v.z),r.push(y.x,y.y,y.z),r.push(_.x,_.y,_.z),r.push(y.x,y.y,y.z),r.push(x.x,x.y,x.z),r.push(_.x,_.y,_.z),M.copy(d),M.applyQuaternion(o),M.normalize(),w.copy(f),w.applyQuaternion(o),w.normalize(),S.copy(f),S.applyQuaternion(o),S.normalize(),A.copy(d),A.applyQuaternion(o),A.normalize(),n.push(M.x,M.y,M.z),n.push(w.x,w.y,w.z),n.push(A.x,A.y,A.z),n.push(w.x,w.y,w.z),n.push(S.x,S.y,S.z),n.push(A.x,A.y,A.z)}}for(var L=new Vector3,C=new Vector3,i=1;i<=t;i++){c.copy(e.getPointAt(i/t)),h.copy(e.getTangentAt(i/t));var N=Math.atan2(h.x,h.z);o.setFromAxisAngle(l,N),c.y>10?(L.set(-.75,-.35,0),L.applyQuaternion(o),L.add(c),C.set(.75,-.35,0),C.applyQuaternion(o),C.add(c),T(d,L,C),L.set(-.7,-.3,0),L.applyQuaternion(o),L.add(c),C.set(-.7,-c.y,0),C.applyQuaternion(o),C.add(c),T(f,L,C),L.set(.7,-.3,0),L.applyQuaternion(o),L.add(c),C.set(.7,-c.y,0),C.applyQuaternion(o),C.add(c),T(m,L,C)):(L.set(0,-.2,0),L.applyQuaternion(o),L.add(c),C.set(0,-c.y,0),C.applyQuaternion(o),C.add(c),T(m,L,C))}this.setAttribute("position",new BufferAttribute(new Float32Array(r),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(n),3))};RollerCoasterLiftersGeometry.prototype=Object.create(BufferGeometry.prototype);var RollerCoasterShadowGeometry=function(e,t){BufferGeometry.call(this);var r=[],n=new Vector3(0,1,0),o=new Vector3,l=new Quaternion,c=new Quaternion;c.setFromAxisAngle(n,Math.PI/2);var h=new Vector3,d=new Vector3;d.copy(e.getPointAt(0)),d.y=0;for(var f=new Vector3,m=new Vector3,v=new Vector3,y=new Vector3,i=1;i<=t;i++){h.copy(e.getPointAt(i/t)),h.y=0,o.subVectors(h,d);var x=Math.atan2(o.x,o.z);l.setFromAxisAngle(n,x),f.set(-.3,0,0),f.applyQuaternion(l),f.add(h),m.set(.3,0,0),m.applyQuaternion(l),m.add(h),v.set(.3,0,0),v.applyQuaternion(c),v.add(d),y.set(-.3,0,0),y.applyQuaternion(c),y.add(d),r.push(f.x,f.y,f.z),r.push(m.x,m.y,m.z),r.push(y.x,y.y,y.z),r.push(m.x,m.y,m.z),r.push(v.x,v.y,v.z),r.push(y.x,y.y,y.z),d.copy(h),c.copy(l)}this.setAttribute("position",new BufferAttribute(new Float32Array(r),3))};RollerCoasterShadowGeometry.prototype=Object.create(BufferGeometry.prototype);var SkyGeometry=function(){BufferGeometry.call(this);for(var e=[],i=0;i<100;i++){var t=800*Math.random()-400,r=50*Math.random()+50,n=800*Math.random()-400,o=40*Math.random()+20;e.push(t-o,r,n-o),e.push(t+o,r,n-o),e.push(t-o,r,n+o),e.push(t+o,r,n-o),e.push(t+o,r,n+o),e.push(t-o,r,n+o)}this.setAttribute("position",new BufferAttribute(new Float32Array(e),3))};SkyGeometry.prototype=Object.create(BufferGeometry.prototype);var TreesGeometry=function(e){BufferGeometry.call(this);var t=[],r=[],n=new Raycaster;n.ray.direction.set(0,-1,0);for(var i=0;i<2e3;i++){var o=500*Math.random()-250,l=500*Math.random()-250;n.ray.origin.set(o,50,l);var c=n.intersectObject(e);if(0!==c.length){var h=c[0].point.y,d=5*Math.random()+.5,f=Math.random()*Math.PI*2;t.push(o+Math.sin(f),h,l+Math.cos(f)),t.push(o,h+d,l),t.push(o+Math.sin(f+Math.PI),h,l+Math.cos(f+Math.PI)),f+=Math.PI/2,t.push(o+Math.sin(f),h,l+Math.cos(f)),t.push(o,h+d,l),t.push(o+Math.sin(f+Math.PI),h,l+Math.cos(f+Math.PI));for(var m=.1*Math.random(),v=0;v<6;v++)r.push(.2+m,.4+m,0)}}this.setAttribute("position",new BufferAttribute(new Float32Array(t),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(r),3))};function TubePainter(){var e=new BufferAttribute(new Float32Array(3e6),3);e.usage=DynamicDrawUsage;var t=new BufferAttribute(new Float32Array(3e6),3);t.usage=DynamicDrawUsage;var r=new BufferAttribute(new Float32Array(3e6),3);r.usage=DynamicDrawUsage;var n=new BufferGeometry;n.setAttribute("position",e),n.setAttribute("normal",t),n.setAttribute("color",r),n.drawRange.count=0;var o=new MeshStandardMaterial({vertexColors:VertexColors}),l=new Mesh(n,o);l.frustumCulled=!1;var c=new Vector3,h=new Vector3,d=new Vector3,f=new Vector3,m=new Color(16777215),v=1;function y(o,l,y,x){if(0!==o.distanceToSquared(l)){for(var _=n.drawRange.count,M=function(e){for(var t=2*Math.PI,r=[],n=.01*e,i=0;i<10;i++){var o=i/10*t;r.push(new Vector3(Math.sin(o)*n,Math.cos(o)*n,0))}return r}(v),i=0,w=M.length;i<w;i++){var S=M[i],A=M[(i+1)%w];c.copy(S).applyMatrix4(x).add(l),h.copy(A).applyMatrix4(x).add(l),d.copy(A).applyMatrix4(y).add(o),f.copy(S).applyMatrix4(y).add(o),c.toArray(e.array,3*(_+0)),h.toArray(e.array,3*(_+1)),f.toArray(e.array,3*(_+2)),h.toArray(e.array,3*(_+3)),d.toArray(e.array,3*(_+4)),f.toArray(e.array,3*(_+5)),c.copy(S).applyMatrix4(x).normalize(),h.copy(A).applyMatrix4(x).normalize(),d.copy(A).applyMatrix4(y).normalize(),f.copy(S).applyMatrix4(y).normalize(),c.toArray(t.array,3*(_+0)),h.toArray(t.array,3*(_+1)),f.toArray(t.array,3*(_+2)),h.toArray(t.array,3*(_+3)),d.toArray(t.array,3*(_+4)),f.toArray(t.array,3*(_+5)),m.toArray(r.array,3*(_+0)),m.toArray(r.array,3*(_+1)),m.toArray(r.array,3*(_+2)),m.toArray(r.array,3*(_+3)),m.toArray(r.array,3*(_+4)),m.toArray(r.array,3*(_+5)),_+=6}n.drawRange.count=_}}var x=new Vector3(0,1,0),_=new Vector3,M=new Vector3,w=new Matrix4,S=new Matrix4;var A=0;return{mesh:l,moveTo:function(e){_.copy(e),w.lookAt(M,_,x),M.copy(e),S.copy(w)},lineTo:function(e){_.copy(e),w.lookAt(M,_,x),y(_,M,w,S),M.copy(_),S.copy(w)},setSize:function(e){v=e},update:function(){var o=A,l=n.drawRange.count;o!==l&&(e.updateRange.offset=3*o,e.updateRange.count=3*(l-o),e.needsUpdate=!0,t.updateRange.offset=3*o,t.updateRange.count=3*(l-o),t.needsUpdate=!0,r.updateRange.offset=3*o,r.updateRange.count=3*(l-o),r.needsUpdate=!0,A=n.drawRange.count)}}}TreesGeometry.prototype=Object.create(BufferGeometry.prototype);var ExplodeModifier=function(){};ExplodeModifier.prototype.modify=function(e){for(var t=[],i=0,r=e.faces.length;i<r;i++){var n=t.length,o=e.faces[i],a=o.a,b=o.b,l=o.c,c=e.vertices[a],h=e.vertices[b],d=e.vertices[l];t.push(c.clone()),t.push(h.clone()),t.push(d.clone()),o.a=n,o.b=n+1,o.c=n+2}e.vertices=t};var SimplifyModifier=function(){};!function(){var e=new Vector3,t=new Vector3;function r(e,object){var t=e.indexOf(object);t>-1&&e.splice(t,1)}function n(u,e){var i,t,r,n=e.position.distanceTo(u.position),o=0,l=[],c=u.faces.length;for(i=0;i<c;i++)(t=u.faces[i]).hasVertex(e)&&l.push(t);for(i=0;i<c;i++){var h=1;t=u.faces[i];for(var d=0;d<l.length;d++){r=l[d];var f=t.normal.dot(r.normal);h=Math.min(h,(1.001-f)/2)}o=Math.max(o,h)}return l.length<2&&(o=1),n*o+0}function o(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var i=0;i<e.neighbors.length;i++){var t=n(e,e.neighbors[i]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[i],e.collapseCost=t,e.minCost=t,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=t,t<e.minCost&&(e.collapseNeighbor=e.neighbors[i],e.minCost=t)}e.collapseCost=e.totalCost/e.costCount}function l(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function c(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,o,l=[e.v1,e.v2,e.v3],i=0;i<3;i++)o=l[(i+1)%3],(n=l[i])&&o&&(n.removeIfNonNeighbor(o),o.removeIfNonNeighbor(n))}function h(e,t,u,r){if(r){var i,n=[];for(i=0;i<u.neighbors.length;i++)n.push(u.neighbors[i]);for(i=u.faces.length-1;i>=0;i--)u.faces[i].hasVertex(r)&&c(u.faces[i],t);for(i=u.faces.length-1;i>=0;i--)u.faces[i].replaceVertex(u,r);for(l(u,e),i=0;i<n.length;i++)o(n[i])}else l(u,e)}function d(e){for(var t=e[0],i=0;i<e.length;i++)e[i].collapseCost<t.collapseCost&&(t=e[i]);return t}function f(e,t,r,a,b,n){this.a=a,this.b=b,this.c=n,this.v1=e,this.v2=t,this.v3=r,this.normal=new Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function m(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}f.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,o=this.v3.position;e.subVectors(o,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},f.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},f.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},m.prototype.addUniqueNeighbor=function(e){var t,object;t=this.neighbors,object=e,-1===t.indexOf(object)&&t.push(object)},m.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,r,n,l=e.vertices,c=e.faces,v=[],y=[];for(i=0,r=l.length;i<r;i++){var x=new m(l[i],i);v.push(x)}for(i=0,r=c.length;i<r;i++){var a=(L=c[i]).a,b=L.b,_=L.c,M=new f(v[a],v[b],v[_],a,b,_);y.push(M)}for(i=0,r=v.length;i<r;i++)o(v[i]);for(var w=t;w--;){if(!(n=d(v))){console.log("SimplifyModifier: No next vertex");break}h(v,y,n,n.collapseNeighbor)}var S=new BufferGeometry,A=[],T=[];for(i=0;i<v.length;i++){x=v[i].position;A.push(x.x,x.y,x.z)}for(i=0;i<y.length;i++){var L=y[i];a=v.indexOf(L.v1),b=v.indexOf(L.v2),_=v.indexOf(L.v3);T.push(a,b,_)}return S.setAttribute("position",new Float32BufferAttribute(A,3)),S.setIndex(T),S}}();var SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e};SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(a,b,map){return map[Math.min(a,b)+"_"+Math.max(a,b)]}function r(a,b,e,map,t,r){var n,o=Math.min(a,b),l=Math.max(a,b),c=o+"_"+l;c in map?n=map[c]:(n={a:e[o],b:e[l],newEdge:null,faces:[]},map[c]=n);n.faces.push(t),r[a].edges.push(n),r[b].edges.push(n)}function n(e,a,b,t,r){e.push(new Face3(a,b,t,void 0,void 0,r))}function o(a,b){return Math.abs(b-a)/2+Math.min(a,b)}function l(e,a,b,t){e.push([a.clone(),b.clone(),t.clone()])}SubdivisionModifier.prototype.smooth=function(c){var h,d,f,m,v,y,i,x,_,M,w,S,A,T=new Vector3,L=[];h=c.vertices,d=c.faces;var C,N,P,F,E,R,D,O,I,B,U,k,V,G,z=void 0!==(f=c.faceVertexUvs)[0]&&f[0].length>0;if(z)for(var j=0;j<f.length;j++)L.push([]);for(i in function(e,t,n,o){var i,l,c;for(i=0,l=e.length;i<l;i++)n[i]={edges:[]};for(i=0,l=t.length;i<l;i++)r((c=t[i]).a,c.b,e,o,c,n),r(c.b,c.c,e,o,c,n),r(c.c,c.a,e,o,c,n)}(h,d,M=new Array(h.length),w={}),S=[],w){for(N=w[i],P=new Vector3,E=3/8,R=1/8,2!=(D=N.faces.length)&&(E=.5,R=0),P.addVectors(N.a,N.b).multiplyScalar(E),T.set(0,0,0),j=0;j<D;j++){for(F=N.faces[j],_=0;_<3&&((C=h[F[e[_]]])===N.a||C===N.b);_++);T.add(C)}T.multiplyScalar(R),P.add(T),N.newEdge=S.length,S.push(P)}for(A=[],i=0,x=h.length;i<x;i++){for(V=h[i],3==(y=(k=M[i].edges).length)?O=3/16:y>3&&(O=3/(8*y)),I=1-y*O,B=O,y<=2&&2==y&&(I=3/4,B=1/8),G=V.clone().multiplyScalar(I),T.set(0,0,0),j=0;j<y;j++)C=(U=k[j]).a!==V?U.a:U.b,T.add(C);T.multiplyScalar(B),G.add(T),A.push(G)}m=A.concat(S);var W,H,X,Y,Q,K,J,Z=A.length;v=[];var $=new Vector2,ee=new Vector2,te=new Vector2;for(i=0,x=d.length;i<x;i++)if(n(v,W=t((F=d[i]).a,F.b,w).newEdge+Z,H=t(F.b,F.c,w).newEdge+Z,X=t(F.c,F.a,w).newEdge+Z,F.materialIndex),n(v,F.a,W,X,F.materialIndex),n(v,F.b,H,W,F.materialIndex),n(v,F.c,X,H,F.materialIndex),z)for(j=0;j<f.length;j++)Q=(Y=f[j][i])[0],K=Y[1],J=Y[2],$.set(o(Q.x,K.x),o(Q.y,K.y)),ee.set(o(K.x,J.x),o(K.y,J.y)),te.set(o(Q.x,J.x),o(Q.y,J.y)),l(L[j],$,ee,te),l(L[j],Q,$,te),l(L[j],K,ee,$),l(L[j],J,te,ee);c.vertices=m,c.faces=v,z&&(c.faceVertexUvs=L)}}();var TessellateModifier=function(e){this.maxEdgeLength=e},camera,geometry,FullScreenQuad;function Pass(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}TessellateModifier.prototype.modify=function(e){for(var t,r=[],n=[],o=this.maxEdgeLength*this.maxEdgeLength,i=0,l=e.faceVertexUvs.length;i<l;i++)n[i]=[];for(i=0,l=e.faces.length;i<l;i++){var c=e.faces[i];if(c instanceof Face3){var a=c.a,b=c.b,h=c.c,d=e.vertices[a],f=e.vertices[b],m=e.vertices[h],v=d.distanceToSquared(f),y=f.distanceToSquared(m),x=d.distanceToSquared(m);if(v>o||y>o||x>o){var _=e.vertices.length,M=c.clone(),w=c.clone();if(v>=y&&v>=x){if((S=d.clone()).lerp(f,.5),M.a=a,M.b=_,M.c=h,w.a=_,w.b=b,w.c=h,3===c.vertexNormals.length)(A=c.vertexNormals[0].clone()).lerp(c.vertexNormals[1],.5),M.vertexNormals[1].copy(A),w.vertexNormals[0].copy(A);if(3===c.vertexColors.length)(T=c.vertexColors[0].clone()).lerp(c.vertexColors[1],.5),M.vertexColors[1].copy(T),w.vertexColors[0].copy(T);t=0}else if(y>=v&&y>=x){if((S=f.clone()).lerp(m,.5),M.a=a,M.b=b,M.c=_,w.a=_,w.b=h,w.c=a,3===c.vertexNormals.length)(A=c.vertexNormals[1].clone()).lerp(c.vertexNormals[2],.5),M.vertexNormals[2].copy(A),w.vertexNormals[0].copy(A),w.vertexNormals[1].copy(c.vertexNormals[2]),w.vertexNormals[2].copy(c.vertexNormals[0]);if(3===c.vertexColors.length)(T=c.vertexColors[1].clone()).lerp(c.vertexColors[2],.5),M.vertexColors[2].copy(T),w.vertexColors[0].copy(T),w.vertexColors[1].copy(c.vertexColors[2]),w.vertexColors[2].copy(c.vertexColors[0]);t=1}else{var S,A,T;if((S=d.clone()).lerp(m,.5),M.a=a,M.b=b,M.c=_,w.a=_,w.b=b,w.c=h,3===c.vertexNormals.length)(A=c.vertexNormals[0].clone()).lerp(c.vertexNormals[2],.5),M.vertexNormals[2].copy(A),w.vertexNormals[0].copy(A);if(3===c.vertexColors.length)(T=c.vertexColors[0].clone()).lerp(c.vertexColors[2],.5),M.vertexColors[2].copy(T),w.vertexColors[0].copy(T);t=2}r.push(M,w),e.vertices.push(S);for(var L=0,C=e.faceVertexUvs.length;L<C;L++)if(e.faceVertexUvs[L].length){var N=e.faceVertexUvs[L][i],P=N[0],F=N[1],E=N[2];if(0===t){(O=P.clone()).lerp(F,.5);var R=[P.clone(),O.clone(),E.clone()],D=[O.clone(),F.clone(),E.clone()]}else if(1===t){(O=F.clone()).lerp(E,.5);R=[P.clone(),F.clone(),O.clone()],D=[O.clone(),E.clone(),P.clone()]}else{var O;(O=P.clone()).lerp(E,.5);R=[P.clone(),F.clone(),O.clone()],D=[O.clone(),F.clone(),E.clone()]}n[L].push(R,D)}}else{r.push(c);for(L=0,C=e.faceVertexUvs.length;L<C;L++)n[L].push(e.faceVertexUvs[L][i])}}}e.faces=r,e.faceVertexUvs=n},Object.assign(Pass.prototype,{setSize:function(){},render:function(){console.error("Pass: .render() must be implemented in derived pass.")}}),Pass.FullScreenQuad=(camera=new OrthographicCamera(-1,1,1,-1,0,1),geometry=new PlaneBufferGeometry(2,2),FullScreenQuad=function(e){this._mesh=new Mesh(geometry,e)},Object.defineProperty(FullScreenQuad.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(FullScreenQuad.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,camera)}}),FullScreenQuad);var ShaderPass=function(e,t){Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=UniformsUtils.clone(e.uniforms),this.material=new ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Pass.FullScreenQuad(this.material)};function NodePass(){ShaderPass.call(this),this.name="",this.uuid=MathUtils.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new ScreenNode,this.material=new NodeMaterial,this.needsUpdate=!0}function Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}ShaderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}),NodePass.prototype=Object.create(ShaderPass.prototype),NodePass.prototype.constructor=NodePass,NodePass.prototype.render=function(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,ShaderPass.prototype.render.apply(this,arguments)},NodePass.prototype.copy=function(source){return this.input=source.input,this},NodePass.prototype.toJSON=function(meta){if((void 0===meta||"string"==typeof meta)&&(meta={nodes:{}}),meta&&!meta.passes&&(meta.passes={}),!meta.passes[this.uuid]){var data={};data.uuid=this.uuid,data.type="NodePass",meta.passes[this.uuid]=data,""!==this.name&&(data.name=this.name),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),data.input=this.input.toJSON(meta).uuid}return meta.pass=this.uuid,meta},Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Fire=function(e,t){Mesh.call(this,e),this.type="Fire",this.clock=new Clock;var r=(t=t||{}).textureWidth||512,n=t.textureHeight||512,o=1/r,l=1/n,c=void 0!==t.debug&&t.debug;this.color1=t.color1||new Color(16777215),this.color2=t.color2||new Color(16752640),this.color3=t.color3||new Color(0),this.colorBias=void 0===t.colorBias?.8:t.colorBias,this.diffuse=void 0===t.diffuse?1.33:t.diffuse,this.viscosity=void 0===t.viscosity?.25:t.viscosity,this.expansion=void 0===t.expansion?-.25:t.expansion,this.swirl=void 0===t.swirl?50:t.swirl,this.burnRate=void 0===t.burnRate?.3:t.burnRate,this.drag=void 0===t.drag?.35:t.drag,this.airSpeed=void 0===t.airSpeed?6:t.airSpeed,this.windVector=t.windVector||new Vector2(0,.75),this.speed=void 0===t.speed?500:t.speed,this.massConservation=void 0!==t.massConservation&&t.massConservation;var h=r*n;this.sourceData=new Uint8Array(4*h),this.clearSources=function(){for(var e=0;e<n;e++)for(var t=0;t<r;t++){var o=4*(e*r+t);this.sourceData[o]=0,this.sourceData[o+1]=0,this.sourceData[o+2]=0,this.sourceData[o+3]=0}return this.sourceMaterial.uniforms.sourceMap.value=this.internalSource,this.sourceMaterial.needsUpdate=!0,this.sourceData},this.addSource=function(u,e,t,c,h,d){void 0===c&&(c=null),void 0===h&&(h=null),void 0===d&&(d=null);for(var f=Math.max(Math.floor((u-t)*r),0),m=Math.max(Math.floor((e-t)*n),0),v=Math.min(Math.floor((u+t)*r),r),y=Math.min(Math.floor((e+t)*n),n),x=m;x<y;x++)for(var _=f;_<v;_++){var M=_*o-u,w=x*l-e;if(M*M+w*w<t*t){var S,A=4*(x*r+_);if(null!=c&&(this.sourceData[A]=255*Math.min(Math.max(c,0),1)),null!=h)S=(S=Math.min(Math.max(h,-1),1))<0?Math.floor(127*S)+255:Math.floor(127*S),this.sourceData[A+1]=S;if(null!=d)S=(S=Math.min(Math.max(d,-1),1))<0?Math.floor(127*S)+255:Math.floor(127*S),this.sourceData[A+2]=S}}return this.internalSource.needsUpdate=!0,this.sourceData},this.setSourceMap=function(e){this.sourceMaterial.uniforms.sourceMap.value=e};var d={minFilter:NearestFilter,magFilter:NearestFilter,depthBuffer:!1,stencilBuffer:!1};this.field0=new WebGLRenderTarget(r,n,d),this.field0.background=new Color(0),this.field1=new WebGLRenderTarget(r,n,d),this.field0.background=new Color(0),this.fieldProj=new WebGLRenderTarget(r,n,d),this.field0.background=new Color(0),MathUtils.isPowerOfTwo(r)&&MathUtils.isPowerOfTwo(n)||(this.field0.texture.generateMipmaps=!1,this.field1.texture.generateMipmaps=!1,this.fieldProj.texture.generateMipmaps=!1),this.fieldScene=new Scene,this.fieldScene.background=new Color(0),this.orthoCamera=new OrthographicCamera(r/-2,r/2,n/2,n/-2,1,2),this.orthoCamera.position.z=1,this.fieldGeometry=new PlaneBufferGeometry(r,n),this.internalSource=new DataTexture(this.sourceData,r,n,RGBAFormat);var f=Fire.SourceShader;this.sourceMaterial=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.clearSources(),this.sourceMesh=new Mesh(this.fieldGeometry,this.sourceMaterial),this.fieldScene.add(this.sourceMesh);f=Fire.DiffuseShader;this.diffuseMaterial=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.diffuseMaterial.uniforms.oneOverWidth.value=o,this.diffuseMaterial.uniforms.oneOverHeight.value=l,this.diffuseMesh=new Mesh(this.fieldGeometry,this.diffuseMaterial),this.fieldScene.add(this.diffuseMesh),f=Fire.DriftShader,this.driftMaterial=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.driftMaterial.uniforms.oneOverWidth.value=o,this.driftMaterial.uniforms.oneOverHeight.value=l,this.driftMesh=new Mesh(this.fieldGeometry,this.driftMaterial),this.fieldScene.add(this.driftMesh),f=Fire.ProjectionShader1,this.projMaterial1=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.projMaterial1.uniforms.oneOverWidth.value=o,this.projMaterial1.uniforms.oneOverHeight.value=l,this.projMesh1=new Mesh(this.fieldGeometry,this.projMaterial1),this.fieldScene.add(this.projMesh1),f=Fire.ProjectionShader2,this.projMaterial2=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.projMaterial2.uniforms.oneOverWidth.value=o,this.projMaterial2.uniforms.oneOverHeight.value=l,this.projMesh2=new Mesh(this.fieldGeometry,this.projMaterial2),this.fieldScene.add(this.projMesh2),f=Fire.ProjectionShader3,this.projMaterial3=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!1}),this.projMaterial3.uniforms.oneOverWidth.value=o,this.projMaterial3.uniforms.oneOverHeight.value=l,this.projMesh3=new Mesh(this.fieldGeometry,this.projMaterial3),this.fieldScene.add(this.projMesh3),f=c?Fire.DebugShader:Fire.ColorShader,this.material=new ShaderMaterial({uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!0}),this.material.uniforms.densityMap.value=this.field1.texture,this.configShaders=function(dt){this.diffuseMaterial.uniforms.diffuse.value=.05*dt*this.diffuse,this.diffuseMaterial.uniforms.viscosity.value=.05*dt*this.viscosity,this.diffuseMaterial.uniforms.expansion.value=Math.exp(-1*this.expansion),this.diffuseMaterial.uniforms.swirl.value=Math.exp(-.1*this.swirl),this.diffuseMaterial.uniforms.drag.value=Math.exp(-.1*this.drag),this.diffuseMaterial.uniforms.burnRate.value=this.burnRate*dt*.01,this.driftMaterial.uniforms.windVector.value=this.windVector,this.driftMaterial.uniforms.airSpeed.value=dt*this.airSpeed*.001*n,this.material.uniforms.color1.value=this.color1,this.material.uniforms.color2.value=this.color2,this.material.uniforms.color3.value=this.color3,this.material.uniforms.colorBias.value=this.colorBias},this.clearDiffuse=function(){this.diffuseMaterial.uniforms.expansion.value=1,this.diffuseMaterial.uniforms.swirl.value=1,this.diffuseMaterial.uniforms.drag.value=1,this.diffuseMaterial.uniforms.burnRate.value=0},this.swapTextures=function(){var e=this.field0;this.field0=this.field1,this.field1=e},this.saveRenderState=function(e){this.savedRenderTarget=e.getRenderTarget(),this.savedXrEnabled=e.xr.enabled,this.savedShadowAutoUpdate=e.shadowMap.autoUpdate,this.savedAntialias=e.antialias,this.savedToneMapping=e.toneMapping},this.restoreRenderState=function(e){e.xr.enabled=this.savedXrEnabled,e.shadowMap.autoUpdate=this.savedShadowAutoUpdate,e.setRenderTarget(this.savedRenderTarget),e.antialias=this.savedAntialias,e.toneMapping=this.savedToneMapping},this.renderSource=function(e){this.sourceMesh.visible=!0,this.sourceMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.sourceMesh.visible=!1,this.swapTextures()},this.renderDiffuse=function(e){this.diffuseMesh.visible=!0,this.diffuseMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.diffuseMesh.visible=!1,this.swapTextures()},this.renderDrift=function(e){this.driftMesh.visible=!0,this.driftMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.driftMesh.visible=!1,this.swapTextures()},this.renderProject=function(e){this.projMesh1.visible=!0,this.projMaterial1.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.fieldProj),e.render(this.fieldScene,this.orthoCamera),this.projMesh1.visible=!1,this.projMaterial2.uniforms.densityMap.value=this.fieldProj.texture,this.projMesh2.visible=!0;for(var i=0;i<20;i++){e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera);var t=this.field1;this.field1=this.fieldProj,this.fieldProj=t,this.projMaterial2.uniforms.densityMap.value=this.fieldProj.texture}this.projMesh2.visible=!1,this.projMaterial3.uniforms.densityMap.value=this.field0.texture,this.projMaterial3.uniforms.projMap.value=this.fieldProj.texture,this.projMesh3.visible=!0,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.projMesh3.visible=!1,this.swapTextures()},this.onBeforeRender=function(e){var t=this.clock.getDelta();t>.1&&(t=.1);var dt=t*(.1*this.speed);this.configShaders(dt),this.saveRenderState(e),e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.antialias=!1,e.toneMapping=NoToneMapping,this.sourceMesh.visible=!1,this.diffuseMesh.visible=!1,this.driftMesh.visible=!1,this.projMesh1.visible=!1,this.projMesh2.visible=!1,this.projMesh3.visible=!1,this.renderSource(e),this.clearDiffuse();for(var i=0;i<21;i++)this.renderDiffuse(e);this.configShaders(dt),this.renderDiffuse(e),this.renderDrift(e),this.massConservation&&(this.renderProject(e),this.renderProject(e)),this.material.map=this.field1.texture,this.material.transparent=!0,this.material.minFilter=LinearFilter,this.material.magFilter=LinearFilter,this.restoreRenderState(e)}};Fire.prototype=Object.create(Mesh.prototype),Fire.prototype.constructor=Fire,Fire.SourceShader={uniforms:{sourceMap:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D sourceMap;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec4 source = texture2D( sourceMap, vUv );","    vec4 current = texture2D( densityMap, vUv );","    vec2 v0 = (current.gb - step(0.5, current.gb)) * 2.0;","    vec2 v1 = (source.gb - step(0.5, source.gb)) * 2.0;","    vec2 newVel = v0 + v1;","    newVel = clamp(newVel, -0.99, 0.99);","    newVel = newVel * 0.5 + step(0.0, -newVel);","    float newDensity = source.r + current.a;","    float newTemp = source.r + current.r;","    newDensity = clamp(newDensity, 0.0, 1.0);","    newTemp = clamp(newTemp, 0.0, 1.0);","    gl_FragColor = vec4(newTemp, newVel.xy, newDensity);","}"].join("\n")},Fire.DiffuseShader={uniforms:{oneOverWidth:{value:null},oneOverHeight:{value:null},diffuse:{value:null},viscosity:{value:null},expansion:{value:null},swirl:{value:null},drag:{value:null},burnRate:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform float diffuse;","uniform float viscosity;","uniform float expansion;","uniform float swirl;","uniform float burnRate;","uniform float drag;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec4 dC = texture2D( densityMap, vUv );","    vec4 dL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) );","    vec4 dR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) );","    vec4 dU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) );","    vec4 dD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) );","    vec4 dUL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y - oneOverHeight) );","    vec4 dUR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y - oneOverHeight) );","    vec4 dDL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y + oneOverHeight) );","    vec4 dDR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y + oneOverHeight) );","    dC.yz = (dC.yz - step(0.5, dC.yz)) * 2.0;","    dL.yz = (dL.yz - step(0.5, dL.yz)) * 2.0;","    dR.yz = (dR.yz - step(0.5, dR.yz)) * 2.0;","    dU.yz = (dU.yz - step(0.5, dU.yz)) * 2.0;","    dD.yz = (dD.yz - step(0.5, dD.yz)) * 2.0;","    dUL.yz = (dUL.yz - step(0.5, dUL.yz)) * 2.0;","    dUR.yz = (dUR.yz - step(0.5, dUR.yz)) * 2.0;","    dDL.yz = (dDL.yz - step(0.5, dDL.yz)) * 2.0;","    dDR.yz = (dDR.yz - step(0.5, dDR.yz)) * 2.0;","    vec4 result = (dC + vec4(diffuse, viscosity, viscosity, diffuse) * ( dL + dR + dU + dD + dUL + dUR + dDL + dDR )) / (1.0 + 8.0 * vec4(diffuse, viscosity, viscosity, diffuse)) - vec4(0.0, 0.0, 0.0, 0.001);","    float temperature = result.r;","    temperature = clamp(temperature - burnRate, 0.0, 1.0);","    vec2 velocity = result.yz;","    vec2 expansionVec = vec2(dL.w - dR.w, dU.w - dD.w);","    vec2 swirlVec = vec2((dL.z - dR.z) * 0.5, (dU.y - dD.y) * 0.5);","    velocity = velocity + (1.0 - expansion) * expansionVec + (1.0 - swirl) * swirlVec;","    velocity = velocity - (1.0 - drag) * velocity;","    gl_FragColor = vec4(temperature, velocity * 0.5 + step(0.0, -velocity), result.w);","    gl_FragColor = gl_FragColor * step(oneOverWidth, vUv.x);","    gl_FragColor = gl_FragColor * step(oneOverHeight, vUv.y);","    gl_FragColor = gl_FragColor * step(vUv.x, 1.0 - oneOverWidth);","    gl_FragColor = gl_FragColor * step(vUv.y, 1.0 - oneOverHeight);","}"].join("\n")},Fire.DriftShader={uniforms:{oneOverWidth:{value:null},oneOverHeight:{value:null},windVector:{value:new Vector2(0,0)},airSpeed:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform vec2 windVector;","uniform float airSpeed;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec2 velocity = texture2D( densityMap, vUv ).gb;","    velocity = (velocity - step(0.5, velocity)) * 2.0;","    velocity = velocity + windVector;","    vec2 sourcePos = vUv - airSpeed * vec2(oneOverWidth, oneOverHeight) * velocity;","    vec2 units = sourcePos / vec2(oneOverWidth, oneOverHeight);","    vec2 intPos = floor(units);","    vec2 frac = units - intPos;","    intPos = intPos * vec2(oneOverWidth, oneOverHeight);","    vec4 dX0Y0 = texture2D( densityMap, intPos + vec2(0.0, -oneOverHeight) );","    vec4 dX1Y0 = texture2D( densityMap, intPos + vec2(oneOverWidth, 0.0) );","    vec4 dX0Y1 = texture2D( densityMap, intPos + vec2(0.0, oneOverHeight) );","    vec4 dX1Y1 = texture2D( densityMap, intPos + vec2(oneOverWidth, oneOverHeight) );","    dX0Y0.gb = (dX0Y0.gb - step(0.5, dX0Y0.gb)) * 2.0;","    dX1Y0.gb = (dX1Y0.gb - step(0.5, dX1Y0.gb)) * 2.0;","    dX0Y1.gb = (dX0Y1.gb - step(0.5, dX0Y1.gb)) * 2.0;","    dX1Y1.gb = (dX1Y1.gb - step(0.5, dX1Y1.gb)) * 2.0;","    vec4 source = mix(mix(dX0Y0, dX1Y0, frac.x), mix(dX0Y1, dX1Y1, frac.x), frac.y);","    source.gb = source.gb * 0.5 + step(0.0, -source.gb);","    gl_FragColor = source;","}"].join("\n")},Fire.ProjectionShader1={uniforms:{oneOverWidth:{value:null},oneOverHeight:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float dL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float dR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float dU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) ).b;","    float dD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) ).b;","    dL = (dL - step(0.5, dL)) * 2.0;","    dR = (dR - step(0.5, dR)) * 2.0;","    dU = (dU - step(0.5, dU)) * 2.0;","    dD = (dD - step(0.5, dD)) * 2.0;","    float h = (oneOverWidth + oneOverHeight) * 0.5;","    float div = -0.5 * h * (dR - dL + dD - dU);","    gl_FragColor = vec4( 0.0, 0.0, div * 0.5 + step(0.0, -div), 0.0);","}"].join("\n")},Fire.ProjectionShader2={uniforms:{oneOverWidth:{value:null},oneOverHeight:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float div = texture2D( densityMap, vUv ).b;","    float pL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float pR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float pU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) ).g;","    float pD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) ).g;","    float divNorm = (div - step(0.5, div)) * 2.0;","    pL = (pL - step(0.5, pL)) * 2.0;","    pR = (pR - step(0.5, pR)) * 2.0;","    pU = (pU - step(0.5, pU)) * 2.0;","    pD = (pD - step(0.5, pD)) * 2.0;","    float p = (divNorm + pR + pL + pD + pU) * 0.25;","    gl_FragColor = vec4( 0.0, p * 0.5 + step(0.0, -p), div, 0.0);","}"].join("\n")},Fire.ProjectionShader3={uniforms:{oneOverWidth:{value:null},oneOverHeight:{value:null},densityMap:{value:null},projMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","uniform sampler2D projMap;","varying vec2 vUv;","void main() {","    vec4 orig = texture2D(densityMap, vUv);","    float pL = texture2D( projMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float pR = texture2D( projMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float pU = texture2D( projMap, vec2(vUv.x, vUv.y - oneOverHeight) ).g;","    float pD = texture2D( projMap, vec2(vUv.x, vUv.y + oneOverHeight) ).g;","    float uNorm = (orig.g - step(0.5, orig.g)) * 2.0;","    float vNorm = (orig.b - step(0.5, orig.b)) * 2.0;","    pL = (pL - step(0.5, pL)) * 2.0;","    pR = (pR - step(0.5, pR)) * 2.0;","    pU = (pU - step(0.5, pU)) * 2.0;","    pD = (pD - step(0.5, pD)) * 2.0;","    float h = (oneOverWidth + oneOverHeight) * 0.5;","    float u = uNorm - (0.5 * (pR - pL) / h);","    float v = vNorm - (0.5 * (pD - pU) / h);","    gl_FragColor = vec4( orig.r, u * 0.5 + step(0.0, -u), v * 0.5 + step(0.0, -v), orig.a);","}"].join("\n")},Fire.ColorShader={uniforms:{color1:{value:null},color2:{value:null},color3:{value:null},colorBias:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color1;","uniform vec3 color2;","uniform vec3 color3;","uniform float colorBias;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float density = texture2D( densityMap, vUv ).a;","    float temperature = texture2D( densityMap, vUv ).r;","    float bias = clamp(colorBias, 0.0001, 0.9999);","    vec3 blend1 = mix(color3, color2, temperature / bias) * (1.0 - step(bias, temperature));","    vec3 blend2 = mix(color2, color1, (temperature - bias) / (1.0 - bias) ) * step(bias, temperature);","    gl_FragColor = vec4(blend1 + blend2, density);","}"].join("\n")},Fire.DebugShader={uniforms:{color1:{value:null},color2:{value:null},color3:{value:null},colorBias:{value:null},densityMap:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float density;","    density = texture2D( densityMap, vUv ).a;","    vec2 vel = texture2D( densityMap, vUv ).gb;","    vel = (vel - step(0.5, vel)) * 2.0;","    float r = density;","    float g = max(abs(vel.x), density * 0.5);","    float b = max(abs(vel.y), density * 0.5);","    float a = max(density * 0.5, max(abs(vel.x), abs(vel.y)));","    gl_FragColor = vec4(r, g, b, a);","}"].join("\n")};var _vector$7=new Vector2;function Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}Object.assign(Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var i=0,t=e.length;i<t;i++)this.expandByPoint(e[i]);return this},setFromCenterAndSize:function(e,t){var r=_vector$7.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return _vector$7.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Lensflare=function(){Mesh.call(this,Lensflare.Geometry,new MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new Vector3,t=new Vector3,r=new DataTexture(new Uint8Array(768),16,16,RGBFormat);r.minFilter=NearestFilter,r.magFilter=NearestFilter,r.wrapS=ClampToEdgeWrapping,r.wrapT=ClampToEdgeWrapping;var n=new DataTexture(new Uint8Array(768),16,16,RGBFormat);n.minFilter=NearestFilter,n.magFilter=NearestFilter,n.wrapS=ClampToEdgeWrapping,n.wrapT=ClampToEdgeWrapping;var o=Lensflare.Geometry,l=new RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),c=new RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),h=new Mesh(o,l),d=[],f=LensflareElement.Shader,m=new RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new Color(16777215)},scale:{value:new Vector2},screenPosition:{value:new Vector3}},vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:AdditiveBlending,transparent:!0,depthWrite:!1}),v=new Mesh(o,m);this.addElement=function(element){d.push(element)};var y=new Vector2,x=new Vector2,_=new Box2,M=new Vector4;this.onBeforeRender=function(f,w,S){f.getCurrentViewport(M);var A=M.w/M.z,T=M.z/2,L=M.w/2,C=16/M.w;if(y.set(C*A,C),_.min.set(M.x,M.y),_.max.set(M.x+(M.z-16),M.y+(M.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(S.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(S.projectionMatrix),x.x=M.x+e.x*T+T-8,x.y=M.y+e.y*L+L-8,_.containsPoint(x))){f.copyFramebufferToTexture(x,r),(E=l.uniforms).scale.value=y,E.screenPosition.value=e,f.renderBufferDirect(S,null,o,l,h,null),f.copyFramebufferToTexture(x,n),(E=c.uniforms).scale.value=y,E.screenPosition.value=e,f.renderBufferDirect(S,null,o,c,h,null);for(var N=2*-e.x,P=2*-e.y,i=0,F=d.length;i<F;i++){var E,element=d[i];(E=m.uniforms).color.value.copy(element.color),E.map.value=element.texture,E.screenPosition.value.x=e.x+N*element.distance,E.screenPosition.value.y=e.y+P*element.distance;C=element.size/M.w,A=M.w/M.z;E.scale.value.set(C*A,C),m.uniformsNeedUpdate=!0,f.renderBufferDirect(S,null,o,m,v,null)}}},this.dispose=function(){l.dispose(),c.dispose(),m.dispose(),r.dispose(),n.dispose();for(var i=0,e=d.length;i<e;i++)d[i].texture.dispose()}};Lensflare.prototype=Object.create(Mesh.prototype),Lensflare.prototype.constructor=Lensflare,Lensflare.prototype.isLensflare=!0;var LensflareElement=function(e,t,r,n){this.texture=e,this.size=t||1,this.distance=r||0,this.color=n||new Color(16777215)};LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Lensflare.Geometry=function(){var e=new BufferGeometry,t=new InterleavedBuffer(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);return e.setIndex([0,1,2,0,2,3]),e.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),e.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1)),e}();var LightningStorm=function(e){Object3D.call(this),e=e||{},this.stormParams=e,e.size=void 0!==e.size?e.size:1e3,e.minHeight=void 0!==e.minHeight?e.minHeight:80,e.maxHeight=void 0!==e.maxHeight?e.maxHeight:100,e.maxSlope=void 0!==e.maxSlope?e.maxSlope:1.1,e.maxLightnings=void 0!==e.maxLightnings?e.maxLightnings:3,e.lightningMinPeriod=void 0!==e.lightningMinPeriod?e.lightningMinPeriod:3,e.lightningMaxPeriod=void 0!==e.lightningMaxPeriod?e.lightningMaxPeriod:7,e.lightningMinDuration=void 0!==e.lightningMinDuration?e.lightningMinDuration:1,e.lightningMaxDuration=void 0!==e.lightningMaxDuration?e.lightningMaxDuration:2.5,this.lightningParameters=LightningStrike.copyParameters(e.lightningParameters,e.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==e.lightningMaterial?e.lightningMaterial:new MeshBasicMaterial({color:11599871}),void 0!==e.onRayPosition?this.onRayPosition=e.onRayPosition:this.onRayPosition=function(source,t){t.set((Math.random()-.5)*e.size,0,(Math.random()-.5)*e.size);var r=MathUtils.lerp(e.minHeight,e.maxHeight,Math.random());source.set(e.maxSlope*(2*Math.random()-1),1,e.maxSlope*(2*Math.random()-1)).multiplyScalar(r).add(t)},this.onLightningDown=e.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(var i=0;i<this.stormParams.maxLightnings;i++){var t=new Mesh(new LightningStrike(LightningStrike.copyParameters({},this.lightningParameters)),this.lightningMaterial);this.deadLightningsMeshes.push(t)}};function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){}}LightningStorm.prototype=Object.create(Object3D.prototype),LightningStorm.prototype.constructor=LightningStorm,LightningStorm.prototype.isLightningStorm=!0,LightningStorm.prototype.update=function(time){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(time)*Math.random(),this.inited=!0),time>=this.nextLightningTime){var e=this.deadLightningsMeshes.pop();if(e){var t=LightningStrike.copyParameters(e.geometry.rayParameters,this.lightningParameters);t.birthTime=time,t.deathTime=time+MathUtils.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(t.sourceOffset,t.destOffset),t.noiseSeed=Math.random(),this.add(e),this.lightningsMeshes.push(e)}this.nextLightningTime=this.getNextLightningTime(time)}for(var i=0,r=this.lightningsMeshes.length;i<r;){var n=this.lightningsMeshes[i],o=n.geometry,l=o.state;o.update(time),l===LightningStrike.RAY_PROPAGATING&&o.state>l&&this.onLightningDown&&this.onLightningDown(o),o.state===LightningStrike.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(n),1),this.deadLightningsMeshes.push(n),this.remove(n),r--):i++}},LightningStorm.prototype.getNextLightningTime=function(e){return e+MathUtils.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)},LightningStorm.prototype.copy=function(source){return Object3D.prototype.copy.call(this,source),this.stormParams.size=source.stormParams.size,this.stormParams.minHeight=source.stormParams.minHeight,this.stormParams.maxHeight=source.stormParams.maxHeight,this.stormParams.maxSlope=source.stormParams.maxSlope,this.stormParams.maxLightnings=source.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=source.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=source.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=source.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=source.stormParams.lightningMaxDuration,this.lightningParameters=LightningStrike.copyParameters({},source.lightningParameters),this.lightningMaterial=source.stormParams.lightningMaterial,this.onLightningDown=source.onLightningDown,this},LightningStrike.prototype.clone=function(){return new this.constructor(this.stormParams).copy(this)},ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var MarchingCubes=function(e,t,r,n){ImmediateRenderObject.call(this,t);var o=this,l=new Float32Array(36),c=new Float32Array(36),h=new Float32Array(36);function d(a,b,e){return a+(b-a)*e}function f(q,e,t,r,n,f,m,v,y,x){var _=(t-m)/(v-m),M=o.normal_cache;l[e+0]=r+_*o.delta,l[e+1]=n,l[e+2]=f,c[e+0]=d(M[q+0],M[q+3],_),c[e+1]=d(M[q+1],M[q+4],_),c[e+2]=d(M[q+2],M[q+5],_),h[e+0]=d(o.palette[3*y+0],o.palette[3*x+0],_),h[e+1]=d(o.palette[3*y+1],o.palette[3*x+1],_),h[e+2]=d(o.palette[3*y+2],o.palette[3*x+2],_)}function m(q,e,t,r,n,f,m,v,y,x){var _=(t-m)/(v-m),M=o.normal_cache;l[e+0]=r,l[e+1]=n+_*o.delta,l[e+2]=f;var w=q+3*o.yd;c[e+0]=d(M[q+0],M[w+0],_),c[e+1]=d(M[q+1],M[w+1],_),c[e+2]=d(M[q+2],M[w+2],_),h[e+0]=d(o.palette[3*y+0],o.palette[3*x+0],_),h[e+1]=d(o.palette[3*y+1],o.palette[3*x+1],_),h[e+2]=d(o.palette[3*y+2],o.palette[3*x+2],_)}function v(q,e,t,r,n,f,m,v,y,x){var _=(t-m)/(v-m),M=o.normal_cache;l[e+0]=r,l[e+1]=n,l[e+2]=f+_*o.delta;var w=q+3*o.zd;c[e+0]=d(M[q+0],M[w+0],_),c[e+1]=d(M[q+1],M[w+1],_),c[e+2]=d(M[q+2],M[w+2],_),h[e+0]=d(o.palette[3*y+0],o.palette[3*x+0],_),h[e+1]=d(o.palette[3*y+1],o.palette[3*x+1],_),h[e+2]=d(o.palette[3*y+2],o.palette[3*x+2],_)}function y(q){var e=3*q;0===o.normal_cache[e]&&(o.normal_cache[e+0]=o.field[q-1]-o.field[q+1],o.normal_cache[e+1]=o.field[q-o.yd]-o.field[q+o.yd],o.normal_cache[e+2]=o.field[q-o.zd]-o.field[q+o.zd])}function x(e,t,r,q,n,d){var x=q+1,M=q+o.yd,w=q+o.zd,S=x+o.yd,A=x+o.zd,T=q+o.yd+o.zd,L=x+o.yd+o.zd,C=0,N=o.field[q],P=o.field[x],F=o.field[M],E=o.field[S],R=o.field[w],D=o.field[A],O=o.field[T],I=o.field[L];N<n&&(C|=1),P<n&&(C|=2),F<n&&(C|=8),E<n&&(C|=4),R<n&&(C|=16),D<n&&(C|=32),O<n&&(C|=128),I<n&&(C|=64);var B=edgeTable[C];if(0===B)return 0;var U=o.delta,k=e+U,V=t+U,G=r+U;1&B&&(y(q),y(x),f(3*q,0,n,e,t,r,N,P,q,x)),2&B&&(y(x),y(S),m(3*x,3,n,k,t,r,P,E,x,S)),4&B&&(y(M),y(S),f(3*M,6,n,e,V,r,F,E,M,S)),8&B&&(y(q),y(M),m(3*q,9,n,e,t,r,N,F,q,M)),16&B&&(y(w),y(A),f(3*w,12,n,e,t,G,R,D,w,A)),32&B&&(y(A),y(L),m(3*A,15,n,k,t,G,D,I,A,L)),64&B&&(y(T),y(L),f(3*T,18,n,e,V,G,O,I,T,L)),128&B&&(y(w),y(T),m(3*w,21,n,e,t,G,R,O,w,T)),256&B&&(y(q),y(w),v(3*q,24,n,e,t,r,N,R,q,w)),512&B&&(y(x),y(A),v(3*x,27,n,k,t,r,P,D,x,A)),1024&B&&(y(S),y(L),v(3*S,30,n,k,V,r,E,I,S,L)),2048&B&&(y(M),y(T),v(3*M,33,n,e,V,r,F,O,M,T)),C<<=4;for(var z,j,W,H=0,i=0;-1!=triTable[C+i];)j=(z=C+i)+1,W=z+2,_(l,c,h,3*triTable[z],3*triTable[j],3*triTable[W],d),i+=3,H++;return H}function _(e,t,r,n,l,c,h){var d=3*o.count;if(o.positionArray[d+0]=e[n],o.positionArray[d+1]=e[n+1],o.positionArray[d+2]=e[n+2],o.positionArray[d+3]=e[l],o.positionArray[d+4]=e[l+1],o.positionArray[d+5]=e[l+2],o.positionArray[d+6]=e[c],o.positionArray[d+7]=e[c+1],o.positionArray[d+8]=e[c+2],!0===o.material.flatShading){var f=(t[n+0]+t[l+0]+t[c+0])/3,m=(t[n+1]+t[l+1]+t[c+1])/3,v=(t[n+2]+t[l+2]+t[c+2])/3;o.normalArray[d+0]=f,o.normalArray[d+1]=m,o.normalArray[d+2]=v,o.normalArray[d+3]=f,o.normalArray[d+4]=m,o.normalArray[d+5]=v,o.normalArray[d+6]=f,o.normalArray[d+7]=m,o.normalArray[d+8]=v}else o.normalArray[d+0]=t[n+0],o.normalArray[d+1]=t[n+1],o.normalArray[d+2]=t[n+2],o.normalArray[d+3]=t[l+0],o.normalArray[d+4]=t[l+1],o.normalArray[d+5]=t[l+2],o.normalArray[d+6]=t[c+0],o.normalArray[d+7]=t[c+1],o.normalArray[d+8]=t[c+2];if(o.enableUvs){var y=2*o.count;o.uvArray[y+0]=e[n+0],o.uvArray[y+1]=e[n+2],o.uvArray[y+2]=e[l+0],o.uvArray[y+3]=e[l+2],o.uvArray[y+4]=e[c+0],o.uvArray[y+5]=e[c+2]}o.enableColors&&(o.colorArray[d+0]=r[n+0],o.colorArray[d+1]=r[n+1],o.colorArray[d+2]=r[n+2],o.colorArray[d+3]=r[l+0],o.colorArray[d+4]=r[l+1],o.colorArray[d+5]=r[l+2],o.colorArray[d+6]=r[c+0],o.colorArray[d+7]=r[c+1],o.colorArray[d+8]=r[c+2]),o.count+=3,o.count>=o.maxCount-3&&(o.hasPositions=!0,o.hasNormals=!0,o.enableUvs&&(o.hasUvs=!0),o.enableColors&&(o.hasColors=!0),h(o))}function M(a,b,e){var t=new Float32Array(a.length+e);return t.set(a,0),t.set(b.slice(0,e),a.length),t}this.enableUvs=void 0!==r&&r,this.enableColors=void 0!==n&&n,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(e){if(0!==this.count){for(var i=3*this.count;i<this.positionArray.length;i++)this.positionArray[i]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&this.material.map&&(this.hasUvs=!0),this.enableColors&&this.material.vertexColors!==NoColors&&(this.hasColors=!0),e(this)}},this.addBall=function(e,t,r,n,o,l){var c=Math.sign(n);n=Math.abs(n);var h=!(null==l),d=new Color(e,t,r);if(h)try{d=l instanceof Color?l:Array.isArray(l)?new Color(Math.min(Math.abs(l[0]),1),Math.min(Math.abs(l[1]),1),Math.min(Math.abs(l[2]),1)):new Color(l)}catch(n){d=new Color(e,t,r)}var f=this.size*Math.sqrt(n/o),m=r*this.size,v=t*this.size,y=e*this.size,x=Math.floor(m-f);x<1&&(x=1);var _=Math.floor(m+f);_>this.size-1&&(_=this.size-1);var M=Math.floor(v-f);M<1&&(M=1);var w=Math.floor(v+f);w>this.size-1&&(w=this.size-1);var S=Math.floor(y-f);S<1&&(S=1);var A,T,L,C,N,P,F,E,R,D,O,I=Math.floor(y+f);for(I>this.size-1&&(I=this.size-1),L=x;L<_;L++)for(N=this.size2*L,R=(E=L/this.size-r)*E,T=M;T<w;T++)for(C=N+this.size*T,D=(F=T/this.size-t)*F,A=S;A<I;A++)if((O=n/(1e-6+(P=A/this.size-e)*P+D+R)-o)>0){this.field[C+A]+=O*c;var B=Math.sqrt((A-y)*(A-y)+(T-v)*(T-v)+(L-m)*(L-m))/f,U=1-B*B*B*(B*(6*B-15)+10);this.palette[3*(C+A)+0]+=d.r*U,this.palette[3*(C+A)+1]+=d.g*U,this.palette[3*(C+A)+2]+=d.b*U}},this.addPlaneX=function(e,t){var r,n,o,l,c,h,d=this.size,f=this.yd,m=this.zd,v=this.field,y=d*Math.sqrt(e/t);for(y>d&&(y=d),r=0;r<y;r++)if((l=e/(1e-4+(c=r/d)*c)-t)>0)for(n=0;n<d;n++)for(h=r+n*f,o=0;o<d;o++)v[m*o+h]+=l},this.addPlaneY=function(e,t){var r,n,o,l,c,h,d,f=this.size,m=this.yd,v=this.zd,y=this.field,x=f*Math.sqrt(e/t);for(x>f&&(x=f),n=0;n<x;n++)if((l=e/(1e-4+(c=n/f)*c)-t)>0)for(h=n*m,r=0;r<f;r++)for(d=h+r,o=0;o<f;o++)y[v*o+d]+=l},this.addPlaneZ=function(e,t){var r,n,o,l,c,h,d,f=this.size,m=this.yd,v=this.zd,y=this.field,x=f*Math.sqrt(e/t);for(x>f&&(x=f),o=0;o<x;o++)if((l=e/(1e-4+(c=o/f)*c)-t)>0)for(h=v*o,n=0;n<f;n++)for(d=h+n*m,r=0;r<f;r++)y[d+r]+=l},this.setCell=function(e,t,r,n){var o=this.size2*r+this.size*t+e;this.field[o]=n},this.getCell=function(e,t,r){var n=this.size2*r+this.size*t+e;return this.field[n]},this.blur=function(e){void 0===e&&(e=1);for(var t=this.field,r=t.slice(),n=this.size,o=this.size2,l=0;l<n;l++)for(var c=0;c<n;c++)for(var h=0;h<n;h++){for(var d=o*h+n*c+l,f=r[d],m=1,v=-1;v<=1;v+=2){var y=v+l;if(!(y<0||y>=n))for(var x=-1;x<=1;x+=2){var _=x+c;if(!(_<0||_>=n))for(var M=-1;M<=1;M+=2){var w=M+h;if(!(w<0||w>=n))f+=e*(r[o*w+n*_+y]-f)/++m}}}t[d]=f}},this.reset=function(){var i;for(i=0;i<this.size3;i++)this.normal_cache[3*i]=0,this.field[i]=0,this.palette[3*i]=this.palette[3*i+1]=this.palette[3*i+2]=0},this.render=function(e){this.begin();for(var t=this.size-2,r=1;r<t;r++)for(var n=this.size2*r,o=(r-this.halfsize)/this.halfsize,l=1;l<t;l++)for(var c=n+this.size*l,h=(l-this.halfsize)/this.halfsize,d=1;d<t;d++){x((d-this.halfsize)/this.halfsize,h,o,c+d,this.isolation,e)}this.end(e)},this.generateGeometry=function(){return console.warn("MarchingCubes: generateGeometry() now returns BufferGeometry"),this.generateBufferGeometry()},this.generateBufferGeometry=function(){var e=new BufferGeometry,t=new Float32Array,r=new Float32Array,n=new Float32Array,o=new Float32Array,l=this;return this.render((function(object){l.hasPositions&&(t=M(t,object.positionArray,3*object.count)),l.hasNormals&&(r=M(r,object.normalArray,3*object.count)),l.hasColors&&(n=M(n,object.colorArray,3*object.count)),l.hasUvs&&(o=M(o,object.uvArray,2*object.count)),object.count=0})),this.hasPositions&&e.setAttribute("position",new BufferAttribute(t,3)),this.hasNormals&&e.setAttribute("normal",new BufferAttribute(r,3)),this.hasColors&&e.setAttribute("color",new BufferAttribute(n,3)),this.hasUvs&&e.setAttribute("uv",new BufferAttribute(o,2)),e},this.init(e)};MarchingCubes.prototype=Object.create(ImmediateRenderObject.prototype),MarchingCubes.prototype.constructor=MarchingCubes;var edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),Reflector=function(e,t){Mesh.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new Color(t.color):new Color(8355711),o=t.textureWidth||512,l=t.textureHeight||512,c=t.clipBias||0,h=t.shader||Reflector.ReflectorShader,d=void 0!==t.recursion?t.recursion:0,f=new Plane,m=new Vector3,v=new Vector3,y=new Vector3,x=new Matrix4,_=new Vector3(0,0,-1),M=new Vector4,view=new Vector3,w=new Vector3,q=new Vector4,S=new Matrix4,A=new PerspectiveCamera,T=new WebGLRenderTarget(o,l,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});MathUtils.isPowerOfTwo(o)&&MathUtils.isPowerOfTwo(l)||(T.texture.generateMipmaps=!1);var L=new ShaderMaterial({uniforms:UniformsUtils.clone(h.uniforms),fragmentShader:h.fragmentShader,vertexShader:h.vertexShader});L.uniforms.tDiffuse.value=T.texture,L.uniforms.color.value=n,L.uniforms.textureMatrix.value=S,this.material=L,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===d)return;n.userData.recursion++}if(v.setFromMatrixPosition(r.matrixWorld),y.setFromMatrixPosition(n.matrixWorld),x.extractRotation(r.matrixWorld),m.set(0,0,1),m.applyMatrix4(x),view.subVectors(v,y),!(view.dot(m)>0)){view.reflect(m).negate(),view.add(v),x.extractRotation(n.matrixWorld),_.set(0,0,-1),_.applyMatrix4(x),_.add(y),w.subVectors(v,_),w.reflect(m).negate(),w.add(v),A.position.copy(view),A.up.set(0,1,0),A.up.applyMatrix4(x),A.up.reflect(m),A.lookAt(w),A.far=n.far,A.updateMatrixWorld(),A.projectionMatrix.copy(n.projectionMatrix),A.userData.recursion=0,S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(A.projectionMatrix),S.multiply(A.matrixWorldInverse),S.multiply(r.matrixWorld),f.setFromNormalAndCoplanarPoint(m,v),f.applyMatrix4(A.matrixWorldInverse),M.set(f.normal.x,f.normal.y,f.normal.z,f.constant);var o=A.projectionMatrix;q.x=(Math.sign(M.x)+o.elements[8])/o.elements[0],q.y=(Math.sign(M.y)+o.elements[9])/o.elements[5],q.z=-1,q.w=(1+o.elements[10])/o.elements[14],M.multiplyScalar(2/M.dot(q)),o.elements[2]=M.x,o.elements[6]=M.y,o.elements[10]=M.z+1-c,o.elements[14]=M.w,r.visible=!1;var l=e.getRenderTarget(),h=e.xr.enabled,L=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(T),e.clear(),e.render(t,A),e.xr.enabled=h,e.shadowMap.autoUpdate=L,e.setRenderTarget(l);var C=n.viewport;void 0!==C&&e.state.viewport(C),r.visible=!0}},this.getRenderTarget=function(){return T}};Reflector.prototype=Object.create(Mesh.prototype),Reflector.prototype.constructor=Reflector,Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var ReflectorRTT=function(e,t){Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)};ReflectorRTT.prototype=Object.create(Reflector.prototype);var Refractor=function(e,t){Mesh.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new Color(t.color):new Color(8355711),o=t.textureWidth||512,l=t.textureHeight||512,c=t.clipBias||0,h=t.shader||Refractor.RefractorShader,d=new PerspectiveCamera;d.matrixAutoUpdate=!1,d.userData.refractor=!0;var f=new Plane,m=new Matrix4,v=new WebGLRenderTarget(o,l,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});MathUtils.isPowerOfTwo(o)&&MathUtils.isPowerOfTwo(l)||(v.texture.generateMipmaps=!1),this.material=new ShaderMaterial({uniforms:UniformsUtils.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=v.texture,this.material.uniforms.textureMatrix.value=m;var y,x,_,view,M,w,S,q,A=(y=new Vector3,x=new Vector3,_=new Matrix4,view=new Vector3,M=new Vector3,function(e){return y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(e.matrixWorld),view.subVectors(y,x),_.extractRotation(r.matrixWorld),M.set(0,0,1),M.applyMatrix4(_),view.dot(M)<0}),T=function(){var e=new Vector3,t=new Vector3,n=new Quaternion,o=new Vector3;return function(){r.matrixWorld.decompose(t,n,o),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),f.setFromNormalAndCoplanarPoint(e,t)}}(),L=(w=new Plane,S=new Vector4,q=new Vector4,function(e){d.matrixWorld.copy(e.matrixWorld),d.matrixWorldInverse.getInverse(d.matrixWorld),d.projectionMatrix.copy(e.projectionMatrix),d.far=e.far,w.copy(f),w.applyMatrix4(d.matrixWorldInverse),S.set(w.normal.x,w.normal.y,w.normal.z,w.constant);var t=d.projectionMatrix;q.x=(Math.sign(S.x)+t.elements[8])/t.elements[0],q.y=(Math.sign(S.y)+t.elements[9])/t.elements[5],q.z=-1,q.w=(1+t.elements[10])/t.elements[14],S.multiplyScalar(2/S.dot(q)),t.elements[2]=S.x,t.elements[6]=S.y,t.elements[10]=S.z+1-c,t.elements[14]=S.w});this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&!0!=!A(n)&&(T(),function(e){m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(e.projectionMatrix),m.multiply(e.matrixWorldInverse),m.multiply(r.matrixWorld)}(n),L(n),function(e,t,n){r.visible=!1;var o=e.getRenderTarget(),l=e.xr.enabled,c=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(v),e.clear(),e.render(t,d),e.xr.enabled=l,e.shadowMap.autoUpdate=c,e.setRenderTarget(o);var h=n.viewport;void 0!==h&&e.state.viewport(h),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return v}};Refractor.prototype=Object.create(Mesh.prototype),Refractor.prototype.constructor=Refractor,Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var ShadowMesh=function(e){var t=new MeshBasicMaterial({color:0,transparent:!0,opacity:.6,depthWrite:!1});Mesh.call(this,e.geometry,t),this.meshMatrix=e.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1},shadowMatrix;ShadowMesh.prototype=Object.create(Mesh.prototype),ShadowMesh.prototype.constructor=ShadowMesh,ShadowMesh.prototype.update=(shadowMatrix=new Matrix4,function(e,t){var r=e.normal.x*t.x+e.normal.y*t.y+e.normal.z*t.z+-e.constant*t.w,n=shadowMatrix.elements;n[0]=r-t.x*e.normal.x,n[4]=-t.x*e.normal.y,n[8]=-t.x*e.normal.z,n[12]=-t.x*-e.constant,n[1]=-t.y*e.normal.x,n[5]=r-t.y*e.normal.y,n[9]=-t.y*e.normal.z,n[13]=-t.y*-e.constant,n[2]=-t.z*e.normal.x,n[6]=-t.z*e.normal.y,n[10]=r-t.z*e.normal.z,n[14]=-t.z*-e.constant,n[3]=-t.w*e.normal.x,n[7]=-t.w*e.normal.y,n[11]=-t.w*e.normal.z,n[15]=r-t.w*-e.constant,this.matrix.multiplyMatrices(shadowMatrix,this.meshMatrix)});var Sky=function(){var e=Sky.SkyShader,t=new ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:UniformsUtils.clone(e.uniforms),side:BackSide});Mesh.call(this,new BoxBufferGeometry(1,1,1),t)};Sky.prototype=Object.create(Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Vector3},up:{value:new Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Water=function(e,t){Mesh.call(this,e);var r=this,n=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,o=void 0!==t.textureHeight?t.textureHeight:512,l=void 0!==t.clipBias?t.clipBias:0,c=void 0!==t.alpha?t.alpha:1,time=void 0!==t.time?t.time:0,h=void 0!==t.waterNormals?t.waterNormals:null,d=void 0!==t.sunDirection?t.sunDirection:new Vector3(.70707,.70707,0),f=new Color(void 0!==t.sunColor?t.sunColor:16777215),m=new Color(void 0!==t.waterColor?t.waterColor:8355711),v=void 0!==t.eye?t.eye:new Vector3(0,0,0),y=void 0!==t.distortionScale?t.distortionScale:20,x=void 0!==t.side?t.side:FrontSide,_=void 0!==t.fog&&t.fog,M=new Plane,w=new Vector3,S=new Vector3,A=new Vector3,T=new Matrix4,L=new Vector3(0,0,-1),C=new Vector4,view=new Vector3,N=new Vector3,q=new Vector4,P=new Matrix4,F=new PerspectiveCamera,E=new WebGLRenderTarget(n,o,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});MathUtils.isPowerOfTwo(n)&&MathUtils.isPowerOfTwo(o)||(E.texture.generateMipmaps=!1);var R={uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Matrix4},sunColor:{value:new Color(8355711)},sunDirection:{value:new Vector3(.70707,.70707,0)},eye:{value:new Vector3},waterColor:{value:new Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",ShaderChunk.fog_pars_vertex,ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",ShaderChunk.fog_vertex,ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",ShaderChunk.common,ShaderChunk.packing,ShaderChunk.bsdfs,ShaderChunk.fog_pars_fragment,ShaderChunk.lights_pars_begin,ShaderChunk.shadowmap_pars_fragment,ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",ShaderChunk.tonemapping_fragment,ShaderChunk.fog_fragment,"}"].join("\n")},D=new ShaderMaterial({fragmentShader:R.fragmentShader,vertexShader:R.vertexShader,uniforms:UniformsUtils.clone(R.uniforms),lights:!0,side:x,fog:_});D.uniforms.mirrorSampler.value=E.texture,D.uniforms.textureMatrix.value=P,D.uniforms.alpha.value=c,D.uniforms.time.value=time,D.uniforms.normalSampler.value=h,D.uniforms.sunColor.value=f,D.uniforms.waterColor.value=m,D.uniforms.sunDirection.value=d,D.uniforms.distortionScale.value=y,D.uniforms.eye.value=v,r.material=D,r.onBeforeRender=function(e,t,n){if(S.setFromMatrixPosition(r.matrixWorld),A.setFromMatrixPosition(n.matrixWorld),T.extractRotation(r.matrixWorld),w.set(0,0,1),w.applyMatrix4(T),view.subVectors(S,A),!(view.dot(w)>0)){view.reflect(w).negate(),view.add(S),T.extractRotation(n.matrixWorld),L.set(0,0,-1),L.applyMatrix4(T),L.add(A),N.subVectors(S,L),N.reflect(w).negate(),N.add(S),F.position.copy(view),F.up.set(0,1,0),F.up.applyMatrix4(T),F.up.reflect(w),F.lookAt(N),F.far=n.far,F.updateMatrixWorld(),F.projectionMatrix.copy(n.projectionMatrix),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(F.projectionMatrix),P.multiply(F.matrixWorldInverse),M.setFromNormalAndCoplanarPoint(w,S),M.applyMatrix4(F.matrixWorldInverse),C.set(M.normal.x,M.normal.y,M.normal.z,M.constant);var o=F.projectionMatrix;q.x=(Math.sign(C.x)+o.elements[8])/o.elements[0],q.y=(Math.sign(C.y)+o.elements[9])/o.elements[5],q.z=-1,q.w=(1+o.elements[10])/o.elements[14],C.multiplyScalar(2/C.dot(q)),o.elements[2]=C.x,o.elements[6]=C.y,o.elements[10]=C.z+1-l,o.elements[14]=C.w,v.setFromMatrixPosition(n.matrixWorld);var c=e.getRenderTarget(),h=e.xr.enabled,d=e.shadowMap.autoUpdate;r.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(E),e.clear(),e.render(t,F),r.visible=!0,e.xr.enabled=h,e.shadowMap.autoUpdate=d,e.setRenderTarget(c);var f=n.viewport;void 0!==f&&e.state.viewport(f)}}};function Water2(e,t){Mesh.call(this,e),this.type="Water2";var r=this,n=void 0!==(t=t||{}).color?new Color(t.color):new Color(16777215),o=t.textureWidth||512,l=t.textureHeight||512,c=t.clipBias||0,h=t.flowDirection||new Vector2(1,0),d=t.flowSpeed||.03,f=t.reflectivity||.02,m=t.scale||1,v=t.shader||Water2.Water2Shader,y=new TextureLoader,x=t.flowMap||void 0,_=t.normalMap0||y.load("textures/water/Water2_1_M_Normal.jpg"),M=t.normalMap1||y.load("textures/water/Water2_2_M_Normal.jpg"),w=new Matrix4,S=new Clock;if(void 0!==Reflector)if(void 0!==Refractor){var A=new Reflector(e,{textureWidth:o,textureHeight:l,clipBias:c}),T=new Refractor(e,{textureWidth:o,textureHeight:l,clipBias:c});A.matrixAutoUpdate=!1,T.matrixAutoUpdate=!1,this.material=new ShaderMaterial({uniforms:UniformsUtils.merge([UniformsLib.fog,v.uniforms]),vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,transparent:!0,fog:!0}),void 0!==x?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:x}):this.material.uniforms.flowDirection={type:"v2",value:h},_.wrapS=_.wrapT=RepeatWrapping,M.wrapS=M.wrapT=RepeatWrapping,this.material.uniforms.tReflectionMap.value=A.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=T.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=_,this.material.uniforms.tNormalMap1.value=M,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=f,this.material.uniforms.textureMatrix.value=w,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=m,this.onBeforeRender=function(e,t,n){var o,l;!function(e){w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(e.projectionMatrix),w.multiply(e.matrixWorldInverse),w.multiply(r.matrixWorld)}(n),o=S.getDelta(),(l=r.material.uniforms.config).value.x+=d*o,l.value.y=l.value.x+.075,l.value.x>=.15?(l.value.x=0,l.value.y=.075):l.value.y>=.15&&(l.value.y=l.value.y-.15),r.visible=!1,A.matrixWorld.copy(r.matrixWorld),T.matrixWorld.copy(r.matrixWorld),A.onBeforeRender(e,t,n),T.onBeforeRender(e,t,n),r.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}Water.prototype=Object.create(Mesh.prototype),Water.prototype.constructor=Water,Water2.prototype=Object.create(Mesh.prototype),Water2.prototype.constructor=Water2,Water2.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Vector4}},vertexShader:["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},LuminosityShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tfloat l = linearToRelativeLuminance( texel.rgb );","\tgl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},ToneMapShader={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","\tuniform sampler2D luminanceMap;","#else","\tuniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","\t#ifdef ADAPTED_LUMINANCE","\t\tfloat fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","\t#else","\t\tfloat fLumAvg = averageLuminance;","\t#endif","\tfloat fLumPixel = linearToRelativeLuminance( vColor );","\tfloat fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","\tfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","\treturn fLumCompressed * vColor;","}","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},AdaptiveToneMappingPass=function(e,t){Pass.call(this),this.resolution=void 0!==t?t:256,this.needsInit=!0,this.adaptive=void 0===e||!!e,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===CopyShader&&console.error("AdaptiveToneMappingPass relies on CopyShader");var r=CopyShader;this.copyUniforms=UniformsUtils.clone(r.uniforms),this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:NoBlending,depthTest:!1}),void 0===LuminosityShader&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new ShaderMaterial({uniforms:UniformsUtils.clone(LuminosityShader.uniforms),vertexShader:LuminosityShader.vertexShader,fragmentShader:LuminosityShader.fragmentShader,blending:NoBlending}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","\tvec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","\tvec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","\tfloat fLastLum = max( minLuminance, lastLum.r );","\tfloat fCurrentLum = max( minLuminance, currentLum.r );","\tfCurrentLum *= fCurrentLum;","\tfloat fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","\tgl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new ShaderMaterial({uniforms:UniformsUtils.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:NoBlending}),void 0===ToneMapShader&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new ShaderMaterial({uniforms:UniformsUtils.clone(ToneMapShader.uniforms),vertexShader:ToneMapShader.vertexShader,fragmentShader:ToneMapShader.fragmentShader,blending:NoBlending}),this.fsQuad=new Pass.FullScreenQuad(null)};AdaptiveToneMappingPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:AdaptiveToneMappingPass,render:function(e,t,r,n){this.needsInit&&(this.reset(e),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.fsQuad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,e.setRenderTarget(this.currentLuminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,e.setRenderTarget(this.luminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,e.setRenderTarget(this.previousLuminanceRT),this.fsQuad.render(e)),this.fsQuad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},reset:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var e={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.luminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,e),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,e),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,e.minFilter=LinearMipmapLinearFilter,e.generateMipmaps=!0,this.currentLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.fsQuad.material=new MeshBasicMaterial({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(e){e?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(e){e&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(e))},setMinLuminance:function(e){e&&(this.materialToneMap.uniforms.minLuminance.value=e,this.materialAdaptiveLum.uniforms.minLuminance.value=e)},setMaxLuminance:function(e){e&&(this.materialToneMap.uniforms.maxLuminance.value=e)},setAverageLuminance:function(e){e&&(this.materialToneMap.uniforms.averageLuminance.value=e)},setMiddleGrey:function(e){e&&(this.materialToneMap.uniforms.middleGrey.value=e)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var AfterimageShader={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float damp;","uniform sampler2D tOld;","uniform sampler2D tNew;","varying vec2 vUv;","vec4 when_gt( vec4 x, float y ) {","\treturn max( sign( x - y ), 0.0 );","}","void main() {","\tvec4 texelOld = texture2D( tOld, vUv );","\tvec4 texelNew = texture2D( tNew, vUv );","\ttexelOld *= damp * when_gt( texelOld, 0.1 );","\tgl_FragColor = max(texelNew, texelOld);","}"].join("\n")},AfterimagePass=function(e){Pass.call(this),void 0===AfterimageShader&&console.error("AfterimagePass relies on AfterimageShader"),this.shader=AfterimageShader,this.uniforms=UniformsUtils.clone(this.shader.uniforms),this.uniforms.damp.value=void 0!==e?e:.96,this.textureComp=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat}),this.textureOld=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat}),this.shaderMaterial=new ShaderMaterial({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new Pass.FullScreenQuad(this.shaderMaterial);var t=new MeshBasicMaterial;this.copyFsQuad=new Pass.FullScreenQuad(t)};AfterimagePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:AfterimagePass,render:function(e,t,r){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=r.texture,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?(e.setRenderTarget(null),this.copyFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.copyFsQuad.render(e));var n=this.textureOld;this.textureOld=this.textureComp,this.textureComp=n},setSize:function(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}});var ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var i,r,n,o,l=2*Math.ceil(3*e)+1;for(l>25&&(l=25),o=.5*(l-1),r=new Array(l),n=0,i=0;i<l;++i)r[i]=t(i-o,e),n+=r[i];for(i=0;i<l;++i)r[i]/=n;return r}},BloomPass=function(e,t,r,n){Pass.call(this),e=void 0!==e?e:1,t=void 0!==t?t:25,r=void 0!==r?r:4,n=void 0!==n?n:256;var o={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetX=new WebGLRenderTarget(n,n,o),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new WebGLRenderTarget(n,n,o),this.renderTargetY.texture.name="BloomPass.y",void 0===CopyShader&&console.error("BloomPass relies on CopyShader");var l=CopyShader;this.copyUniforms=UniformsUtils.clone(l.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:AdditiveBlending,transparent:!0}),void 0===ConvolutionShader&&console.error("BloomPass relies on ConvolutionShader");var c=ConvolutionShader;this.convolutionUniforms=UniformsUtils.clone(c.uniforms),this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,this.convolutionUniforms.cKernel.value=ConvolutionShader.buildKernel(r),this.materialConvolution=new ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new Pass.FullScreenQuad(null)};BloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BloomPass,render:function(e,t,r,n,o){o&&e.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),this.fsQuad.render(e),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,o&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e)}}),BloomPass.blurX=new Vector2(.001953125,0),BloomPass.blurY=new Vector2(0,.001953125);var BokehPass=function(e,t,r){Pass.call(this),this.scene=e,this.camera=t;var n=void 0!==r.focus?r.focus:1,o=void 0!==r.aspect?r.aspect:t.aspect,l=void 0!==r.aperture?r.aperture:.025,c=void 0!==r.maxblur?r.maxblur:1,h=r.width||window.innerWidth||1,d=r.height||window.innerHeight||1;this.renderTargetColor=new WebGLRenderTarget(h,d,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new MeshDepthMaterial,this.materialDepth.depthPacking=RGBADepthPacking,this.materialDepth.blending=NoBlending,void 0===BokehShader&&console.error("BokehPass relies on BokehShader");var f=BokehShader,m=UniformsUtils.clone(f.uniforms);m.tDepth.value=this.renderTargetDepth.texture,m.focus.value=n,m.aspect.value=o,m.aperture.value=l,m.maxblur.value=c,m.nearClip.value=t.near,m.farClip.value=t.far,this.materialBokeh=new ShaderMaterial({defines:Object.assign({},f.defines),uniforms:m,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),this.uniforms=m,this.needsSwap=!1,this.fsQuad=new Pass.FullScreenQuad(this.materialBokeh),this.oldClearColor=new Color};BokehPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BokehPass,render:function(e,t,r){this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor());var n=e.getClearAlpha(),o=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(n),e.autoClear=o}});var ClearPass=function(e,t){Pass.call(this),this.needsSwap=!1,this.clearColor=void 0!==e?e:0,this.clearAlpha=void 0!==t?t:0};ClearPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ClearPass,render:function(e,t,r){var n,o;this.clearColor&&(n=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),this.clearColor&&e.setClearColor(n,o)}});var CubeTexturePass=function(e,t,r){Pass.call(this),this.camera=e,this.needsSwap=!1,this.cubeShader=ShaderLib.cube,this.cubeMesh=new Mesh(new BoxBufferGeometry(10,10,10),new ShaderMaterial({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:BackSide})),Object.defineProperty(this.cubeMesh.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),this.envMap=t,this.opacity=void 0!==r?r:1,this.cubeScene=new Scene,this.cubeCamera=new PerspectiveCamera,this.cubeScene.add(this.cubeMesh)};CubeTexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:CubeTexturePass,render:function(e,t,r){var n=e.autoClear;e.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.envMap.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),e.render(this.cubeScene,this.cubeCamera),e.autoClear=n}});var DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new Vector2(256,256)},center:{value:new Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","\tfloat s = sin( angle ), c = cos( angle );","\tvec2 tex = vUv * tSize - center;","\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat average = ( color.r + color.g + color.b ) / 3.0;","\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},DotScreenPass=function(e,t,r){Pass.call(this),void 0===DotScreenShader&&console.error("DotScreenPass relies on DotScreenShader");var n=DotScreenShader;this.uniforms=UniformsUtils.clone(n.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==r&&(this.uniforms.scale.value=r),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.fsQuad=new Pass.FullScreenQuad(this.material)};DotScreenPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:DotScreenPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}});var MaskPass=function(e,t){Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};MaskPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:MaskPass,render:function(e,t,r){var n,o,l=e.getContext(),c=e.state;c.buffers.color.setMask(!1),c.buffers.depth.setMask(!1),c.buffers.color.setLocked(!0),c.buffers.depth.setLocked(!0),this.inverse?(n=0,o=1):(n=1,o=0),c.buffers.stencil.setTest(!0),c.buffers.stencil.setOp(l.REPLACE,l.REPLACE,l.REPLACE),c.buffers.stencil.setFunc(l.ALWAYS,n,4294967295),c.buffers.stencil.setClear(o),c.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),c.buffers.color.setLocked(!1),c.buffers.depth.setLocked(!1),c.buffers.stencil.setLocked(!1),c.buffers.stencil.setFunc(l.EQUAL,1,4294967295),c.buffers.stencil.setOp(l.KEEP,l.KEEP,l.KEEP),c.buffers.stencil.setLocked(!0)}});var ClearMaskPass=function(){Pass.call(this),this.needsSwap=!1};ClearMaskPass.prototype=Object.create(Pass.prototype),Object.assign(ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1},n=e.getSize(new Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===CopyShader&&console.error("EffectComposer relies on CopyShader"),void 0===ShaderPass&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new ShaderPass(CopyShader),this.clock=new Clock};Object.assign(EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,i,r=this.renderer.getRenderTarget(),n=!1,o=this.passes.length;for(i=0;i<o;i++)if(!1!==(t=this.passes[i]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var l=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==MaskPass&&(t instanceof MaskPass?n=!0:t instanceof ClearMaskPass&&(n=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var FilmShader={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 cTextureScreen = texture2D( tDiffuse, vUv );","\tfloat dx = rand( vUv + time );","\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","\tvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","\tif( grayscale ) {","\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","\t}","\tgl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},FilmPass=function(e,t,r,n){Pass.call(this),void 0===FilmShader&&console.error("FilmPass relies on FilmShader");var o=FilmShader;this.uniforms=UniformsUtils.clone(o.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==r&&(this.uniforms.sCount.value=r),this.fsQuad=new Pass.FullScreenQuad(this.material)};FilmPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:FilmPass,render:function(e,t,r,n){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}});var DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","\tif(byp<1) {","\t\tvec2 p = vUv;","\t\tfloat xs = floor(gl_FragCoord.x / 0.5);","\t\tfloat ys = floor(gl_FragCoord.y / 0.5);","\t\tvec4 normal = texture2D (tDisp, p*seed*seed);","\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","\t\t\tif(seed_x>0.){","\t\t\t\tp.y = 1. - (p.y + distortion_y);","\t\t\t}","\t\t\telse {","\t\t\t\tp.y = distortion_y;","\t\t\t}","\t\t}","\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","\t\t\tif(seed_y>0.){","\t\t\t\tp.x=distortion_x;","\t\t\t}","\t\t\telse {","\t\t\t\tp.x = 1. - (p.x + distortion_x);","\t\t\t}","\t\t}","\t\tp.x+=normal.x*seed_x*(seed/5.);","\t\tp.y+=normal.y*seed_y*(seed/5.);","\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\t\tvec4 cr = texture2D(tDiffuse, p + offset);","\t\tvec4 cga = texture2D(tDiffuse, p);","\t\tvec4 cb = texture2D(tDiffuse, p - offset);","\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","\t\tgl_FragColor = gl_FragColor+ snow;","\t}","\telse {","\t\tgl_FragColor=texture2D (tDiffuse, vUv);","\t}","}"].join("\n")},GlitchPass=function(e){Pass.call(this),void 0===DigitalGlitch&&console.error("GlitchPass relies on DigitalGlitch");var t=DigitalGlitch;this.uniforms=UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new Pass.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()};GlitchPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:GlitchPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.uniforms.seed_x.value=MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=MathUtils.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,i=0;i<r;i++){var n=MathUtils.randFloat(0,1);t[3*i+0]=n,t[3*i+1]=n,t[3*i+2]=n}return new DataTexture(t,e,e,RGBFormat,FloatType)}});var HalftoneShader={uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:["varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define SQRT2_MINUS_ONE 0.41421356","#define SQRT2_HALF_MINUS_ONE 0.20710678","#define PI2 6.28318531","#define SHAPE_DOT 1","#define SHAPE_ELLIPSE 2","#define SHAPE_LINE 3","#define SHAPE_SQUARE 4","#define BLENDING_LINEAR 1","#define BLENDING_MULTIPLY 2","#define BLENDING_ADD 3","#define BLENDING_LIGHTER 4","#define BLENDING_DARKER 5","uniform sampler2D tDiffuse;","uniform float radius;","uniform float rotateR;","uniform float rotateG;","uniform float rotateB;","uniform float scatter;","uniform float width;","uniform float height;","uniform int shape;","uniform bool disable;","uniform float blending;","uniform int blendingMode;","varying vec2 vUV;","uniform bool greyscale;","const int samples = 8;","float blend( float a, float b, float t ) {","\treturn a * ( 1.0 - t ) + b * t;","}","float hypot( float x, float y ) {","\treturn sqrt( x * x + y * y );","}","float rand( vec2 seed ){","return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}","float distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {","\tfloat dist = hypot( coord.x - p.x, coord.y - p.y );","\tfloat rad = channel;","\tif ( shape == SHAPE_DOT ) {","\t\trad = pow( abs( rad ), 1.125 ) * rad_max;","\t} else if ( shape == SHAPE_ELLIPSE ) {","\t\trad = pow( abs( rad ), 1.125 ) * rad_max;","\t\tif ( dist != 0.0 ) {","\t\t\tfloat dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );","\t\t\tdist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;","\t\t}","\t} else if ( shape == SHAPE_LINE ) {","\t\trad = pow( abs( rad ), 1.5) * rad_max;","\t\tfloat dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;","\t\tdist = hypot( normal.x * dot_p, normal.y * dot_p );","\t} else if ( shape == SHAPE_SQUARE ) {","\t\tfloat theta = atan( p.y - coord.y, p.x - coord.x ) - angle;","\t\tfloat sin_t = abs( sin( theta ) );","\t\tfloat cos_t = abs( cos( theta ) );","\t\trad = pow( abs( rad ), 1.4 );","\t\trad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );","\t}","\treturn rad - dist;","}","struct Cell {","\tvec2 normal;","\tvec2 p1;","\tvec2 p2;","\tvec2 p3;","\tvec2 p4;","\tfloat samp2;","\tfloat samp1;","\tfloat samp3;","\tfloat samp4;","};","vec4 getSample( vec2 point ) {","\tvec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );","\tfloat base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;","\tfloat step = PI2 / float( samples );","\tfloat dist = radius * 0.66;","\tfor ( int i = 0; i < samples; ++i ) {","\t\tfloat r = base + step * float( i );","\t\tvec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );","\t\ttex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );","\t}","\ttex /= float( samples ) + 1.0;","\treturn tex;","}","float getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {","\tfloat dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;","\tif ( channel == 0 ) {","\t\tc.samp1 = getSample( c.p1 ).r;","\t\tc.samp2 = getSample( c.p2 ).r;","\t\tc.samp3 = getSample( c.p3 ).r;","\t\tc.samp4 = getSample( c.p4 ).r;","\t} else if (channel == 1) {","\t\tc.samp1 = getSample( c.p1 ).g;","\t\tc.samp2 = getSample( c.p2 ).g;","\t\tc.samp3 = getSample( c.p3 ).g;","\t\tc.samp4 = getSample( c.p4 ).g;","\t} else {","\t\tc.samp1 = getSample( c.p1 ).b;","\t\tc.samp3 = getSample( c.p3 ).b;","\t\tc.samp2 = getSample( c.p2 ).b;","\t\tc.samp4 = getSample( c.p4 ).b;","\t}","\tdist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );","\tdist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );","\tdist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );","\tdist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );","\tres = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;","\tres = clamp( res, 0.0, 1.0 );","\treturn res;","}","Cell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {","\tCell c;","\tvec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );","\tfloat threshold = step * 0.5;","\tfloat dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );","\tfloat dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );","\tvec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );","\tfloat offset_normal = mod( hypot( offset.x, offset.y ), step );","\tfloat normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;","\tfloat normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;","\tfloat offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );","\tfloat line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;","\tfloat line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;","\tc.normal = n;","\tc.p1.x = p.x - n.x * normal_scale + n.y * line_scale;","\tc.p1.y = p.y - n.y * normal_scale - n.x * line_scale;","\tif ( scatter != 0.0 ) {","\t\tfloat off_mag = scatter * threshold * 0.5;","\t\tfloat off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;","\t\tc.p1.x += cos( off_angle ) * off_mag;","\t\tc.p1.y += sin( off_angle ) * off_mag;","\t}","\tfloat normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );","\tfloat line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );","\tc.p2.x = c.p1.x - n.x * normal_step;","\tc.p2.y = c.p1.y - n.y * normal_step;","\tc.p3.x = c.p1.x + n.y * line_step;","\tc.p3.y = c.p1.y - n.x * line_step;","\tc.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;","\tc.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;","\treturn c;","}","float blendColour( float a, float b, float t ) {","\tif ( blendingMode == BLENDING_LINEAR ) {","\t\treturn blend( a, b, 1.0 - t );","\t} else if ( blendingMode == BLENDING_ADD ) {","\t\treturn blend( a, min( 1.0, a + b ), t );","\t} else if ( blendingMode == BLENDING_MULTIPLY ) {","\t\treturn blend( a, max( 0.0, a * b ), t );","\t} else if ( blendingMode == BLENDING_LIGHTER ) {","\t\treturn blend( a, max( a, b ), t );","\t} else if ( blendingMode == BLENDING_DARKER ) {","\t\treturn blend( a, min( a, b ), t );","\t} else {","\t\treturn blend( a, b, 1.0 - t );","\t}","}","void main() {","\tif ( ! disable ) {","\t\tvec2 p = vec2( vUV.x * width, vUV.y * height );","\t\tvec2 origin = vec2( 0, 0 );","\t\tfloat aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;","\t\tCell cell_r = getReferenceCell( p, origin, rotateR, radius );","\t\tCell cell_g = getReferenceCell( p, origin, rotateG, radius );","\t\tCell cell_b = getReferenceCell( p, origin, rotateB, radius );","\t\tfloat r = getDotColour( cell_r, p, 0, rotateR, aa );","\t\tfloat g = getDotColour( cell_g, p, 1, rotateG, aa );","\t\tfloat b = getDotColour( cell_b, p, 2, rotateB, aa );","\t\tvec4 colour = texture2D( tDiffuse, vUV );","\t\tr = blendColour( r, colour.r, blending );","\t\tg = blendColour( g, colour.g, blending );","\t\tb = blendColour( b, colour.b, blending );","\t\tif ( greyscale ) {","\t\t\tr = g = b = (r + b + g) / 3.0;","\t\t}","\t\tgl_FragColor = vec4( r, g, b, 1.0 );","\t} else {","\t\tgl_FragColor = texture2D( tDiffuse, vUV );","\t}","}"].join("\n")},HalftonePass=function(e,t,r){for(var n in Pass.call(this),void 0===HalftoneShader&&console.error("HalftonePass requires HalftoneShader"),this.uniforms=UniformsUtils.clone(HalftoneShader.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,fragmentShader:HalftoneShader.fragmentShader,vertexShader:HalftoneShader.vertexShader}),this.uniforms.width.value=e,this.uniforms.height.value=t,r)r.hasOwnProperty(n)&&this.uniforms.hasOwnProperty(n)&&(this.uniforms[n].value=r[n]);this.fsQuad=new Pass.FullScreenQuad(this.material)};HalftonePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:HalftonePass,render:function(e,t,r){this.material.uniforms.tDiffuse.value=r.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},setSize:function(e,t){this.uniforms.width.value=e,this.uniforms.height.value=t}});var OutlinePass=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new Color(1,1,1),this.hiddenEdgeColor=new Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,Pass.call(this),this.resolution=void 0!==e?new Vector2(e.x,e.y):new Vector2(256,256);var o={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},l=Math.round(this.resolution.x/this.downSampleRatio),c=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=DoubleSide,this.renderTargetMaskBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,o),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.side=DoubleSide,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,o),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new WebGLRenderTarget(l,c,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new WebGLRenderTarget(l,c,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new WebGLRenderTarget(Math.round(l/2),Math.round(c/2),o),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new WebGLRenderTarget(l,c,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new WebGLRenderTarget(Math.round(l/2),Math.round(c/2),o),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(l,c),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(l/2),Math.round(c/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===CopyShader&&console.error("OutlinePass relies on CopyShader");var h=CopyShader;this.copyUniforms=UniformsUtils.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Color,this.oldClearAlpha=1,this.fsQuad=new Pass.FullScreenQuad(null),this.tempPulseColor1=new Color,this.tempPulseColor2=new Color,this.textureMatrix=new Matrix4};OutlinePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value.set(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(object){object.isMesh&&(e?(object.visible=object.userData.oldVisible,delete object.userData.oldVisible):(object.userData.oldVisible=object.visible,object.visible=e))}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(object){object.isMesh&&t.push(object)}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(r)}this.renderScene.traverse((function(object){if(object.isMesh||object.isLine||object.isSprite){for(var r=!1,i=0;i<t.length;i++){if(t[i].id===object.id){r=!0;break}}if(!r){var n=object.visible;e&&!object.bVisible||(object.visible=e),object.bVisible=n}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,o){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var l=e.autoClear;e.autoClear=!1,o&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var c=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=c,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var h=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(h),this.tempPulseColor2.multiplyScalar(h)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,o&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=l}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new Vector2(.5,.5)},visibleEdgeColor:{value:new Vector3(1,1,1)},hiddenEdgeColor:{value:new Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),OutlinePass.BlurDirectionX=new Vector2(1,0),OutlinePass.BlurDirectionY=new Vector2(0,1);var RenderPass=function(e,t,r,n,o){Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function DepthTexture(e,t,r,n,o,l,c,h,d,f){if((f=void 0!==f?f:DepthFormat)!==DepthFormat&&f!==DepthStencilFormat)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===r&&f===DepthFormat&&(r=UnsignedShortType),void 0===r&&f===DepthStencilFormat&&(r=UnsignedInt248Type),Texture.call(this,null,n,o,l,c,h,f,r,d),this.image={width:e,height:t},this.magFilter=void 0!==c?c:NearestFilter,this.minFilter=void 0!==h?h:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}RenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:RenderPass,render:function(e,t,r){var n,o,l=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(n=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(n,o),this.scene.overrideMaterial=null,e.autoClear=l}}),DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;var SAOShader={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},DepthLimitedBlurShader={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Vector2(512,512)},sampleUvOffsets:{value:[new Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},BlurShaderUtils={createSampleWeights:function(e,t){for(var r=function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)},n=[],i=0;i<=e;i++)n.push(r(i,t));return n},createSampleOffsets:function(e,t){for(var r=[],i=0;i<=e;i++)r.push(t.clone().multiplyScalar(i));return r},configure:function(e,t,r,n){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=BlurShaderUtils.createSampleOffsets(t,n),e.uniforms.sampleWeights.value=BlurShaderUtils.createSampleWeights(t,r),e.needsUpdate=!0}},UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},SAOPass=function(e,t,r,n,o){(Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==r&&r,this.supportsNormalTexture=void 0!==n&&n,this.originalClearColor=new Color,this.oldClearColor=new Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==o?new Vector2(o.x,o.y):new Vector2(256,256),this.saoRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension)&&((r=new DepthTexture).type=UnsignedShortType,r.minFilter=NearestFilter,r.maxFilter=NearestFilter,this.beautyRenderTarget.depthTexture=r,this.beautyRenderTarget.depthBuffer=!0);this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,void 0===SAOShader&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new ShaderMaterial({defines:Object.assign({},SAOShader.defines),fragmentShader:SAOShader.fragmentShader,vertexShader:SAOShader.vertexShader,uniforms:UniformsUtils.clone(SAOShader.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=NoBlending,void 0===DepthLimitedBlurShader&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=NoBlending,this.hBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=NoBlending,void 0===CopyShader&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,blending:NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=CustomBlending,this.materialCopy.blendSrc=DstColorFactor,this.materialCopy.blendDst=ZeroFactor,this.materialCopy.blendEquation=AddEquation,this.materialCopy.blendSrcAlpha=DstAlphaFactor,this.materialCopy.blendDstAlpha=ZeroFactor,this.materialCopy.blendEquationAlpha=AddEquation,void 0===UnpackDepthRGBAShader&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(UnpackDepthRGBAShader.uniforms),vertexShader:UnpackDepthRGBAShader.vertexShader,fragmentShader:UnpackDepthRGBAShader.fragmentShader,blending:NoBlending}),this.fsQuad=new Pass.FullScreenQuad(null)};SAOPass.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},SAOPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SAOPass,render:function(e,t,r){if(this.renderToScreen&&(this.materialCopy.blending=NoBlending,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var n=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var o=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=o,this.hBlurMaterial.uniforms.depthCutoff.value=o,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(BlurShaderUtils.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(0,1)),BlurShaderUtils.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var l=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,l=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?l.blending=CustomBlending:l.blending=NoBlending,this.renderPass(e,l,this.renderToScreen?null:r),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=n}},renderPass:function(e,t,r,n,o){this.originalClearColor.copy(e.getClearColor());var l=e.getClearAlpha(),c=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(o||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=c,e.setClearColor(this.originalClearColor),e.setClearAlpha(l)},renderOverride:function(e,t,r,n,o){this.originalClearColor.copy(e.getClearColor());var l=e.getClearAlpha(),c=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,o=t.clearAlpha||o,null!=n&&(e.setClearColor(n),e.setClearAlpha(o||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=c,e.setClearColor(this.originalClearColor),e.setClearAlpha(l)},setSize:function(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}});var SavePass=function(e){Pass.call(this),void 0===CopyShader&&console.error("SavePass relies on CopyShader");var t=CopyShader;this.textureID="tDiffuse",this.uniforms=UniformsUtils.clone(t.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new Pass.FullScreenQuad(this.material)};SavePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SavePass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}});var SMAAEdgesShader={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","\tvUv = uv;","\tSMAAEdgeDetectionVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","\tvec4 delta;","\tvec3 C = texture2D( colorTex, texcoord ).rgb;","\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","\tvec3 t = abs( C - Cleft );","\tdelta.x = max( max( t.r, t.g ), t.b );","\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","\tt = abs( C - Ctop );","\tdelta.y = max( max( t.r, t.g ), t.b );","\tvec2 edges = step( threshold, delta.xy );","\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","\t\tdiscard;","\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","\tt = abs( C - Cright );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","\tt = abs( C - Cbottom );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","\tt = abs( C - Cleftleft );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","\tt = abs( C - Ctoptop );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );","\tedges.xy *= step( 0.5 * maxDelta, delta.xy );","\treturn vec4( edges, 0.0, 0.0 );","}","void main() {","\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},SMAAWeightsShader={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","\tvPixcoord = texcoord / resolution;","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","\tvUv = uv;","\tSMAABlendingWeightCalculationVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","#if __VERSION__ == 100","vec2 round( vec2 x ) {","\treturn sign( x ) * floor( abs( x ) + 0.5 );","}","#endif","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","\te.r = bias + e.r * scale;","\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x += 0.25 * resolution.x;","\ttexcoord.x += resolution.x;","\ttexcoord.x += 2.0 * resolution.x;","\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","\treturn texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x -= 0.25 * resolution.x;","\ttexcoord.x -= resolution.x;","\ttexcoord.x -= 2.0 * resolution.x;","\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","\treturn texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y -= 0.25 * resolution.y;","\ttexcoord.y -= resolution.y;","\ttexcoord.y -= 2.0 * resolution.y;","\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","\treturn texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y += 0.25 * resolution.y;","\ttexcoord.y += resolution.y;","\ttexcoord.y += 2.0 * resolution.y;","\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","\treturn texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","\treturn texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","\tvec2 e = texture2D( edgesTex, texcoord ).rg;","\tif ( e.g > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","\t\tcoords.y = offset[ 1 ].y;","\t\td.x = coords.x;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;","\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","\t\td.y = coords.x;","\t\td = d / resolution.x - pixcoord.x;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","\t}","\tif ( e.r > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","\t\tcoords.x = offset[ 0 ].x;","\t\td.x = coords.y;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;","\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","\t\td.y = coords.y;","\t\td = d / resolution.y - pixcoord.y;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","\t}","\treturn weights;","}","void main() {","\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},SMAABlendShader={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","\tvUv = uv;","\tSMAANeighborhoodBlendingVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","\tvec4 a;","\ta.xz = texture2D( blendTex, texcoord ).xz;","\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;","\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;","\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","\t\treturn texture2D( colorTex, texcoord, 0.0 );","\t} else {","\t\tvec2 offset;","\t\toffset.x = a.a > a.b ? a.a : -a.b;","\t\toffset.y = a.g > a.r ? -a.g : a.r;","\t\tif ( abs( offset.x ) > abs( offset.y )) {","\t\t\toffset.y = 0.0;","\t\t} else {","\t\t\toffset.x = 0.0;","\t\t}","\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );","\t\ttexcoord += sign( offset ) * resolution;","\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );","\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","\t\tC.xyz = pow(C.xyz, vec3(2.2));","\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));","\t\tvec4 mixed = mix(C, Cop, s);","\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","\t\treturn mixed;","\t}","}","void main() {","\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")},SMAAPass=function(e,t){Pass.call(this),this.edgesRT=new WebGLRenderTarget(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:LinearFilter,format:RGBFormat}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new WebGLRenderTarget(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:LinearFilter,format:RGBAFormat}),this.weightsRT.texture.name="SMAAPass.weights";var r=this,n=new Image;n.src=this.getAreaTexture(),n.onload=function(){r.areaTexture.needsUpdate=!0},this.areaTexture=new Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=n,this.areaTexture.format=RGBFormat,this.areaTexture.minFilter=LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;var o=new Image;o.src=this.getSearchTexture(),o.onload=function(){r.searchTexture.needsUpdate=!0},this.searchTexture=new Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=o,this.searchTexture.magFilter=NearestFilter,this.searchTexture.minFilter=NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,void 0===SMAAEdgesShader&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=UniformsUtils.clone(SMAAEdgesShader.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new ShaderMaterial({defines:Object.assign({},SMAAEdgesShader.defines),uniforms:this.uniformsEdges,vertexShader:SMAAEdgesShader.vertexShader,fragmentShader:SMAAEdgesShader.fragmentShader}),this.uniformsWeights=UniformsUtils.clone(SMAAWeightsShader.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ShaderMaterial({defines:Object.assign({},SMAAWeightsShader.defines),uniforms:this.uniformsWeights,vertexShader:SMAAWeightsShader.vertexShader,fragmentShader:SMAAWeightsShader.fragmentShader}),this.uniformsBlend=UniformsUtils.clone(SMAABlendShader.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAABlendShader.vertexShader,fragmentShader:SMAABlendShader.fragmentShader}),this.needsSwap=!1,this.fsQuad=new Pass.FullScreenQuad(null)};SMAAPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SMAAPass,render:function(e,t,r){this.uniformsEdges.tDiffuse.value=r.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=r.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},setSize:function(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var SSAARenderPass=function(e,t,r,n){Pass.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,void 0===CopyShader&&console.error("SSAARenderPass relies on CopyShader");var o=CopyShader;this.copyUniforms=UniformsUtils.clone(o.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new Pass.FullScreenQuad(this.copyMaterial)};SSAARenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAARenderPass,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(r.width,r.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],o=e.autoClear;e.autoClear=!1;var l=e.getClearColor().getHex(),c=e.getClearAlpha(),h=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var d=r.width,f=r.height,i=0;i<n.length;i++){var m=n[i];this.camera.setViewOffset&&this.camera.setViewOffset(d,f,.0625*m[0],.0625*m[1],d,f);var v=h;if(this.unbiased)v+=1/32*((i+.5)/n.length-.5);this.copyUniforms.opacity.value=v,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===i&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=o,e.setClearColor(l,c)}}),SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")},SSAOPass=function(e,t,r,n){Pass.call(this),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var o=new DepthTexture;o.type=UnsignedShortType,o.minFilter=NearestFilter,o.maxFilter=NearestFilter,this.beautyRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthTexture:o,depthBuffer:!0}),this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),this.ssaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===SSAOShader&&console.error("SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new ShaderMaterial({defines:Object.assign({},SSAOShader.defines),uniforms:UniformsUtils.clone(SSAOShader.uniforms),vertexShader:SSAOShader.vertexShader,fragmentShader:SSAOShader.fragmentShader,blending:NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSAOBlurShader.defines),uniforms:UniformsUtils.clone(SSAOBlurShader.uniforms),vertexShader:SSAOBlurShader.vertexShader,fragmentShader:SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSAODepthShader.defines),uniforms:UniformsUtils.clone(SSAODepthShader.uniforms),vertexShader:SSAODepthShader.vertexShader,fragmentShader:SSAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new Pass.FullScreenQuad(null),this.originalClearColor=new Color};SSAOPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("SSAOPass: Unknown output type.")}},renderPass:function(e,t,r,n,o){this.originalClearColor.copy(e.getClearColor());var l=e.getClearAlpha(),c=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(o||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=c,e.setClearColor(this.originalClearColor),e.setClearAlpha(l)},renderOverride:function(e,t,r,n,o){this.originalClearColor.copy(e.getClearColor());var l=e.getClearAlpha(),c=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,o=t.clearAlpha||o,null!=n&&(e.setClearColor(n),e.setClearAlpha(o||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=c,e.setClearColor(this.originalClearColor),e.setClearAlpha(l)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,i=0;i<e;i++){var r=new Vector3;r.x=2*Math.random()-1,r.y=2*Math.random()-1,r.z=Math.random(),r.normalize();var n=i/e;n=MathUtils.lerp(.1,1,n*n),r.multiplyScalar(n),t.push(r)}},generateRandomKernelRotations:function(){void 0===SimplexNoise&&console.error("SSAOPass: The pass relies on SimplexNoise.");for(var e=new SimplexNoise,data=new Float32Array(64),i=0;i<16;i++){var t=4*i,r=2*Math.random()-1,n=2*Math.random()-1,o=e.noise3d(r,n,0);data[t]=o,data[t+1]=o,data[t+2]=o,data[t+3]=1}this.noiseTexture=new DataTexture(data,4,4,RGBAFormat,FloatType),this.noiseTexture.wrapS=RepeatWrapping,this.noiseTexture.wrapT=RepeatWrapping}}),SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};var TAARenderPass=function(e,t,r,n){void 0===SSAARenderPass&&console.error("TAARenderPass relies on SSAARenderPass"),SSAARenderPass.call(this,e,t,r,n),this.sampleLevel=0,this.accumulate=!1};TAARenderPass.JitterVectors=SSAARenderPass.JitterVectors,TAARenderPass.prototype=Object.assign(Object.create(SSAARenderPass.prototype),{constructor:TAARenderPass,render:function(e,t,r,n){if(!this.accumulate)return SSAARenderPass.prototype.render.call(this,e,t,r,n),void(this.accumulateIndex=-1);var o=TAARenderPass.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new WebGLRenderTarget(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(SSAARenderPass.prototype.render.call(this,e,this.holdRenderTarget,r,n),this.accumulateIndex=0);var l=e.autoClear;e.autoClear=!1;var c=1/o.length;if(this.accumulateIndex>=0&&this.accumulateIndex<o.length){this.copyUniforms.opacity.value=c,this.copyUniforms.tDiffuse.value=t.texture;for(var h=Math.pow(2,this.sampleLevel),i=0;i<h;i++){var d=o[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*d[0],.0625*d[1],r.width,r.height),e.setRenderTarget(t),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&e.clear(),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=o.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var f=this.accumulateIndex*c;f>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),f<1&&(this.copyUniforms.opacity.value=1-f,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),0===f&&e.clear(),this.fsQuad.render(e)),e.autoClear=l}});var TexturePass=function(map,e){Pass.call(this),void 0===CopyShader&&console.error("TexturePass relies on CopyShader");var t=CopyShader;this.map=map,this.opacity=void 0!==e?e:1,this.uniforms=UniformsUtils.clone(t.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.fsQuad=new Pass.FullScreenQuad(null)};TexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:TexturePass,render:function(e,t,r){var n=e.autoClear;e.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),this.fsQuad.render(e),e.autoClear=n}});var LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},UnrealBloomPass=function(e,t,r,n){Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new Vector2(e.x,e.y):new Vector2(256,256),this.clearColor=new Color(0,0,0);var o={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var l=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(l,c,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var i=0;i<this.nMips;i++){var h=new WebGLRenderTarget(l,c,o);h.texture.name="UnrealBloomPass.h"+i,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);var d=new WebGLRenderTarget(l,c,o);d.texture.name="UnrealBloomPass.v"+i,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),l=Math.round(l/2),c=Math.round(c/2)}void 0===LuminosityHighPassShader&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var f=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(f.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var m=[3,5,7,9,11];for(l=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2),i=0;i<this.nMips;i++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(m[i])),this.separableBlurMaterials[i].uniforms.texSize.value=new Vector2(l,c),l=Math.round(l/2),c=Math.round(c/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===CopyShader&&console.error("UnrealBloomPass relies on CopyShader");var v=CopyShader;this.copyUniforms=UniformsUtils.clone(v.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Color,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial,this.fsQuad=new Pass.FullScreenQuad(null)};UnrealBloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:UnrealBloomPass,dispose:function(){for(var i=0;i<this.renderTargetsHorizontal.length;i++)this.renderTargetsHorizontal[i].dispose();for(i=0;i<this.renderTargetsVertical.length;i++)this.renderTargetsVertical[i].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,o){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var l=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),o&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var c=this.renderTargetBright,i=0;i<this.nMips;i++)this.fsQuad.material=this.separableBlurMaterials[i],this.separableBlurMaterials[i].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[i].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[i]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[i].uniforms.colorTexture.value=this.renderTargetsHorizontal[i].texture,this.separableBlurMaterials[i].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[i]),e.clear(),this.fsQuad.render(e),c=this.renderTargetsVertical[i];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,o&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=l},getSeperableBlurMaterial:function(e){return new ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),UnrealBloomPass.BlurDirectionX=new Vector2(1,0),UnrealBloomPass.BlurDirectionY=new Vector2(0,1);var CSS2DObject=function(element){Object3D.call(this),this.element=element,this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(object){object.element instanceof Element&&null!==object.element.parentNode&&object.element.parentNode.removeChild(object.element)}))}))};CSS2DObject.prototype=Object.create(Object3D.prototype),CSS2DObject.prototype.constructor=CSS2DObject;var CSS2DRenderer=function(){var e,t,r,n,o=this,l=new Vector3,c=new Matrix4,h=new Matrix4,d={objects:new WeakMap},f=document.createElement("div");f.style.overflow="hidden",this.domElement=f,this.getSize=function(){return{width:e,height:t}},this.setSize=function(o,l){r=(e=o)/2,n=(t=l)/2,f.style.width=o+"px",f.style.height=l+"px"};var a,b,m=function(object,e,t){if(object instanceof CSS2DObject){object.onBeforeRender(o,e,t),l.setFromMatrixPosition(object.matrixWorld),l.applyMatrix4(h);var element=object.element,style="translate(-50%,-50%) translate("+(l.x*r+r)+"px,"+(-l.y*n+n)+"px)";element.style.WebkitTransform=style,element.style.MozTransform=style,element.style.oTransform=style,element.style.transform=style,element.style.display=object.visible&&l.z>=-1&&l.z<=1?"":"none";var c={distanceToCameraSquared:v(t,object)};d.objects.set(object,c),element.parentNode!==f&&f.appendChild(element),object.onAfterRender(o,e,t)}for(var i=0,y=object.children.length;i<y;i++)m(object.children[i],e,t)},v=(a=new Vector3,b=new Vector3,function(e,t){return a.setFromMatrixPosition(e.matrixWorld),b.setFromMatrixPosition(t.matrixWorld),a.distanceToSquared(b)}),y=function(e){for(var t=function(e){var t=[];return e.traverse((function(object){object instanceof CSS2DObject&&t.push(object)})),t}(e).sort((function(a,b){return d.objects.get(a).distanceToCameraSquared-d.objects.get(b).distanceToCameraSquared})),r=t.length,i=0,n=t.length;i<n;i++)t[i].element.style.zIndex=r-i};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),c.copy(t.matrixWorldInverse),h.multiplyMatrices(t.projectionMatrix,c),m(e,e,t),y(e)}},CSS3DObject=function(element){Object3D.call(this),this.element=element,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(object){object.element instanceof Element&&null!==object.element.parentNode&&object.element.parentNode.removeChild(object.element)}))}))};CSS3DObject.prototype=Object.create(Object3D.prototype),CSS3DObject.prototype.constructor=CSS3DObject;var CSS3DSprite=function(element){CSS3DObject.call(this,element)};CSS3DSprite.prototype=Object.create(CSS3DObject.prototype),CSS3DSprite.prototype.constructor=CSS3DSprite;var CSS3DRenderer=function(){var e,t,r,n,o=this,l=new Matrix4,c={camera:{fov:0,style:""},objects:new WeakMap},h=document.createElement("div");h.style.overflow="hidden",this.domElement=h;var d=document.createElement("div");d.style.WebkitTransformStyle="preserve-3d",d.style.transformStyle="preserve-3d",d.style.pointerEvents="none",h.appendChild(d);var f=/Trident/i.test(navigator.userAgent);function m(e){return Math.abs(e)<1e-10?0:e}function v(e){var t=e.elements;return"matrix3d("+m(t[0])+","+m(-t[1])+","+m(t[2])+","+m(t[3])+","+m(t[4])+","+m(-t[5])+","+m(t[6])+","+m(t[7])+","+m(t[8])+","+m(-t[9])+","+m(t[10])+","+m(t[11])+","+m(t[12])+","+m(-t[13])+","+m(t[14])+","+m(t[15])+")"}function y(e,t){var o=e.elements,l="matrix3d("+m(o[0])+","+m(o[1])+","+m(o[2])+","+m(o[3])+","+m(-o[4])+","+m(-o[5])+","+m(-o[6])+","+m(-o[7])+","+m(o[8])+","+m(o[9])+","+m(o[10])+","+m(o[11])+","+m(o[12])+","+m(o[13])+","+m(o[14])+","+m(o[15])+")";return f?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+t+l:"translate(-50%,-50%)"+l}this.getSize=function(){return{width:e,height:t}},this.setSize=function(o,l){r=(e=o)/2,n=(t=l)/2,h.style.width=o+"px",h.style.height=l+"px",d.style.width=o+"px",d.style.height=l+"px"};var a,b,x=(a=new Vector3,b=new Vector3,function(e,t){return a.setFromMatrixPosition(e.matrixWorld),b.setFromMatrixPosition(t.matrixWorld),a.distanceToSquared(b)});function _(e){for(var t=function(e){var t=[];return e.traverse((function(object){object instanceof CSS3DObject&&t.push(object)})),t}(e).sort((function(a,b){return c.objects.get(a).distanceToCameraSquared-c.objects.get(b).distanceToCameraSquared})),r=t.length,i=0,n=t.length;i<n;i++)t[i].element.style.zIndex=r-i}this.render=function(e,t){var M=t.projectionMatrix.elements[5]*n;if(c.camera.fov!==M&&(t.isPerspectiveCamera?(h.style.WebkitPerspective=M+"px",h.style.perspective=M+"px"):(h.style.WebkitPerspective="",h.style.perspective=""),c.camera.fov=M),!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var w=-(t.right+t.left)/2,S=(t.top+t.bottom)/2;var A=t.isOrthographicCamera?"scale("+M+")translate("+m(w)+"px,"+m(S)+"px)"+v(t.matrixWorldInverse):"translateZ("+M+"px)"+v(t.matrixWorldInverse),style=A+"translate("+r+"px,"+n+"px)";c.camera.style===style||f||(d.style.WebkitTransform=style,d.style.transform=style,c.camera.style=style),function e(object,t,r,n){if(object instanceof CSS3DObject){var style;object.onBeforeRender(o,t,r),object instanceof CSS3DSprite?(l.copy(r.matrixWorldInverse),l.transpose(),l.copyPosition(object.matrixWorld),l.scale(object.scale),l.elements[3]=0,l.elements[7]=0,l.elements[11]=0,l.elements[15]=1,style=y(l,n)):style=y(object.matrixWorld,n);var element=object.element,h=c.objects.get(object);if(void 0===h||h.style!==style){element.style.WebkitTransform=style,element.style.transform=style;var m={style:style};f&&(m.distanceToCameraSquared=x(r,object)),c.objects.set(object,m)}element.parentNode!==d&&d.appendChild(element),object.onAfterRender(o,t,r)}for(var i=0,v=object.children.length;i<v;i++)e(object.children[i],t,r,n)}(e,e,t,A),f&&_(e)}},_geometry,_intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;function Sprite(e){if(Object3D.call(this),this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry;var t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=_geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(e,t,r,n,o,l){_alignedPosition.subVectors(e,r).addScalar(.5).multiply(n),void 0!==o?(_rotatedPosition.x=l*_alignedPosition.x-o*_alignedPosition.y,_rotatedPosition.y=o*_alignedPosition.x+l*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var r,n,o=this.material.rotation;0!==o&&(n=Math.cos(o),r=Math.sin(o));var l=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,l,_worldScale,r,n),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,l,_worldScale,r,n),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,l,_worldScale,r,n),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);var c=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(null!==c||(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,l,_worldScale,r,n),_uvB$1.set(0,1),null!==(c=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint)))){var h=e.ray.origin.distanceTo(_intersectPoint);h<e.near||h>e.far||t.push({distance:h,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(source){return Object3D.prototype.copy.call(this,source),void 0!==source.center&&this.center.copy(source.center),this}});var RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},RenderableFace=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.v3=new RenderableVertex,this.normalModel=new Vector3,this.vertexNormalsModel=[new Vector3,new Vector3,new Vector3],this.vertexNormalsLength=0,this.color=new Color,this.material=null,this.uvs=[new Vector2,new Vector2,new Vector2],this.z=0,this.renderOrder=0},RenderableVertex=function(){this.position=new Vector3,this.positionWorld=new Vector3,this.positionScreen=new Vector4,this.visible=!0};RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)};var RenderableLine=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.vertexColors=[new Color,new Color],this.material=null,this.z=0,this.renderOrder=0},RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Vector2,this.material=null,this.renderOrder=0},Projector=function(){var e,t,r,n,o,l,c,h,d,f,m,v=[],y=0,x=[],_=0,M=[],w=0,S=[],A=0,T=[],L=0,C={objects:[],lights:[],elements:[]},N=new Vector3,P=new Vector4,F=new Box3(new Vector3(-1,-1,-1),new Vector3(1,1,1)),E=new Box3,R=new Array(3),D=new Matrix4,O=new Matrix4,I=new Matrix4,B=new Matrix3,U=new Frustum,k=new Vector4,V=new Vector4;this.projectVector=function(e,t){console.warn("Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var G=new function(){var e=[],t=[],n=[],object=null,l=new Matrix3;function h(e){var t=e.position,r=e.positionWorld,n=e.positionScreen;r.copy(t).applyMatrix4(m),n.copy(r).applyMatrix4(O);var o=1/n.w;n.x*=o,n.y*=o,n.z*=o,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function d(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(R[0]=e.positionScreen,R[1]=t.positionScreen,R[2]=r.positionScreen,F.intersectsBox(E.setFromPoints(R)))}function f(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(r){object=r,l.getNormalMatrix(object.matrixWorld),e.length=0,t.length=0,n.length=0},projectVertex:h,checkTriangleVisibility:d,checkBackfaceCulling:f,pushVertex:function(e,t,n){(r=W()).position.set(e,t,n),h(r)},pushNormal:function(t,r,n){e.push(t,r,n)},pushColor:function(e,g,b){t.push(e,g,b)},pushUv:function(e,t){n.push(e,t)},pushLine:function(a,b){var e=x[a],r=x[b];e.positionScreen.copy(e.position).applyMatrix4(I),r.positionScreen.copy(r.position).applyMatrix4(I),!0===Q(e.positionScreen,r.positionScreen)&&(e.positionScreen.multiplyScalar(1/e.positionScreen.w),r.positionScreen.multiplyScalar(1/r.positionScreen.w),(c=X()).id=object.id,c.v1.copy(e),c.v2.copy(r),c.z=Math.max(e.positionScreen.z,r.positionScreen.z),c.renderOrder=object.renderOrder,c.material=object.material,object.material.vertexColors===VertexColors&&(c.vertexColors[0].fromArray(t,3*a),c.vertexColors[1].fromArray(t,3*b)),C.elements.push(c))},pushTriangle:function(a,b,r,c){var h=arguments,m=x[a],v=x[b],y=x[r];if(!1!==d(m,v,y)&&(c.side===DoubleSide||!0===f(m,v,y))){(o=H()).id=object.id,o.v1.copy(m),o.v2.copy(v),o.v3.copy(y),o.z=(m.positionScreen.z+v.positionScreen.z+y.positionScreen.z)/3,o.renderOrder=object.renderOrder,N.subVectors(y.position,v.position),P.subVectors(m.position,v.position),N.cross(P),o.normalModel.copy(N),o.normalModel.applyMatrix3(l).normalize();for(var i=0;i<3;i++){var _=o.vertexNormalsModel[i];_.fromArray(e,3*h[i]),_.applyMatrix3(l).normalize();var M=o.uvs[i];M.fromArray(n,2*h[i])}o.vertexNormalsLength=3,o.material=c,c.vertexColors!==FaceColors&&c.vertexColors!==VertexColors||o.color.fromArray(t,3*a),C.elements.push(o)}}}};function z(object){(e=function(){if(t===y){var object=new RenderableObject;return v.push(object),y++,t++,object}return v[t++]}()).id=object.id,e.object=object,N.setFromMatrixPosition(object.matrixWorld),N.applyMatrix4(O),e.z=N.z,e.renderOrder=object.renderOrder,C.objects.push(e)}function j(e,object,t){var r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&((d=function(){if(f===L){var e=new RenderableSprite;return T.push(e),L++,f++,e}return T[f++]}()).id=object.id,d.x=e.x*r,d.y=e.y*r,d.z=e.z,d.renderOrder=object.renderOrder,d.object=object,d.rotation=object.rotation,d.scale.x=object.scale.x*Math.abs(d.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),d.scale.y=object.scale.y*Math.abs(d.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),d.material=object.material,C.elements.push(d))}function W(){if(n===_){var e=new RenderableVertex;return x.push(e),_++,n++,e}return x[n++]}function H(){if(l===w){var e=new RenderableFace;return M.push(e),w++,l++,e}return M[l++]}function X(){if(h===A){var line=new RenderableLine;return S.push(line),A++,h++,line}return S[h++]}function Y(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function Q(e,t){var r=0,n=1,o=e.z+e.w,l=t.z+t.w,c=-e.z+e.w,h=-t.z+t.w;return o>=0&&l>=0&&c>=0&&h>=0||!(o<0&&l<0||c<0&&h<0)&&(o<0?r=Math.max(r,o/(o-l)):l<0&&(n=Math.min(n,o/(o-l))),c<0?r=Math.max(r,c/(c-h)):h<0&&(n=Math.min(n,c/(c-h))),!(n<r)&&(e.lerp(t,r),t.lerp(e,1-n),!0))}this.projectScene=function(e,r,d,v){l=0,h=0,f=0,C.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),D.copy(r.matrixWorldInverse),O.multiplyMatrices(r.projectionMatrix,D),U.setFromProjectionMatrix(O),t=0,C.objects.length=0,C.lights.length=0,function e(object){if(!1!==object.visible){if(object instanceof Light)C.lights.push(object);else if(object instanceof Mesh||object instanceof Line||object instanceof Points){if(!1===object.material.visible)return;if(!0===object.frustumCulled&&!1===U.intersectsObject(object))return;z(object)}else if(object instanceof Sprite){if(!1===object.material.visible)return;if(!0===object.frustumCulled&&!1===U.intersectsSprite(object))return;z(object)}for(var t=object.children,i=0,r=t.length;i<r;i++)e(t[i])}}(e),!0===d&&C.objects.sort(Y);for(var y=C.objects,_=0,ol=y.length;_<ol;_++){var object=y[_].object,M=object.geometry;if(G.setObject(object),m=object.matrixWorld,n=0,object instanceof Mesh){if(M instanceof BufferGeometry){var w=object.material,S=Array.isArray(w),A=M.attributes,T=M.groups;if(void 0===A.position)continue;for(var i=0,L=(Ne=A.position.array).length;i<L;i+=3){var F=Ne[i],E=Ne[i+1],R=Ne[i+2];if(!0===w.morphTargets)for(var K=M.morphAttributes.position,J=M.morphTargetsRelative,Z=object.morphTargetInfluences,$=0,ee=K.length;$<ee;$++){if(0!==(de=Z[$])){var te=K[$];J?(F+=te.getX(i/3)*de,E+=te.getY(i/3)*de,R+=te.getZ(i/3)*de):(F+=(te.getX(i/3)-Ne[i])*de,E+=(te.getY(i/3)-Ne[i+1])*de,R+=(te.getZ(i/3)-Ne[i+2])*de)}}G.pushVertex(F,E,R)}if(void 0!==A.normal){var re=A.normal.array;for(i=0,L=re.length;i<L;i+=3)G.pushNormal(re[i],re[i+1],re[i+2])}if(void 0!==A.color)for(i=0,L=(Le=A.color.array).length;i<L;i+=3)G.pushColor(Le[i],Le[i+1],Le[i+2]);if(void 0!==A.uv){var ie=A.uv.array;for(i=0,L=ie.length;i<L;i+=2)G.pushUv(ie[i],ie[i+1])}if(null!==M.index){var ne=M.index.array;if(T.length>0)for(var g=0;g<T.length;g++){var ae=T[g];if(void 0!==(w=!0===S?object.material[ae.materialIndex]:object.material))for(i=ae.start,L=ae.start+ae.count;i<L;i+=3)G.pushTriangle(ne[i],ne[i+1],ne[i+2],w)}else for(i=0,L=ne.length;i<L;i+=3)G.pushTriangle(ne[i],ne[i+1],ne[i+2],w)}else if(T.length>0)for(g=0;g<T.length;g++){ae=T[g];if(void 0!==(w=!0===S?object.material[ae.materialIndex]:object.material))for(i=ae.start,L=ae.start+ae.count;i<L;i+=3)G.pushTriangle(i,i+1,i+2,w)}else for(i=0,L=Ne.length/3;i<L;i+=3)G.pushTriangle(i,i+1,i+2,w)}else if(M instanceof Geometry){var oe=M.vertices,se=M.faces,le=M.faceVertexUvs[0];B.getNormalMatrix(m);w=object.material,S=Array.isArray(w);for(var ce=0,ue=oe.length;ce<ue;ce++){var he=oe[ce];if(N.copy(he),!0===w.morphTargets)for(K=M.morphTargets,Z=object.morphTargetInfluences,$=0,ee=K.length;$<ee;$++){var de;if(0!==(de=Z[$])){var pe=(te=K[$]).vertices[ce];N.x+=(pe.x-he.x)*de,N.y+=(pe.y-he.y)*de,N.z+=(pe.z-he.z)*de}}G.pushVertex(N.x,N.y,N.z)}for(var fe=0,me=se.length;fe<me;fe++){var ve=se[fe];if(void 0!==(w=!0===S?object.material[ve.materialIndex]:object.material)){var ge=w.side,ye=x[ve.a],xe=x[ve.b],be=x[ve.c];if(!1!==G.checkTriangleVisibility(ye,xe,be)){var _e=G.checkBackfaceCulling(ye,xe,be);if(ge!==DoubleSide){if(ge===FrontSide&&!1===_e)continue;if(ge===BackSide&&!0===_e)continue}(o=H()).id=object.id,o.v1.copy(ye),o.v2.copy(xe),o.v3.copy(be),o.normalModel.copy(ve.normal),!1!==_e||ge!==BackSide&&ge!==DoubleSide||o.normalModel.negate(),o.normalModel.applyMatrix3(B).normalize();for(var Me=ve.vertexNormals,we=0,Se=Math.min(Me.length,3);we<Se;we++){var Ae=o.vertexNormalsModel[we];Ae.copy(Me[we]),!1!==_e||ge!==BackSide&&ge!==DoubleSide||Ae.negate(),Ae.applyMatrix3(B).normalize()}o.vertexNormalsLength=Me.length;var Te=le[fe];if(void 0!==Te)for(var u=0;u<3;u++)o.uvs[u].copy(Te[u]);o.color=ve.color,o.material=w,o.z=(ye.positionScreen.z+xe.positionScreen.z+be.positionScreen.z)/3,o.renderOrder=object.renderOrder,C.elements.push(o)}}}}}else if(object instanceof Line){if(I.multiplyMatrices(O,m),M instanceof BufferGeometry){if(void 0!==(A=M.attributes).position){for(i=0,L=(Ne=A.position.array).length;i<L;i+=3)G.pushVertex(Ne[i],Ne[i+1],Ne[i+2]);if(void 0!==A.color){var Le;for(i=0,L=(Le=A.color.array).length;i<L;i+=3)G.pushColor(Le[i],Le[i+1],Le[i+2])}if(null!==M.index)for(i=0,L=(ne=M.index.array).length;i<L;i+=2)G.pushLine(ne[i],ne[i+1]);else{var Ce=object instanceof LineSegments?2:1;for(i=0,L=Ne.length/3-1;i<L;i+=Ce)G.pushLine(i,i+1)}}}else if(M instanceof Geometry){if(0===(oe=object.geometry.vertices).length)continue;(ye=W()).positionScreen.copy(oe[0]).applyMatrix4(I);for(Ce=object instanceof LineSegments?2:1,ce=1,ue=oe.length;ce<ue;ce++)(ye=W()).positionScreen.copy(oe[ce]).applyMatrix4(I),(ce+1)%Ce>0||(xe=x[n-2],k.copy(ye.positionScreen),V.copy(xe.positionScreen),!0===Q(k,V)&&(k.multiplyScalar(1/k.w),V.multiplyScalar(1/V.w),(c=X()).id=object.id,c.v1.positionScreen.copy(k),c.v2.positionScreen.copy(V),c.z=Math.max(k.z,V.z),c.renderOrder=object.renderOrder,c.material=object.material,object.material.vertexColors===VertexColors&&(c.vertexColors[0].copy(object.geometry.colors[ce]),c.vertexColors[1].copy(object.geometry.colors[ce-1])),C.elements.push(c)))}}else if(object instanceof Points){if(I.multiplyMatrices(O,m),M instanceof Geometry)for(ce=0,ue=(oe=object.geometry.vertices).length;ce<ue;ce++){he=oe[ce];P.set(he.x,he.y,he.z,1),P.applyMatrix4(I),j(P,object,r)}else if(M instanceof BufferGeometry){if(void 0!==(A=M.attributes).position){var Ne;for(i=0,L=(Ne=A.position.array).length;i<L;i+=3)P.set(Ne[i],Ne[i+1],Ne[i+2],1),P.applyMatrix4(I),j(P,object,r)}}}else object instanceof Sprite&&(object.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,object.matrixWorld),P.set(m.elements[12],m.elements[13],m.elements[14],1),P.applyMatrix4(O),j(P,object,r))}return!0===v&&C.elements.sort(Y),C}},SVGObject=function(e){Object3D.call(this),this.node=e};SVGObject.prototype=Object.create(Object3D.prototype),SVGObject.prototype.constructor=SVGObject;var SVGRenderer=function(){var e,t,r,n,o,l,c,h,d,f,m,v,y,x=this,_=new Projector,M=document.createElementNS("http://www.w3.org/2000/svg","svg"),w=new Box2,S=new Box2,A=new Color,T=new Color,L=new Color,C=new Color,N=new Color,P=new Color,F=new Vector3,E=new Vector3,R=new Vector3,D=new Matrix3,O=new Matrix4,I=new Matrix4,B=[],U=0,k=1,V=null;function G(){for(U=0;M.childNodes.length>0;)M.removeChild(M.childNodes[0])}function z(e){return null!==V?e.toFixed(V):e}function j(e,element,t){var r=element.scale.x*l,n=element.scale.y*c;t.isPointsMaterial&&(r*=t.size,n*=t.size);var path="M"+z(e.x-.5*r)+","+z(e.y-.5*n)+"h"+z(r)+"v"+z(n)+"h"+z(-r)+"z",style="";(t.isSpriteMaterial||t.isPointsMaterial)&&(style="fill:"+t.color.getStyle()+";fill-opacity:"+t.opacity),Y(style,path)}function W(e,t,element,r){var path="M"+z(e.positionScreen.x)+","+z(e.positionScreen.y)+"L"+z(t.positionScreen.x)+","+z(t.positionScreen.y);if(r.isLineBasicMaterial){var style="fill:none;stroke:"+r.color.getStyle()+";stroke-opacity:"+r.opacity+";stroke-width:"+r.linewidth+";stroke-linecap:"+r.linecap;r.isLineDashedMaterial&&(style=style+";stroke-dasharray:"+r.dashSize+","+r.gapSize),Y(style,path)}}function H(e,t,n,element,o){x.info.render.vertices+=3,x.info.render.faces++;var path="M"+z(e.positionScreen.x)+","+z(e.positionScreen.y)+"L"+z(t.positionScreen.x)+","+z(t.positionScreen.y)+"L"+z(n.positionScreen.x)+","+z(n.positionScreen.y)+"z";o.isMeshBasicMaterial?(A.copy(o.color),o.vertexColors!==FaceColors&&o.vertexColors!==VertexColors||A.multiply(element.color)):o.isMeshLambertMaterial||o.isMeshPhongMaterial||o.isMeshStandardMaterial?(T.copy(o.color),o.vertexColors!==FaceColors&&o.vertexColors!==VertexColors||T.multiply(element.color),A.copy(L),E.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),function(e,t,r,n){for(var o=0,l=e.length;o<l;o++){var c=e[o],h=c.color;if(c.isDirectionalLight){var d=F.setFromMatrixPosition(c.matrixWorld).normalize();if((f=r.dot(d))<=0)continue;f*=c.intensity,n.r+=h.r*f,n.g+=h.g*f,n.b+=h.b*f}else if(c.isPointLight){var f;d=F.setFromMatrixPosition(c.matrixWorld);if((f=r.dot(F.subVectors(d,t).normalize()))<=0)continue;if(0==(f*=0==c.distance?1:1-Math.min(t.distanceTo(d)/c.distance,1)))continue;f*=c.intensity,n.r+=h.r*f,n.g+=h.g*f,n.b+=h.b*f}}}(r,E,element.normalModel,A),A.multiply(T).add(o.emissive)):o.isMeshNormalMaterial&&(R.copy(element.normalModel).applyMatrix3(D).normalize(),A.setRGB(R.x,R.y,R.z).multiplyScalar(.5).addScalar(.5)),Y(o.wireframe?"fill:none;stroke:"+A.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.wireframeLinewidth+";stroke-linecap:"+o.wireframeLinecap+";stroke-linejoin:"+o.wireframeLinejoin:"fill:"+A.getStyle()+";fill-opacity:"+o.opacity,path)}function X(e,t,r){var n,o=t.x-e.x,l=t.y-e.y,c=o*o+l*l;0!==c&&(o*=n=r/Math.sqrt(c),l*=n,t.x+=o,t.y+=l,e.x-=o,e.y-=l)}function Y(style,path){y===style?v+=path:(Q(),y=style,v=path)}function Q(){v&&((m=function(e){if(null==B[e])return B[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==k&&B[e].setAttribute("shape-rendering","crispEdges"),B[e];return B[e]}(U++)).setAttribute("d",v),m.setAttribute("style",y),M.appendChild(m)),v="",y=""}this.domElement=M,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":k=1;break;case"low":k=0}},this.setClearColor=function(e){P.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){l=(n=e)/2,c=(o=t)/2,M.setAttribute("viewBox",-l+" "+-c+" "+n+" "+o),M.setAttribute("width",n),M.setAttribute("height",o),w.min.set(-l,-c),w.max.set(l,c)},this.setPrecision=function(e){V=e},this.clear=function(){G(),M.style.backgroundColor=P.getStyle()},this.render=function(n,o){if(o instanceof Camera!=!1){var m=n.background;m&&m.isColor?(G(),M.style.backgroundColor=m.getStyle()):!0===this.autoClear&&this.clear(),x.info.render.vertices=0,x.info.render.faces=0,O.copy(o.matrixWorldInverse),I.multiplyMatrices(o.projectionMatrix,O),e=_.projectScene(n,o,this.sortObjects,this.sortElements),t=e.elements,r=e.lights,D.getNormalMatrix(o.matrixWorldInverse),function(e){L.setRGB(0,0,0),C.setRGB(0,0,0),N.setRGB(0,0,0);for(var t=0,r=e.length;t<r;t++){var n=e[t],o=n.color;n.isAmbientLight?(L.r+=o.r,L.g+=o.g,L.b+=o.b):n.isDirectionalLight?(C.r+=o.r,C.g+=o.g,C.b+=o.b):n.isPointLight&&(N.r+=o.r,N.g+=o.g,N.b+=o.b)}}(r),v="",y="";for(var A=0,T=t.length;A<T;A++){var element=t[A],P=element.material;if(void 0!==P&&0!==P.opacity)if(S.makeEmpty(),element instanceof RenderableSprite)(h=element).x*=l,h.y*=-c,j(h,element,P);else if(element instanceof RenderableLine)h=element.v1,d=element.v2,h.positionScreen.x*=l,h.positionScreen.y*=-c,d.positionScreen.x*=l,d.positionScreen.y*=-c,S.setFromPoints([h.positionScreen,d.positionScreen]),!0===w.intersectsBox(S)&&W(h,d,element,P);else if(element instanceof RenderableFace){if(h=element.v1,d=element.v2,f=element.v3,h.positionScreen.z<-1||h.positionScreen.z>1)continue;if(d.positionScreen.z<-1||d.positionScreen.z>1)continue;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;h.positionScreen.x*=l,h.positionScreen.y*=-c,d.positionScreen.x*=l,d.positionScreen.y*=-c,f.positionScreen.x*=l,f.positionScreen.y*=-c,this.overdraw>0&&(X(h.positionScreen,d.positionScreen,this.overdraw),X(d.positionScreen,f.positionScreen,this.overdraw),X(f.positionScreen,h.positionScreen,this.overdraw)),S.setFromPoints([h.positionScreen,d.positionScreen,f.positionScreen]),!0===w.intersectsBox(S)&&H(h,d,f,element,P)}}Q(),n.traverseVisible((function(object){if(object instanceof SVGObject){if(F.setFromMatrixPosition(object.matrixWorld),F.applyMatrix4(I),F.z<-1||F.z>1)return;var e=F.x*l,t=-F.y*c,r=object.node;r.setAttribute("transform","translate("+e+","+t+")"),M.appendChild(r)}}))}else console.error("SVGRenderer.render: camera is not an instance of Camera.")}},BasicShader={uniforms:{},vertexShader:["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 base = texture2D( tDiffuse, vUv );","\tvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","\tfloat lum = dot( lumCoeff, base.rgb );","\tvec3 blend = vec3( lum );","\tfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","\tvec3 result1 = 2.0 * base.rgb * blend;","\tvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","\tvec3 newColor = mix( result1, result2, L );","\tfloat A2 = opacity * base.a;","\tvec3 mixRGB = A2 * newColor.rgb;","\tmixRGB += ( ( 1.0 - A2 ) * base.rgb );","\tgl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},BlendShader={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","\tvec4 texel1 = texture2D( tDiffuse1, vUv );","\tvec4 texel2 = texture2D( tDiffuse2, vUv );","\tgl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},BrightnessContrastShader={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tgl_FragColor.rgb += brightness;","\tif (contrast > 0.0) {","\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","\t} else {","\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","\t}","}"].join("\n")},ColorCorrectionShader={uniforms:{tDiffuse:{value:null},powRGB:{value:new Vector3(2,2,2)},mulRGB:{value:new Vector3(1,1,1)},addRGB:{value:new Vector3(0,0,0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n")},ColorifyShader={uniforms:{tDiffuse:{value:null},color:{value:new Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tgl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},DOFMipMapShader={uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","\tvec4 depth = texture2D( tDepth, vUv );","\tfloat factor = depth.x - focus;","\tvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","\tgl_FragColor = col;","\tgl_FragColor.a = 1.0;","}"].join("\n")},FocusShader={uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color, org, tmp, add;","\tfloat sample_dist, f;","\tvec2 vin;","\tvec2 uv = vUv;","\tadd = color = org = texture2D( tDiffuse, uv );","\tvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","\tsample_dist = dot( vin, vin ) * 2.0;","\tf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","\tvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tcolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","\tcolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","\tgl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},FreiChenShader={uniforms:{tDiffuse:{value:null},aspect:{value:new Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","\tG[0] = g0,","\tG[1] = g1,","\tG[2] = g2,","\tG[3] = g3,","\tG[4] = g4,","\tG[5] = g5,","\tG[6] = g6,","\tG[7] = g7,","\tG[8] = g8;","\tmat3 I;","\tfloat cnv[9];","\tvec3 sample;","\tfor (float i=0.0; i<3.0; i++) {","\t\tfor (float j=0.0; j<3.0; j++) {","\t\t\tsample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","\t\t\tI[int(i)][int(j)] = length(sample);","\t\t}","\t}","\tfor (int i=0; i<9; i++) {","\t\tfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","\t\tcnv[i] = dp3 * dp3;","\t}","\tfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","\tfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","\tgl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvReflect = reflect( I, worldNormal );","\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\tvec4 refractedColor = vec4( 1.0 );","\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")},FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")},GodRaysDepthMaskShader={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},GodRaysGenerateShader={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},GodRaysCombineShader={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},GodRaysFakeSunShader={uniforms:{vSunPositionScreenSpace:{value:new Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new Color(16772608)},bgColor:{value:new Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","\tgl_FragColor.w = 1.0;","}"].join("\n")},HorizontalBlurShader={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},HorizontalTiltShiftShader={uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tfloat hh = h * abs( r - vUv.y );","\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},HueSaturationShader={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tfloat angle = hue * 3.14159265;","\tfloat s = sin(angle), c = cos(angle);","\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","\tfloat len = length(gl_FragColor.rgb);","\tgl_FragColor.rgb = vec3(","\t\tdot(gl_FragColor.rgb, weights.xyz),","\t\tdot(gl_FragColor.rgb, weights.zxy),","\t\tdot(gl_FragColor.rgb, weights.yzx)","\t);","\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","\tif (saturation > 0.0) {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","\t} else {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","\t}","}"].join("\n")},KaleidoShader={uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","\tvec2 p = vUv - 0.5;","\tfloat r = length(p);","\tfloat a = atan(p.y, p.x) + angle;","\tfloat tau = 2. * 3.1416 ;","\ta = mod(a, tau/sides);","\ta = abs(a - tau/sides/2.) ;","\tp = r * vec2(cos(a), sin(a));","\tvec4 color = texture2D(tDiffuse, p + 0.5);","\tgl_FragColor = color;","}"].join("\n")},MirrorShader={uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","\tvec2 p = vUv;","\tif (side == 0){","\t\tif (p.x > 0.5) p.x = 1.0 - p.x;","\t}else if (side == 1){","\t\tif (p.x < 0.5) p.x = 1.0 - p.x;","\t}else if (side == 2){","\t\tif (p.y < 0.5) p.y = 1.0 - p.y;","\t}else if (side == 3){","\t\tif (p.y > 0.5) p.y = 1.0 - p.y;","\t} ","\tvec4 color = texture2D(tDiffuse, p);","\tgl_FragColor = color;","}"].join("\n")},NormalMapShader={uniforms:{heightMap:{value:null},resolution:{value:new Vector2(512,512)},scale:{value:new Vector2(1,1)},height:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","\tfloat val = texture2D( heightMap, vUv ).x;","\tfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","\tfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","\tgl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},ParallaxShader={modes:{none:"NO_PARALLAX",basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"},uniforms:{bumpMap:{value:null},map:{value:null},parallaxScale:{value:null},parallaxMinLayers:{value:null},parallaxMaxLayers:{value:null}},vertexShader:["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","\tvUv = uv;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvViewPosition = -mvPosition.xyz;","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","\tvec2 parallaxMap( in vec3 V ) {","\t\tfloat initialHeight = texture2D( bumpMap, vUv ).r;","\t\tvec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","\t\treturn vUv - texCoordOffset;","\t}","#else","\tvec2 parallaxMap( in vec3 V ) {","\t\tfloat numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","\t\tfloat layerHeight = 1.0 / numLayers;","\t\tfloat currentLayerHeight = 0.0;","\t\tvec2 dtex = parallaxScale * V.xy / V.z / numLayers;","\t\tvec2 currentTextureCoords = vUv;","\t\tfloat heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\tfor ( int i = 0; i < 30; i += 1 ) {","\t\t\tif ( heightFromTexture <= currentLayerHeight ) {","\t\t\t\tbreak;","\t\t\t}","\t\t\tcurrentLayerHeight += layerHeight;","\t\t\tcurrentTextureCoords -= dtex;","\t\t\theightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\t}","\t\t#ifdef USE_STEEP_PARALLAX","\t\t\treturn currentTextureCoords;","\t\t#elif defined( USE_RELIEF_PARALLAX )","\t\t\tvec2 deltaTexCoord = dtex / 2.0;","\t\t\tfloat deltaHeight = layerHeight / 2.0;","\t\t\tcurrentTextureCoords += deltaTexCoord;","\t\t\tcurrentLayerHeight -= deltaHeight;","\t\t\tconst int numSearches = 5;","\t\t\tfor ( int i = 0; i < numSearches; i += 1 ) {","\t\t\t\tdeltaTexCoord /= 2.0;","\t\t\t\tdeltaHeight /= 2.0;","\t\t\t\theightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\t\t\tif( heightFromTexture > currentLayerHeight ) {","\t\t\t\t\tcurrentTextureCoords -= deltaTexCoord;","\t\t\t\t\tcurrentLayerHeight += deltaHeight;","\t\t\t\t} else {","\t\t\t\t\tcurrentTextureCoords += deltaTexCoord;","\t\t\t\t\tcurrentLayerHeight -= deltaHeight;","\t\t\t\t}","\t\t\t}","\t\t\treturn currentTextureCoords;","\t\t#elif defined( USE_OCLUSION_PARALLAX )","\t\t\tvec2 prevTCoords = currentTextureCoords + dtex;","\t\t\tfloat nextH = heightFromTexture - currentLayerHeight;","\t\t\tfloat prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","\t\t\tfloat weight = nextH / ( nextH - prevH );","\t\t\treturn prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","\t\t#else","\t\t\treturn vUv;","\t\t#endif","\t}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","\tvec2 texDx = dFdx( vUv );","\tvec2 texDy = dFdy( vUv );","\tvec3 vSigmaX = dFdx( surfPosition );","\tvec3 vSigmaY = dFdy( surfPosition );","\tvec3 vR1 = cross( vSigmaY, surfNormal );","\tvec3 vR2 = cross( surfNormal, vSigmaX );","\tfloat fDet = dot( vSigmaX, vR1 );","\tvec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","\tvec3 vProjVtex;","\tvProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","\tvProjVtex.z = dot( surfNormal, viewPosition );","\treturn parallaxMap( vProjVtex );","}","void main() {","\tvec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","\tgl_FragColor = texture2D( map, mapUv );","}"].join("\n")},PixelShader={uniforms:{tDiffuse:{value:null},resolution:{value:null},pixelSize:{value:1}},vertexShader:["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n")},RGBShiftShader={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\tvec4 cr = texture2D(tDiffuse, vUv + offset);","\tvec4 cga = texture2D(tDiffuse, vUv);","\tvec4 cb = texture2D(tDiffuse, vUv - offset);","\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tvec3 c = color.rgb;","\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},SobelOperatorShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","\tconst mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","\tconst mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","\tfloat tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","\tfloat tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","\tfloat tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","\tfloat tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","\tfloat tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","\tfloat tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","\tfloat tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","\tfloat tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","\tfloat tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","\tfloat valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","\t\tGx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","\t\tGx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","\tfloat valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","\t\tGy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","\t\tGy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","\tfloat G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","\tgl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n")},TechnicolorShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tvec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","\tgl_FragColor = newTex;","}"].join("\n")},ToonShader1={uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvNormal = normalize( normalMatrix * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvRefract = refract( normalize( I ), worldNormal, 1.02 );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","\tfloat directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","\tvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","\tfloat intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","\tintensity += length(lightWeighting) * 0.2;","\tfloat cameraWeighting = dot( normalize( vNormal ), vRefract );","\tintensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","\tintensity = intensity * 0.2 + 0.3;","\tif ( intensity < 0.50 ) {","\t\tgl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","\t} else {","\t\tgl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},ToonShader2={uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(15658734)},uLineColor1:{value:new Color(8421504)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","\tfloat camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","\tfloat light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","\tgl_FragColor = vec4( uBaseColor, 1.0 );","\tif ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","\t\tgl_FragColor *= vec4( uLineColor1, 1.0 );","\t}","\tif ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","\t\tgl_FragColor *= vec4( uLineColor2, 1.0 );","\t}","}"].join("\n")},ToonShaderHatching={uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","\tfloat directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","\tvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","\tgl_FragColor = vec4( uBaseColor, 1.0 );","\tif ( length(lightWeighting) < 1.00 ) {","\t\tif ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.75 ) {","\t\tif (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor2, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.50 ) {","\t\tif (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor3, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.3465 ) {","\t\tif (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor4, 1.0 );","\t}","\t}","}"].join("\n")},ToonShaderDotted={uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","\t\tif ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.50 ) {","\t\tif ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","}"].join("\n")},TranslucentShader={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.lights,{color:{value:new Color(16777215)},diffuse:{value:new Color(16777215)},specular:{value:new Color(16777215)},emissive:{value:new Color(0)},opacity:{value:1},shininess:{value:1},thicknessMap:{value:null},thicknessColor:{value:new Color(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,"void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvViewPosition = -mvPosition.xyz;","\tvNormal = normalize( normalMatrix * normal );","\tvUv = uv;","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["#define USE_UV","#define USE_MAP","#define PHONG","#define TRANSLUCENT","#include <common>","#include <bsdfs>","#include <uv_pars_fragment>","#include <map_pars_fragment>","#include <lights_phong_pars_fragment>","varying vec3 vColor;","uniform vec3 diffuse;","uniform vec3 specular;","uniform vec3 emissive;","uniform float opacity;","uniform float shininess;","uniform sampler2D thicknessMap;","uniform float thicknessPower;","uniform float thicknessScale;","uniform float thicknessDistortion;","uniform float thicknessAmbient;","uniform float thicknessAttenuation;","uniform vec3 thicknessColor;",ShaderChunk.lights_pars_begin,"void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in GeometricContext geometry, inout ReflectedLight reflectedLight) {","\tvec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;","\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * thicknessDistortion));","\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), thicknessPower) * thicknessScale;","\tvec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;","\treflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;","}","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 viewerDirection = normalize( vViewPosition );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",ShaderChunk.map_fragment,ShaderChunk.color_fragment,ShaderChunk.specularmap_fragment,"\tvec3 totalEmissiveRadiance = emissive;",ShaderChunk.lights_phong_fragment,"\tGeometricContext geometry;","\tgeometry.position = - vViewPosition;","\tgeometry.normal = normal;","\tgeometry.viewDir = normalize( vViewPosition );","\tIncidentLight directLight;","\t#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )","\t\tPointLight pointLight;","\t\t#pragma unroll_loop","\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","\t\t \tpointLight = pointLights[ i ];","\t\t \tgetPointDirectLightIrradiance( pointLight, geometry, directLight );","\t\t\t#ifdef USE_SHADOWMAP","\t\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;","\t\t\t#endif","\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );","\t\t\t#if defined( TRANSLUCENT ) && defined( USE_UV )","\t\t\tRE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);","\t\t\t#endif","\t\t}","\t\t#endif","\t#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )","\t\tDirectionalLight directionalLight;","\t\t#pragma unroll_loop","\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {","\t\t\tdirectionalLight = directionalLights[ i ];","\t\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );","\t\t\t#ifdef USE_SHADOWMAP","\t\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","\t\t\t#endif","\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );","\t\t\t#if defined( TRANSLUCENT ) && defined( USE_UV )","\t\t\tRE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);","\t\t\t#endif","\t\t}","\t#endif","\t#if defined( RE_IndirectDiffuse )","\t\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );","\t\t#if ( NUM_HEMI_LIGHTS > 0 )","\t\t\t#pragma unroll_loop","\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","\t\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );","\t\t\t}","\t\t#endif","\t#endif","\t#if defined( RE_IndirectSpecular )","\t\tvec3 radiance = vec3( 0.0 );","\t\tvec3 clearcoatRadiance = vec3( 0.0 );","\t#endif",ShaderChunk.lights_fragment_end,"\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );",ShaderChunk.encodings_fragment,"}"].join("\n")},TriangleBlurShader={uniforms:{texture:{value:null},delta:{value:new Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","\tvec4 color = vec4( 0.0 );","\tfloat total = 0.0;","\tfloat offset = rand( vUv );","\tfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","\t\tfloat percent = ( t + offset - 0.5 ) / ITERATIONS;","\t\tfloat weight = 1.0 - abs( percent );","\t\tcolor += texture2D( texture, vUv + delta * percent ) * weight;","\t\ttotal += weight;","\t}","\tgl_FragColor = color / total;","}"].join("\n")},VerticalBlurShader={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},VerticalTiltShiftShader={uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tfloat vv = v * abs( r - vUv.y );","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},VolumeRenderShader1={uniforms:{u_size:{value:new Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tvarying vec3 v_position;","\t\tmat4 inversemat(mat4 m) {","\t\t\t\tfloat","\t\t\t\ta00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","\t\t\t\ta10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","\t\t\t\ta20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","\t\t\t\ta30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","\t\t\t\tb00 = a00 * a11 - a01 * a10,","\t\t\t\tb01 = a00 * a12 - a02 * a10,","\t\t\t\tb02 = a00 * a13 - a03 * a10,","\t\t\t\tb03 = a01 * a12 - a02 * a11,","\t\t\t\tb04 = a01 * a13 - a03 * a11,","\t\t\t\tb05 = a02 * a13 - a03 * a12,","\t\t\t\tb06 = a20 * a31 - a21 * a30,","\t\t\t\tb07 = a20 * a32 - a22 * a30,","\t\t\t\tb08 = a20 * a33 - a23 * a30,","\t\t\t\tb09 = a21 * a32 - a22 * a31,","\t\t\t\tb10 = a21 * a33 - a23 * a31,","\t\t\t\tb11 = a22 * a33 - a23 * a32,","\t\t\t\tdet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","\t\treturn mat4(","\t\t\t\ta11 * b11 - a12 * b10 + a13 * b09,","\t\t\t\ta02 * b10 - a01 * b11 - a03 * b09,","\t\t\t\ta31 * b05 - a32 * b04 + a33 * b03,","\t\t\t\ta22 * b04 - a21 * b05 - a23 * b03,","\t\t\t\ta12 * b08 - a10 * b11 - a13 * b07,","\t\t\t\ta00 * b11 - a02 * b08 + a03 * b07,","\t\t\t\ta32 * b02 - a30 * b05 - a33 * b01,","\t\t\t\ta20 * b05 - a22 * b02 + a23 * b01,","\t\t\t\ta10 * b10 - a11 * b08 + a13 * b06,","\t\t\t\ta01 * b08 - a00 * b10 - a03 * b06,","\t\t\t\ta30 * b04 - a31 * b02 + a33 * b00,","\t\t\t\ta21 * b02 - a20 * b04 - a23 * b00,","\t\t\t\ta11 * b07 - a10 * b09 - a12 * b06,","\t\t\t\ta00 * b09 - a01 * b07 + a02 * b06,","\t\t\t\ta31 * b01 - a30 * b03 - a32 * b00,","\t\t\t\ta20 * b03 - a21 * b01 + a22 * b00) / det;","\t\t}","\t\tvoid main() {","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inversemat(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;","\t\t\t\tpos_in_cam.z = -pos_in_cam.w;","\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;","\t\t\t\tpos_in_cam.z = pos_in_cam.w;","\t\t\t\tv_farpos = viewtransformi * pos_in_cam;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","\t\t}"].join("\n"),fragmentShader:["\t\tprecision highp float;","\t\tprecision mediump sampler3D;","\t\tuniform vec3 u_size;","\t\tuniform int u_renderstyle;","\t\tuniform float u_renderthreshold;","\t\tuniform vec2 u_clim;","\t\tuniform sampler3D u_data;","\t\tuniform sampler2D u_cmdata;","\t\tvarying vec3 v_position;","\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","\t\tconst int REFINEMENT_STEPS = 4;","\t\tconst float relative_step_size = 1.0;","\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","\t\tconst float shininess = 40.0;","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tfloat sample1(vec3 texcoords);","\t\tvec4 apply_colormap(float val);","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","\t\tvoid main() {","\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;","\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;","\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));","\t\t\t\tvec3 front = v_position + view_ray * distance;","\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);","\t\t\t\tif ( nsteps < 1 )","\t\t\t\t\t\tdiscard;","\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);","\t\t\t\tvec3 start_loc = front / u_size;","\t\t\t\tif (u_renderstyle == 0)","\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);","\t\t\t\telse if (u_renderstyle == 1)","\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);","\t\t\t\tif (gl_FragColor.a < 0.05)","\t\t\t\t\t\tdiscard;","\t\t}","\t\tfloat sample1(vec3 texcoords) {","\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */","\t\t\t\treturn texture(u_data, texcoords.xyz).r;","\t\t}","\t\tvec4 apply_colormap(float val) {","\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));","\t\t}","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tfloat max_val = -1e6;","\t\t\t\tint max_i = 100;","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > max_val) {","\t\t\t\t\t\t\t\tmax_val = val;","\t\t\t\t\t\t\t\tmax_i = iter;","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);","\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));","\t\t\t\t\t\tiloc += istep;","\t\t\t\t}","\t\t\t\tgl_FragColor = apply_colormap(max_val);","\t\t}","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent","\t\t\t\tvec4 color3 = vec4(0.0);\t// final color","\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > low_threshold) {","\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;","\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);","\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {","\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);","\t\t\t\t\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t\tiloc += istep;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t}","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","\t\t{","\t\t\t\tvec3 V = normalize(view_ray);","\t\t\t\tvec3 N;","\t\t\t\tfloat val1, val2;","\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","\t\t\t\tN[0] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));","\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));","\t\t\t\tN[1] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","\t\t\t\tN[2] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tfloat gm = length(N); // gradient magnitude","\t\t\t\tN = normalize(N);","\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);","\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tfor (int i=0; i<1; i++)","\t\t\t\t{","\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];","\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );","\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));","\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);","\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector","\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);","\t\t\t\t\t\tfloat mask1 = lightEnabled;","\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;","\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;","\t\t\t\t}","\t\t\t\tvec4 final_color;","\t\t\t\tvec4 color = apply_colormap(val);","\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;","\t\t\t\tfinal_color.a = color.a;","\t\t\t\treturn final_color;","\t\t}"].join("\n")},WaterRefractionShader={uniforms:{color:{value:null},time:{value:0},tDiffuse:{value:null},tDudv:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,o=r.position.array,l=r.normal.array,c=r.uv.array,h=o.length/3;void 0===r.tangent&&e.setAttribute("tangent",new BufferAttribute(new Float32Array(4*h),4));for(var d=r.tangent.array,f=[],m=[],i=0;i<h;i++)f[i]=new Vector3,m[i]=new Vector3;var v=new Vector3,y=new Vector3,x=new Vector3,_=new Vector2,M=new Vector2,w=new Vector2,S=new Vector3,A=new Vector3,T=e.groups;0===T.length&&(T=[{start:0,count:n.length}]);i=0;for(var L=T.length;i<L;++i)for(var C=U=(B=T[i]).start,N=U+B.count;C<N;C+=3)k(n[C+0],n[C+1],n[C+2]);var P,F,E,R=new Vector3,D=new Vector3,O=new Vector3,I=new Vector3;for(i=0,L=T.length;i<L;++i){var B,U;for(C=U=(B=T[i]).start,N=U+B.count;C<N;C+=3)V(n[C+0]),V(n[C+1]),V(n[C+2])}}else console.warn("BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function k(a,b,e){v.fromArray(o,3*a),y.fromArray(o,3*b),x.fromArray(o,3*e),_.fromArray(c,2*a),M.fromArray(c,2*b),w.fromArray(c,2*e),y.sub(v),x.sub(v),M.sub(_),w.sub(_);var t=1/(M.x*w.y-w.x*M.y);isFinite(t)&&(S.copy(y).multiplyScalar(w.y).addScaledVector(x,-M.y).multiplyScalar(t),A.copy(x).multiplyScalar(M.x).addScaledVector(y,-w.x).multiplyScalar(t),f[a].add(S),f[b].add(S),f[e].add(S),m[a].add(A),m[b].add(A),m[e].add(A))}function V(e){O.fromArray(l,3*e),I.copy(O),F=f[e],R.copy(F),R.sub(O.multiplyScalar(O.dot(F))).normalize(),D.crossVectors(I,F),E=D.dot(m[e]),P=E<0?-1:1,d[4*e]=R.x,d[4*e+1]=R.y,d[4*e+2]=R.z,d[4*e+3]=P}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),l={},c={},h=e[0].morphTargetsRelative,d=new BufferGeometry,f=0,i=0;i<e.length;++i){var m=e[i];if(r!==(null!==m.index))return null;for(var v in m.attributes){if(!n.has(v))return null;void 0===l[v]&&(l[v]=[]),l[v].push(m.attributes[v])}if(h!==m.morphTargetsRelative)return null;for(var v in m.morphAttributes){if(!o.has(v))return null;void 0===c[v]&&(c[v]=[]),c[v].push(m.morphAttributes[v])}if(d.userData.mergedUserData=d.userData.mergedUserData||[],d.userData.mergedUserData.push(m.userData),t){var y;if(r)y=m.index.count;else{if(void 0===m.attributes.position)return null;y=m.attributes.position.count}d.addGroup(f,y,i),f+=y}}if(r){var x=0,_=[];for(i=0;i<e.length;++i){for(var M=e[i].index,w=0;w<M.count;++w)_.push(M.getX(w)+x);x+=e[i].attributes.position.count}d.setIndex(_)}for(var v in l){var S=this.mergeBufferAttributes(l[v]);if(!S)return null;d.setAttribute(v,S)}for(var v in c){var A=c[v][0].length;if(0===A)break;d.morphAttributes=d.morphAttributes||{},d.morphAttributes[v]=[];for(i=0;i<A;++i){var T=[];for(w=0;w<c[v].length;++w)T.push(c[v][w][i]);var L=this.mergeBufferAttributes(T);if(!L)return null;d.morphAttributes[v].push(L)}}return d},mergeBufferAttributes:function(e){for(var t,r,n,o=0,i=0;i<e.length;++i){var l=e[i];if(l.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=l.array.constructor),t!==l.array.constructor)return null;if(void 0===r&&(r=l.itemSize),r!==l.itemSize)return null;if(void 0===n&&(n=l.normalized),n!==l.normalized)return null;o+=l.array.length}var c=new t(o),h=0;for(i=0;i<e.length;++i)c.set(e[i].array,h),h+=e[i].array.length;return new BufferAttribute(c,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,i=0,o=e.length;i<o;++i){var l=e[i];if(void 0===t&&(t=l.array.constructor),t!==l.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=l.array.length,n+=l.itemSize}var c=new InterleavedBuffer(new t(r),n),h=0,d=[],f=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"],v=0;for(o=e.length;v<o;v++){var y=(l=e[v]).itemSize,x=l.count,_=new InterleavedBufferAttribute(c,y,h,l.normalized);d.push(_),h+=y;for(var M=0;M<x;M++)for(var w=0;w<y;w++)_[m[w]](M,l[f[w]](M))}return d},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t){void 0===t&&(t=1e-4),t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),o=e.getAttribute("position"),l=n?n.count:o.count,c=0,h=Object.keys(e.attributes),d={},f={},m=[],v=["getX","getY","getZ","getW"],i=0,y=h.length;i<y;i++){d[A=h[i]]=[],(N=e.morphAttributes[A])&&(f[A]=new Array(N.length).fill().map((function(){return[]})))}var x=Math.log10(1/t),_=Math.pow(10,x);for(i=0;i<l;i++){var M=n?n.getX(i):i,w="",S=0;for(y=h.length;S<y;S++)for(var A=h[S],T=(C=e.getAttribute(A)).itemSize,L=0;L<T;L++)w+=~~(C[v[L]](M)*_)+",";if(w in r)m.push(r[w]);else{for(S=0,y=h.length;S<y;S++){A=h[S];var C=e.getAttribute(A),N=e.morphAttributes[A],P=(T=C.itemSize,d[A]),F=f[A];for(L=0;L<T;L++){var E=v[L];if(P.push(C[E](M)),N)for(var R=0,D=N.length;R<D;R++)F[R].push(N[R][E](M))}}r[w]=c,m.push(c),c++}}var O=e.clone();for(i=0,y=h.length;i<y;i++){A=h[i];var I=e.getAttribute(A);C=new BufferAttribute(new I.array.constructor(d[A]),I.itemSize,I.normalized);if(O.setAttribute(A,C),A in f)for(S=0;S<f[A].length;S++){var B=e.morphAttributes[A][S],U=new BufferAttribute(new B.array.constructor(f[A][S]),B.itemSize,B.normalized);O.morphAttributes[A][S]=U}}return O.setIndex(m),O},toTrianglesDrawMode:function(e,t){if(t===TrianglesDrawMode)return console.warn("BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===TriangleFanDrawMode||t===TriangleStripDrawMode){var r=e.getIndex();if(null===r){var n=[],o=e.getAttribute("position");if(void 0===o)return console.error("BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)n.push(i);e.setIndex(n),r=e.getIndex()}var l=r.count-2,c=[];if(t===TriangleFanDrawMode)for(i=1;i<=l;i++)c.push(r.getX(0)),c.push(r.getX(i)),c.push(r.getX(i+1));else for(i=0;i<l;i++)i%2==0?(c.push(r.getX(i)),c.push(r.getX(i+1)),c.push(r.getX(i+2))):(c.push(r.getX(i+2)),c.push(r.getX(i+1)),c.push(r.getX(i)));c.length/3!==l&&console.error("BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var h=e.clone();return h.setIndex(c),h.clearGroups(),h}return console.error("BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}},GeometryCompressionUtils={compressNormals:function(e,t){e.geometry||console.error("Mesh must contain geometry. ");var r=e.geometry.attributes.normal;if(r||console.error("Geometry must contain normal attribute. "),!r.isPacked){3!=r.itemSize&&console.error("normal.itemSize is not 3, which cannot be encoded. ");var n,o=r.array,l=r.count;if("DEFAULT"==t){n=new Uint8Array(3*l);for(var c=0;c<o.length;c+=3){var h;h=this.EncodingFuncs.defaultEncode(o[c],o[c+1],o[c+2],1),n[c+0]=h[0],n[c+1]=h[1],n[c+2]=h[2]}e.geometry.setAttribute("normal",new BufferAttribute(n,3,!0)),e.geometry.attributes.normal.bytes=1*n.length}else if("OCT1Byte"==t){n=new Int8Array(2*l);for(var d=0;d<o.length;d+=3){var f;f=this.EncodingFuncs.octEncodeBest(o[d],o[d+1],o[d+2],1),n[d/3*2+0]=f[0],n[d/3*2+1]=f[1]}e.geometry.setAttribute("normal",new BufferAttribute(n,2,!0)),e.geometry.attributes.normal.bytes=1*n.length}else if("OCT2Byte"==t){n=new Int16Array(2*l);for(var m=0;m<o.length;m+=3){var v;v=this.EncodingFuncs.octEncodeBest(o[m],o[m+1],o[m+2],2),n[m/3*2+0]=v[0],n[m/3*2+1]=v[1]}e.geometry.setAttribute("normal",new BufferAttribute(n,2,!0)),e.geometry.attributes.normal.bytes=2*n.length}else if("ANGLES"==t){n=new Uint16Array(2*l);for(var y=0;y<o.length;y+=3){var x;x=this.EncodingFuncs.anglesEncode(o[y],o[y+1],o[y+2]),n[y/3*2+0]=x[0],n[y/3*2+1]=x[1]}e.geometry.setAttribute("normal",new BufferAttribute(n,2,!0)),e.geometry.attributes.normal.bytes=2*n.length}else console.error("Unrecognized encoding method, should be `DEFAULT` or `ANGLES` or `OCT`. ");e.geometry.attributes.normal.needsUpdate=!0,e.geometry.attributes.normal.isPacked=!0,e.geometry.attributes.normal.packingMethod=t,e.material instanceof PackedPhongMaterial||(e.material=(new PackedPhongMaterial).copy(e.material)),"ANGLES"==t&&(e.material.defines.USE_PACKED_NORMAL=0),"OCT1Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"OCT2Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"DEFAULT"==t&&(e.material.defines.USE_PACKED_NORMAL=2)}},compressPositions:function(e){e.geometry||console.error("Mesh must contain geometry. ");var t=e.geometry.attributes.position;if(t||console.error("Geometry must contain position attribute. "),!t.isPacked){3!=t.itemSize&&console.error("position.itemSize is not 3, which cannot be packed. ");var r=t.array,n=(t.count,this.EncodingFuncs.quantizedEncode(r,2)),o=n.quantized,l=n.decodeMat;null==e.geometry.boundingBox&&e.geometry.computeBoundingBox(),null==e.geometry.boundingSphere&&e.geometry.computeBoundingSphere(),e.geometry.setAttribute("position",new BufferAttribute(o,3)),e.geometry.attributes.position.isPacked=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.position.bytes=2*o.length,e.material instanceof PackedPhongMaterial||(e.material=(new PackedPhongMaterial).copy(e.material)),e.material.defines.USE_PACKED_POSITION=0,e.material.uniforms.quantizeMatPos.value=l,e.material.uniforms.quantizeMatPos.needsUpdate=!0}},compressUvs:function(e){e.geometry||console.error("Mesh must contain geometry property. ");var t=e.geometry.attributes.uv;if(t||console.error("Geometry must contain uv attribute. "),!t.isPacked){for(var r,n={min:1/0,max:-1/0},o=t.array,i=(t.count,0);i<o.length;i++)n.min=Math.min(n.min,o[i]),n.max=Math.max(n.max,o[i]);if(n.min>=-1&&n.max<=1){r=new Uint16Array(o.length);for(var l=0;l<o.length;l+=2){var c=this.EncodingFuncs.defaultEncode(o[l],o[l+1],0,2);r[l]=c[0],r[l+1]=c[1]}e.geometry.setAttribute("uv",new BufferAttribute(r,2,!0)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*r.length,e.material instanceof PackedPhongMaterial||(e.material=(new PackedPhongMaterial).copy(e.material)),e.material.defines.USE_PACKED_UV=0}else r=this.EncodingFuncs.quantizedEncodeUV(o,2),e.geometry.setAttribute("uv",new BufferAttribute(r.quantized,2)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*r.quantized.length,e.material instanceof PackedPhongMaterial||(e.material=(new PackedPhongMaterial).copy(e.material)),e.material.defines.USE_PACKED_UV=1,e.material.uniforms.quantizeMatUV.value=r.decodeMat,e.material.uniforms.quantizeMatUV.needsUpdate=!0}},EncodingFuncs:{defaultEncode:function(e,t,r,n){if(1==n){var o=Math.round(.5*(e+1)*255),l=Math.round(.5*(t+1)*255),c=Math.round(.5*(r+1)*255);return new Uint8Array([o,l,c])}if(2==n){var h=Math.round(.5*(e+1)*65535),d=Math.round(.5*(t+1)*65535),f=Math.round(.5*(r+1)*65535);return new Uint16Array([h,d,f])}console.error("number of bytes must be 1 or 2")},defaultDecode:function(e,t){return 1==t?[e[0]/255*2-1,e[1]/255*2-1,e[2]/255*2-1]:2==t?[e[0]/65535*2-1,e[1]/65535*2-1,e[2]/65535*2-1]:void console.error("number of bytes must be 1 or 2")},anglesEncode:function(e,t,r){var n=parseInt(.5*(1+Math.atan2(t,e)/Math.PI)*65535),o=parseInt(.5*(1+r)*65535);return new Uint16Array([n,o])},octEncodeBest:function(e,t,r,n){var o,l,c,h,d;return c=o=f(e,t,r,"floor","floor"),l=m(o),h=d=v(e,t,r,l),l=m(o=f(e,t,r,"ceil","floor")),(h=v(e,t,r,l))>d&&(c=o,d=h),l=m(o=f(e,t,r,"floor","ceil")),(h=v(e,t,r,l))>d&&(c=o,d=h),l=m(o=f(e,t,r,"ceil","ceil")),(h=v(e,t,r,l))>d&&(c=o,d=h),c;function f(e,t,o,l,c){var h=e/(Math.abs(e)+Math.abs(t)+Math.abs(o)),d=t/(Math.abs(e)+Math.abs(t)+Math.abs(o));if(r<0){var f,m;f=(1-Math.abs(d))*(h>=0?1:-1),m=(1-Math.abs(h))*(d>=0?1:-1),h=f,d=m;var v=1-Math.abs(h)-Math.abs(d);v>0&&(v+=.001,h+=h>0?v/2:-v/2,d+=d>0?v/2:-v/2)}return 1==n?new Int8Array([Math[l](127.5*h+(h<0?1:0)),Math[c](127.5*d+(d<0?1:0))]):2==n?new Int16Array([Math[l](32767.5*h+(h<0?1:0)),Math[c](32767.5*d+(d<0?1:0))]):void 0}function m(e){var t=e[0],r=e[1];1==n?(t/=t<0?127:128,r/=r<0?127:128):2==n&&(t/=t<0?32767:32768,r/=r<0?32767:32768);var o=1-Math.abs(t)-Math.abs(r);if(o<0){var l=t;t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(l))*(r>=0?1:-1)}var c=Math.sqrt(t*t+r*r+o*o);return[t/c,r/c,o/c]}function v(e,t,r,n){return e*n[0]+t*n[1]+r*n[2]}},quantizedEncode:function(e,t){var r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");var o=new Matrix4,l=new Float32Array(3),c=new Float32Array(3);l[0]=l[1]=l[2]=Number.MAX_VALUE,c[0]=c[1]=c[2]=-Number.MAX_VALUE;for(var i=0;i<e.length;i+=3)l[0]=Math.min(l[0],e[i+0]),l[1]=Math.min(l[1],e[i+1]),l[2]=Math.min(l[2],e[i+2]),c[0]=Math.max(c[0],e[i+0]),c[1]=Math.max(c[1],e[i+1]),c[2]=Math.max(c[2],e[i+2]);o.scale(new Vector3((c[0]-l[0])/n,(c[1]-l[1])/n,(c[2]-l[2])/n)),o.elements[12]=l[0],o.elements[13]=l[1],o.elements[14]=l[2],o.transpose();for(var h=new Float32Array([c[0]!==l[0]?n/(c[0]-l[0]):0,c[1]!==l[1]?n/(c[1]-l[1]):0,c[2]!==l[2]?n/(c[2]-l[2]):0]),d=0;d<e.length;d+=3)r[d+0]=Math.floor((e[d+0]-l[0])*h[0]),r[d+1]=Math.floor((e[d+1]-l[1])*h[1]),r[d+2]=Math.floor((e[d+2]-l[2])*h[2]);return{quantized:r,decodeMat:o}},quantizedEncodeUV:function(e,t){var r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");var o=new Matrix3,l=new Float32Array(2),c=new Float32Array(2);l[0]=l[1]=Number.MAX_VALUE,c[0]=c[1]=-Number.MAX_VALUE;for(var i=0;i<e.length;i+=2)l[0]=Math.min(l[0],e[i+0]),l[1]=Math.min(l[1],e[i+1]),c[0]=Math.max(c[0],e[i+0]),c[1]=Math.max(c[1],e[i+1]);o.scale((c[0]-l[0])/n,(c[1]-l[1])/n),o.elements[6]=l[0],o.elements[7]=l[1],o.transpose();for(var h=new Float32Array([c[0]!==l[0]?n/(c[0]-l[0]):0,c[1]!==l[1]?n/(c[1]-l[1]):0]),d=0;d<e.length;d+=2)r[d+0]=Math.floor((e[d+0]-l[0])*h[0]),r[d+1]=Math.floor((e[d+1]-l[1])*h[1]);return{quantized:r,decodeMat:o}}}};function PackedPhongMaterial(e){MeshPhongMaterial.call(this),this.defines={},this.type="PackedPhongMaterial",this.uniforms=UniformsUtils.merge([ShaderLib.phong.uniforms,{quantizeMatPos:{value:null},quantizeMatUV:{value:null}}]),this.vertexShader=["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif",ShaderChunk.common,ShaderChunk.uv_pars_vertex,ShaderChunk.uv2_pars_vertex,ShaderChunk.displacementmap_pars_vertex,ShaderChunk.envmap_pars_vertex,ShaderChunk.color_pars_vertex,ShaderChunk.fog_pars_vertex,ShaderChunk.morphtarget_pars_vertex,ShaderChunk.skinning_pars_vertex,ShaderChunk.shadowmap_pars_vertex,ShaderChunk.logdepthbuf_pars_vertex,ShaderChunk.clipping_planes_pars_vertex,"#ifdef USE_PACKED_NORMAL\n            #if USE_PACKED_NORMAL == 0\n                vec3 decodeNormal(vec3 packedNormal)\n                { \n                    float x = packedNormal.x * 2.0 - 1.0;\n                    float y = packedNormal.y * 2.0 - 1.0;\n                    vec2 scth = vec2(sin(x * PI), cos(x * PI));\n                    vec2 scphi = vec2(sqrt(1.0 - y * y), y); \n                    return normalize( vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y) );\n                } \n            #endif\n\n            #if USE_PACKED_NORMAL == 1\n                vec3 decodeNormal(vec3 packedNormal)\n                { \n                    vec3 v = vec3(packedNormal.xy, 1.0 - abs(packedNormal.x) - abs(packedNormal.y));\n                    if (v.z < 0.0) \n                    {\n                        v.xy = (1.0 - abs(v.yx)) * vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n                    }\n                    return normalize(v);\n                }\n            #endif\n\n            #if USE_PACKED_NORMAL == 2\n                vec3 decodeNormal(vec3 packedNormal)\n                {\n                    vec3 v = (packedNormal * 2.0) - 1.0;\n                    return normalize(v);\n                }\n            #endif\n        #endif","#ifdef USE_PACKED_POSITION\n            #if USE_PACKED_POSITION == 0\n                uniform mat4 quantizeMatPos;\n            #endif\n        #endif","#ifdef USE_PACKED_UV\n            #if USE_PACKED_UV == 1\n                uniform mat3 quantizeMatUV;\n            #endif\n        #endif","#ifdef USE_PACKED_UV\n            #if USE_PACKED_UV == 0\n                vec2 decodeUV(vec2 packedUV)\n                {\n                    vec2 uv = (packedUV * 2.0) - 1.0;\n                    return uv;\n                }\n            #endif\n\n            #if USE_PACKED_UV == 1\n                vec2 decodeUV(vec2 packedUV)\n                {\n                    vec2 uv = ( vec3(packedUV, 1.0) * quantizeMatUV ).xy;\n                    return uv;\n                }\n            #endif\n        #endif","void main() {",ShaderChunk.uv_vertex,"\n        #ifdef USE_UV\n            #ifdef USE_PACKED_UV\n                vUv = decodeUV(vUv);\n            #endif\n        #endif\n        ",ShaderChunk.uv2_vertex,ShaderChunk.color_vertex,ShaderChunk.beginnormal_vertex,"#ifdef USE_PACKED_NORMAL\n            objectNormal = decodeNormal(objectNormal);\n        #endif\n\n        #ifdef USE_TANGENT\n            vec3 objectTangent = vec3( tangent.xyz );\n        #endif\n        ",ShaderChunk.morphnormal_vertex,ShaderChunk.skinbase_vertex,ShaderChunk.skinnormal_vertex,ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","vNormal = normalize( transformedNormal );","#endif",ShaderChunk.begin_vertex,"#ifdef USE_PACKED_POSITION\n            #if USE_PACKED_POSITION == 0\n                transformed = ( vec4(transformed, 1.0) * quantizeMatPos ).xyz;\n            #endif\n        #endif",ShaderChunk.morphtarget_vertex,ShaderChunk.skinning_vertex,ShaderChunk.displacementmap_vertex,ShaderChunk.project_vertex,ShaderChunk.logdepthbuf_vertex,ShaderChunk.clipping_planes_vertex,"vViewPosition = - mvPosition.xyz;",ShaderChunk.worldpos_vertex,ShaderChunk.envmap_vertex,ShaderChunk.shadowmap_vertex,ShaderChunk.fog_vertex,"}"].join("\n"),this.fragmentShader=["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",ShaderChunk.common,ShaderChunk.packing,ShaderChunk.dithering_pars_fragment,ShaderChunk.color_pars_fragment,ShaderChunk.uv_pars_fragment,ShaderChunk.uv2_pars_fragment,ShaderChunk.map_pars_fragment,ShaderChunk.alphamap_pars_fragment,ShaderChunk.aomap_pars_fragment,ShaderChunk.lightmap_pars_fragment,ShaderChunk.emissivemap_pars_fragment,ShaderChunk.envmap_common_pars_fragment,ShaderChunk.envmap_pars_fragment,ShaderChunk.cube_uv_reflection_fragment,ShaderChunk.fog_pars_fragment,ShaderChunk.bsdfs,ShaderChunk.lights_pars_begin,ShaderChunk.lights_phong_pars_fragment,ShaderChunk.shadowmap_pars_fragment,ShaderChunk.bumpmap_pars_fragment,ShaderChunk.normalmap_pars_fragment,ShaderChunk.specularmap_pars_fragment,ShaderChunk.logdepthbuf_pars_fragment,ShaderChunk.clipping_planes_pars_fragment,"void main() {",ShaderChunk.clipping_planes_fragment,"vec4 diffuseColor = vec4( diffuse, opacity );","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;",ShaderChunk.logdepthbuf_fragment,ShaderChunk.map_fragment,ShaderChunk.color_fragment,ShaderChunk.alphamap_fragment,ShaderChunk.alphatest_fragment,ShaderChunk.specularmap_fragment,ShaderChunk.normal_fragment_begin,ShaderChunk.normal_fragment_maps,ShaderChunk.emissivemap_fragment,ShaderChunk.lights_phong_fragment,ShaderChunk.lights_fragment_begin,ShaderChunk.lights_fragment_maps,ShaderChunk.lights_fragment_end,ShaderChunk.aomap_fragment,"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",ShaderChunk.envmap_fragment,"gl_FragColor = vec4( outgoingLight, diffuseColor.a );",ShaderChunk.tonemapping_fragment,ShaderChunk.encodings_fragment,ShaderChunk.fog_fragment,ShaderChunk.premultiplied_alpha_fragment,ShaderChunk.dithering_fragment,"}"].join("\n"),this.setValues(e)}PackedPhongMaterial.prototype=Object.create(MeshPhongMaterial.prototype);var GeometryUtils={hilbert2D:function(e,t,r,n,o,l,c){e=void 0!==e?e:new Vector3(0,0,0);var h=(t=void 0!==t?t:10)/2,d=(r=void 0!==r?r:1,n=void 0!==n?n:0,o=void 0!==o?o:1,l=void 0!==l?l:2,c=void 0!==c?c:3,[new Vector3(e.x-h,e.y,e.z-h),new Vector3(e.x-h,e.y,e.z+h),new Vector3(e.x+h,e.y,e.z+h),new Vector3(e.x+h,e.y,e.z-h)]),f=[d[n],d[o],d[l],d[c]];if(0<=--r){var m=[];return Array.prototype.push.apply(m,GeometryUtils.hilbert2D(f[0],h,r,n,c,l,o)),Array.prototype.push.apply(m,GeometryUtils.hilbert2D(f[1],h,r,n,o,l,c)),Array.prototype.push.apply(m,GeometryUtils.hilbert2D(f[2],h,r,n,o,l,c)),Array.prototype.push.apply(m,GeometryUtils.hilbert2D(f[3],h,r,l,o,n,c)),m}return f},hilbert3D:function(e,t,r,n,o,l,c,h,d,f,m){e=void 0!==e?e:new Vector3(0,0,0);var v=(t=void 0!==t?t:10)/2,y=(r=void 0!==r?r:1,n=void 0!==n?n:0,o=void 0!==o?o:1,l=void 0!==l?l:2,c=void 0!==c?c:3,h=void 0!==h?h:4,d=void 0!==d?d:5,f=void 0!==f?f:6,m=void 0!==m?m:7,[new Vector3(e.x-v,e.y+v,e.z-v),new Vector3(e.x-v,e.y+v,e.z+v),new Vector3(e.x-v,e.y-v,e.z+v),new Vector3(e.x-v,e.y-v,e.z-v),new Vector3(e.x+v,e.y-v,e.z-v),new Vector3(e.x+v,e.y-v,e.z+v),new Vector3(e.x+v,e.y+v,e.z+v),new Vector3(e.x+v,e.y+v,e.z-v)]),x=[y[n],y[o],y[l],y[c],y[h],y[d],y[f],y[m]];if(--r>=0){var _=[];return Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[0],v,r,n,c,h,m,f,d,l,o)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[1],v,r,n,m,f,o,l,d,h,c)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[2],v,r,n,m,f,o,l,d,h,c)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[3],v,r,l,c,n,o,f,m,h,d)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[4],v,r,l,c,n,o,f,m,h,d)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[5],v,r,h,c,l,d,f,o,n,m)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[6],v,r,h,c,l,d,f,o,n,m)),Array.prototype.push.apply(_,GeometryUtils.hilbert3D(x[7],v,r,f,d,l,o,n,c,h,m)),_}return x}},RoughnessMipmapper=function(){var e,t=((e=new RawShaderMaterial({uniforms:{roughnessMap:{value:null},normalMap:{value:null},texelSize:{value:new Vector2(1,1)}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4( position, 1.0 );\n}\n              ",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec2 vUv;\nuniform sampler2D roughnessMap;\nuniform sampler2D normalMap;\nuniform vec2 texelSize;\n\n#define ENVMAP_TYPE_CUBE_UV\nvec4 envMapTexelToLinear(vec4 a){return a;}\n#include <cube_uv_reflection_fragment>\n\nfloat roughnessToVariance(float roughness) {\n  float variance = 0.0;\n  if (roughness >= r1) {\n    variance = (r0 - roughness) * (v1 - v0) / (r0 - r1) + v0;\n  } else if (roughness >= r4) {\n    variance = (r1 - roughness) * (v4 - v1) / (r1 - r4) + v1;\n  } else if (roughness >= r5) {\n    variance = (r4 - roughness) * (v5 - v4) / (r4 - r5) + v4;\n  } else {\n    float roughness2 = roughness * roughness;\n    variance = 1.79 * roughness2 * roughness2;\n  }\n  return variance;\n}\nfloat varianceToRoughness(float variance) {\n  float roughness = 0.0;\n  if (variance >= v1) {\n    roughness = (v0 - variance) * (r1 - r0) / (v0 - v1) + r0;\n  } else if (variance >= v4) {\n    roughness = (v1 - variance) * (r4 - r1) / (v1 - v4) + r1;\n  } else if (variance >= v5) {\n    roughness = (v4 - variance) * (r5 - r4) / (v4 - v5) + r4;\n  } else {\n    roughness = pow(0.559 * variance, 0.25);// 0.559 = 1.0 / 1.79\n  }\n  return roughness;\n}\n\nvoid main() {\n    gl_FragColor = texture2D(roughnessMap, vUv, -1.0);\n    if (texelSize.x == 0.0) return;\n    float roughness = gl_FragColor.g;\n    float variance = roughnessToVariance(roughness);\n    vec3 avgNormal;\n    for (float x = -1.0; x < 2.0; x += 2.0) {\n    for (float y = -1.0; y < 2.0; y += 2.0) {\n        vec2 uv = vUv + vec2(x, y) * 0.25 * texelSize;\n        avgNormal += normalize(texture2D(normalMap, uv, -1.0).xyz - 0.5);\n    }\n    }\n    variance += 1.0 - 0.25 * length(avgNormal);\n    gl_FragColor.g = varianceToRoughness(variance);\n}\n              ",blending:NoBlending,depthTest:!1,depthWrite:!1})).type="RoughnessMipmapper",e),r=new Scene;r.add(new Mesh(new PlaneBufferGeometry(2,2),t));var n=new OrthographicCamera(0,1,0,1,0,1),o=null,l=null,c=function(e){(l=e).compile(r,n)};return c.prototype={constructor:c,generateMipmaps:function(e){var c=e.roughnessMap,h=e.normalMap;if(null!=c&&null!=h&&c.generateMipmaps&&!e.userData.roughnessUpdated){e.userData.roughnessUpdated=!0;var d=Math.max(c.image.width,h.image.width),f=Math.max(c.image.height,h.image.height);if(MathUtils.isPowerOfTwo(d)&&MathUtils.isPowerOfTwo(f)){var m=l.getRenderTarget(),v=l.autoClear;if(l.autoClear=!1,null!=o&&o.width===d&&o.height===f||(null!=o&&o.dispose(),(o=new WebGLRenderTarget(d,f,{depthBuffer:!1,stencilBuffer:!1})).scissorTest=!0),d!==c.image.width||f!==c.image.height){var y=new WebGLRenderTarget(d,f,{minFilter:LinearMipMapLinearFilter,depthBuffer:!1,stencilBuffer:!1});y.texture.generateMipmaps=!0,l.setRenderTarget(y),e.roughnessMap=y.texture,e.metalnessMap==c&&(e.metalnessMap=e.roughnessMap),e.aoMap==c&&(e.aoMap=e.roughnessMap)}t.uniforms.roughnessMap.value=c,t.uniforms.normalMap.value=h;for(var x=new Vector2(0,0),_=t.uniforms.texelSize.value,M=0;d>=1&&f>=1;++M,d/=2,f/=2)_.set(1/d,1/f),0==M&&_.set(0,0),o.viewport.set(x.x,x.y,d,f),o.scissor.set(x.x,x.y,d,f),l.setRenderTarget(o),l.render(r,n),l.copyFramebufferToTexture(x,e.roughnessMap,M),t.uniforms.roughnessMap.value=e.roughnessMap;c!==e.roughnessMap&&c.dispose(),l.setRenderTarget(m),l.autoClear=v}}},dispose:function(){t.dispose(),r.children[0].geometry.dispose(),null!=o&&o.dispose()}},c}(),SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new Group,i=0,n=t.length;i<n;i++)r.add(new Mesh(e,t[i]));return r},detach:function(e,t,r){console.warn("SceneUtils: detach() has been deprecated. Use scene.attach( child ) instead."),r.attach(e)},attach:function(e,t,r){console.warn("SceneUtils: attach() has been deprecated. Use parent.attach( child ) instead."),r.attach(e)}},ShadowMapViewer=function(e){var t,r=this,n=void 0!==e.name&&""!==e.name,o=10,l=10,c=256,h=256,d=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);d.position.set(0,0,2);var f,m,v=new Scene,y=UnpackDepthRGBAShader,x=UniformsUtils.clone(y.uniforms),_=new ShaderMaterial({uniforms:x,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader}),M=new Mesh(new PlaneBufferGeometry(c,h),_);if(v.add(M),n){var w=(f=document.createElement("canvas")).getContext("2d");w.font="Bold 20px Arial";var S=w.measureText(e.name).width;f.width=S,f.height=25,w.font="Bold 20px Arial",w.fillStyle="rgba( 255, 0, 0, 1 )",w.fillText(e.name,0,20);var A=new Texture(f);A.magFilter=LinearFilter,A.minFilter=LinearFilter,A.needsUpdate=!0;var T=new MeshBasicMaterial({map:A,side:DoubleSide});T.transparent=!0;var L=new PlaneBufferGeometry(f.width,f.height);m=new Mesh(L,T),v.add(m)}this.enabled=!0,this.size={width:c,height:h,set:function(e,t){this.width=e,this.height=t,M.scale.set(this.width/c,this.height/h,1),r.position.set(r.position.x,r.position.y)}},this.position={x:o,y:l,set:function(e,t){this.x=e,this.y=t;var o=r.size.width,l=r.size.height;M.position.set(-window.innerWidth/2+o/2+this.x,window.innerHeight/2-l/2-this.y,0),n&&m.position.set(M.position.x,M.position.y-r.size.height/2+f.height/2,0)}},this.render=function(r){this.enabled&&(x.tDiffuse.value=e.shadow.map.texture,t=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(v,d),r.autoClear=t)},this.updateForWindowResize=function(){this.enabled&&(d.left=window.innerWidth/-2,d.right=window.innerWidth/2,d.top=window.innerHeight/2,d.bottom=window.innerHeight/-2,d.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};ShadowMapViewer.prototype.constructor=ShadowMapViewer;var _vector$8=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;function getBoneList(object){var e=[];object&&object.isBone&&e.push(object);for(var i=0;i<object.children.length;i++)e.push.apply(e,getBoneList(object.children[i]));return e}function SkeletonHelper(object){for(var e=getBoneList(object),t=new BufferGeometry,r=[],n=[],o=new Color(0,0,1),l=new Color(0,1,0),i=0;i<e.length;i++){var c=e[i];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(l.r,l.g,l.b))}t.setAttribute("position",new Float32BufferAttribute(r,3)),t.setAttribute("color",new Float32BufferAttribute(n,3));var h=new LineBasicMaterial({vertexColors:VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,t,h),this.root=object,this.bones=e,this.matrix=object.matrixWorld,this.matrixAutoUpdate=!1}SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");_matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var l=t[i];l.parent&&l.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,l.matrixWorld),_vector$8.setFromMatrixPosition(_boneMatrix),n.setXYZ(o,_vector$8.x,_vector$8.y,_vector$8.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,l.parent.matrixWorld),_vector$8.setFromMatrixPosition(_boneMatrix),n.setXYZ(o+1,_vector$8.x,_vector$8.y,_vector$8.z),o+=2)}r.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,e)};var SkeletonUtils={retarget:(pos=new Vector3,quat=new Quaternion,scale=new Vector3,bindBoneMatrix=new Matrix4,relativeMatrix=new Matrix4,globalMatrix=new Matrix4,function(e,source,t){(t=t||{}).preserveMatrix=void 0===t.preserveMatrix||t.preserveMatrix,t.preservePosition=void 0===t.preservePosition||t.preservePosition,t.preserveHipPosition=void 0!==t.preserveHipPosition&&t.preserveHipPosition,t.useTargetMatrix=void 0!==t.useTargetMatrix&&t.useTargetMatrix,t.hip=void 0!==t.hip?t.hip:"hip",t.names=t.names||{};var r,n,o,l,c,i,h=source.isObject3D?source.skeleton.bones:this.getBones(source),d=e.isObject3D?e.skeleton.bones:this.getBones(e);if(e.isObject3D?e.skeleton.pose():(t.useTargetMatrix=!0,t.preserveMatrix=!1),t.preservePosition)for(c=[],i=0;i<d.length;i++)c.push(d[i].position.clone());if(t.preserveMatrix)for(e.updateMatrixWorld(),e.matrixWorld.identity(),i=0;i<e.children.length;++i)e.children[i].updateMatrixWorld(!0);if(t.offsets)for(r=[],i=0;i<d.length;++i)n=d[i],o=t.names[n.name]||n.name,t.offsets&&t.offsets[o]&&(n.matrix.multiply(t.offsets[o]),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()),r.push(n.matrixWorld.clone());for(i=0;i<d.length;++i){if(n=d[i],o=t.names[n.name]||n.name,l=this.getBoneByName(o,h),globalMatrix.copy(n.matrixWorld),l){if(l.updateMatrixWorld(),t.useTargetMatrix?relativeMatrix.copy(l.matrixWorld):(relativeMatrix.getInverse(e.matrixWorld),relativeMatrix.multiply(l.matrixWorld)),scale.setFromMatrixScale(relativeMatrix),relativeMatrix.scale(scale.set(1/scale.x,1/scale.y,1/scale.z)),globalMatrix.makeRotationFromQuaternion(quat.setFromRotationMatrix(relativeMatrix)),e.isObject3D){var f=d.indexOf(n),m=r?r[f]:bindBoneMatrix.getInverse(e.skeleton.boneInverses[f]);globalMatrix.multiply(m)}globalMatrix.copyPosition(relativeMatrix)}n.parent&&n.parent.isBone?(n.matrix.getInverse(n.parent.matrixWorld),n.matrix.multiply(globalMatrix)):n.matrix.copy(globalMatrix),t.preserveHipPosition&&o===t.hip&&n.matrix.setPosition(pos.set(0,n.position.y,0)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()}if(t.preservePosition)for(i=0;i<d.length;++i)n=d[i],(o=t.names[n.name]||n.name)!==t.hip&&n.position.copy(c[i]);t.preserveMatrix&&e.updateMatrixWorld(!0)}),retargetClip:function(e,source,t,r){(r=r||{}).useFirstFramePosition=void 0!==r.useFirstFramePosition&&r.useFirstFramePosition,r.fps=void 0!==r.fps?r.fps:30,r.names=r.names||[],source.isObject3D||(source=this.getHelperFromSkeleton(source));var n,o,l,c,i,h,d=Math.round(t.duration*(r.fps/1e3)*1e3),f=1/r.fps,m=[],v=new AnimationMixer(source),y=this.getBones(e.skeleton),x=[];for(v.clipAction(t).play(),v.update(0),source.updateMatrixWorld(),i=0;i<d;++i){var time=i*f;for(this.retarget(e,source,r),h=0;h<y.length;++h)c=r.names[y[h].name]||y[h].name,this.getBoneByName(c,source.skeleton)&&(o=y[h],l=x[h]=x[h]||{bone:o},r.hip===c&&(l.pos||(l.pos={times:new Float32Array(d),values:new Float32Array(3*d)}),r.useFirstFramePosition&&(0===i&&(n=o.position.clone()),o.position.sub(n)),l.pos.times[i]=time,o.position.toArray(l.pos.values,3*i)),l.quat||(l.quat={times:new Float32Array(d),values:new Float32Array(4*d)}),l.quat.times[i]=time,o.quaternion.toArray(l.quat.values,4*i));v.update(f),source.updateMatrixWorld()}for(i=0;i<x.length;++i)(l=x[i])&&(l.pos&&m.push(new VectorKeyframeTrack(".bones["+l.bone.name+"].position",l.pos.times,l.pos.values)),m.push(new QuaternionKeyframeTrack(".bones["+l.bone.name+"].quaternion",l.quat.times,l.quat.values)));return v.uncacheAction(t),new AnimationClip(t.name,-1,m)},getHelperFromSkeleton:function(e){var source=new SkeletonHelper(e.bones[0]);return source.skeleton=e,source},getSkeletonOffsets:(targetParentPos=new Vector3,targetPos=new Vector3,sourceParentPos=new Vector3,sourcePos=new Vector3,targetDir=new Vector2,sourceDir=new Vector2,function(e,source,t){(t=t||{}).hip=void 0!==t.hip?t.hip:"hip",t.names=t.names||{},source.isObject3D||(source=this.getHelperFromSkeleton(source));var r,n,o,i,l=Object.keys(t.names),c=Object.values(t.names),h=source.isObject3D?source.skeleton.bones:this.getBones(source),d=e.isObject3D?e.skeleton.bones:this.getBones(e),f=[];for(e.skeleton.pose(),i=0;i<d.length;++i)if(r=d[i],o=t.names[r.name]||r.name,(n=this.getBoneByName(o,h))&&o!==t.hip){var m=this.getNearestBone(r.parent,l),v=this.getNearestBone(n.parent,c);m.updateMatrixWorld(),v.updateMatrixWorld(),targetParentPos.setFromMatrixPosition(m.matrixWorld),targetPos.setFromMatrixPosition(r.matrixWorld),sourceParentPos.setFromMatrixPosition(v.matrixWorld),sourcePos.setFromMatrixPosition(n.matrixWorld),targetDir.subVectors(new Vector2(targetPos.x,targetPos.y),new Vector2(targetParentPos.x,targetParentPos.y)).normalize(),sourceDir.subVectors(new Vector2(sourcePos.x,sourcePos.y),new Vector2(sourceParentPos.x,sourceParentPos.y)).normalize();var y=targetDir.angle()-sourceDir.angle(),x=(new Matrix4).makeRotationFromEuler(new Euler(0,0,y));r.matrix.multiply(x),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(),f[o]=x}return f}),renameBones:function(e,t){for(var r=this.getBones(e),i=0;i<r.length;++i){var n=r[i];t[n.name]&&(n.name=t[n.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(var i=0,r=this.getBones(t);i<r.length;i++)if(e===r[i].name)return r[i]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){for(var r=/\[(.*)\]\.(.*)/,n={name:e},i=0;i<t.length;++i){var o=r.exec(t[i].name);o&&e===o[1]&&(n[o[2]]=i)}return n},getEqualsBonesNames:function(e,t){var r=this.getBones(e),n=this.getBones(t),o=[];e:for(var i=0;i<r.length;i++)for(var l=r[i].name,c=0;c<n.length;c++)if(l===n[c].name){o.push(l);continue e}return o},clone:function(source){var e=new Map,t=new Map,r=source.clone();return parallelTraverse(source,r,(function(r,n){e.set(n,r),t.set(r,n)})),r.traverse((function(r){if(r.isSkinnedMesh){var n=r,o=e.get(r),l=o.skeleton.bones;n.skeleton=o.skeleton.clone(),n.bindMatrix.copy(o.bindMatrix),n.skeleton.bones=l.map((function(e){return t.get(e)})),n.bind(n.skeleton,n.bindMatrix)}})),r}},targetParentPos,targetPos,sourceParentPos,sourcePos,targetDir,sourceDir,pos,quat,scale,bindBoneMatrix,relativeMatrix,globalMatrix;function parallelTraverse(a,b,e){e(a,b);for(var i=0;i<a.children.length;i++)parallelTraverse(a.children[i],b.children[i],e)}var TypedArrayUtils={quicksortIP:function(e,t,r){for(var i,n,o=[],l=-1,c=0,h=e.length/t-1,d=0,f=0,m=0,v=function(a,b){for(a*=t,b*=t,m=0;m<t;m++)d=e[a+m],e[a+m]=e[b+m],e[b+m]=d},y=new Float32Array(t),x=new Float32Array(t);;)if(h-c<=25){for(n=c+1;n<=h;n++){for(f=0;f<t;f++)y[f]=e[n*t+f];for(i=n-1;i>=c&&e[i*t+r]>y[r];){for(f=0;f<t;f++)e[(i+1)*t+f]=e[i*t+f];i--}for(f=0;f<t;f++)e[(i+1)*t+f]=y[f]}if(-1==l)break;h=o[l--],c=o[l--]}else{for(n=h,v(c+h>>1,i=c+1),e[c*t+r]>e[h*t+r]&&v(c,h),e[i*t+r]>e[h*t+r]&&v(i,h),e[c*t+r]>e[i*t+r]&&v(c,i),f=0;f<t;f++)x[f]=e[i*t+f];for(;;){do{i++}while(e[i*t+r]<x[r]);do{n--}while(e[n*t+r]>x[r]);if(n<i)break;v(i,n)}for(f=0;f<t;f++)e[(c+1)*t+f]=e[n*t+f],e[n*t+f]=x[f];h-i+1>=n-c?(o[++l]=i,o[++l]=h,h=n-1):(o[++l]=c,o[++l]=n-1,c=i)}return e},Kdtree:function(e,t,r){var n=this,o=0,l=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,c,h,d){var f,m,v=c%r,y=t.length/r;return c>o&&(o=c),0===y?null:1===y?new n.Node(l(t,0),c,h,d):(TypedArrayUtils.quicksortIP(t,r,v),f=Math.floor(y/2),(m=new n.Node(l(t,f),c,h,f+d)).left=e(t.subarray(0,f*r),c+1,m,d),m.right=e(t.subarray((f+1)*r,t.length),c+1,m,d+f+1),m)}(e,0,null,0),this.getMaxDepth=function(){return o},this.nearest=function(e,o,l){var i,c,h;if(h=new TypedArrayUtils.Kdtree.BinaryHeap((function(e){return-e[1]})),l)for(i=0;i<o;i+=1)h.push([null,l]);for(function n(l){var c,d,f,i,m=l.depth%r,v=t(e,l.obj),y=[];function x(e,t){h.push([e,t]),h.size()>o&&h.pop()}for(i=0;i<r;i+=1)i===l.depth%r?y[i]=e[i]:y[i]=l.obj[i];d=t(y,l.obj),null!==l.right||null!==l.left?(n(c=null===l.right?l.left:null===l.left?l.right:e[m]<l.obj[m]?l.left:l.right),(h.size()<o||v<h.peek()[1])&&x(l,v),(h.size()<o||Math.abs(d)<h.peek()[1])&&null!==(f=c===l.left?l.right:l.left)&&n(f)):(h.size()<o||v<h.peek()[1])&&x(l,v)}(n.root),c=[],i=0;i<o;i+=1)h.content[i][0]&&c.push([h.content[i][0],h.content[i][1]]);return c}}};TypedArrayUtils.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(element){this.content.push(element),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,i=0;i<t;i++)if(this.content[i]==e){var r=this.content.pop();return void(i!=t-1&&(this.content[i]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(i):this.sinkDown(i)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var element=this.content[e];e>0;){var t=Math.floor((e+1)/2)-1,r=this.content[t];if(!(this.scoreFunction(element)<this.scoreFunction(r)))break;this.content[t]=element,this.content[e]=r,e=t}},sinkDown:function(e){for(var t=this.content.length,element=this.content[e],r=this.scoreFunction(element);;){var n=2*(e+1),o=n-1,l=null;if(o<t){var c=this.content[o],h=this.scoreFunction(c);h<r&&(l=o)}if(n<t){var d=this.content[n];this.scoreFunction(d)<(null===l?r:h)&&(l=n)}if(null===l)break;this.content[e]=this.content[l],this.content[l]=element,e=l}}};var UVsDebug=function(e,t){var a=new Vector2,b=new Vector2,r=[new Vector2,new Vector2,new Vector2],n=[],canvas=document.createElement("canvas"),o=t||1024,l=t||1024;canvas.width=o,canvas.height=l;var c=canvas.getContext("2d");if(c.lineWidth=2,c.strokeStyle="rgba( 0, 0, 0, 1.0 )",c.textAlign="center",c.fillStyle="rgba( 255, 255, 255, 1.0 )",c.fillRect(0,0,o,l),e.isGeometry)for(var h=e.faces,d=e.faceVertexUvs[0],i=0,f=d.length;i<f;i++){n=h[i];var m=d[i];n[0]=n.a,n[1]=n.b,n[2]=n.c,r[0].copy(m[0]),r[1].copy(m[1]),r[2].copy(m[2]),x(n,r,i)}else{var v=e.index,y=e.attributes.uv;if(v)for(i=0,f=v.count;i<f;i+=3)n[0]=v.getX(i),n[1]=v.getX(i+1),n[2]=v.getX(i+2),r[0].fromBufferAttribute(y,n[0]),r[1].fromBufferAttribute(y,n[1]),r[2].fromBufferAttribute(y,n[2]),x(n,r,i/3);else for(i=0,f=y.count;i<f;i+=3)n[0]=i,n[1]=i+1,n[2]=i+2,r[0].fromBufferAttribute(y,n[0]),r[1].fromBufferAttribute(y,n[1]),r[2].fromBufferAttribute(y,n[2]),x(n,r,i/3)}return canvas;function x(e,t,r){c.beginPath(),a.set(0,0);for(var n=0,h=t.length;n<h;n++){var d=t[n];a.x+=d.x,a.y+=d.y,0===n?c.moveTo(d.x*o,(1-d.y)*l):c.lineTo(d.x*o,(1-d.y)*l)}for(c.closePath(),c.stroke(),a.divideScalar(t.length),c.font="12pt Arial bold",c.fillStyle="rgba( 0, 0, 0, 1.0 )",c.fillText(r,a.x*o,(1-a.y)*l),a.x>.95&&c.fillText(r,a.x%1*o,(1-a.y)*l),c.font="8pt Arial bold",c.fillStyle="rgba( 0, 0, 0, 1.0 )",n=0,h=t.length;n<h;n++){d=t[n];b.addVectors(a,d).divideScalar(2);var f=e[n];c.fillText("abc"[n]+f,b.x*o,(1-b.y)*l),b.x>.95&&c.fillText("abc"[n]+f,b.x%1*o,(1-b.y)*l)}}},WebGL={isWebGLAvailable:function(){try{var canvas=document.createElement("canvas");return!(!window.WebGLRenderingContext||!canvas.getContext("webgl")&&!canvas.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var canvas=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!canvas.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},r='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',element=document.createElement("div");return element.id="webglmessage",element.style.fontFamily="monospace",element.style.fontSize="13px",element.style.fontWeight="normal",element.style.textAlign="center",element.style.background="#fff",element.style.color="#000",element.style.padding="1.5em",element.style.width="400px",element.style.margin="5em auto 0",r=(r=t[e]?r.replace("$0","graphics card"):r.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),element.innerHTML=r,element}},ARButton={createButton:function(e){function t(){button.style.display="",button.style.cursor="auto",button.style.left="calc(50% - 75px)",button.style.width="150px",button.onmouseenter=null,button.onmouseleave=null,button.onclick=null,button.textContent="AR NOT SUPPORTED"}function r(element){element.style.position="absolute",element.style.bottom="20px",element.style.padding="12px 6px",element.style.border="1px solid #fff",element.style.borderRadius="4px",element.style.background="rgba(0,0,0,0.1)",element.style.color="#fff",element.style.font="normal 13px sans-serif",element.style.textAlign="center",element.style.opacity="0.5",element.style.outline="none",element.style.zIndex="999"}if("xr"in navigator){var button=document.createElement("button");return button.style.display="none",r(button),navigator.xr.isSessionSupported("immersive-ar").then((function(r){r?function(){var t=null;function r(r){r.addEventListener("end",n),e.xr.setReferenceSpaceType("local"),e.xr.setSession(r),button.textContent="STOP AR",t=r}function n(){t.removeEventListener("end",n),button.textContent="START AR",t=null}button.style.display="",button.style.cursor="pointer",button.style.left="calc(50% - 50px)",button.style.width="100px",button.textContent="START AR",button.onmouseenter=function(){button.style.opacity="1.0"},button.onmouseleave=function(){button.style.opacity="0.5"},button.onclick=function(){null===t?navigator.xr.requestSession("immersive-ar").then(r):t.end()}}():t()})).catch(t),button}var n=document.createElement("a");return n.href="https://immersiveweb.dev/",!1===window.isSecureContext?n.innerHTML="WEBXR NEEDS HTTPS":n.innerHTML="WEBXR NOT AVAILABLE",n.style.left="calc(50% - 90px)",n.style.width="180px",n.style.textDecoration="none",r(n),n}},VRButton={createButton:function(e,t){function r(){button.style.display="",button.style.cursor="auto",button.style.left="calc(50% - 75px)",button.style.width="150px",button.onmouseenter=null,button.onmouseleave=null,button.onclick=null,button.textContent="VR NOT SUPPORTED"}function n(element){element.style.position="absolute",element.style.bottom="20px",element.style.padding="12px 6px",element.style.border="1px solid #fff",element.style.borderRadius="4px",element.style.background="rgba(0,0,0,0.1)",element.style.color="#fff",element.style.font="normal 13px sans-serif",element.style.textAlign="center",element.style.opacity="0.5",element.style.outline="none",element.style.zIndex="999"}if(t&&t.referenceSpaceType&&e.xr.setReferenceSpaceType(t.referenceSpaceType),"xr"in navigator){var button=document.createElement("button");return button.style.display="none",n(button),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){var t=null;function r(r){r.addEventListener("end",n),e.xr.setSession(r),button.textContent="EXIT VR",t=r}function n(){t.removeEventListener("end",n),button.textContent="ENTER VR",t=null}button.style.display="",button.style.cursor="pointer",button.style.left="calc(50% - 50px)",button.style.width="100px",button.textContent="ENTER VR",button.onmouseenter=function(){button.style.opacity="1.0"},button.onmouseleave=function(){button.style.opacity="0.5"},button.onclick=function(){if(null===t){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(r)}else t.end()}}():r()})),button}var o=document.createElement("a");return o.href="https://immersiveweb.dev/",!1===window.isSecureContext?o.innerHTML="WEBXR NEEDS HTTPS":o.innerHTML="WEBXR NOT AVAILABLE",o.style.left="calc(50% - 90px)",o.style.width="180px",o.style.textDecoration="none",n(o),o}},_context;function AnimationObjectGroup(){var e=arguments;this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var i=0,r=arguments.length;i!==r;++i)t[e[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Audio(e){Object3D.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}function AudioAnalyser(audio,e){this.analyser=audio.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),audio.getOutput().connect(this.analyser)}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=arguments,t=this._objects,r=t.length,n=this.nCachedObjects_,o=this._indicesByUUID,l=this._paths,c=this._parsedPaths,h=this._bindings,d=h.length,f=void 0,i=0,m=arguments.length;i!==m;++i){var object=e[i],v=object.uuid,y=o[v];if(void 0===y){y=r++,o[v]=y,t.push(object);for(var x=0,_=d;x!==_;++x)h[x].push(new PropertyBinding(object,l[x],c[x]))}else if(y<n){f=t[y];var M=--n,w=t[M];o[w.uuid]=y,t[y]=w,o[v]=M,t[M]=object;for(x=0,_=d;x!==_;++x){var S=h[x],A=S[M],T=S[y];S[y]=A,void 0===T&&(T=new PropertyBinding(object,l[x],c[x])),S[M]=T}}else t[y]!==f&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=arguments,t=this._objects,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._bindings,l=o.length,i=0,c=arguments.length;i!==c;++i){var object=e[i],h=object.uuid,d=n[h];if(void 0!==d&&d>=r){var f=r++,m=t[f];n[m.uuid]=d,t[d]=m,n[h]=f,t[f]=object;for(var v=0,y=l;v!==y;++v){var x=o[v],_=x[f],M=x[d];x[d]=_,x[f]=M}}}this.nCachedObjects_=r},uncache:function(){for(var e=arguments,t=this._objects,r=t.length,n=this.nCachedObjects_,o=this._indicesByUUID,l=this._bindings,c=l.length,i=0,h=arguments.length;i!==h;++i){var object=e[i],d=object.uuid,f=o[d];if(void 0!==f)if(delete o[d],f<n){var m=--n,v=t[m],y=t[S=--r];o[v.uuid]=f,t[f]=v,o[y.uuid]=m,t[m]=y,t.pop();for(var x=0,_=c;x!==_;++x){var M=(A=l[x])[m],w=A[S];A[f]=M,A[m]=w,A.pop()}}else{var S;o[(y=t[S=--r]).uuid]=f,t[f]=y,t.pop();for(x=0,_=c;x!==_;++x){var A;(A=l[x])[f]=A[S],A.pop()}}}this.nCachedObjects_=n},subscribe_:function(path,e){var t=this._bindingsIndicesByPath,r=t[path],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,l=this._parsedPaths,c=this._objects,h=c.length,d=this.nCachedObjects_,f=new Array(h);r=n.length,t[path]=r,o.push(path),l.push(e),n.push(f);for(var i=d,m=c.length;i!==m;++i){var object=c[i];f[i]=new PropertyBinding(object,path,e)}return f},unsubscribe_:function(path){var e=this._bindingsIndicesByPath,t=e[path];if(void 0!==t){var r=this._paths,n=this._parsedPaths,o=this._bindings,l=o.length-1,c=o[l];e[path[l]]=t,o[t]=c,o.pop(),n[t]=n[l],n.pop(),r[t]=r[l],r.pop()}}}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var source=this.context.createBufferSource();return source.buffer=this.buffer,source.loop=this.loop,source.loopStart=this.loopStart,source.loopEnd=this.loopEnd,source.onended=this.onEnded.bind(this),source.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=source,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var i=1,e=this.filters.length;i<e;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var i=1,e=this.filters.length;i<e;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(filter){return this.setFilters(filter?[filter]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,data=this.getFrequencyData(),i=0;i<data.length;i++)e+=data[i];return e/data.length}});var AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}},_position$2=new Vector3,_quaternion$3=new Quaternion,_scale$1=new Vector3,_orientation=new Vector3;function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1),_orientation.set(0,0,-1).applyQuaternion(_quaternion$3),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_position$2.x,n),t.positionY.linearRampToValueAtTime(_position$2.y,n),t.positionZ.linearRampToValueAtTime(_position$2.z,n),t.forwardX.linearRampToValueAtTime(_orientation.x,n),t.forwardY.linearRampToValueAtTime(_orientation.y,n),t.forwardZ.linearRampToValueAtTime(_orientation.z,n),t.upX.linearRampToValueAtTime(r.x,n),t.upY.linearRampToValueAtTime(r.y,n),t.upZ.linearRampToValueAtTime(r.z,n)}else t.setPosition(_position$2.x,_position$2.y,_position$2.z),t.setOrientation(_orientation.x,_orientation.y,_orientation.z,r.x,r.y,r.z)}});var _position$3=new Vector3,_quaternion$4=new Quaternion,_scale$2=new Vector3,_orientation$1=new Vector3;function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}function WebGLCubeRenderTarget(e,t,r){Number.isInteger(t)&&(console.warn("WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),WebGLRenderTarget.call(this,e,e,t)}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(Object3D.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2),_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_position$3.x,r),t.positionY.linearRampToValueAtTime(_position$3.y,r),t.positionZ.linearRampToValueAtTime(_position$3.z,r),t.orientationX.linearRampToValueAtTime(_orientation$1.x,r),t.orientationY.linearRampToValueAtTime(_orientation$1.y,r),t.orientationZ.linearRampToValueAtTime(_orientation$1.z,r)}else t.setPosition(_position$3.x,_position$3.y,_position$3.z),t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new Scene,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},o=new ShaderMaterial({type:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=t;var l=new Mesh(new BoxBufferGeometry(5,5,5),o);r.add(l);var c=new CubeCamera(1,10,1);return c.renderTarget=this,c.renderTarget.texture.name="CubeCameraTexture",c.update(e,r),l.geometry.dispose(),l.material.dispose(),this};var fov=90,aspect=1;function CubeCamera(e,t,r,n){Object3D.call(this),this.type="CubeCamera";var o=new PerspectiveCamera(fov,aspect,e,t);o.up.set(0,-1,0),o.lookAt(new Vector3(1,0,0)),this.add(o);var l=new PerspectiveCamera(fov,aspect,e,t);l.up.set(0,-1,0),l.lookAt(new Vector3(-1,0,0)),this.add(l);var c=new PerspectiveCamera(fov,aspect,e,t);c.up.set(0,0,1),c.lookAt(new Vector3(0,1,0)),this.add(c);var h=new PerspectiveCamera(fov,aspect,e,t);h.up.set(0,0,-1),h.lookAt(new Vector3(0,-1,0)),this.add(h);var d=new PerspectiveCamera(fov,aspect,e,t);d.up.set(0,-1,0),d.lookAt(new Vector3(0,0,1)),this.add(d);var f=new PerspectiveCamera(fov,aspect,e,t);f.up.set(0,-1,0),f.lookAt(new Vector3(0,0,-1)),this.add(f),n=n||{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter},this.renderTarget=new WebGLCubeRenderTarget(r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,o),e.setRenderTarget(n,1),e.render(t,l),e.setRenderTarget(n,2),e.render(t,c),e.setRenderTarget(n,3),e.render(t,h),e.setRenderTarget(n,4),e.render(t,d),n.texture.generateMipmaps=m,e.setRenderTarget(n,5),e.render(t,f),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var o=e.getRenderTarget(),l=this.renderTarget,i=0;i<6;i++)e.setRenderTarget(l,i),e.clear(t,r,n);e.setRenderTarget(o)}}function InstancedBufferAttribute(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,r),this.meshPerAttribute=n||1}function Uniform(e){"string"==typeof e&&(console.warn("Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Font(data){this.type="Font",this.data=data}function createPaths(text,e,data){for(var t=Array.from?Array.from(text):String(text).split(""),r=e/data.resolution,n=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*r,o=[],l=0,c=0,i=0;i<t.length;i++){var h=t[i];if("\n"===h)l=0,c-=n;else{var d=createPath(h,r,l,c,data);l+=d.offsetX,o.push(d.path)}}return o}function createPath(e,t,r,n,data){var glyph=data.glyphs[e]||data.glyphs["?"];if(glyph){var o,l,c,h,d,f,m,v,path=new ShapePath;if(glyph.o)for(var y=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" ")),i=0,x=y.length;i<x;){switch(y[i++]){case"m":o=y[i++]*t+r,l=y[i++]*t+n,path.moveTo(o,l);break;case"l":o=y[i++]*t+r,l=y[i++]*t+n,path.lineTo(o,l);break;case"q":c=y[i++]*t+r,h=y[i++]*t+n,d=y[i++]*t+r,f=y[i++]*t+n,path.quadraticCurveTo(d,f,c,h);break;case"b":c=y[i++]*t+r,h=y[i++]*t+n,d=y[i++]*t+r,f=y[i++]*t+n,m=y[i++]*t+r,v=y[i++]*t+n,path.bezierCurveTo(d,f,m,v,c,h)}}return{offsetX:glyph.ha*t,path:path}}console.error('Font: character "'+e+'" does not exists in font family '+data.familyName+".")}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(source){return BufferAttribute.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this},toJSON:function(){var data=BufferAttribute.prototype.toJSON.call(this);return data.meshPerAttribute=this.meshPerAttribute,data.isInstancedBufferAttribute=!0,data}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},Object.assign(Font.prototype,{isFont:!0,generateShapes:function(text,e){void 0===e&&(e=100);for(var t=[],r=createPaths(text,e,this.data),p=0,n=r.length;p<n;p++)Array.prototype.push.apply(t,r[p].toShapes());return t}});var LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={};ENCODINGS[LinearEncoding]=0,ENCODINGS[sRGBEncoding]=1,ENCODINGS[RGBEEncoding]=2,ENCODINGS[RGBM7Encoding]=3,ENCODINGS[RGBM16Encoding]=4,ENCODINGS[RGBDEncoding]=5,ENCODINGS[GammaEncoding]=6;var _flatCamera=new OrthographicCamera,_blurMaterial=_getBlurShader(MAX_SAMPLES),_equirectShader=null,_cubemapShader=null,ref=_createPlanes(),_lodPlanes=ref._lodPlanes,_sizeLods=ref._sizeLods,_sigmas=ref._sigmas,_pingPongRenderTarget=null,_renderer=null,_oldTarget=null,PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];function PMREMGenerator(e){_renderer=e,_compileMaterial(_blurMaterial)}function _createPlanes(){for(var e=[],t=[],r=[],n=LOD_MAX,i=0;i<TOTAL_LODS;i++){var o=Math.pow(2,n);t.push(o);var l=1/o;i>LOD_MAX-LOD_MIN?l=EXTRA_LOD_SIGMA[i-LOD_MAX+LOD_MIN-1]:0==i&&(l=0),r.push(l);for(var c=1/(o-1),h=-c/2,d=1+c/2,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=new Float32Array(108),v=new Float32Array(72),y=new Float32Array(36),x=0;x<6;x++){var _=x%3*2/3-1,M=x>2?0:-1,w=[_,M,0,_+2/3,M,0,_+2/3,M+1,0,_,M,0,_+2/3,M+1,0,_,M+1,0];m.set(w,18*x),v.set(f,12*x);var S=[x,x,x,x,x,x];y.set(S,6*x)}var A=new BufferGeometry;A.setAttribute("position",new BufferAttribute(m,3)),A.setAttribute("uv",new BufferAttribute(v,2)),A.setAttribute("faceIndex",new BufferAttribute(y,1)),e.push(A),n>LOD_MIN&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}function _allocateTargets(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:e?e.type:UnsignedByteType,format:e?e.format:RGBEFormat,encoding:e?e.encoding:RGBEEncoding,depthBuffer:!1,stencilBuffer:!1},r=_createRenderTarget(t);return r.depthBuffer=!e,_pingPongRenderTarget=_createRenderTarget(t),r}function _cleanup(e){_pingPongRenderTarget.dispose(),_renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,e.setSize(e.width,e.height)}function _sceneToCubeUV(e,t,r,n){var o=new PerspectiveCamera(90,1,t,r),l=[1,1,1,1,-1,1],c=[1,1,-1,-1,-1,1],h=_renderer.outputEncoding,d=_renderer.toneMapping,f=_renderer.toneMappingExposure,m=_renderer.getClearColor(),v=_renderer.getClearAlpha();_renderer.toneMapping=LinearToneMapping,_renderer.toneMappingExposure=1,_renderer.outputEncoding=LinearEncoding,e.scale.z*=-1;var y=e.background;if(y&&y.isColor){y.convertSRGBToLinear();var x=Math.max(y.r,y.g,y.b),_=Math.min(Math.max(Math.ceil(Math.log2(x)),-128),127);y=y.multiplyScalar(Math.pow(2,-_));var M=(_+128)/255;_renderer.setClearColor(y,M),e.background=null}for(var i=0;i<6;i++){var col=i%3;0==col?(o.up.set(0,l[i],0),o.lookAt(c[i],0,0)):1==col?(o.up.set(0,0,l[i]),o.lookAt(0,c[i],0)):(o.up.set(0,l[i],0),o.lookAt(0,0,c[i])),_setViewport(n,col*SIZE_MAX,i>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),_renderer.setRenderTarget(n),_renderer.render(e,o)}_renderer.toneMapping=d,_renderer.toneMappingExposure=f,_renderer.outputEncoding=h,_renderer.setClearColor(m,v),e.scale.z*=-1}function _textureToCubeUV(e,t){var r=new Scene;e.isCubeTexture?null==_cubemapShader&&(_cubemapShader=_getCubemapShader()):null==_equirectShader&&(_equirectShader=_getEquirectShader());var n=e.isCubeTexture?_cubemapShader:_equirectShader;r.add(new Mesh(_lodPlanes[0],n));var o=n.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=ENCODINGS[e.encoding],o.outputEncoding.value=ENCODINGS[e.encoding],_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX),_renderer.setRenderTarget(t),_renderer.render(r,_flatCamera)}function _compileMaterial(e){var t=new Scene;t.add(new Mesh(_lodPlanes[0],e)),_renderer.compile(t,_flatCamera)}function _createRenderTarget(e){var t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(e,t,r,n,o){e.viewport.set(t,r,n,o),e.scissor.set(t,r,n,o)}function _applyPMREM(e){var t=_renderer.autoClear;_renderer.autoClear=!1;for(var i=1;i<TOTAL_LODS;i++){_blur(e,i-1,i,Math.sqrt(_sigmas[i]*_sigmas[i]-_sigmas[i-1]*_sigmas[i-1]),_axisDirections[(i-1)%_axisDirections.length])}_renderer.autoClear=t}function _blur(e,t,r,n,o){_halfBlur(e,_pingPongRenderTarget,t,r,n,"latitudinal",o),_halfBlur(_pingPongRenderTarget,e,r,r,n,"longitudinal",o)}function _halfBlur(e,t,r,n,o,l,c){"latitudinal"!==l&&"longitudinal"!==l&&console.error("blur direction must be either latitudinal or longitudinal!");var h=new Scene;h.add(new Mesh(_lodPlanes[n],_blurMaterial));var d=_blurMaterial.uniforms,f=_sizeLods[r]-1,m=isFinite(o)?Math.PI/(2*f):2*Math.PI/(2*MAX_SAMPLES-1),v=o/m,y=isFinite(o)?1+Math.floor(3*v):MAX_SAMPLES;y>MAX_SAMPLES&&console.warn("sigmaRadians, "+o+", is too large and will clip, as it requested "+y+" samples when the maximum is set to "+MAX_SAMPLES);for(var x=[],_=0,i=0;i<MAX_SAMPLES;++i){var M=i/v,w=Math.exp(-M*M/2);x.push(w),0==i?_+=w:i<y&&(_+=2*w)}for(i=0;i<x.length;i++)x[i]=x[i]/_;d.envMap.value=e.texture,d.samples.value=y,d.weights.value=x,d.latitudinal.value="latitudinal"===l,c&&(d.poleAxis.value=c),d.dTheta.value=m,d.mipInt.value=LOD_MAX-r,d.inputEncoding.value=ENCODINGS[e.texture.encoding],d.outputEncoding.value=ENCODINGS[e.texture.encoding];var S=_sizeLods[n];_setViewport(t,M=3*Math.max(0,SIZE_MAX-2*S),(0===n?0:2*SIZE_MAX)+2*S*(n>LOD_MAX-LOD_MIN?n-LOD_MAX+LOD_MIN:0),3*S,2*S),_renderer.setRenderTarget(t),_renderer.render(h,_flatCamera)}function _getBlurShader(e){var t=new RawShaderMaterial({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(e)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Vector3(0,1,0)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n"+_getEncodings()+"\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1});return t.type="SphericalGaussianBlur",t}function _getEquirectShader(){var e=new RawShaderMaterial({uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n"+_getEncodings()+"\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function _getCubemapShader(){var e=new RawShaderMaterial({uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n"+_getEncodings()+"\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function _getCommonVertexShader(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function _getEncodings(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function CircleGeometry(e,t,r,n){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new CircleBufferGeometry(e,t,r,n)),this.mergeVertices()}function CircleBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,s,o=[],l=[],c=[],h=[],d=new Vector3,f=new Vector2;for(l.push(0,0,0),c.push(0,0,1),h.push(.5,.5),s=0,i=3;s<=t;s++,i+=3){var m=r+s/t*n;d.x=e*Math.cos(m),d.y=e*Math.sin(m),l.push(d.x,d.y,d.z),c.push(0,0,1),f.x=(l[i]/e+1)/2,f.y=(l[i+1]/e+1)/2,h.push(f.x,f.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}function ConeGeometry(e,t,r,n,o,l,c){CylinderGeometry.call(this,0,e,t,r,n,o,l,c),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:l,thetaLength:c}}function ConeBufferGeometry(e,t,r,n,o,l,c){CylinderBufferGeometry.call(this,0,e,t,r,n,o,l,c),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:l,thetaLength:c}}function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}function DodecahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];PolyhedronBufferGeometry.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,o,l,c=[],h=Math.cos(MathUtils.DEG2RAD*t),d=[0,0],f={},m=["a","b","c"];e.isBufferGeometry?(l=new Geometry).fromBufferGeometry(e):l=e.clone(),l.mergeVertices(),l.computeFaceNormals();for(var v=l.vertices,y=l.faces,i=0,x=y.length;i<x;i++)for(var _=y[i],M=0;M<3;M++)r=_[m[M]],n=_[m[(M+1)%3]],d[0]=Math.min(r,n),d[1]=Math.max(r,n),void 0===f[o=d[0]+","+d[1]]?f[o]={index1:d[0],index2:d[1],face1:i,face2:void 0}:f[o].face2=i;for(o in f){var w=f[o];if(void 0===w.face2||y[w.face1].normal.dot(y[w.face2].normal)<=h){var S=v[w.index1];c.push(S.x,S.y,S.z),S=v[w.index2],c.push(S.x,S.y,S.z)}}this.setAttribute("position",new Float32BufferAttribute(c,3))}function ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}function ExtrudeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],o=[],i=0,l=e.length;i<l;i++){c(e[i])}function c(e){var l=[],c=void 0!==t.curveSegments?t.curveSegments:12,h=void 0!==t.steps?t.steps:1,d=void 0!==t.depth?t.depth:100,f=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.bevelThickness?t.bevelThickness:6,v=void 0!==t.bevelSize?t.bevelSize:m-2,y=void 0!==t.bevelOffset?t.bevelOffset:0,x=void 0!==t.bevelSegments?t.bevelSegments:3,_=t.extrudePath,M=void 0!==t.UVGenerator?t.UVGenerator:WorldUVGenerator;void 0!==t.amount&&(console.warn("ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);var w,S,A,T,L,C,N,P,F=!1;_&&(w=_.getSpacedPoints(h),F=!0,f=!1,S=_.computeFrenetFrames(h,!1),A=new Vector3,T=new Vector3,L=new Vector3),f||(x=0,m=0,v=0,y=0);var E=e.extractPoints(c),R=E.shape,D=E.holes;if(!ShapeUtils.isClockWise(R))for(R=R.reverse(),N=0,P=D.length;N<P;N++)C=D[N],ShapeUtils.isClockWise(C)&&(D[N]=C.reverse());var O=ShapeUtils.triangulateShape(R,D),I=R;for(N=0,P=D.length;N<P;N++)C=D[N],R=R.concat(C);function B(e,t,r){return t||console.error("ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var b,U,k,V,G,z,j=R.length,W=O.length;function H(e,t,r){var n,o,l,c=e.x-t.x,h=e.y-t.y,d=r.x-e.x,f=r.y-e.y,m=c*c+h*h,v=c*f-h*d;if(Math.abs(v)>Number.EPSILON){var y=Math.sqrt(m),x=Math.sqrt(d*d+f*f),_=t.x-h/y,M=t.y+c/y,w=((r.x-f/x-_)*f-(r.y+d/x-M)*d)/(c*f-h*d),S=(n=_+c*w-e.x)*n+(o=M+h*w-e.y)*o;if(S<=2)return new Vector2(n,o);l=Math.sqrt(S/2)}else{var A=!1;c>Number.EPSILON?d>Number.EPSILON&&(A=!0):c<-Number.EPSILON?d<-Number.EPSILON&&(A=!0):Math.sign(h)===Math.sign(f)&&(A=!0),A?(n=-h,o=c,l=Math.sqrt(m)):(n=c,o=h,l=Math.sqrt(m/2))}return new Vector2(n/l,o/l)}for(var X=[],i=0,Y=I.length,Q=Y-1,K=i+1;i<Y;i++,Q++,K++)Q===Y&&(Q=0),K===Y&&(K=0),X[i]=H(I[i],I[Q],I[K]);var J,s,Z=[],$=X.concat();for(N=0,P=D.length;N<P;N++){for(C=D[N],J=[],i=0,Q=(Y=C.length)-1,K=i+1;i<Y;i++,Q++,K++)Q===Y&&(Q=0),K===Y&&(K=0),J[i]=H(C[i],C[Q],C[K]);Z.push(J),$=$.concat(J)}for(b=0;b<x;b++){for(k=b/x,V=m*Math.cos(k*Math.PI/2),U=v*Math.sin(k*Math.PI/2)+y,i=0,Y=I.length;i<Y;i++)te((G=B(I[i],X[i],U)).x,G.y,-V);for(N=0,P=D.length;N<P;N++)for(C=D[N],J=Z[N],i=0,Y=C.length;i<Y;i++)te((G=B(C[i],J[i],U)).x,G.y,-V)}for(U=v+y,i=0;i<j;i++)G=f?B(R[i],$[i],U):R[i],F?(T.copy(S.normals[0]).multiplyScalar(G.x),A.copy(S.binormals[0]).multiplyScalar(G.y),L.copy(w[0]).add(T).add(A),te(L.x,L.y,L.z)):te(G.x,G.y,0);for(s=1;s<=h;s++)for(i=0;i<j;i++)G=f?B(R[i],$[i],U):R[i],F?(T.copy(S.normals[s]).multiplyScalar(G.x),A.copy(S.binormals[s]).multiplyScalar(G.y),L.copy(w[s]).add(T).add(A),te(L.x,L.y,L.z)):te(G.x,G.y,d/h*s);for(b=x-1;b>=0;b--){for(k=b/x,V=m*Math.cos(k*Math.PI/2),U=v*Math.sin(k*Math.PI/2)+y,i=0,Y=I.length;i<Y;i++)te((G=B(I[i],X[i],U)).x,G.y,d+V);for(N=0,P=D.length;N<P;N++)for(C=D[N],J=Z[N],i=0,Y=C.length;i<Y;i++)G=B(C[i],J[i],U),F?te(G.x,G.y+w[h-1].y,w[h-1].x+V):te(G.x,G.y,d+V)}function ee(e,t){var r,n;for(i=e.length;--i>=0;){r=i,(n=i-1)<0&&(n=e.length-1);var s=0,o=h+2*x;for(s=0;s<o;s++){var l=j*s,c=j*(s+1);ie(t+r+l,t+n+l,t+n+c,t+r+c)}}}function te(e,t,r){l.push(e),l.push(t),l.push(r)}function re(a,b,e){ne(a),ne(b),ne(e);var t=n.length/3,o=M.generateTopUV(r,n,t-3,t-2,t-1);ae(o[0]),ae(o[1]),ae(o[2])}function ie(a,b,e,t){ne(a),ne(b),ne(t),ne(b),ne(e),ne(t);var o=n.length/3,l=M.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);ae(l[0]),ae(l[1]),ae(l[3]),ae(l[1]),ae(l[2]),ae(l[3])}function ne(e){n.push(l[3*e+0]),n.push(l[3*e+1]),n.push(l[3*e+2])}function ae(e){o.push(e.x),o.push(e.y)}!function(){var e=n.length/3;if(f){var t=0,o=j*t;for(i=0;i<W;i++)re((z=O[i])[2]+o,z[1]+o,z[0]+o);for(o=j*(t=h+2*x),i=0;i<W;i++)re((z=O[i])[0]+o,z[1]+o,z[2]+o)}else{for(i=0;i<W;i++)re((z=O[i])[2],z[1],z[0]);for(i=0;i<W;i++)re((z=O[i])[0]+j*h,z[1]+j*h,z[2]+j*h)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(ee(I,t),t+=I.length,N=0,P=D.length;N<P;N++)ee(C=D[N],t),t+=C.length;r.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals()}PMREMGenerator.prototype={constructor:PMREMGenerator,fromScene:function(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=.1),void 0===n&&(n=100),_oldTarget=_renderer.getRenderTarget();var o=_allocateTargets();return _sceneToCubeUV(e,r,n,o),t>0&&_blur(o,0,0,t),_applyPMREM(o),_cleanup(o),o},fromEquirectangular:function(e){return e.magFilter=NearestFilter,e.minFilter=NearestFilter,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){_oldTarget=_renderer.getRenderTarget();var t=_allocateTargets(e);return _textureToCubeUV(e,t),_applyPMREM(t),_cleanup(t),t},compileCubemapShader:function(){null==_cubemapShader&&_compileMaterial(_cubemapShader=_getCubemapShader())},compileEquirectangularShader:function(){null==_equirectShader&&_compileMaterial(_equirectShader=_getEquirectShader())},dispose:function(){_blurMaterial.dispose(),null!=_cubemapShader&&_cubemapShader.dispose(),null!=_equirectShader&&_equirectShader.dispose();for(var i=0;i<_lodPlanes.length;i++)_lodPlanes[i].dispose()}},CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,data)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,data)};var WorldUVGenerator={generateTopUV:function(e,t,r,n,o){var l=t[3*r],c=t[3*r+1],h=t[3*n],d=t[3*n+1],f=t[3*o],m=t[3*o+1];return[new Vector2(l,c),new Vector2(h,d),new Vector2(f,m)]},generateSideWallUV:function(e,t,r,n,o,l){var c=t[3*r],h=t[3*r+1],d=t[3*r+2],f=t[3*n],m=t[3*n+1],v=t[3*n+2],y=t[3*o],x=t[3*o+1],_=t[3*o+2],M=t[3*l],w=t[3*l+1],S=t[3*l+2];return Math.abs(h-m)<.01?[new Vector2(c,1-d),new Vector2(f,1-v),new Vector2(y,1-_),new Vector2(M,1-S)]:[new Vector2(h,1-d),new Vector2(m,1-v),new Vector2(x,1-_),new Vector2(w,1-S)]}};function toJSON(e,t,data){if(data.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];data.shapes.push(n.uuid)}else data.shapes.push(e.uuid);return void 0!==t.extrudePath&&(data.options.extrudePath=t.extrudePath.toJSON()),data}function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}function IcosahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];PolyhedronBufferGeometry.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function LatheGeometry(e,t,r,n){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new LatheBufferGeometry(e,t,r,n)),this.mergeVertices()}function LatheBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=MathUtils.clamp(n,0,2*Math.PI);var base,i,o,l=[],c=[],h=[],d=1/t,f=new Vector3,m=new Vector2;for(i=0;i<=t;i++){var v=r+i*d*n,y=Math.sin(v),x=Math.cos(v);for(o=0;o<=e.length-1;o++)f.x=e[o].x*y,f.y=e[o].y,f.z=e[o].x*x,c.push(f.x,f.y,f.z),m.x=i/t,m.y=o/(e.length-1),h.push(m.x,m.y)}for(i=0;i<t;i++)for(o=0;o<e.length-1;o++){var a=base=o+i*e.length,b=base+e.length,_=base+e.length+1,M=base+1;l.push(a,b,M),l.push(b,_,M)}if(this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2)),this.computeVertexNormals(),n===2*Math.PI){var w=this.attributes.normal.array,S=new Vector3,A=new Vector3,T=new Vector3;for(base=t*e.length*3,i=0,o=0;i<e.length;i++,o+=3)S.x=w[o+0],S.y=w[o+1],S.z=w[o+2],A.x=w[base+o+0],A.y=w[base+o+1],A.z=w[base+o+2],T.addVectors(S,A).normalize(),w[o+0]=w[base+o+0]=T.x,w[o+1]=w[base+o+1]=T.y,w[o+2]=w[base+o+2]=T.z}}function RingGeometry(e,t,r,n,o,l){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:l},this.fromBufferGeometry(new RingBufferGeometry(e,t,r,n,o,l)),this.mergeVertices()}function RingBufferGeometry(e,t,r,n,o,l){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:l},e=e||.5,t=t||1,o=void 0!==o?o:0,l=void 0!==l?l:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var c,h,i,d=[],f=[],m=[],v=[],y=e,x=(t-e)/(n=void 0!==n?Math.max(1,n):1),_=new Vector3,M=new Vector2;for(h=0;h<=n;h++){for(i=0;i<=r;i++)c=o+i/r*l,_.x=y*Math.cos(c),_.y=y*Math.sin(c),f.push(_.x,_.y,_.z),m.push(0,0,1),M.x=(_.x/t+1)/2,M.y=(_.y/t+1)/2,v.push(M.x,M.y);y+=x}for(h=0;h<n;h++){var w=h*(r+1);for(i=0;i<r;i++){var a=c=i+w,b=c+r+1,S=c+r+2,A=c+1;d.push(a,b,A),d.push(b,S,A)}}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(v,2))}function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}function ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],o=[],l=[],c=0,h=0;if(!1===Array.isArray(e))d(e);else for(var i=0;i<e.length;i++)d(e[i]),this.addGroup(c,h,i),c+=h,h=0;function d(e){var i,c,d,f=n.length/3,m=e.extractPoints(t),v=m.shape,y=m.holes;for(!1===ShapeUtils.isClockWise(v)&&(v=v.reverse()),i=0,c=y.length;i<c;i++)d=y[i],!0===ShapeUtils.isClockWise(d)&&(y[i]=d.reverse());var x=ShapeUtils.triangulateShape(v,y);for(i=0,c=y.length;i<c;i++)d=y[i],v=v.concat(d);for(i=0,c=v.length;i<c;i++){var _=v[i];n.push(_.x,_.y,0),o.push(0,0,1),l.push(_.x,_.y)}for(i=0,c=x.length;i<c;i++){var M=x[i],a=M[0]+f,b=M[1]+f,w=M[2]+f;r.push(a,b,w),h+=3}}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}function toJSON$1(e,data){if(data.shapes=[],Array.isArray(e))for(var i=0,t=e.length;i<t;i++){var r=e[i];data.shapes.push(r.uuid)}else data.shapes.push(e.uuid);return data}function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}function TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TextGeometry(text,e){Geometry.call(this),this.type="TextGeometry",this.parameters={text:text,parameters:e},this.fromBufferGeometry(new TextBufferGeometry(text,e)),this.mergeVertices()}function TextBufferGeometry(text,e){var t=(e=e||{}).font;if(!t||!t.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Geometry;var r=t.generateShapes(text,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,r,e),this.type="TextBufferGeometry"}function TorusKnotGeometry(e,t,r,n,p,q,o){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:p,q:q},void 0!==o&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,r,n,p,q)),this.mergeVertices()}function TorusKnotBufferGeometry(e,t,r,n,p,q){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:p,q:q},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,p=p||2,q=q||3;var i,o,l=[],c=[],h=[],d=[],f=new Vector3,m=new Vector3,v=new Vector3,y=new Vector3,x=new Vector3,_=new Vector3,M=new Vector3;for(i=0;i<=r;++i){var u=i/r*p*Math.PI*2;for(C(u,p,q,e,v),C(u+.01,p,q,e,y),_.subVectors(y,v),M.addVectors(y,v),x.crossVectors(_,M),M.crossVectors(x,_),x.normalize(),M.normalize(),o=0;o<=n;++o){var w=o/n*Math.PI*2,S=-t*Math.cos(w),A=t*Math.sin(w);f.x=v.x+(S*M.x+A*x.x),f.y=v.y+(S*M.y+A*x.y),f.z=v.z+(S*M.z+A*x.z),c.push(f.x,f.y,f.z),m.subVectors(f,v).normalize(),h.push(m.x,m.y,m.z),d.push(i/r),d.push(o/n)}}for(o=1;o<=r;o++)for(i=1;i<=n;i++){var a=(n+1)*(o-1)+(i-1),b=(n+1)*o+(i-1),T=(n+1)*o+i,L=(n+1)*(o-1)+i;l.push(a,b,L),l.push(b,T,L)}function C(u,p,q,e,t){var r=Math.cos(u),n=Math.sin(u),o=q/p*u,l=Math.cos(o);t.x=e*(2+l)*.5*r,t.y=e*(2+l)*n*.5,t.z=e*Math.sin(o)*.5}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}function TubeGeometry(path,e,t,r,n,o){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:path,tubularSegments:e,radius:t,radialSegments:r,closed:n},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var l=new TubeBufferGeometry(path,e,t,r,n);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals,this.fromBufferGeometry(l),this.mergeVertices()}function TubeBufferGeometry(path,e,t,r,n){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:path,tubularSegments:e,radius:t,radialSegments:r,closed:n},e=e||64,t=t||1,r=r||8,n=n||!1;var o=path.computeFrenetFrames(e,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var i,l,c=new Vector3,h=new Vector3,d=new Vector2,f=new Vector3,m=[],v=[],y=[],x=[];function _(i){f=path.getPointAt(i/e,f);var n=o.normals[i],d=o.binormals[i];for(l=0;l<=r;l++){var y=l/r*Math.PI*2,x=Math.sin(y),_=-Math.cos(y);h.x=_*n.x+x*d.x,h.y=_*n.y+x*d.y,h.z=_*n.z+x*d.z,h.normalize(),v.push(h.x,h.y,h.z),c.x=f.x+t*h.x,c.y=f.y+t*h.y,c.z=f.z+t*h.z,m.push(c.x,c.y,c.z)}}!function(){for(i=0;i<e;i++)_(i);_(!1===n?e:0),function(){for(i=0;i<=e;i++)for(l=0;l<=r;l++)d.x=i/e,d.y=l/r,y.push(d.x,d.y)}(),function(){for(l=1;l<=e;l++)for(i=1;i<=r;i++){var a=(r+1)*(l-1)+(i-1),b=(r+1)*l+(i-1),t=(r+1)*l+i,n=(r+1)*(l-1)+i;x.push(a,b,n),x.push(b,t,n)}}()}(),this.setIndex(x),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}function AxesHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(t,3)),r.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,r,n)}function Box3Helper(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,n,new LineBasicMaterial({color:t})),this.geometry.computeBoundingSphere()}IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,data)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,data)},TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TubeBufferGeometry.prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return data.path=this.parameters.path.toJSON(),data},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper,Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))};var _box$3=new Box3;function BoxHelper(object,e){this.object=object,void 0===e&&(e=16776960);var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(t,1)),n.setAttribute("position",new BufferAttribute(r,3)),LineSegments.call(this,n,new LineBasicMaterial({color:e})),this.matrixAutoUpdate=!1,this.update()}BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(object){if(void 0!==object&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box$3.setFromObject(this.object),!_box$3.isEmpty()){var e=_box$3.min,t=_box$3.max,r=this.geometry.attributes.position,n=r.array;n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=e.x,n[4]=t.y,n[5]=t.z,n[6]=e.x,n[7]=e.y,n[8]=t.z,n[9]=t.x,n[10]=e.y,n[11]=t.z,n[12]=t.x,n[13]=t.y,n[14]=e.z,n[15]=e.x,n[16]=t.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=t.x,n[22]=e.y,n[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},BoxHelper.prototype.setFromObject=function(object){return this.object=object,this.update(),this},BoxHelper.prototype.copy=function(source){return LineSegments.prototype.copy.call(this,source),this.object=source.object,this},BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)};var _vector$9=new Vector3,_camera=new Camera;function CameraHelper(e){var t=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:FaceColors}),n=[],o=[],l={},c=new Color(16755200),h=new Color(16711680),d=new Color(43775),f=new Color(16777215),m=new Color(3355443);function v(a,b,e){y(a,e),y(b,e)}function y(e,t){n.push(0,0,0),o.push(t.r,t.g,t.b),void 0===l[e]&&(l[e]=[]),l[e].push(n.length/3-1)}v("n1","n2",c),v("n2","n4",c),v("n4","n3",c),v("n3","n1",c),v("f1","f2",c),v("f2","f4",c),v("f4","f3",c),v("f3","f1",c),v("n1","f1",c),v("n2","f2",c),v("n3","f3",c),v("n4","f4",c),v("p","n1",h),v("p","n2",h),v("p","n3",h),v("p","n4",h),v("u1","u2",d),v("u2","u3",d),v("u3","u1",d),v("c","t",f),v("p","c",m),v("cn1","cn2",m),v("cn3","cn4",m),v("cf1","cf2",m),v("cf3","cf4",m),t.setAttribute("position",new Float32BufferAttribute(n,3)),t.setAttribute("color",new Float32BufferAttribute(o,3)),LineSegments.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update()}function setPoint(e,t,r,n,o,l,c){_vector$9.set(o,l,c).unproject(n);var h=t[e];if(void 0!==h)for(var d=r.getAttribute("position"),i=0,f=h.length;i<f;i++)d.setXYZ(h[i],_vector$9.x,_vector$9.y,_vector$9.z)}CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var e=this.geometry,t=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,1,-1,-1),setPoint("n3",t,e,_camera,-1,1,-1),setPoint("n4",t,e,_camera,1,1,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,1,-1,1),setPoint("f3",t,e,_camera,-1,1,1),setPoint("f4",t,e,_camera,1,1,1),setPoint("u1",t,e,_camera,.7,1.1,-1),setPoint("u2",t,e,_camera,-.7,1.1,-1),setPoint("u3",t,e,_camera,0,2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,1,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,1,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,1,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,1,-1),e.getAttribute("position").needsUpdate=!0};var _v1$7=new Vector3,_v2$5=new Vector3,_v3$1=new Vector3;function DirectionalLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var o=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(n,o),this.add(this.lightPlane),(n=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,o),this.add(this.targetLine),this.update()}function GridHelper(e,t,r,n){e=e||10,t=t||10,r=new Color(void 0!==r?r:4473924),n=new Color(void 0!==n?n:8947848);for(var o=t/2,l=e/t,c=e/2,h=[],d=[],i=0,f=0,m=-c;i<=t;i++,m+=l){h.push(-c,0,m,c,0,m),h.push(m,0,-c,m,0,c);var v=i===o?r:n;v.toArray(d,f),f+=3,v.toArray(d,f),f+=3,v.toArray(d,f),f+=3,v.toArray(d,f),f+=3}var y=new BufferGeometry;y.setAttribute("position",new Float32BufferAttribute(h,3)),y.setAttribute("color",new Float32BufferAttribute(d,3));var x=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,y,x)}DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){_v1$7.setFromMatrixPosition(this.light.matrixWorld),_v2$5.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$5,_v1$7),this.lightPlane.lookAt(_v2$5),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$5),this.targetLine.scale.z=_v3$1.length()},GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(source){return LineSegments.prototype.copy.call(this,source),this.geometry.copy(source.geometry),this.material.copy(source.material),this},clone:function(){return(new this.constructor).copy(this)}});var _vector$a=new Vector3,_color1=new Color,_color2=new Color;function HemisphereLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new OctahedronBufferGeometry(t);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=VertexColors);var o=n.getAttribute("position"),l=new Float32Array(3*o.count);n.setAttribute("color",new BufferAttribute(l,3)),this.add(new Mesh(n,this.material)),this.update()}function PlaneHelper(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),Line.call(this,o,new LineBasicMaterial({color:n}));var l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),l.computeBoundingSphere(),this.add(new Mesh(l,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function PointLightHelper(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new SphereBufferGeometry(t,4,2),o=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,n,o),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function PolarGridHelper(e,t,r,n,o,l){e=e||10,t=t||16,r=r||8,n=n||64,o=new Color(void 0!==o?o:4473924),l=new Color(void 0!==l?l:8947848);var c,h,d,i,f,m,v,y=[],x=[];for(i=0;i<=t;i++)d=i/t*(2*Math.PI),c=Math.sin(d)*e,h=Math.cos(d)*e,y.push(0,0,0),y.push(c,0,h),v=1&i?o:l,x.push(v.r,v.g,v.b),x.push(v.r,v.g,v.b);for(i=0;i<=r;i++)for(v=1&i?o:l,m=e-e/r*i,f=0;f<n;f++)d=f/n*(2*Math.PI),c=Math.sin(d)*m,h=Math.cos(d)*m,y.push(c,0,h),x.push(v.r,v.g,v.b),d=(f+1)/n*(2*Math.PI),c=Math.sin(d)*m,h=Math.cos(d)*m,y.push(c,0,h),x.push(v.r,v.g,v.b);var _=new BufferGeometry;_.setAttribute("position",new Float32BufferAttribute(y,3)),_.setAttribute("color",new Float32BufferAttribute(x,3));var M=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,_,M)}HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?_color1:_color2;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(_vector$a.setFromMatrixPosition(this.light.matrixWorld).negate())},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)},PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper;var _vector$b=new Vector3;function SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var l=i/32*Math.PI*2,c=o/32*Math.PI*2;n.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}r.setAttribute("position",new Float32BufferAttribute(n,3));var h=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(r,h),this.add(this.cone),this.update()}function AmbientLightProbe(e,t){LightProbe.call(this,void 0,t);var r=(new Color).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}function HemisphereLight(e,t,r){Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}function HemisphereLightProbe(e,t,r){LightProbe.call(this,void 0,r);var n=(new Color).set(e),o=(new Color).set(t),l=new Vector3(n.r,n.g,n.b),c=new Vector3(o.r,o.g,o.b),h=Math.sqrt(Math.PI),d=h*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(c).multiplyScalar(h),this.sh.coefficients[1].copy(l).sub(c).multiplyScalar(d)}function RectAreaLight(e,t,r,n){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function AnimationLoader(e){Loader.call(this,e)}function AudioLoader(e){Loader.call(this,e)}function BufferGeometryLoader(e){Loader.call(this,e)}SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$b.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$b),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(source){return LightProbe.prototype.copy.call(this,source),this},toJSON:function(meta){return LightProbe.prototype.toJSON.call(this,meta)}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.groundColor.copy(source.groundColor),this}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(source){return LightProbe.prototype.copy.call(this,source),this},toJSON:function(meta){return LightProbe.prototype.toJSON.call(this,meta)}}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.width=source.width,this.height=source.height,this},toJSON:function(meta){var data=Light.prototype.toJSON.call(this,meta);return data.object.width=this.width,data.object.height=this.height,data}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(JSON.parse(text)))}),r,n)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var r=AnimationClip.parse(e[i]);t.push(r)}return t}}),AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(e,t,r,n){var o=new FileLoader(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){var r=e.slice(0);AudioContext.getContext().decodeAudioData(r,(function(e){t(e)}))}),r,n)}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(o.manager);l.setPath(o.path),l.load(e,(function(text){t(o.parse(JSON.parse(text)))}),r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,r=e.data.index;if(void 0!==r){var n=new TYPED_ARRAYS[r.type](r.array);t.setIndex(new BufferAttribute(n,1))}var o=e.data.attributes;for(var l in o){var c=o[l],h=(n=new TYPED_ARRAYS[c.type](c.array),new(c.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(n,c.itemSize,c.normalized));void 0!==c.name&&(h.name=c.name),t.setAttribute(l,h)}var d=e.data.morphAttributes;if(d)for(var l in d){for(var f=d[l],m=[],i=0,v=f.length;i<v;i++){c=f[i],h=new BufferAttribute(n=new TYPED_ARRAYS[c.type](c.array),c.itemSize,c.normalized);void 0!==c.name&&(h.name=c.name),m.push(h)}t.morphAttributes[l]=m}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var y=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==y){i=0;for(var x=y.length;i!==x;++i){var _=y[i];t.addGroup(_.start,_.count,_.materialIndex)}}var M=e.data.boundingSphere;if(void 0!==M){var w=new Vector3;void 0!==M.center&&w.fromArray(M.center),t.boundingSphere=new Sphere(w,M.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function CubeTextureLoader(e){Loader.call(this,e)}function FontLoader(e){Loader.call(this,e)}function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),Loader.call(this,e),this.options=void 0}CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(e,t,r,n){var o=new CubeTexture,l=new ImageLoader(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);var c=0;function h(i){l.load(e[i],(function(image){o.images[i]=image,6===++c&&(o.needsUpdate=!0,t&&t(o))}),void 0,n)}for(var i=0;i<e.length;++i)h(i);return o}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(e,t,r,n){var o=this,l=new FileLoader(this.manager);l.setPath(this.path),l.load(e,(function(text){var e;try{e=JSON.parse(text)}catch(t){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),e=JSON.parse(text.substring(65,text.length-2))}var r=o.parse(e);t&&t(r)}),r,n)},parse:function(e){return new Font(e)}}),ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,l=Cache.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout((function(){t&&t(l),o.manager.itemEnd(e)}),0),l;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===o.options?createImageBitmap(e):createImageBitmap(e,o.options)})).then((function(r){Cache.add(e,r),t&&t(r),o.manager.itemEnd(e)})).catch((function(t){n&&n(t),o.manager.itemError(e),o.manager.itemEnd(e)})),o.manager.itemStart(e)}});var _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(e,t,r){Mesh.call(this,e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var r=this.matrixWorld,n=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(var o=0;o<n;o++)this.getMatrixAt(o,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects),_instanceIntersects.length>0&&(_instanceIntersects[0].instanceId=o,_instanceIntersects[0].object=this,t.push(_instanceIntersects[0]),_instanceIntersects.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}});var _v1$8=new Vector3,_v2$6=new Vector3;function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Fog(e,t,r){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(source){Object3D.prototype.copy.call(this,source,!1);for(var e=source.levels,i=0,t=e.length;i<t;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=source.autoUpdate,this},addLevel:function(object,e){void 0===e&&(e=0),e=Math.abs(e);for(var t=this.levels,r=0;r<t.length&&!(e<t[r].distance);r++);return t.splice(r,0,{distance:e,object:object}),this.add(object),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){_v1$8.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(_v1$8);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){_v1$8.setFromMatrixPosition(e.matrixWorld),_v2$6.setFromMatrixPosition(this.matrixWorld);var r=_v1$8.distanceTo(_v2$6);t[0].object.visible=!0;for(var i=1,n=t.length;i<n&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<n;i++)t[i].object.visible=!1}},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);!1===this.autoUpdate&&(data.object.autoUpdate=!1),data.object.levels=[];for(var e=this.levels,i=0,t=e.length;i<t;i++){var r=e[i];data.object.levels.push({object:r.object.uuid,distance:r.distance})}return data}}),Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});var Geometries={WireframeGeometry:WireframeGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry},Curves$1={ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve,GrannyKnot:GrannyKnot,HeartCurve:HeartCurve,VivianiCurve:VivianiCurve,KnotCurve:KnotCurve,HelixCurve:HelixCurve,TrefoilKnot:TrefoilKnot,TorusKnot:TorusKnot,CinquefoilKnot:CinquefoilKnot,TrefoilPolynomialKnot:TrefoilPolynomialKnot,FigureEightPolynomialKnot:FigureEightPolynomialKnot,DecoratedTorusKnot4a:DecoratedTorusKnot4a,DecoratedTorusKnot4b:DecoratedTorusKnot4b,DecoratedTorusKnot5a:DecoratedTorusKnot5a,DecoratedTorusKnot5c:DecoratedTorusKnot5c};function ObjectLoader(e){Loader.call(this,e)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(e,t,r,n){var o=this,path=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||path;var l=new FileLoader(o.manager);l.setPath(this.path),l.load(e,(function(text){var r=null;try{r=JSON.parse(text)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var l=r.metadata;void 0!==l&&void 0!==l.type&&"geometry"!==l.type.toLowerCase()?o.parse(r,t):console.error("ObjectLoader: Can't load "+e)}),r,n)},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(object)})),l=this.parseTextures(e.textures,o),c=this.parseMaterials(e.materials,l),object=this.parseObject(e.object,n,c);return e.animations&&(object.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(object),object},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new BufferGeometryLoader,i=0,o=e.length;i<o;i++){var l,data=e[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":l=new Geometries[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new Geometries[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new Geometries[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new Geometries[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new Geometries[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new Geometries[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new Geometries[data.type](data.radius,data.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new Geometries[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new Geometries[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new Geometries[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case"TubeGeometry":case"TubeBufferGeometry":l=new Geometries[data.type]((new Curves$1[data.path.type]).fromJSON(data.path),data.tubularSegments,data.radius,data.radialSegments,data.closed);break;case"LatheGeometry":case"LatheBufferGeometry":l=new Geometries[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new Geometries[data.type](data.vertices,data.indices,data.radius,data.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var c=[],h=0,d=data.shapes.length;h<d;h++){var f=t[data.shapes[h]];c.push(f)}l=new Geometries[data.type](c,data.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(c=[],h=0,d=data.shapes.length;h<d;h++){f=t[data.shapes[h]];c.push(f)}var m=data.options.extrudePath;void 0!==m&&(data.options.extrudePath=(new Curves$1[m.type]).fromJSON(m)),l=new Geometries[data.type](c,data.options);break;case"BufferGeometry":case"InstancedBufferGeometry":l=n.parse(data);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)l=(new LegacyJSONLoader).parse(data,this.resourcePath).geometry;else console.error('ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('ObjectLoader: Unsupported geometry type "'+data.type+'"');continue}l.uuid=data.uuid,void 0!==data.name&&(l.name=data.name),!0===l.isBufferGeometry&&void 0!==data.userData&&(l.userData=data.userData),r[data.uuid]=l}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var o=new MaterialLoader;o.setTextures(t);for(var i=0,l=e.length;i<l;i++){var data=e[i];if("MultiMaterial"===data.type){for(var c=[],h=0;h<data.materials.length;h++){var d=data.materials[h];void 0===r[d.uuid]&&(r[d.uuid]=o.parse(d)),c.push(r[d.uuid])}n[data.uuid]=c}else void 0===r[data.uuid]&&(r[data.uuid]=o.parse(data)),n[data.uuid]=r[data.uuid]}}return n},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var data=e[i],r=AnimationClip.parse(data);void 0!==data.uuid&&(r.uuid=data.uuid),t.push(r)}return t},parseImages:function(e,t){var r=this,n={};function o(e){return r.manager.itemStart(e),l.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var l=new ImageLoader(new LoadingManager(t));l.setCrossOrigin(this.crossOrigin);for(var i=0,c=e.length;i<c;i++){var image=e[i],h=image.url;if(Array.isArray(h)){n[image.uuid]=[];for(var d=0,f=h.length;d<f;d++){var m=h[d],path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(m)?m:r.resourcePath+m;n[image.uuid].push(o(path))}}else{path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:r.resourcePath+image.url;n[image.uuid]=o(path)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var l,data=e[i];void 0===data.image&&console.warn('ObjectLoader: No "image" specified for',data.uuid),void 0===t[data.image]&&console.warn("ObjectLoader: Undefined image",data.image),(l=Array.isArray(t[data.image])?new CubeTexture(t[data.image]):new Texture(t[data.image])).needsUpdate=!0,l.uuid=data.uuid,void 0!==data.name&&(l.name=data.name),void 0!==data.mapping&&(l.mapping=r(data.mapping,TEXTURE_MAPPING)),void 0!==data.offset&&l.offset.fromArray(data.offset),void 0!==data.repeat&&l.repeat.fromArray(data.repeat),void 0!==data.center&&l.center.fromArray(data.center),void 0!==data.rotation&&(l.rotation=data.rotation),void 0!==data.wrap&&(l.wrapS=r(data.wrap[0],TEXTURE_WRAPPING),l.wrapT=r(data.wrap[1],TEXTURE_WRAPPING)),void 0!==data.format&&(l.format=data.format),void 0!==data.type&&(l.type=data.type),void 0!==data.encoding&&(l.encoding=data.encoding),void 0!==data.minFilter&&(l.minFilter=r(data.minFilter,TEXTURE_FILTER)),void 0!==data.magFilter&&(l.magFilter=r(data.magFilter,TEXTURE_FILTER)),void 0!==data.anisotropy&&(l.anisotropy=data.anisotropy),void 0!==data.flipY&&(l.flipY=data.flipY),void 0!==data.premultiplyAlpha&&(l.premultiplyAlpha=data.premultiplyAlpha),void 0!==data.unpackAlignment&&(l.unpackAlignment=data.unpackAlignment),n[data.uuid]=l}return n},parseObject:function(data,e,t){var object;function r(t){return void 0===e[t]&&console.warn("ObjectLoader: Undefined geometry",t),e[t]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var r=[],i=0,n=e.length;i<n;i++){var o=e[i];void 0===t[o]&&console.warn("ObjectLoader: Undefined material",o),r.push(t[o])}return r}return void 0===t[e]&&console.warn("ObjectLoader: Undefined material",e),t[e]}}switch(data.type){case"Scene":object=new Scene,void 0!==data.background&&Number.isInteger(data.background)&&(object.background=new Color(data.background)),void 0!==data.fog&&("Fog"===data.fog.type?object.fog=new Fog(data.fog.color,data.fog.near,data.fog.far):"FogExp2"===data.fog.type&&(object.fog=new FogExp2(data.fog.color,data.fog.density)));break;case"PerspectiveCamera":object=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far),void 0!==data.focus&&(object.focus=data.focus),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.filmGauge&&(object.filmGauge=data.filmGauge),void 0!==data.filmOffset&&(object.filmOffset=data.filmOffset),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"OrthographicCamera":object=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"AmbientLight":object=new AmbientLight(data.color,data.intensity);break;case"DirectionalLight":object=new DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new PointLight(data.color,data.intensity,data.distance,data.decay);break;case"RectAreaLight":object=new RectAreaLight(data.color,data.intensity,data.width,data.height);break;case"SpotLight":object=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case"HemisphereLight":object=new HemisphereLight(data.color,data.groundColor,data.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=r(data.geometry),l=n(data.material);object=o.bones&&o.bones.length>0?new SkinnedMesh(o,l):new Mesh(o,l);break;case"InstancedMesh":o=r(data.geometry),l=n(data.material);var c=data.count,h=data.instanceMatrix;(object=new InstancedMesh(o,l,c)).instanceMatrix=new BufferAttribute(new Float32Array(h.array),16);break;case"LOD":object=new LOD;break;case"Line":object=new Line(r(data.geometry),n(data.material),data.mode);break;case"LineLoop":object=new LineLoop(r(data.geometry),n(data.material));break;case"LineSegments":object=new LineSegments(r(data.geometry),n(data.material));break;case"PointCloud":case"Points":object=new Points(r(data.geometry),n(data.material));break;case"Sprite":object=new Sprite(n(data.material));break;case"Group":object=new Group;break;default:object=new Object3D}if(object.uuid=data.uuid,void 0!==data.name&&(object.name=data.name),void 0!==data.matrix?(object.matrix.fromArray(data.matrix),void 0!==data.matrixAutoUpdate&&(object.matrixAutoUpdate=data.matrixAutoUpdate),object.matrixAutoUpdate&&object.matrix.decompose(object.position,object.quaternion,object.scale)):(void 0!==data.position&&object.position.fromArray(data.position),void 0!==data.rotation&&object.rotation.fromArray(data.rotation),void 0!==data.quaternion&&object.quaternion.fromArray(data.quaternion),void 0!==data.scale&&object.scale.fromArray(data.scale)),void 0!==data.castShadow&&(object.castShadow=data.castShadow),void 0!==data.receiveShadow&&(object.receiveShadow=data.receiveShadow),data.shadow&&(void 0!==data.shadow.bias&&(object.shadow.bias=data.shadow.bias),void 0!==data.shadow.radius&&(object.shadow.radius=data.shadow.radius),void 0!==data.shadow.mapSize&&object.shadow.mapSize.fromArray(data.shadow.mapSize),void 0!==data.shadow.camera&&(object.shadow.camera=this.parseObject(data.shadow.camera))),void 0!==data.visible&&(object.visible=data.visible),void 0!==data.frustumCulled&&(object.frustumCulled=data.frustumCulled),void 0!==data.renderOrder&&(object.renderOrder=data.renderOrder),void 0!==data.userData&&(object.userData=data.userData),void 0!==data.layers&&(object.layers.mask=data.layers),void 0!==data.children)for(var d=data.children,i=0;i<d.length;i++)object.add(this.parseObject(d[i],e,t));if("LOD"===data.type){void 0!==data.autoUpdate&&(object.autoUpdate=data.autoUpdate);for(var f=data.levels,m=0;m<f.length;m++){var v=f[m],y=object.getObjectByProperty("uuid",v.object);void 0!==y&&object.addLevel(y,v.distance)}}return object}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};function MeshMatcapMaterial(e){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Cylindrical(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function WebGLAnimation(){var e=null,t=!1,r=null;function n(time,o){!1!==t&&(r(time,o),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function WebGLAttributes(e,t){var r=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var data=n.get(t);data&&(e.deleteBuffer(data.buffer),n.delete(t))},update:function(t,o){t.isInterleavedBufferAttribute&&(t=t.data);var data=n.get(t);void 0===data?n.set(t,function(t,r){var n=t.array,o=t.usage,l=e.createBuffer();e.bindBuffer(r,l),e.bufferData(r,n,o),t.onUploadCallback();var c=e.FLOAT;return n instanceof Float32Array?c=e.FLOAT:n instanceof Float64Array?console.warn("WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?c=e.UNSIGNED_SHORT:n instanceof Int16Array?c=e.SHORT:n instanceof Uint32Array?c=e.UNSIGNED_INT:n instanceof Int32Array?c=e.INT:n instanceof Int8Array?c=e.BYTE:n instanceof Uint8Array&&(c=e.UNSIGNED_BYTE),{buffer:l,type:c,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,o)):data.version<t.version&&(!function(t,n,o){var l=n.array,c=n.updateRange;e.bindBuffer(o,t),-1===c.count?e.bufferSubData(o,0,l):(r?e.bufferSubData(o,c.offset*l.BYTES_PER_ELEMENT,l,c.offset,c.count):e.bufferSubData(o,c.offset*l.BYTES_PER_ELEMENT,l.subarray(c.offset,c.offset+c.count)),c.count=-1)}(data.buffer,t,o),data.version=t.version)}}}function WebGLBackground(e,t,r,n){var o,l,c=new Color(0),h=0,d=null,f=0,m=null;function v(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return c},setClearColor:function(e,t){c.set(e),v(c,h=void 0!==t?t:1)},getClearAlpha:function(){return h},setClearAlpha:function(e){v(c,h=e)},render:function(t,n,y,x){var _=n.background,M=e.xr,w=M.getSession&&M.getSession();if(w&&"additive"===w.environmentBlendMode&&(_=null),null===_?v(c,h):_&&_.isColor&&(v(_,1),x=!0),(e.autoClear||x)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.isWebGLCubeRenderTarget||_.mapping===CubeUVReflectionMapping)){void 0===l&&((l=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l));var S=_.isWebGLCubeRenderTarget?_.texture:_;l.material.uniforms.envMap.value=S,l.material.uniforms.flipEnvMap.value=S.isCubeTexture?-1:1,d===_&&f===S.version&&m===e.toneMapping||(l.material.needsUpdate=!0,d=_,f=S.version,m=e.toneMapping),t.unshift(l,l.geometry,l.material,0,0,null)}else _&&_.isTexture&&(void 0===o&&((o=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),o.material.uniforms.uvTransform.value.copy(_.matrix),d===_&&f===_.version&&m===e.toneMapping||(o.material.needsUpdate=!0,d=_,f=_.version,m=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null))}}}function WebGLBufferRenderer(e,t,r,n){var o,l=n.isWebGL2;this.setMode=function(e){o=e},this.render=function(t,n){e.drawArrays(o,t,n),r.update(n,o)},this.renderInstances=function(n,c,h,d){if(0!==d){var f,m;if(l)f=e,m="drawArraysInstanced";else if(m="drawArraysInstancedANGLE",null===(f=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");f[m](o,c,h,d),r.update(h,o,d)}}}function WebGLCapabilities(e,t,r){var n;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var l="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,c=void 0!==r.precision?r.precision:"highp",h=o(c);h!==c&&(console.warn("WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);var d=!0===r.logarithmicDepthBuffer,f=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),m=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=e.getParameter(e.MAX_TEXTURE_SIZE),y=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),x=e.getParameter(e.MAX_VERTEX_ATTRIBS),_=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),M=e.getParameter(e.MAX_VARYING_VECTORS),w=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),S=m>0,A=l||!!t.get("OES_texture_float");return{isWebGL2:l,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:o,precision:c,logarithmicDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:v,maxCubemapSize:y,maxAttributes:x,maxVertexUniforms:_,maxVaryings:M,maxFragmentUniforms:w,vertexTextures:S,floatFragmentTextures:A,floatVertexTextures:S&&A,maxSamples:l?e.getParameter(e.MAX_SAMPLES):0}}function WebGLClipping(){var e=this,t=null,r=0,n=!1,o=!1,l=new Plane,c=new Matrix3,h={value:null,needsUpdate:!1};function d(){h.value!==t&&(h.value=t,h.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function f(t,r,n,o){var d=null!==t?t.length:0,f=null;if(0!==d){if(f=h.value,!0!==o||null===f){var m=n+4*d,v=r.matrixWorldInverse;c.getNormalMatrix(v),(null===f||f.length<m)&&(f=new Float32Array(m));for(var i=0,y=n;i!==d;++i,y+=4)l.copy(t[i]).applyMatrix4(v,c),l.normal.toArray(f,y),f[y+3]=l.constant}h.value=f,h.needsUpdate=!0}return e.numPlanes=d,f}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(e,o,l){var c=0!==e.length||o||0!==r||n;return n=o,t=f(e,l,0),r=e.length,c},this.beginShadows=function(){o=!0,f(null)},this.endShadows=function(){o=!1,d()},this.setState=function(e,l,c,m,v,y){if(!n||null===e||0===e.length||o&&!c)o?f(null):d();else{var x=o?0:r,_=4*x,M=v.clippingState||null;h.value=M,M=f(e,m,_,y);for(var i=0;i!==_;++i)M[i]=t[i];v.clippingState=M,this.numIntersection=l?this.numPlanes:0,this.numPlanes+=x}}}function WebGLExtensions(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function WebGLGeometries(e,t,r){var n=new WeakMap,o=new WeakMap;function l(e){var c=e.target,h=n.get(c);for(var d in null!==h.index&&t.remove(h.index),h.attributes)t.remove(h.attributes[d]);c.removeEventListener("dispose",l),n.delete(c);var f=o.get(h);f&&(t.remove(f),o.delete(h)),r.memory.geometries--}function c(r){var n=[],l=r.index,c=r.attributes.position,h=0;if(null!==l){var d=l.array;h=l.version;for(var i=0,f=d.length;i<f;i+=3){var a=d[i+0],b=d[i+1],m=d[i+2];n.push(a,b,b,m,m,a)}}else{d=c.array;h=c.version;for(i=0,f=d.length/3-1;i<f;i+=3){a=i+0,b=i+1,m=i+2;n.push(a,b,b,m,m,a)}}var v=new(arrayMax(n)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(n,1);v.version=h,t.update(v,e.ELEMENT_ARRAY_BUFFER);var y=o.get(r);y&&t.remove(y),o.set(r,v)}return{get:function(object,e){var t=n.get(e);return t||(e.addEventListener("dispose",l),e.isBufferGeometry?t=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new BufferGeometry).setFromObject(object)),t=e._bufferGeometry),n.set(e,t),r.memory.geometries++,t)},update:function(r){var n=r.index,o=r.attributes;for(var l in null!==n&&t.update(n,e.ELEMENT_ARRAY_BUFFER),o)t.update(o[l],e.ARRAY_BUFFER);var c=r.morphAttributes;for(var l in c)for(var h=c[l],i=0,d=h.length;i<d;i++)t.update(h[i],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=o.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&c(e)}else c(e);return o.get(e)}}}function WebGLIndexedBufferRenderer(e,t,r,n){var o,l,c,h=n.isWebGL2;this.setMode=function(e){o=e},this.setIndex=function(e){l=e.type,c=e.bytesPerElement},this.render=function(t,n){e.drawElements(o,n,l,t*c),r.update(n,o)},this.renderInstances=function(n,d,f,m){if(0!==m){var v,y;if(h)v=e,y="drawElementsInstanced";else if(y="drawElementsInstancedANGLE",null===(v=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLIndexedBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");v[y](o,f,l,d*c,m),r.update(f,o,m)}}}function WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,n,o){switch(o=o||1,t.calls++,n){case e.TRIANGLES:t.triangles+=o*(r/3);break;case e.LINES:t.lines+=o*(r/2);break;case e.LINE_STRIP:t.lines+=o*(r-1);break;case e.LINE_LOOP:t.lines+=o*r;break;case e.POINTS:t.points+=o*r;break;default:console.error("WebGLInfo: Unknown draw mode:",n)}}}}function UniformsCache(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":r={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":r={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":r={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=r,r}}}MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.defines={MATCAP:""},this.color.copy(source.color),this.matcap=source.matcap,this.map=source.map,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.alphaMap=source.alphaMap,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},Object.assign(Cylindrical.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(){for(var e=new UniformsCache,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},i=0;i<9;i++)t.probe.push(new Vector3);var r=new Vector3,n=new Matrix4,o=new Matrix4;return{setup:function(l,c,h){for(var d=0,g=0,b=0,i=0;i<9;i++)t.probe[i].set(0,0,0);var f=0,m=0,v=0,y=0,x=0,_=0,M=0,w=0,S=h.matrixWorldInverse;l.sort(shadowCastingLightsFirst),i=0;for(var A=l.length;i<A;i++){var T=l[i],L=T.color,C=T.intensity,N=T.distance,P=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)d+=L.r*C,g+=L.g*C,b+=L.b*C;else if(T.isLightProbe)for(var F=0;F<9;F++)t.probe[F].addScaledVector(T.sh.coefficients[F],C);else if(T.isDirectionalLight){if((E=e.get(T)).color.copy(T.color).multiplyScalar(T.intensity),E.direction.setFromMatrixPosition(T.matrixWorld),r.setFromMatrixPosition(T.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(S),E.shadow=T.castShadow,T.castShadow){var shadow=T.shadow;E.shadowBias=shadow.bias,E.shadowRadius=shadow.radius,E.shadowMapSize=shadow.mapSize,t.directionalShadowMap[f]=P,t.directionalShadowMatrix[f]=T.shadow.matrix,_++}t.directional[f]=E,f++}else if(T.isSpotLight){if((E=e.get(T)).position.setFromMatrixPosition(T.matrixWorld),E.position.applyMatrix4(S),E.color.copy(L).multiplyScalar(C),E.distance=N,E.direction.setFromMatrixPosition(T.matrixWorld),r.setFromMatrixPosition(T.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(S),E.coneCos=Math.cos(T.angle),E.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),E.decay=T.decay,E.shadow=T.castShadow,T.castShadow){shadow=T.shadow;E.shadowBias=shadow.bias,E.shadowRadius=shadow.radius,E.shadowMapSize=shadow.mapSize,t.spotShadowMap[v]=P,t.spotShadowMatrix[v]=T.shadow.matrix,w++}t.spot[v]=E,v++}else if(T.isRectAreaLight){(E=e.get(T)).color.copy(L).multiplyScalar(C),E.position.setFromMatrixPosition(T.matrixWorld),E.position.applyMatrix4(S),o.identity(),n.copy(T.matrixWorld),n.premultiply(S),o.extractRotation(n),E.halfWidth.set(.5*T.width,0,0),E.halfHeight.set(0,.5*T.height,0),E.halfWidth.applyMatrix4(o),E.halfHeight.applyMatrix4(o),t.rectArea[y]=E,y++}else if(T.isPointLight){if((E=e.get(T)).position.setFromMatrixPosition(T.matrixWorld),E.position.applyMatrix4(S),E.color.copy(T.color).multiplyScalar(T.intensity),E.distance=T.distance,E.decay=T.decay,E.shadow=T.castShadow,T.castShadow){shadow=T.shadow;E.shadowBias=shadow.bias,E.shadowRadius=shadow.radius,E.shadowMapSize=shadow.mapSize,E.shadowCameraNear=shadow.camera.near,E.shadowCameraFar=shadow.camera.far,t.pointShadowMap[m]=P,t.pointShadowMatrix[m]=T.shadow.matrix,M++}t.point[m]=E,m++}else if(T.isHemisphereLight){var E;(E=e.get(T)).direction.setFromMatrixPosition(T.matrixWorld),E.direction.transformDirection(S),E.direction.normalize(),E.skyColor.copy(T.color).multiplyScalar(C),E.groundColor.copy(T.groundColor).multiplyScalar(C),t.hemi[x]=E,x++}}t.ambient[0]=d,t.ambient[1]=g,t.ambient[2]=b;var R=t.hash;R.directionalLength===f&&R.pointLength===m&&R.spotLength===v&&R.rectAreaLength===y&&R.hemiLength===x&&R.numDirectionalShadows===_&&R.numPointShadows===M&&R.numSpotShadows===w||(t.directional.length=f,t.spot.length=v,t.rectArea.length=y,t.point.length=m,t.hemi.length=x,t.directionalShadowMap.length=_,t.pointShadowMap.length=M,t.spotShadowMap.length=w,t.directionalShadowMatrix.length=_,t.pointShadowMatrix.length=M,t.spotShadowMatrix.length=w,R.directionalLength=f,R.pointLength=m,R.spotLength=v,R.rectAreaLength=y,R.hemiLength=x,R.numDirectionalShadows=_,R.numPointShadows=M,R.numSpotShadows=w,t.version=nextVersion++)},state:t}}function absNumericalSort(a,b){return Math.abs(b[1])-Math.abs(a[1])}function WebGLMorphtargets(e){var t={},r=new Float32Array(8);return{update:function(object,n,o,l){var c=object.morphTargetInfluences,h=void 0===c?0:c.length,d=t[n.id];if(void 0===d){d=[];for(var i=0;i<h;i++)d[i]=[i,0];t[n.id]=d}var f=o.morphTargets&&n.morphAttributes.position,m=o.morphNormals&&n.morphAttributes.normal;for(i=0;i<h;i++){0!==(y=d[i])[1]&&(f&&n.deleteAttribute("morphTarget"+i),m&&n.deleteAttribute("morphNormal"+i))}for(i=0;i<h;i++){(y=d[i])[0]=i,y[1]=c[i]}d.sort(absNumericalSort);var v=0;for(i=0;i<8;i++){var y;if(y=d[i]){var x=y[0],_=y[1];if(_){f&&n.setAttribute("morphTarget"+i,f[x]),m&&n.setAttribute("morphNormal"+i,m[x]),r[i]=_,v+=_;continue}}r[i]=0}var M=n.morphTargetsRelative?1:1-v;l.getUniforms().setValue(e,"morphTargetBaseInfluence",M),l.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function WebGLMultiviewRenderTarget(e,t,r,n){WebGLRenderTarget.call(this,e,t,n),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=r}function WebGLMultiview(e,t){var r,n,o,l,c,h,d,f=e.extensions,m=e.properties,v=0;function y(e){return e.isArrayCamera?e.cameras:(c[0]=e,c)}this.isAvailable=function(){if(void 0===d){var e=f.get("OVR_multiview2");if(d=null!==e&&!1===t.getContextAttributes().antialias){v=t.getParameter(e.MAX_VIEWS_OVR),r=new WebGLMultiviewRenderTarget(0,0,2),h=new Vector2,l=[],o=[],c=[];for(var i=0;i<v;i++)l[i]=new Matrix4,o[i]=new Matrix3}}return d},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>v)return!1;for(var i=1,r=t.length;i<r;i++)if(t[0].viewport.z!==t[i].viewport.z||t[0].viewport.w!==t[i].viewport.w)return!1;return!0}(t)&&(n=e.getRenderTarget(),function(t){if(n?h.set(n.width,n.height):e.getDrawingBufferSize(h),t.isArrayCamera){var o=t.cameras[0].viewport;r.setSize(o.z,o.w),r.setNumViews(t.cameras.length)}else r.setSize(h.x,h.y),r.setNumViews(2)}(t),e.setRenderTarget(r))},this.detachCamera=function(o){r===e.getRenderTarget()&&(e.setRenderTarget(n),function(e){var n=r,o=n.numViews,l=m.get(n).__webglViewFramebuffers,c=n.width,d=n.height;if(e.isArrayCamera)for(var i=0;i<o;i++){var f=e.cameras[i].viewport,v=f.x,y=f.y,x=v+f.z,_=y+f.w;t.bindFramebuffer(t.READ_FRAMEBUFFER,l[i]),t.blitFramebuffer(0,0,c,d,v,y,x,_,t.COLOR_BUFFER_BIT,t.NEAREST)}else t.bindFramebuffer(t.READ_FRAMEBUFFER,l[0]),t.blitFramebuffer(0,0,c,d,0,0,h.x,h.y,t.COLOR_BUFFER_BIT,t.NEAREST)}(o))},this.updateCameraProjectionMatricesUniform=function(e,r){for(var n=y(e),i=0;i<n.length;i++)l[i].copy(n[i].projectionMatrix);r.setValue(t,"projectionMatrices",l)},this.updateCameraViewMatricesUniform=function(e,r){for(var n=y(e),i=0;i<n.length;i++)l[i].copy(n[i].matrixWorldInverse);r.setValue(t,"viewMatrices",l)},this.updateObjectMatricesUniforms=function(object,e,r){for(var n=y(e),i=0;i<n.length;i++)l[i].multiplyMatrices(n[i].matrixWorldInverse,object.matrixWorld),o[i].getNormalMatrix(l[i]);r.setValue(t,"modelViewMatrices",l),r.setValue(t,"normalMatrices",o)}}function WebGLObjects(e,t,r,n){var o={};return{update:function(object){var l=n.render.frame,c=object.geometry,h=t.get(object,c);return o[h.id]!==l&&(c.isGeometry&&h.updateFromObject(object),t.update(h),o[h.id]=l),object.isInstancedMesh&&r.update(object.instanceMatrix,e.ARRAY_BUFFER),h},dispose:function(){o={}}}}function DataTexture2DArray(data,e,t,r){Texture.call(this,null),this.image={data:data||null,width:e||1,height:t||1,depth:r||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(data,e,t,r){Texture.call(this,null),this.image={data:data||null,width:e||1,height:t||1,depth:r||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}WebGLMultiviewRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultiviewRenderTarget,isWebGLMultiviewRenderTarget:!0,copy:function(source){return WebGLRenderTarget.prototype.copy.call(this,source),this.numViews=source.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(e,t,r){var n=e[0];if(n<=0||n>0)return e;var o=t*r,l=arrayCacheF32[o];if(void 0===l&&(l=new Float32Array(o),arrayCacheF32[o]=l),0!==t){n.toArray(l,0);for(var i=1,c=0;i!==t;++i)c+=r,e[i].toArray(l,c)}return l}function arraysEqual(a,b){if(a.length!==b.length)return!1;for(var i=0,e=a.length;i<e;i++)if(a[i]!==b[i])return!1;return!0}function copyArray(a,b){for(var i=0,e=b.length;i<e;i++)a[i]=b[i]}function allocTexUnits(e,t){var r=arrayCacheI32[t];void 0===r&&(r=new Int32Array(t),arrayCacheI32[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function setValueV1f(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2fv(this.addr,t),copyArray(r,t)}}function setValueV3f(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(arraysEqual(r,t))return;e.uniform3fv(this.addr,t),copyArray(r,t)}}function setValueV4f(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4fv(this.addr,t),copyArray(r,t)}}function setValueM2(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat2array.set(n),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,n)}}function setValueM3(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat3array.set(n),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,n)}}function setValueM4(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat4array.set(n),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,n)}}function setValueT1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.safeSetTexture2D(t||emptyTexture,o)}function setValueT2DArray1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.setTexture2DArray(t||emptyTexture2dArray,o)}function setValueT3D1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.setTexture3D(t||emptyTexture3d,o)}function setValueT6(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.safeSetTextureCube(t||emptyCubeTexture,o)}function setValueV1i(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValueV3i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValueV4i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}function setValueV1ui(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV2fArray(e,t){var data=flatten(t,this.size,2);e.uniform2fv(this.addr,data)}function setValueV3fArray(e,t){var data=flatten(t,this.size,3);e.uniform3fv(this.addr,data)}function setValueV4fArray(e,t){var data=flatten(t,this.size,4);e.uniform4fv(this.addr,data)}function setValueM2Array(e,t){var data=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,data)}function setValueM3Array(e,t){var data=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,data)}function setValueM4Array(e,t){var data=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,data)}function setValueT1Array(e,t,r){var n=t.length,o=allocTexUnits(r,n);e.uniform1iv(this.addr,o);for(var i=0;i!==n;++i)r.safeSetTexture2D(t[i]||emptyTexture,o[i])}function setValueT6Array(e,t,r){var n=t.length,o=allocTexUnits(r,n);e.uniform1iv(this.addr,o);for(var i=0;i!==n;++i)r.safeSetTextureCube(t[i]||emptyCubeTexture,o[i])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(data){var e=this.cache;data instanceof Float32Array&&e.length!==data.length&&(this.cache=new Float32Array(data.length)),copyArray(e,data)},StructuredUniform.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var u=n[i];u.setValue(e,t[u.id],r)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,r){var path=e.name,n=path.length;for(RePathPart.lastIndex=0;;){var o=RePathPart.exec(path),l=RePathPart.lastIndex,c=o[1],h="]"===o[2],d=o[3];if(h&&(c|=0),void 0===d||"["===d&&l+2===n){addUniform(r,void 0===d?new SingleUniform(c,e,t):new PureArrayUniform(c,e,t));break}var f=r.map[c];void 0===f&&addUniform(r,f=new StructuredUniform(c)),r=f}}function WebGLUniforms(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;++i){var n=e.getActiveUniform(t,i);parseUniform(n,e.getUniformLocation(t,n.name),this)}}function WebGLShader(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}WebGLUniforms.prototype.setValue=function(e,t,r,n){var u=this.map[t];void 0!==u&&u.setValue(e,r,n)},WebGLUniforms.prototype.setOptional=function(e,object,t){var r=object[t];void 0!==r&&this.setValue(e,t,r)},WebGLUniforms.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var u=t[i],l=r[u.id];!1!==l.needsUpdate&&u.setValue(e,l.value,n)}},WebGLUniforms.seqWithValue=function(e,t){for(var r=[],i=0,n=e.length;i!==n;++i){var u=e[i];u.id in t&&r.push(u)}return r};var programIdCount=0;function addLineNumbers(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function getShaderErrors(e,t,r){var n=e.getShaderParameter(t,e.COMPILE_STATUS),o=e.getShaderInfoLog(t).trim();return n&&""===o?"":"WebGLShader: gl.getShaderInfoLog() "+r+"\n"+o+addLineNumbers(e.getShaderSource(t))}function getTexelDecodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function getTexelEncodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function getToneMappingFunction(e,t){var r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case Uncharted2ToneMapping:r="Uncharted2";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}function fetchAttributeLocations(e,t){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=e.getActiveAttrib(t,i).name;r[o]=e.getAttribLocation(t,o)}return r}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var r=ShaderChunk[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(r)}var loopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function unrollLoops(e){return e.replace(loopPattern,loopReplacer)}function loopReplacer(e,t,r,n){for(var o="",i=parseInt(t);i<parseInt(r);i++)o+=n.replace(/\[ i \]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return o}function generatePrecision(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:t="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:t="ENVMAP_TYPE_SPHERE"}return t}function generateEnvMapModeDefine(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case EquirectangularRefractionMapping:t="ENVMAP_MODE_REFRACTION"}return t}function generateEnvMapBlendingDefine(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function WebGLProgram(e,t,r){var n,o,l=e.getContext(),c=r.defines,h=r.vertexShader,d=r.fragmentShader,f=generateShadowMapTypeDefine(r),m=generateEnvMapTypeDefine(r),v=generateEnvMapModeDefine(r),y=generateEnvMapBlendingDefine(r),x=e.gammaFactor>0?e.gammaFactor:1,_=r.isWebGL2?"":generateExtensions(r),M=generateDefines(c),w=l.createProgram(),S=r.numMultiviewViews;if(r.isRawShaderMaterial?((n=[M].filter(filterEmptyLine).join("\n")).length>0&&(n+="\n"),(o=[_,M].filter(filterEmptyLine).join("\n")).length>0&&(o+="\n")):(n=[generatePrecision(r),"#define SHADER_NAME "+r.shaderName,M,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+v:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),o=[_,generatePrecision(r),"#define SHADER_NAME "+r.shaderName,M,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+x,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+m:"",r.envMap?"#define "+v:"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?ShaderChunk.encodings_pars_fragment:"",r.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?getTexelDecodingFunction("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),h=replaceClippingPlaneNums(h=replaceLightNums(h=resolveIncludes(h),r),r),d=replaceClippingPlaneNums(d=replaceLightNums(d=resolveIncludes(d),r),r),h=unrollLoops(h),d=unrollLoops(d),r.isWebGL2&&!r.isRawShaderMaterial){var A=!1,T=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==h.match(T)&&null!==d.match(T)&&(A=!0,h=h.replace(T,""),d=d.replace(T,"")),n=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,o=["#version 300 es\n","#define varying in",A?"":"out highp vec4 pc_fragColor;",A?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o,S>0&&(n=(n=n.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+S+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+S+"];","uniform mat4 projectionMatrices["+S+"];","uniform mat4 viewMatrices["+S+"];","uniform mat3 normalMatrices["+S+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),o=(o=o.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+S+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var L,C,N=n+h,P=o+d,F=WebGLShader(l,l.VERTEX_SHADER,N),E=WebGLShader(l,l.FRAGMENT_SHADER,P);if(l.attachShader(w,F),l.attachShader(w,E),void 0!==r.index0AttributeName?l.bindAttribLocation(w,0,r.index0AttributeName):!0===r.morphTargets&&l.bindAttribLocation(w,0,"position"),l.linkProgram(w),e.debug.checkShaderErrors){var R=l.getProgramInfoLog(w).trim(),D=l.getShaderInfoLog(F).trim(),O=l.getShaderInfoLog(E).trim(),I=!0,B=!0;if(!1===l.getProgramParameter(w,l.LINK_STATUS)){I=!1;var U=getShaderErrors(l,F,"vertex"),k=getShaderErrors(l,E,"fragment");console.error("WebGLProgram: shader error: ",l.getError(),"gl.VALIDATE_STATUS",l.getProgramParameter(w,l.VALIDATE_STATUS),"gl.getProgramInfoLog",R,U,k)}else""!==R?console.warn("WebGLProgram: gl.getProgramInfoLog()",R):""!==D&&""!==O||(B=!1);B&&(this.diagnostics={runnable:I,programLog:R,vertexShader:{log:D,prefix:n},fragmentShader:{log:O,prefix:o}})}return l.deleteShader(F),l.deleteShader(E),this.getUniforms=function(){return void 0===L&&(L=new WebGLUniforms(l,w)),L},this.getAttributes=function(){return void 0===C&&(C=fetchAttributeLocations(l,w)),C},this.destroy=function(){l.deleteProgram(w),this.program=void 0},this.name=r.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=w,this.vertexShader=F,this.fragmentShader=E,this.numMultiviewViews=S,this}function WebGLPrograms(e,t,r){var n=[],o=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,h=r.precision,d=r.maxVertexUniforms,f=r.vertexTextures,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function y(map){var e;return map?map.isTexture?e=map.encoding:map.isWebGLRenderTarget&&(console.warn("WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=map.texture.encoding):e=LinearEncoding,e}this.getParameters=function(n,v,x,_,M,w,object){var S=_.fog,A=n.isMeshStandardMaterial?_.environment:null,T=n.envMap||A,L=m[n.type],C=object.isSkinnedMesh?function(object){var e=object.skeleton.bones;if(c)return 1024;var t=d,r=Math.floor((t-20)/4),n=Math.min(r,e.length);return n<e.length?(console.warn("WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}(object):0;null!==n.precision&&(h=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("WebGLProgram.getParameters:",n.precision,"not supported, using",h,"instead.");var N=function(e,t){var r;if(t){var n=ShaderLib[t];r={name:e.type,uniforms:UniformsUtils.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}}else r={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return r}(n,L);n.onBeforeCompile(N,e);var P=e.getRenderTarget(),F=P&&P.isWebGLMultiviewRenderTarget?P.numViews:0;return{isWebGL2:o,shaderID:L,shaderName:N.name,uniforms:N.uniforms,vertexShader:N.vertexShader,fragmentShader:N.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:h,instancing:!0===object.isInstancedMesh,supportsVertexTextures:f,numMultiviewViews:F,outputEncoding:null!==P?y(P.texture):e.outputEncoding,map:!!n.map,mapEncoding:y(n.map),matcap:!!n.matcap,matcapEncoding:y(n.matcap),envMap:!!T,envMapMode:T&&T.mapping,envMapEncoding:y(T),envMapCubeUV:!!T&&(T.mapping===CubeUVReflectionMapping||T.mapping===CubeUVRefractionMapping),lightMap:!!n.lightMap,lightMapEncoding:y(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:y(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:n.normalMapType===TangentSpaceNormalMap,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!S,useFog:n.fog,fogExp2:S&&S.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:l,skinning:n.skinning&&C>0,maxBones:C,useVertexTexture:c,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:v.directional.length,numPointLights:v.point.length,numSpotLights:v.spot.length,numRectAreaLights:v.rectArea.length,numHemiLights:v.hemi.length,numDirLightShadows:v.directionalShadowMap.length,numPointLightShadows:v.pointShadowMap.length,numSpotLightShadows:v.spotShadowMap.length,numClippingPlanes:M,numClipIntersection:w,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&x.length>0,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:NoToneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===DoubleSide,flipSided:n.side===BackSide,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.frawbuffers,extensionDrawbuffers:n.extensions&&n.extensions.drawbuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile}},this.getProgramCacheKey=function(t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<v.length;i++)r.push(t[v[i]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(t,r){for(var o,p=0,l=n.length;p<l;p++){var c=n[p];if(c.cacheKey===r){++(o=c).usedTimes;break}}return void 0===o&&(o=new WebGLProgram(e,r,t),n.push(o)),o},this.releaseProgram=function(e){if(0==--e.usedTimes){var i=n.indexOf(e);n[i]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function WebGLProperties(){var e=new WeakMap;return{get:function(object){var map=e.get(object);return void 0===map&&(map={},e.set(object,map)),map},remove:function(object){e.delete(object)},update:function(object,t,r){e.get(object)[t]=r},dispose:function(){e=new WeakMap}}}function painterSortStable(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function reversePainterSortStable(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function WebGLRenderList(){var e=[],t=0,r=[],n=[],o={id:-1};function l(object,r,n,l,c,h){var d=e[t];return void 0===d?(d={id:object.id,object:object,geometry:r,material:n,program:n.program||o,groupOrder:l,renderOrder:object.renderOrder,z:c,group:h},e[t]=d):(d.id=object.id,d.object=object,d.geometry=r,d.material=n,d.program=n.program||o,d.groupOrder=l,d.renderOrder=object.renderOrder,d.z=c,d.group=h),t++,d}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(object,e,t,o,c,h){var d=l(object,e,t,o,c,h);(!0===t.transparent?n:r).push(d)},unshift:function(object,e,t,o,c,h){var d=l(object,e,t,o,c,h);(!0===t.transparent?n:r).unshift(d)},sort:function(e,t){r.length>1&&r.sort(e||painterSortStable),n.length>1&&n.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var o,l=e.get(r);return void 0===l?(o=new WebGLRenderList,e.set(r,new WeakMap),e.get(r).set(n,o),r.addEventListener("dispose",t)):void 0===(o=l.get(n))&&(o=new WebGLRenderList,l.set(n,o)),o},dispose:function(){e=new WeakMap}}}function WebGLRenderState(){var e=new WebGLLights,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function WebGLRenderStates(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var o;return!1===e.has(r)?(o=new WebGLRenderState,e.set(r,new WeakMap),e.get(r).set(n,o),r.addEventListener("dispose",t)):!1===e.get(r).has(n)?(o=new WebGLRenderState,e.get(r).set(n,o)):o=e.get(r).get(n),o},dispose:function(){e=new WeakMap}}}var vsm_frag="\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n    #ifdef HORIZONAL_PASS\n\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n    #else\n\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n\n    #endif\n\n  }\n\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n  float std_dev = sqrt( squared_mean - mean * mean );\n\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n",vsm_vert="\n\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n\n";function WebGLShadowMap(e,t,r){var n=new Frustum,o=new Vector2,l=new Vector2,c=new Vector4,h=[],d=[],f={},m={0:BackSide,1:FrontSide,2:DoubleSide},v=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),y=v.clone();y.defines.HORIZONAL_PASS=1;var x=new BufferGeometry;x.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var _=new Mesh(x,v),M=this;function w(shadow,r){var n=t.update(_);v.uniforms.shadow_pass.value=shadow.map.texture,v.uniforms.resolution.value=shadow.mapSize,v.uniforms.radius.value=shadow.radius,e.setRenderTarget(shadow.mapPass),e.clear(),e.renderBufferDirect(r,null,n,v,_,null),y.uniforms.shadow_pass.value=shadow.mapPass.texture,y.uniforms.resolution.value=shadow.mapSize,y.uniforms.radius.value=shadow.radius,e.setRenderTarget(shadow.map),e.clear(),e.renderBufferDirect(r,null,n,y,_,null)}function S(e,t,r){var n=e<<0|t<<1|r<<2,o=h[n];return void 0===o&&(o=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:e,skinning:t}),h[n]=o),o}function A(e,t,r){var n=e<<0|t<<1|r<<2,o=d[n];return void 0===o&&(o=new MeshDistanceMaterial({morphTargets:e,skinning:t}),d[n]=o),o}function T(object,t,r,n,o,l){var c=object.geometry,h=null,d=S,v=object.customDepthMaterial;if(!0===r.isPointLight&&(d=A,v=object.customDistanceMaterial),void 0===v){var y=!1;!0===t.morphTargets&&(!0===c.isBufferGeometry?y=c.morphAttributes&&c.morphAttributes.position&&c.morphAttributes.position.length>0:!0===c.isGeometry&&(y=c.morphTargets&&c.morphTargets.length>0));var x=!1;!0===object.isSkinnedMesh&&(!0===t.skinning?x=!0:console.warn("WebGLShadowMap: SkinnedMesh with material.skinning set to false:",object)),h=d(y,x,!0===object.isInstancedMesh)}else h=v;if(e.localClippingEnabled&&!0===t.clipShadows&&0!==t.clippingPlanes.length){var _=h.uuid,M=t.uuid,w=f[_];void 0===w&&(w={},f[_]=w);var T=w[M];void 0===T&&(T=h.clone(),w[M]=T),h=T}return h.visible=t.visible,h.wireframe=t.wireframe,h.side=l===VSMShadowMap?null!==t.shadowSide?t.shadowSide:t.side:null!==t.shadowSide?t.shadowSide:m[t.side],h.clipShadows=t.clipShadows,h.clippingPlanes=t.clippingPlanes,h.clipIntersection=t.clipIntersection,h.wireframeLinewidth=t.wireframeLinewidth,h.linewidth=t.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=n,h.farDistance=o),h}function L(object,r,o,l,c){if(!1!==object.visible){if(object.layers.test(r.layers)&&(object.isMesh||object.isLine||object.isPoints)&&(object.castShadow||object.receiveShadow&&c===VSMShadowMap)&&(!object.frustumCulled||n.intersectsObject(object))){object.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,object.matrixWorld);var h=t.update(object),d=object.material;if(Array.isArray(d))for(var f=h.groups,m=0,v=f.length;m<v;m++){var y=f[m],x=d[y.materialIndex];if(x&&x.visible){var _=T(object,x,l,o.near,o.far,c);e.renderBufferDirect(o,null,h,_,object,y)}}else if(d.visible){_=T(object,d,l,o.near,o.far,c);e.renderBufferDirect(o,null,h,_,object,null)}}for(var M=object.children,i=0,w=M.length;i<w;i++)L(M[i],r,o,l,c)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(t,h,d){if(!1!==M.enabled&&(!1!==M.autoUpdate||!1!==M.needsUpdate)&&0!==t.length){var f=e.getRenderTarget(),m=e.getActiveCubeFace(),v=e.getActiveMipmapLevel(),y=e.state;y.setBlending(NoBlending),y.buffers.color.setClear(1,1,1,1),y.buffers.depth.setTest(!0),y.setScissorTest(!1);for(var i=0,x=t.length;i<x;i++){var _=t[i],shadow=_.shadow;if(void 0!==shadow){o.copy(shadow.mapSize);var S=shadow.getFrameExtents();if(o.multiply(S),l.copy(shadow.mapSize),(o.x>r||o.y>r)&&(console.warn("WebGLShadowMap:",_,"has shadow exceeding max texture size, reducing"),o.x>r&&(l.x=Math.floor(r/S.x),o.x=l.x*S.x,shadow.mapSize.x=l.x),o.y>r&&(l.y=Math.floor(r/S.y),o.y=l.y*S.y,shadow.mapSize.y=l.y)),null===shadow.map&&!shadow.isPointLightShadow&&this.type===VSMShadowMap){var A={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};shadow.map=new WebGLRenderTarget(o.x,o.y,A),shadow.map.texture.name=_.name+".shadowMap",shadow.mapPass=new WebGLRenderTarget(o.x,o.y,A),shadow.camera.updateProjectionMatrix()}if(null===shadow.map){A={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};shadow.map=new WebGLRenderTarget(o.x,o.y,A),shadow.map.texture.name=_.name+".shadowMap",shadow.camera.updateProjectionMatrix()}e.setRenderTarget(shadow.map),e.clear();for(var T=shadow.getViewportCount(),C=0;C<T;C++){var N=shadow.getViewport(C);c.set(l.x*N.x,l.y*N.y,l.x*N.z,l.y*N.w),y.viewport(c),shadow.updateMatrices(_,C),n=shadow.getFrustum(),L(h,d,shadow.camera,_,this.type)}shadow.isPointLightShadow||this.type!==VSMShadowMap||w(shadow,d)}else console.warn("WebGLShadowMap:",_,"has no shadow.")}M.needsUpdate=!1,e.setRenderTarget(f,m,v)}}}function WebGLState(e,t,r){var n=r.isWebGL2;var o=new function(){var t=!1,r=new Vector4,n=null,o=new Vector4(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,g,b,a,n){!0===n&&(t*=a,g*=a,b*=a),r.set(t,g,b,a),!1===o.equals(r)&&(e.clearColor(t,g,b,a),o.copy(r))},reset:function(){t=!1,n=null,o.set(-1,0,0,0)}}},l=new function(){var t=!1,r=null,n=null,o=null;return{setTest:function(t){t?H(e.DEPTH_TEST):X(e.DEPTH_TEST)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case NeverDepth:e.depthFunc(e.NEVER);break;case AlwaysDepth:e.depthFunc(e.ALWAYS);break;case LessDepth:e.depthFunc(e.LESS);break;case LessEqualDepth:e.depthFunc(e.LEQUAL);break;case EqualDepth:e.depthFunc(e.EQUAL);break;case GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case GreaterDepth:e.depthFunc(e.GREATER);break;case NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);n=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,r=null,n=null,o=null}}},c=new function(){var t=!1,r=null,n=null,o=null,l=null,c=null,h=null,d=null,f=null;return{setTest:function(r){t||(r?H(e.STENCIL_TEST):X(e.STENCIL_TEST))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,c){n===t&&o===r&&l===c||(e.stencilFunc(t,r,c),n=t,o=r,l=c)},setOp:function(t,r,n){c===t&&h===r&&d===n||(e.stencilOp(t,r,n),c=t,h=r,d=n)},setLocked:function(e){t=e},setClear:function(t){f!==t&&(e.clearStencil(t),f=t)},reset:function(){t=!1,r=null,n=null,o=null,l=null,c=null,h=null,d=null,f=null}}},h=e.getParameter(e.MAX_VERTEX_ATTRIBS),d=new Uint8Array(h),f=new Uint8Array(h),m=new Uint8Array(h),v={},y=null,x=null,_=null,M=null,w=null,S=null,A=null,T=null,L=null,C=!1,N=null,P=null,F=null,E=null,R=null,D=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),O=!1,I=0,B=e.getParameter(e.VERSION);-1!==B.indexOf("WebGL")?(I=parseFloat(/^WebGL\ ([0-9])/.exec(B)[1]),O=I>=1):-1!==B.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(B)[1]),O=I>=2);var U=null,k={},V=new Vector4,G=new Vector4;function z(t,r,n){var data=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var i=0;i<n;i++)e.texImage2D(r+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,data);return o}var j={};function W(r,o){(d[r]=1,0===f[r]&&(e.enableVertexAttribArray(r),f[r]=1),m[r]!==o)&&((n?e:t.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,o),m[r]=o)}function H(t){!0!==v[t]&&(e.enable(t),v[t]=!0)}function X(t){!1!==v[t]&&(e.disable(t),v[t]=!1)}j[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),j[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),H(e.DEPTH_TEST),l.setFunc(LessEqualDepth),Z(!1),$(CullFaceBack),H(e.CULL_FACE),J(NoBlending);var Y={};if(Y[AddEquation]=e.FUNC_ADD,Y[SubtractEquation]=e.FUNC_SUBTRACT,Y[ReverseSubtractEquation]=e.FUNC_REVERSE_SUBTRACT,n)Y[MinEquation]=e.MIN,Y[MaxEquation]=e.MAX;else{var Q=t.get("EXT_blend_minmax");null!==Q&&(Y[MinEquation]=Q.MIN_EXT,Y[MaxEquation]=Q.MAX_EXT)}var K={};function J(t,r,n,o,l,c,h,d){if(t!==NoBlending){if(x||(H(e.BLEND),x=!0),t===CustomBlending)l=l||r,c=c||n,h=h||o,r===M&&l===A||(e.blendEquationSeparate(Y[r],Y[l]),M=r,A=l),n===w&&o===S&&c===T&&h===L||(e.blendFuncSeparate(K[n],K[o],K[c],K[h]),w=n,S=o,T=c,L=h),_=t,C=null;else if(t!==_||d!==C){if(M===AddEquation&&A===AddEquation||(e.blendEquation(e.FUNC_ADD),M=AddEquation,A=AddEquation),d)switch(t){case NormalBlending:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.ONE,e.ONE);break;case SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case MultiplyBlending:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("WebGLState: Invalid blending: ",t)}else switch(t){case NormalBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case SubtractiveBlending:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case MultiplyBlending:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("WebGLState: Invalid blending: ",t)}w=null,S=null,T=null,L=null,_=t,C=d}}else x&&(X(e.BLEND),x=!1)}function Z(t){N!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),N=t)}function $(t){t!==CullFaceNone?(H(e.CULL_FACE),t!==P&&(t===CullFaceBack?e.cullFace(e.BACK):t===CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):X(e.CULL_FACE),P=t}function ee(t,r,n){t?(H(e.POLYGON_OFFSET_FILL),E===r&&R===n||(e.polygonOffset(r,n),E=r,R=n)):X(e.POLYGON_OFFSET_FILL)}function te(t){void 0===t&&(t=e.TEXTURE0+D-1),U!==t&&(e.activeTexture(t),U=t)}return K[ZeroFactor]=e.ZERO,K[OneFactor]=e.ONE,K[SrcColorFactor]=e.SRC_COLOR,K[SrcAlphaFactor]=e.SRC_ALPHA,K[SrcAlphaSaturateFactor]=e.SRC_ALPHA_SATURATE,K[DstColorFactor]=e.DST_COLOR,K[DstAlphaFactor]=e.DST_ALPHA,K[OneMinusSrcColorFactor]=e.ONE_MINUS_SRC_COLOR,K[OneMinusSrcAlphaFactor]=e.ONE_MINUS_SRC_ALPHA,K[OneMinusDstColorFactor]=e.ONE_MINUS_DST_COLOR,K[OneMinusDstAlphaFactor]=e.ONE_MINUS_DST_ALPHA,{buffers:{color:o,depth:l,stencil:c},initAttributes:function(){for(var i=0,e=d.length;i<e;i++)d[i]=0},enableAttribute:function(e){W(e,0)},enableAttributeAndDivisor:W,disableUnusedAttributes:function(){for(var i=0,t=f.length;i!==t;++i)f[i]!==d[i]&&(e.disableVertexAttribArray(i),f[i]=0)},enable:H,disable:X,useProgram:function(t){return y!==t&&(e.useProgram(t),y=t,!0)},setBlending:J,setMaterial:function(t,r){t.side===DoubleSide?X(e.CULL_FACE):H(e.CULL_FACE);var n=t.side===BackSide;r&&(n=!n),Z(n),t.blending===NormalBlending&&!1===t.transparent?J(NoBlending):J(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),o.setMask(t.colorWrite);var h=t.stencilWrite;c.setTest(h),h&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),ee(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:Z,setCullFace:$,setLineWidth:function(t){t!==F&&(O&&e.lineWidth(t),F=t)},setPolygonOffset:ee,setScissorTest:function(t){t?H(e.SCISSOR_TEST):X(e.SCISSOR_TEST)},activeTexture:te,bindTexture:function(t,r){null===U&&te();var n=k[U];void 0===n&&(n={type:void 0,texture:void 0},k[U]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||j[t]),n.type=t,n.texture=r)},unbindTexture:function(){var t=k[U];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},scissor:function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},viewport:function(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){for(var i=0;i<f.length;i++)1===f[i]&&(e.disableVertexAttribArray(i),f[i]=0);v={},U=null,k={},y=null,_=null,N=null,P=null,o.reset(),l.reset(),c.reset()}}}function WebGLTextures(e,t,r,n,o,l,c){var h,d=o.isWebGL2,f=o.maxTextures,m=o.maxCubemapSize,v=o.maxTextureSize,y=o.maxSamples,x=new WeakMap,_=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function M(e,t){return _?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function w(image,e,t,r){var n=1;if((image.width>r||image.height>r)&&(n=r/Math.max(image.width,image.height)),n<1||!0===e){if("undefined"!=typeof HTMLImageElement&&image instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&image instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&image instanceof ImageBitmap){var o=e?MathUtils.floorPowerOfTwo:Math.floor,l=o(n*image.width),c=o(n*image.height);void 0===h&&(h=M(l,c));var canvas=t?M(l,c):h;return canvas.width=l,canvas.height=c,canvas.getContext("2d").drawImage(image,0,0,l,c),console.warn("WebGLRenderer: Texture has been resized from ("+image.width+"x"+image.height+") to ("+l+"x"+c+")."),canvas}return"data"in image&&console.warn("WebGLRenderer: Image in DataTexture is too big ("+image.width+"x"+image.height+")."),image}return image}function S(image){return MathUtils.isPowerOfTwo(image.width)&&MathUtils.isPowerOfTwo(image.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function T(t,r,o,l){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log(Math.max(o,l))*Math.LOG2E}function L(r,n,o){if(!1===d)return n;if(null!==r){if(void 0!==e[r])return e[r];console.warn("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var l=n;return n===e.RED&&(o===e.FLOAT&&(l=e.R32F),o===e.HALF_FLOAT&&(l=e.R16F),o===e.UNSIGNED_BYTE&&(l=e.R8)),n===e.RGB&&(o===e.FLOAT&&(l=e.RGB32F),o===e.HALF_FLOAT&&(l=e.RGB16F),o===e.UNSIGNED_BYTE&&(l=e.RGB8)),n===e.RGBA&&(o===e.FLOAT&&(l=e.RGBA32F),o===e.HALF_FLOAT&&(l=e.RGBA16F),o===e.UNSIGNED_BYTE&&(l=e.RGBA8)),l===e.R16F||l===e.R32F||l===e.RGBA16F||l===e.RGBA32F?t.get("EXT_color_buffer_float"):l!==e.RGB16F&&l!==e.RGB32F||console.warn("WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),l}function C(t){return t===NearestFilter||t===NearestMipmapNearestFilter||t===NearestMipmapLinearFilter?e.NEAREST:e.LINEAR}function N(t){var r=t.target;r.removeEventListener("dispose",N),function(t){var r=n.get(t);if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture),n.remove(t)}(r),r.isVideoTexture&&x.delete(r),c.memory.textures--}function P(t){var r=t.target;r.removeEventListener("dispose",P),function(t){var r=n.get(t),o=n.get(t.texture);if(!t)return;void 0!==o.__webglTexture&&e.deleteTexture(o.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var i=0;i<6;i++)e.deleteFramebuffer(r.__webglFramebuffer[i]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[i]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(r.__webglColorTexture),e.deleteTexture(r.__webglDepthStencilTexture),c.memory.textures-=2;i=0;for(var l=r.__webglViewFramebuffers.length;i<l;i++)e.deleteFramebuffer(r.__webglViewFramebuffers[i])}n.remove(t.texture),n.remove(t)}(r),c.memory.textures--}var F=0;function E(t,slot){var o=n.get(t);if(t.isVideoTexture&&function(e){var t=c.render.frame;x.get(e)!==t&&(x.set(e,t),e.update())}(t),t.version>0&&o.__version!==t.version){var image=t.image;if(void 0===image)console.warn("WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==image.complete)return void k(o,t,slot);console.warn("WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_2D,o.__webglTexture)}function R(t,slot){if(6===t.image.length){var o=n.get(t);if(t.version>0&&o.__version!==t.version){U(o,t),r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),h=t.image[0]&&t.image[0].isDataTexture,f=[],i=0;i<6;i++)f[i]=c||h?h?t.image[i].image:t.image[i]:w(t.image[i],!1,!0,m);var v,image=f[0],y=S(image)||d,x=l.convert(t.format),_=l.convert(t.type),M=L(t.internalFormat,x,_);if(B(e.TEXTURE_CUBE_MAP,t,y),c){for(i=0;i<6;i++){v=f[i].mipmaps;for(var C=0;C<v.length;C++){var N=v[C];t.format!==RGBAFormat&&t.format!==RGBFormat?null!==x?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,C,M,N.width,N.height,0,N.data):console.warn("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,C,M,N.width,N.height,0,x,_,N.data)}}o.__maxMipLevel=v.length-1}else{v=t.mipmaps;for(i=0;i<6;i++)if(h){r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,M,f[i].width,f[i].height,0,x,_,f[i].data);for(C=0;C<v.length;C++){var P=(N=v[C]).image[i].image;r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,C+1,M,P.width,P.height,0,x,_,P.data)}}else{r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,M,x,_,f[i]);for(C=0;C<v.length;C++){N=v[C];r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,C+1,M,x,_,N.image[i])}}o.__maxMipLevel=v.length}A(t,y)&&T(e.TEXTURE_CUBE_MAP,t,image.width,image.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture)}}function D(t,slot){r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_CUBE_MAP,n.get(t).__webglTexture)}var O={};O[RepeatWrapping]=e.REPEAT,O[ClampToEdgeWrapping]=e.CLAMP_TO_EDGE,O[MirroredRepeatWrapping]=e.MIRRORED_REPEAT;var I={};function B(r,l,c){c?(e.texParameteri(r,e.TEXTURE_WRAP_S,O[l.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,O[l.wrapT]),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,O[l.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,I[l.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,I[l.minFilter])):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),l.wrapS===ClampToEdgeWrapping&&l.wrapT===ClampToEdgeWrapping||console.warn("WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,C(l.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,C(l.minFilter)),l.minFilter!==NearestFilter&&l.minFilter!==LinearFilter&&console.warn("WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to NearestFilter or LinearFilter."));var h=t.get("EXT_texture_filter_anisotropic");if(h){if(l.type===FloatType&&null===t.get("OES_texture_float_linear"))return;if(l.type===HalfFloatType&&null===(d||t.get("OES_texture_half_float_linear")))return;(l.anisotropy>1||n.get(l).__currentAnisotropy)&&(e.texParameterf(r,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(l.anisotropy,o.getMaxAnisotropy())),n.get(l).__currentAnisotropy=l.anisotropy)}}function U(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",N),t.__webglTexture=e.createTexture(),c.memory.textures++)}function k(t,n,slot){var o=e.TEXTURE_2D;n.isDataTexture2DArray&&(o=e.TEXTURE_2D_ARRAY),n.isDataTexture3D&&(o=e.TEXTURE_3D),U(t,n),r.activeTexture(e.TEXTURE0+slot),r.bindTexture(o,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var c=function(e){return!d&&(e.wrapS!==ClampToEdgeWrapping||e.wrapT!==ClampToEdgeWrapping||e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter)}(n)&&!1===S(n.image),image=w(n.image,c,!1,v),h=S(image)||d,f=l.convert(n.format),m=l.convert(n.type),y=L(n.internalFormat,f,m);B(o,n,h);var x,_=n.mipmaps;if(n.isDepthTexture){if(y=e.DEPTH_COMPONENT,n.type===FloatType){if(!1===d)throw new Error("Float Depth Texture only supported in WebGL2.0");y=e.DEPTH_COMPONENT32F}else d&&(y=e.DEPTH_COMPONENT16);n.format===DepthFormat&&y===e.DEPTH_COMPONENT&&n.type!==UnsignedShortType&&n.type!==UnsignedIntType&&(console.warn("WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=UnsignedShortType,m=l.convert(n.type)),n.format===DepthStencilFormat&&(y=e.DEPTH_STENCIL,n.type!==UnsignedInt248Type&&(console.warn("WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=UnsignedInt248Type,m=l.convert(n.type))),r.texImage2D(e.TEXTURE_2D,0,y,image.width,image.height,0,f,m,null)}else if(n.isDataTexture)if(_.length>0&&h){for(var i=0,M=_.length;i<M;i++)x=_[i],r.texImage2D(e.TEXTURE_2D,i,y,x.width,x.height,0,f,m,x.data);n.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else r.texImage2D(e.TEXTURE_2D,0,y,image.width,image.height,0,f,m,image.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(i=0,M=_.length;i<M;i++)x=_[i],n.format!==RGBAFormat&&n.format!==RGBFormat?null!==f?r.compressedTexImage2D(e.TEXTURE_2D,i,y,x.width,x.height,0,x.data):console.warn("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,i,y,x.width,x.height,0,f,m,x.data);t.__maxMipLevel=_.length-1}else if(n.isDataTexture2DArray)r.texImage3D(e.TEXTURE_2D_ARRAY,0,y,image.width,image.height,image.depth,0,f,m,image.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(e.TEXTURE_3D,0,y,image.width,image.height,image.depth,0,f,m,image.data),t.__maxMipLevel=0;else if(_.length>0&&h){for(i=0,M=_.length;i<M;i++)x=_[i],r.texImage2D(e.TEXTURE_2D,i,y,f,m,x);n.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else r.texImage2D(e.TEXTURE_2D,0,y,f,m,image),t.__maxMipLevel=0;A(n,h)&&T(o,n,image.width,image.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function V(t,o,c,h){var d=l.convert(o.texture.format),f=l.convert(o.texture.type),m=L(o.texture.internalFormat,d,f);r.texImage2D(h,0,m,o.width,o.height,0,d,f,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,c,h,n.get(o.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function G(t,r,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){if(n){var o=j(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,o,e.DEPTH_COMPONENT16,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){o=j(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,o,e.DEPTH24_STENCIL8,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{var c=l.convert(r.texture.format),h=l.convert(r.texture.type),d=L(r.texture.internalFormat,c,h);if(n){o=j(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,o,d,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,d,r.width,r.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function z(t){var r=n.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);var o=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===DepthFormat)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(var i=0;i<6;i++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),G(r.__webglDepthbuffer[i],t)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),G(r.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function j(e){return d&&e.isWebGLMultisampleRenderTarget?Math.min(y,e.samples):0}I[NearestFilter]=e.NEAREST,I[NearestMipmapNearestFilter]=e.NEAREST_MIPMAP_NEAREST,I[NearestMipmapLinearFilter]=e.NEAREST_MIPMAP_LINEAR,I[LinearFilter]=e.LINEAR,I[LinearMipmapNearestFilter]=e.LINEAR_MIPMAP_NEAREST,I[LinearMipmapLinearFilter]=e.LINEAR_MIPMAP_LINEAR;var W=!1,H=!1;this.allocateTextureUnit=function(){var e=F;return e>=f&&console.warn("WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+f),F+=1,e},this.resetTextureUnits=function(){F=0},this.setTexture2D=E,this.setTexture2DArray=function(t,slot){var o=n.get(t);t.version>0&&o.__version!==t.version?k(o,t,slot):(r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture))},this.setTexture3D=function(t,slot){var o=n.get(t);t.version>0&&o.__version!==t.version?k(o,t,slot):(r.activeTexture(e.TEXTURE0+slot),r.bindTexture(e.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=R,this.setTextureCubeDynamic=D,this.setupRenderTarget=function(o){var h=n.get(o),f=n.get(o.texture);o.addEventListener("dispose",P),f.__webglTexture=e.createTexture(),c.memory.textures++;var m=!0===o.isWebGLCubeRenderTarget,v=!0===o.isWebGLMultisampleRenderTarget,y=!0===o.isWebGLMultiviewRenderTarget,x=S(o)||d;if(m){h.__webglFramebuffer=[];for(var i=0;i<6;i++)h.__webglFramebuffer[i]=e.createFramebuffer()}else if(h.__webglFramebuffer=e.createFramebuffer(),v)if(d){h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,h.__webglColorRenderbuffer);var _=l.convert(o.texture.format),M=l.convert(o.texture.type),w=L(o.texture.internalFormat,_,M),C=j(o);e.renderbufferStorageMultisample(e.RENDERBUFFER,C,w,o.width,o.height),e.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),o.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),G(h.__webglDepthRenderbuffer,o,!0)),e.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(y){var N=o.width,F=o.height,E=o.numViews;e.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer);var R=t.get("OVR_multiview2");c.memory.textures+=2;var D=e.createTexture();e.bindTexture(e.TEXTURE_2D_ARRAY,D),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA8,N,F,E,0,e.RGBA,e.UNSIGNED_BYTE,null),R.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,D,0,0,E);var O=e.createTexture();e.bindTexture(e.TEXTURE_2D_ARRAY,O),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.DEPTH24_STENCIL8,N,F,E,0,e.DEPTH_STENCIL,e.UNSIGNED_INT_24_8,null),R.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,O,0,0,E);var I=new Array(E);for(i=0;i<E;++i)I[i]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,I[i]),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,D,0,i);h.__webglColorTexture=D,h.__webglDepthStencilTexture=O,h.__webglViewFramebuffers=I,e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D_ARRAY,null)}if(m){r.bindTexture(e.TEXTURE_CUBE_MAP,f.__webglTexture),B(e.TEXTURE_CUBE_MAP,o.texture,x);for(i=0;i<6;i++)V(h.__webglFramebuffer[i],o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i);A(o.texture,x)&&T(e.TEXTURE_CUBE_MAP,o.texture,o.width,o.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else y||(r.bindTexture(e.TEXTURE_2D,f.__webglTexture),B(e.TEXTURE_2D,o.texture,x),V(h.__webglFramebuffer,o,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),A(o.texture,x)&&T(e.TEXTURE_2D,o.texture,o.width,o.height),r.bindTexture(e.TEXTURE_2D,null));o.depthBuffer&&z(o)},this.updateRenderTargetMipmap=function(t){var o=t.texture;if(A(o,S(t)||d)){var l=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,c=n.get(o).__webglTexture;r.bindTexture(l,c),T(l,o,t.width,t.height),r.bindTexture(l,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(d){var r=n.get(t);e.bindFramebuffer(e.READ_FRAMEBUFFER,r.__webglMultisampledFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r.__webglFramebuffer);var o=t.width,l=t.height,mask=e.COLOR_BUFFER_BIT;t.depthBuffer&&(mask|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(mask|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,o,l,0,0,o,l,mask,e.NEAREST)}else console.warn("WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,slot){e&&e.isWebGLRenderTarget&&(!1===W&&(console.warn("WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),W=!0),e=e.texture),E(e,slot)},this.safeSetTextureCube=function(e,slot){e&&e.isWebGLCubeRenderTarget&&(!1===H&&(console.warn("WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),H=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?R(e,slot):D(e,slot)}}function WebGLUtils(e,t,r){var n=r.isWebGL2;return{convert:function(p){var r;if(p===UnsignedByteType)return e.UNSIGNED_BYTE;if(p===UnsignedShort4444Type)return e.UNSIGNED_SHORT_4_4_4_4;if(p===UnsignedShort5551Type)return e.UNSIGNED_SHORT_5_5_5_1;if(p===UnsignedShort565Type)return e.UNSIGNED_SHORT_5_6_5;if(p===ByteType)return e.BYTE;if(p===ShortType)return e.SHORT;if(p===UnsignedShortType)return e.UNSIGNED_SHORT;if(p===IntType)return e.INT;if(p===UnsignedIntType)return e.UNSIGNED_INT;if(p===FloatType)return e.FLOAT;if(p===HalfFloatType)return n?e.HALF_FLOAT:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(p===AlphaFormat)return e.ALPHA;if(p===RGBFormat)return e.RGB;if(p===RGBAFormat)return e.RGBA;if(p===LuminanceFormat)return e.LUMINANCE;if(p===LuminanceAlphaFormat)return e.LUMINANCE_ALPHA;if(p===DepthFormat)return e.DEPTH_COMPONENT;if(p===DepthStencilFormat)return e.DEPTH_STENCIL;if(p===RedFormat)return e.RED;if(p===RedIntegerFormat)return e.RED_INTEGER;if(p===RGFormat)return e.RG;if(p===RGIntegerFormat)return e.RG_INTEGER;if(p===RGBIntegerFormat)return e.RGB_INTEGER;if(p===RGBAIntegerFormat)return e.RGBA_INTEGER;if(p===RGB_S3TC_DXT1_Format||p===RGBA_S3TC_DXT1_Format||p===RGBA_S3TC_DXT3_Format||p===RGBA_S3TC_DXT5_Format){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(p===RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(p===RGB_PVRTC_4BPPV1_Format||p===RGB_PVRTC_2BPPV1_Format||p===RGBA_PVRTC_4BPPV1_Format||p===RGBA_PVRTC_2BPPV1_Format){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(p===RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return p===RGB_ETC1_Format?null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null:p===RGBA_ASTC_4x4_Format||p===RGBA_ASTC_5x4_Format||p===RGBA_ASTC_5x5_Format||p===RGBA_ASTC_6x5_Format||p===RGBA_ASTC_6x6_Format||p===RGBA_ASTC_8x5_Format||p===RGBA_ASTC_8x6_Format||p===RGBA_ASTC_8x8_Format||p===RGBA_ASTC_10x5_Format||p===RGBA_ASTC_10x6_Format||p===RGBA_ASTC_10x8_Format||p===RGBA_ASTC_10x10_Format||p===RGBA_ASTC_12x10_Format||p===RGBA_ASTC_12x12_Format?null!==(r=t.get("WEBGL_compressed_texture_astc"))?p:null:p===UnsignedInt248Type?n?e.UNSIGNED_INT_24_8:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function WebGLMultisampleRenderTarget(e,t,r){WebGLRenderTarget.call(this,e,t,r),this.samples=4}function WebXRManager(e,t){var r=this,n=null,o=null,l="local-floor",c=null,h=[],d=new Map,f=new PerspectiveCamera;f.layers.enable(1),f.viewport=new Vector4;var m=new PerspectiveCamera;m.layers.enable(2),m.viewport=new Vector4;var v=new ArrayCamera([f,m]);v.layers.enable(1),v.layers.enable(2);var y=null,x=null;function _(e){var t=d.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function M(){d.forEach((function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)})),d.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),N.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function w(e){o=e,N.setContext(n),N.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function S(e){for(var t=n.inputSources,i=0;i<h.length;i++)d.set(t[i],h[i]);for(i=0;i<e.removed.length;i++){var r=e.removed[i];(o=d.get(r))&&(o.targetRay&&o.targetRay.dispatchEvent({type:"disconnected",data:r}),o.grip&&o.grip.dispatchEvent({type:"disconnected",data:r}),d.delete(r))}for(i=0;i<e.added.length;i++){var o;r=e.added[i];(o=d.get(r))&&(o.targetRay&&o.targetRay.dispatchEvent({type:"connected",data:r}),o.grip&&o.grip.dispatchEvent({type:"connected",data:r}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=h[e];return void 0===t&&(t={},h[e]=t),void 0===t.targetRay&&(t.targetRay=new Group,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=h[e];return void 0===t&&(t={},h[e]=t),void 0===t.grip&&(t.grip=new Group,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){l=e},this.getReferenceSpace=function(){return o},this.getSession=function(){return n},this.setSession=function(e){if(null!==(n=e)){n.addEventListener("select",_),n.addEventListener("selectstart",_),n.addEventListener("selectend",_),n.addEventListener("squeeze",_),n.addEventListener("squeezestart",_),n.addEventListener("squeezeend",_),n.addEventListener("end",M);var r=t.getContextAttributes(),o={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil},c=new XRWebGLLayer(n,t,o);n.updateRenderState({baseLayer:c}),n.requestReferenceSpace(l).then(w),n.addEventListener("inputsourceschange",S)}};var A=new Vector3,T=new Vector3;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){v.near=m.near=f.near=e.near,v.far=m.far=f.far=e.far,y===v.near&&x===v.far||(n.updateRenderState({depthNear:v.near,depthFar:v.far}),y=v.near,x=v.far);var t=e.parent,r=v.cameras;L(v,t);for(var i=0;i<r.length;i++)L(r[i],t);e.matrixWorld.copy(v.matrixWorld);for(var o=e.children,l=(i=0,o.length);i<l;i++)o[i].updateMatrixWorld(!0);return function(e,t,r){A.setFromMatrixPosition(t.matrixWorld),T.setFromMatrixPosition(r.matrixWorld);var n=A.distanceTo(T),o=t.projectionMatrix.elements,l=r.projectionMatrix.elements,c=o[14]/(o[10]-1),h=o[14]/(o[10]+1),d=(o[9]+1)/o[5],f=(o[9]-1)/o[5],m=(o[8]-1)/o[0],v=(l[8]+1)/l[0],y=c*m,x=c*v,_=n/(-m+v),M=_*-m;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(M),e.translateZ(_),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var w=c+_,S=h+_,L=y-M,C=x+(n-M),N=d*h/S*w,P=f*h/S*w;e.projectionMatrix.makePerspective(L,C,N,P,w,S)}(v,f,m),v};var C=null;var N=new WebGLAnimation;N.setAnimationLoop((function(time,t){if(null!==(c=t.getViewerPose(o))){var r=c.views,l=n.renderState.baseLayer;e.setFramebuffer(l.framebuffer);for(var i=0;i<r.length;i++){var view=r[i],d=l.getViewport(view),f=v.cameras[i];f.matrix.fromArray(view.transform.matrix),f.projectionMatrix.fromArray(view.projectionMatrix),f.viewport.set(d.x,d.y,d.width,d.height),0===i&&v.matrix.copy(f.matrix)}}var m=n.inputSources;for(i=0;i<h.length;i++){var y=h[i],x=m[i],_=null,M=null;x&&(y.targetRay&&null!==(_=t.getPose(x.targetRaySpace,o))&&(y.targetRay.matrix.fromArray(_.transform.matrix),y.targetRay.matrix.decompose(y.targetRay.position,y.targetRay.rotation,y.targetRay.scale)),y.grip&&x.gripSpace&&null!==(M=t.getPose(x.gripSpace,o))&&(y.grip.matrix.fromArray(M.transform.matrix),y.grip.matrix.decompose(y.grip.position,y.grip.rotation,y.grip.scale))),y.targetRay&&(y.targetRay.visible=null!==_),y.grip&&(y.grip.visible=null!==M)}C&&C(time,t)})),this.setAnimationLoop=function(e){C=e},this.dispose=function(){}}function WebGLRenderer(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,l=void 0===e.stencil||e.stencil,c=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,d=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,f=void 0!==e.powerPreference?e.powerPreference:"default",m=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,v=null,y=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var x,_,M,w,S,A,T,L,C,N,P,F,E,R,D,O,I,B,U=this,k=!1,V=null,G=0,z=0,j=null,W=null,H=-1,X={geometry:null,program:null,wireframe:!1},Y=null,Q=null,K=new Vector4,J=new Vector4,Z=null,$=t.width,ee=t.height,te=1,re=null,ie=null,ne=new Vector4(0,0,$,ee),ae=new Vector4(0,0,$,ee),oe=!1,se=new Frustum,le=new WebGLClipping,ce=!1,ue=!1,he=new Matrix4,de=new Vector3;function pe(){return null===j?te:1}try{var fe={alpha:n,depth:o,stencil:l,antialias:c,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:f,failIfMajorPerformanceCaveat:m,xrCompatible:!0};if(t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",be,!1),null===(x=r||t.getContext("webgl",fe)||t.getContext("experimental-webgl",fe)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("WebGLRenderer: "+e.message),e}function me(){_=new WebGLExtensions(x),!1===(M=new WebGLCapabilities(x,_,e)).isWebGL2&&(_.get("WEBGL_depth_texture"),_.get("OES_texture_float"),_.get("OES_texture_half_float"),_.get("OES_texture_half_float_linear"),_.get("OES_standard_derivatives"),_.get("OES_element_index_uint"),_.get("ANGLE_instanced_arrays")),_.get("OES_texture_float_linear"),B=new WebGLUtils(x,_,M),(w=new WebGLState(x,_,M)).scissor(J.copy(ae).multiplyScalar(te).floor()),w.viewport(K.copy(ne).multiplyScalar(te).floor()),S=new WebGLInfo(x),A=new WebGLProperties,T=new WebGLTextures(x,_,w,A,M,B,S),L=new WebGLAttributes(x,M),C=new WebGLGeometries(x,L,S),N=new WebGLObjects(x,C,L,S),D=new WebGLMorphtargets(x),P=new WebGLPrograms(U,_,M),F=new WebGLRenderLists,E=new WebGLRenderStates,R=new WebGLBackground(U,w,N,h),O=new WebGLBufferRenderer(x,_,S,M),I=new WebGLIndexedBufferRenderer(x,_,S,M),S.programs=P.programs,U.capabilities=M,U.extensions=_,U.properties=A,U.renderLists=F,U.state=w,U.info=S}me();var ve=new WebXRManager(U,x);this.xr=ve;var ge=new WebGLMultiview(U,x),ye=new WebGLShadowMap(U,N,M.maxTextureSize);function xe(e){e.preventDefault(),console.log("WebGLRenderer: Context Lost."),k=!0}function be(){console.log("WebGLRenderer: Context Restored."),k=!1,me()}function _e(e){var t=e.target;t.removeEventListener("dispose",_e),function(e){Me(e),A.remove(e)}(t)}function Me(e){var t=A.get(e).program;e.program=void 0,void 0!==t&&P.releaseProgram(t)}this.shadowMap=ye,this.getContext=function(){return x},this.getContextAttributes=function(){return x.getContextAttributes()},this.forceContextLoss=function(){var e=_.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=_.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return te},this.setPixelRatio=function(e){void 0!==e&&(te=e,this.setSize($,ee,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set($,ee)},this.setSize=function(e,r,n){ve.isPresenting?console.warn("WebGLRenderer: Can't change size while VR device is presenting."):($=e,ee=r,t.width=Math.floor(e*te),t.height=Math.floor(r*te),!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set($*te,ee*te).floor()},this.setDrawingBufferSize=function(e,r,n){$=e,ee=r,te=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(K)},this.getViewport=function(e){return e.copy(ne)},this.setViewport=function(e,t,r,n){e.isVector4?ne.set(e.x,e.y,e.z,e.w):ne.set(e,t,r,n),w.viewport(K.copy(ne).multiplyScalar(te).floor())},this.getScissor=function(e){return e.copy(ae)},this.setScissor=function(e,t,r,n){e.isVector4?ae.set(e.x,e.y,e.z,e.w):ae.set(e,t,r,n),w.scissor(J.copy(ae).multiplyScalar(te).floor())},this.getScissorTest=function(){return oe},this.setScissorTest=function(e){w.setScissorTest(oe=e)},this.setOpaqueSort=function(e){re=e},this.setTransparentSort=function(e){ie=e},this.getClearColor=function(){return R.getClearColor()},this.setClearColor=function(){R.setClearColor.apply(R,arguments)},this.getClearAlpha=function(){return R.getClearAlpha()},this.setClearAlpha=function(){R.setClearAlpha.apply(R,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=x.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=x.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=x.STENCIL_BUFFER_BIT),x.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",be,!1),F.dispose(),E.dispose(),A.dispose(),N.dispose(),ve.dispose(),Ae.stop()},this.renderBufferImmediate=function(object,e){w.initAttributes();var t=A.get(object);object.hasPositions&&!t.position&&(t.position=x.createBuffer()),object.hasNormals&&!t.normal&&(t.normal=x.createBuffer()),object.hasUvs&&!t.uv&&(t.uv=x.createBuffer()),object.hasColors&&!t.color&&(t.color=x.createBuffer());var r=e.getAttributes();object.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,t.position),x.bufferData(x.ARRAY_BUFFER,object.positionArray,x.DYNAMIC_DRAW),w.enableAttribute(r.position),x.vertexAttribPointer(r.position,3,x.FLOAT,!1,0,0)),object.hasNormals&&(x.bindBuffer(x.ARRAY_BUFFER,t.normal),x.bufferData(x.ARRAY_BUFFER,object.normalArray,x.DYNAMIC_DRAW),w.enableAttribute(r.normal),x.vertexAttribPointer(r.normal,3,x.FLOAT,!1,0,0)),object.hasUvs&&(x.bindBuffer(x.ARRAY_BUFFER,t.uv),x.bufferData(x.ARRAY_BUFFER,object.uvArray,x.DYNAMIC_DRAW),w.enableAttribute(r.uv),x.vertexAttribPointer(r.uv,2,x.FLOAT,!1,0,0)),object.hasColors&&(x.bindBuffer(x.ARRAY_BUFFER,t.color),x.bufferData(x.ARRAY_BUFFER,object.colorArray,x.DYNAMIC_DRAW),w.enableAttribute(r.color),x.vertexAttribPointer(r.color,3,x.FLOAT,!1,0,0)),w.disableUnusedAttributes(),x.drawArrays(x.TRIANGLES,0,object.count),object.count=0};var we=new Scene;this.renderBufferDirect=function(e,t,r,n,object,o){null===t&&(t=we);var l=object.isMesh&&object.matrixWorld.determinant()<0,c=Pe(e,t,n,object);w.setMaterial(n,l);var h=!1;X.geometry===r.id&&X.program===c.id&&X.wireframe===(!0===n.wireframe)||(X.geometry=r.id,X.program=c.id,X.wireframe=!0===n.wireframe,h=!0),(n.morphTargets||n.morphNormals)&&(D.update(object,r,n,c),h=!0);var d=r.index,f=r.attributes.position;if(null===d){if(void 0===f||0===f.count)return}else if(0===d.count)return;var m,v=1;!0===n.wireframe&&(d=C.getWireframeAttribute(r),v=2);var y=O;null!==d&&(m=L.get(d),(y=I).setIndex(m)),h&&(!function(object,e,t,r){if(!1===M.isWebGL2&&(object.isInstancedMesh||e.isInstancedBufferGeometry)&&null===_.get("ANGLE_instanced_arrays"))return;w.initAttributes();var n=e.attributes,o=r.getAttributes(),l=t.defaultAttributeValues;for(var c in o){var h=o[c];if(h>=0){var d=n[c];if(void 0!==d){var f=d.normalized,m=d.itemSize;if(void 0===(C=L.get(d)))continue;var v=C.buffer,y=C.type,S=C.bytesPerElement;if(d.isInterleavedBufferAttribute){var data=d.data,A=data.stride,T=d.offset;data&&data.isInstancedInterleavedBuffer?(w.enableAttributeAndDivisor(h,data.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=data.meshPerAttribute*data.count)):w.enableAttribute(h),x.bindBuffer(x.ARRAY_BUFFER,v),x.vertexAttribPointer(h,m,y,f,A*S,T*S)}else d.isInstancedBufferAttribute?(w.enableAttributeAndDivisor(h,d.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=d.meshPerAttribute*d.count)):w.enableAttribute(h),x.bindBuffer(x.ARRAY_BUFFER,v),x.vertexAttribPointer(h,m,y,f,0,0)}else if("instanceMatrix"===c){var C;if(void 0===(C=L.get(object.instanceMatrix)))continue;v=C.buffer,y=C.type;w.enableAttributeAndDivisor(h+0,1),w.enableAttributeAndDivisor(h+1,1),w.enableAttributeAndDivisor(h+2,1),w.enableAttributeAndDivisor(h+3,1),x.bindBuffer(x.ARRAY_BUFFER,v),x.vertexAttribPointer(h+0,4,y,!1,64,0),x.vertexAttribPointer(h+1,4,y,!1,64,16),x.vertexAttribPointer(h+2,4,y,!1,64,32),x.vertexAttribPointer(h+3,4,y,!1,64,48)}else if(void 0!==l){var N=l[c];if(void 0!==N)switch(N.length){case 2:x.vertexAttrib2fv(h,N);break;case 3:x.vertexAttrib3fv(h,N);break;case 4:x.vertexAttrib4fv(h,N);break;default:x.vertexAttrib1fv(h,N)}}}}w.disableUnusedAttributes()}(object,r,n,c),null!==d&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,m.buffer));var S=null!==d?d.count:f.count,A=r.drawRange.start*v,T=r.drawRange.count*v,N=null!==o?o.start*v:0,P=null!==o?o.count*v:1/0,F=Math.max(A,N),E=Math.min(S,A+T,N+P)-1,R=Math.max(0,E-F+1);if(0!==R){if(object.isMesh)!0===n.wireframe?(w.setLineWidth(n.wireframeLinewidth*pe()),y.setMode(x.LINES)):y.setMode(x.TRIANGLES);else if(object.isLine){var B=n.linewidth;void 0===B&&(B=1),w.setLineWidth(B*pe()),object.isLineSegments?y.setMode(x.LINES):object.isLineLoop?y.setMode(x.LINE_LOOP):y.setMode(x.LINE_STRIP)}else object.isPoints?y.setMode(x.POINTS):object.isSprite&&y.setMode(x.TRIANGLES);object.isInstancedMesh?y.renderInstances(r,F,R,object.count):r.isInstancedBufferGeometry?y.renderInstances(r,F,R,r.maxInstancedCount):y.render(F,R)}},this.compile=function(e,t){(y=E.get(e,t)).init(),e.traverse((function(object){object.isLight&&(y.pushLight(object),object.castShadow&&y.pushShadow(object))})),y.setupLights(t);var r={};e.traverse((function(object){if(object.material)if(Array.isArray(object.material))for(var i=0;i<object.material.length;i++)object.material[i].uuid in r==!1&&(Ne(object.material[i],e,object),r[object.material[i].uuid]=!0);else object.material.uuid in r==!1&&(Ne(object.material,e,object),r[object.material.uuid]=!0)}))};var Se=null;var Ae=new WebGLAnimation;function Te(object,e,t,r){if(!1!==object.visible){if(object.layers.test(e.layers))if(object.isGroup)t=object.renderOrder;else if(object.isLOD)!0===object.autoUpdate&&object.update(e);else if(object.isLight)y.pushLight(object),object.castShadow&&y.pushShadow(object);else if(object.isSprite){if(!object.frustumCulled||se.intersectsSprite(object)){r&&de.setFromMatrixPosition(object.matrixWorld).applyMatrix4(he);var n=N.update(object);(o=object.material).visible&&v.push(object,n,o,t,de.z,null)}}else if(object.isImmediateRenderObject)r&&de.setFromMatrixPosition(object.matrixWorld).applyMatrix4(he),v.push(object,null,object.material,t,de.z,null);else if((object.isMesh||object.isLine||object.isPoints)&&(object.isSkinnedMesh&&object.skeleton.frame!==S.render.frame&&(object.skeleton.update(),object.skeleton.frame=S.render.frame),!object.frustumCulled||se.intersectsObject(object))){r&&de.setFromMatrixPosition(object.matrixWorld).applyMatrix4(he);n=N.update(object);var o=object.material;if(Array.isArray(o))for(var l=n.groups,i=0,c=l.length;i<c;i++){var h=l[i],d=o[h.materialIndex];d&&d.visible&&v.push(object,n,d,t,de.z,h)}else o.visible&&v.push(object,n,o,t,de.z,null)}var f=object.children;for(i=0,c=f.length;i<c;i++)Te(f[i],e,t,r)}}function Le(e,t,r,n){for(var i=0,o=e.length;i<o;i++){var l=e[i],object=l.object,c=l.geometry,h=void 0===n?l.material:n,d=l.group;if(r.isArrayCamera)if(Q=r,ve.enabled&&ge.isAvailable())Ce(object,t,r,c,h,d);else for(var f=r.cameras,m=0,v=f.length;m<v;m++){var x=f[m];object.layers.test(x.layers)&&(w.viewport(K.copy(x.viewport)),y.setupLights(x),Ce(object,t,x,c,h,d))}else Q=null,Ce(object,t,r,c,h,d)}}function Ce(object,e,t,r,n,o){if(object.onBeforeRender(U,e,t,r,n,o),y=E.get(e,Q||t),object.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.isImmediateRenderObject){var l=Pe(t,e,n,object);w.setMaterial(n),X.geometry=null,X.program=null,X.wireframe=!1,function(object,e){object.render((function(object){U.renderBufferImmediate(object,e)}))}(object,l)}else U.renderBufferDirect(t,e,r,n,object,o);object.onAfterRender(U,e,t,r,n,o),y=E.get(e,Q||t)}function Ne(e,t,object){var r=A.get(e),n=y.state.lights,o=y.state.shadowsArray,l=n.state.version,c=P.getParameters(e,n.state,o,t,le.numPlanes,le.numIntersection,object),h=P.getProgramCacheKey(c),d=r.program,f=!0;if(void 0===d)e.addEventListener("dispose",_e);else if(d.cacheKey!==h)Me(e);else if(r.lightsStateVersion!==l)r.lightsStateVersion=l,f=!1;else{if(void 0!==c.shaderID)return;f=!1}f&&(d=P.acquireProgram(c,h),r.program=d,r.uniforms=c.uniforms,r.environment=e.isMeshStandardMaterial?t.environment:null,r.outputEncoding=U.outputEncoding,e.program=d);var m=d.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var i=0;i<U.maxMorphTargets;i++)m["morphTarget"+i]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(i=0;i<U.maxMorphNormals;i++)m["morphNormal"+i]>=0&&e.numSupportedMorphNormals++}var v=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=le.numPlanes,r.numIntersection=le.numIntersection,v.clippingPlanes=le.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=l,r.needsLights&&(v.ambientLightColor.value=n.state.ambient,v.lightProbe.value=n.state.probe,v.directionalLights.value=n.state.directional,v.spotLights.value=n.state.spot,v.rectAreaLights.value=n.state.rectArea,v.pointLights.value=n.state.point,v.hemisphereLights.value=n.state.hemi,v.directionalShadowMap.value=n.state.directionalShadowMap,v.directionalShadowMatrix.value=n.state.directionalShadowMatrix,v.spotShadowMap.value=n.state.spotShadowMap,v.spotShadowMatrix.value=n.state.spotShadowMatrix,v.pointShadowMap.value=n.state.pointShadowMap,v.pointShadowMatrix.value=n.state.pointShadowMatrix);var x=r.program.getUniforms(),_=WebGLUniforms.seqWithValue(x.seq,v);r.uniformsList=_}function Pe(e,t,r,object){T.resetTextureUnits();var n=t.fog,o=r.isMeshStandardMaterial?t.environment:null,l=A.get(r),c=y.state.lights;if(ce&&(ue||e!==Y)){var h=e===Y&&r.id===H;le.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,l,h)}r.version===l.__version?void 0===l.program||r.fog&&l.fog!==n||l.environment!==o||l.needsLights&&l.lightsStateVersion!==c.state.version?Ne(r,t,object):void 0===l.numClippingPlanes||l.numClippingPlanes===le.numPlanes&&l.numIntersection===le.numIntersection?l.outputEncoding!==U.outputEncoding&&Ne(r,t,object):Ne(r,t,object):(Ne(r,t,object),l.__version=r.version);var d,f,m=!1,v=!1,_=!1,S=l.program,L=S.getUniforms(),C=l.uniforms;if(w.useProgram(S.program)&&(m=!0,v=!0,_=!0),r.id!==H&&(H=r.id,v=!0),m||Y!==e){if(S.numMultiviewViews>0?ge.updateCameraProjectionMatricesUniform(e,L):L.setValue(x,"projectionMatrix",e.projectionMatrix),M.logarithmicDepthBuffer&&L.setValue(x,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),Y!==e&&(Y=e,v=!0,_=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var N=L.map.cameraPosition;void 0!==N&&N.setValue(x,de.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&L.setValue(x,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&(S.numMultiviewViews>0?ge.updateCameraViewMatricesUniform(e,L):L.setValue(x,"viewMatrix",e.matrixWorldInverse))}if(r.skinning){L.setOptional(x,object,"bindMatrix"),L.setOptional(x,object,"bindMatrixInverse");var P=object.skeleton;if(P){var F=P.bones;if(M.floatVertexTextures){if(void 0===P.boneTexture){var E=Math.sqrt(4*F.length);E=MathUtils.ceilPowerOfTwo(E),E=Math.max(E,4);var R=new Float32Array(E*E*4);R.set(P.boneMatrices);var D=new DataTexture(R,E,E,RGBAFormat,FloatType);P.boneMatrices=R,P.boneTexture=D,P.boneTextureSize=E}L.setValue(x,"boneTexture",P.boneTexture,T),L.setValue(x,"boneTextureSize",P.boneTextureSize)}else L.setOptional(x,P,"boneMatrices")}}return(v||l.receiveShadow!==object.receiveShadow)&&(l.receiveShadow=object.receiveShadow,L.setValue(x,"receiveShadow",object.receiveShadow)),v&&(L.setValue(x,"toneMappingExposure",U.toneMappingExposure),L.setValue(x,"toneMappingWhitePoint",U.toneMappingWhitePoint),l.needsLights&&(f=_,(d=C).ambientLightColor.needsUpdate=f,d.lightProbe.needsUpdate=f,d.directionalLights.needsUpdate=f,d.pointLights.needsUpdate=f,d.spotLights.needsUpdate=f,d.rectAreaLights.needsUpdate=f,d.hemisphereLights.needsUpdate=f),n&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(C,n),r.isMeshBasicMaterial?Fe(C,r):r.isMeshLambertMaterial?(Fe(C,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(C,r)):r.isMeshToonMaterial?(Fe(C,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(C,r)):r.isMeshPhongMaterial?(Fe(C,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(C,r)):r.isMeshStandardMaterial?(Fe(C,r,o),r.isMeshPhysicalMaterial?function(e,t,r){Ee(e,t,r),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===BackSide&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(C,r,o):Ee(C,r,o)):r.isMeshMatcapMaterial?(Fe(C,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(C,r)):r.isMeshDepthMaterial?(Fe(C,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(C,r)):r.isMeshDistanceMaterial?(Fe(C,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(C,r)):r.isMeshNormalMaterial?(Fe(C,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(C,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(C,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(C,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*te,e.scale.value=.5*ee,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(C,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(C,r):r.isShadowMaterial&&(C.color.value.copy(r.color),C.opacity.value=r.opacity),void 0!==C.ltc_1&&(C.ltc_1.value=UniformsLib.LTC_1),void 0!==C.ltc_2&&(C.ltc_2.value=UniformsLib.LTC_2),WebGLUniforms.upload(x,l.uniformsList,C,T),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(x,l.uniformsList,C,T),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&L.setValue(x,"center",object.center),S.numMultiviewViews>0?ge.updateObjectMatricesUniforms(object,e,L):(L.setValue(x,"modelViewMatrix",object.modelViewMatrix),L.setValue(x,"normalMatrix",object.normalMatrix)),L.setValue(x,"modelMatrix",object.matrixWorld),S}function Fe(e,t,r){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var n,o,l=t.envMap||r;l&&(e.envMap.value=l,e.flipEnvMap.value=l.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=A.get(l).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix)),t.aoMap?o=t.aoMap:t.lightMap&&(o=t.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function Ee(e,t,r){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||r)&&(e.envMapIntensity.value=t.envMapIntensity)}Ae.setAnimationLoop((function(time){ve.isPresenting||Se&&Se(time)})),"undefined"!=typeof window&&Ae.setContext(window),this.setAnimationLoop=function(e){Se=e,ve.setAnimationLoop(e),Ae.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!k){X.geometry=null,X.program=null,X.wireframe=!1,H=-1,Y=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ve.enabled&&ve.isPresenting&&(t=ve.getCamera(t)),(y=E.get(e,t)).init(),e.onBeforeRender(U,e,t,r||j),he.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),se.setFromProjectionMatrix(he),ue=this.localClippingEnabled,ce=le.init(this.clippingPlanes,ue,t),(v=F.get(e,t)).init(),Te(e,t,0,U.sortObjects),!0===U.sortObjects&&v.sort(re,ie),ce&&le.beginShadows();var o=y.state.shadowsArray;ye.render(o,e,t),y.setupLights(t),ce&&le.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),ve.enabled&&ge.isAvailable()&&ge.attachCamera(t),R.render(v,e,t,n);var l=v.opaque,c=v.transparent;if(e.overrideMaterial){var h=e.overrideMaterial;l.length&&Le(l,e,t,h),c.length&&Le(c,e,t,h)}else l.length&&Le(l,e,t),c.length&&Le(c,e,t);e.onAfterRender(U,e,t),null!==j&&(T.updateRenderTargetMipmap(j),T.updateMultisampleRenderTarget(j)),w.buffers.depth.setTest(!0),w.buffers.depth.setMask(!0),w.buffers.color.setMask(!0),w.setPolygonOffset(!1),ve.enabled&&ge.isAvailable()&&ge.detachCamera(t),v=null,y=null}}else console.error("WebGLRenderer.render: camera is not an instance of Camera.")},this.setFramebuffer=function(e){V!==e&&null===j&&x.bindFramebuffer(x.FRAMEBUFFER,e),V=e},this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return z},this.getRenderTarget=function(){return j},this.setRenderTarget=function(e,t,r){j=e,G=t,z=r,e&&void 0===A.get(e).__webglFramebuffer&&T.setupRenderTarget(e);var n=V,o=!1;if(e){var l=A.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=l[t||0],o=!0):n=e.isWebGLMultisampleRenderTarget?A.get(e).__webglMultisampledFramebuffer:l,K.copy(e.viewport),J.copy(e.scissor),Z=e.scissorTest}else K.copy(ne).multiplyScalar(te).floor(),J.copy(ae).multiplyScalar(te).floor(),Z=oe;if(W!==n&&(x.bindFramebuffer(x.FRAMEBUFFER,n),W=n),w.viewport(K),w.scissor(J),w.setScissorTest(Z),o){var c=A.get(e.texture);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+(t||0),c.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,o,l,c){if(e&&e.isWebGLRenderTarget){var h=A.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==c&&(h=h[c]),h){var d=!1;h!==W&&(x.bindFramebuffer(x.FRAMEBUFFER,h),d=!0);try{var f=e.texture,m=f.format,v=f.type;if(m!==RGBAFormat&&B.convert(m)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(v===UnsignedByteType||B.convert(v)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||v===FloatType&&(M.isWebGL2||_.get("OES_texture_float")||_.get("WEBGL_color_buffer_float"))||v===HalfFloatType&&(M.isWebGL2?_.get("EXT_color_buffer_float"):_.get("EXT_color_buffer_half_float"))))return void console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-o&&x.readPixels(t,r,n,o,B.convert(m),B.convert(v),l):console.error("WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{d&&x.bindFramebuffer(x.FRAMEBUFFER,W)}}}else console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){void 0===r&&(r=0);var n=Math.pow(2,-r),o=Math.floor(t.image.width*n),l=Math.floor(t.image.height*n),c=B.convert(t.format);T.setTexture2D(t,0),x.copyTexImage2D(x.TEXTURE_2D,r,c,e.x,e.y,o,l,0),w.unbindTexture()},this.copyTextureToTexture=function(e,t,r,n){var o=t.image.width,l=t.image.height,c=B.convert(r.format),h=B.convert(r.type);T.setTexture2D(r,0),t.isDataTexture?x.texSubImage2D(x.TEXTURE_2D,n||0,e.x,e.y,o,l,c,h,t.image.data):x.texSubImage2D(x.TEXTURE_2D,n||0,e.x,e.y,c,h,t.image),w.unbindTexture()},this.initTexture=function(e){T.setTexture2D(e,0),w.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function CanvasTexture(canvas,e,t,r,n,o,l,c,h){Texture.call(this,canvas,e,t,r,n,o,l,c,h),this.needsUpdate=!0}function VideoTexture(video,e,t,r,n,o,l,c,h){Texture.call(this,video,e,t,r,n,o,l,c,h),this.format=void 0!==l?l:RGBFormat,this.minFilter=void 0!==o?o:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1}WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(source){return WebGLRenderTarget.prototype.copy.call(this,source),this.samples=source.samples,this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var video=this.image;video.readyState>=video.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}})},174:function(e,t,r){e.exports=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2));e.exports=n.default},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(9)),l=n(r(3)),s=r(4);t.default=function(){if("undefined"!=typeof window){var e={history:[]},t={offset:{},threshold:0,test:s.inViewport},i=(0,o.default)((function(){e.history.forEach((function(t){e[t].check()}))}),100);["scroll","resize","load"].forEach((function(e){return addEventListener(e,i)})),window.MutationObserver&&addEventListener("DOMContentLoaded",(function(){new MutationObserver(i).observe(document.body,{attributes:!0,childList:!0,subtree:!0})}));var u=function(r){if("string"==typeof r){var n=[].slice.call(document.querySelectorAll(r));return e.history.indexOf(r)>-1?e[r].elements=n:(e[r]=(0,l.default)(n,t),e.history.push(r)),e[r]}};return u.offset=function(e){if(void 0===e)return t.offset;var r=function(e){return"number"==typeof e};return["top","right","bottom","left"].forEach(r(e)?function(r){return t.offset[r]=e}:function(n){return r(e[n])?t.offset[n]=e[n]:null}),t.offset},u.threshold=function(e){return"number"==typeof e&&e>=0&&e<=1?t.threshold=e:t.threshold},u.test=function(e){return"function"==typeof e?t.test=e:t.test},u.is=function(e){return t.test(e,t)},u.offset(0),u}}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.options=r,this.elements=t,this.current=[],this.handlers={enter:[],exit:[]},this.singles={enter:[],exit:[]}}return r(e,[{key:"check",value:function(){var e=this;return this.elements.forEach((function(t){var r=e.options.test(t,e.options),n=e.current.indexOf(t),i=n>-1,u=!r&&i;r&&!i&&(e.current.push(t),e.emit("enter",t)),u&&(e.current.splice(n,1),e.emit("exit",t))})),this}},{key:"on",value:function(e,t){return this.handlers[e].push(t),this}},{key:"once",value:function(e,t){return this.singles[e].unshift(t),this}},{key:"emit",value:function(e,t){for(;this.singles[e].length;)this.singles[e].pop()(t);for(var r=this.handlers[e].length;--r>-1;)this.handlers[e][r](t);return this}}]),e}();t.default=function(e,t){return new i(e,t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inViewport=function(e,t){var r=e.getBoundingClientRect(),n=r.top,i=r.right,o=r.bottom,u=r.left,l=r.width,s=r.height,c=o,h=window.innerWidth-u,d=window.innerHeight-n,f=i,m=t.threshold*l,v=t.threshold*s;return c>t.offset.top+v&&h>t.offset.right+m&&d>t.offset.bottom+v&&f>t.offset.left+m}},function(e,t){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(t,function(){return this}())},function(e,t,r){var n=r(5),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t,r){var i=r(1),n=r(8),u=r(10),o="Expected a function",s=Math.max,l=Math.min;e.exports=function(e,t,r){function c(t){var r=f,n=m;return f=m=void 0,_=t,v=e.apply(n,r)}function a(e){return _=e,y=setTimeout(d,t),M?c(e):v}function h(e){var r=e-x;return void 0===x||r>=t||r<0||w&&e-_>=g}function d(){var e=n();return h(e)?p(e):void(y=setTimeout(d,function(e){var i=t-(e-x);return w?l(i,g-(e-_)):i}(e)))}function p(e){return y=void 0,S&&f?c(e):(f=m=void 0,v)}function b(){var e=n(),r=h(e);if(f=arguments,m=this,x=e,r){if(void 0===y)return a(x);if(w)return y=setTimeout(d,t),c(x)}return void 0===y&&(y=setTimeout(d,t)),v}var f,m,g,v,y,x,_=0,M=!1,w=!1,S=!0;if("function"!=typeof e)throw new TypeError(o);return t=u(t)||0,i(r)&&(M=!!r.leading,g=(w="maxWait"in r)?s(u(r.maxWait)||0,t):g,S="trailing"in r?!!r.trailing:S),b.cancel=function(){void 0!==y&&clearTimeout(y),_=0,f=x=m=y=void 0},b.flush=function(){return void 0===y?v:p(n())},b}},function(e,t,r){var n=r(6);e.exports=function(){return n.Date.now()}},function(e,t,r){var i=r(7),n=r(1),u="Expected a function";e.exports=function(e,t,r){var o=!0,l=!0;if("function"!=typeof e)throw new TypeError(u);return n(r)&&(o="leading"in r?!!r.leading:o,l="trailing"in r?!!r.trailing:l),i(e,t,{leading:o,maxWait:t,trailing:l})}},function(e,t){e.exports=function(e){return e}}])},183:function(e,t,r){"use strict";var n=r(198),o=r(199),l=r(200).Lethargy,c=r(201),h=(r(202),r(203)),d="virtualscroll";e.exports=_;var f=37,m=38,v=39,y=40,x=32;function _(e){h(this,"_onWheel","_onMouseWheel","_onTouchStart","_onTouchMove","_onKeyDown"),this.el=window,e&&e.el&&(this.el=e.el,delete e.el),this.options=n({mouseMultiplier:.35,touchMultiplier:1,firefoxMultiplier:15,keyStep:120,preventTouch:!1,unpreventTouchClass:"vs-touchmove-allowed",limitInertia:!1,useKeyboard:!0},e),this.options.limitInertia&&(this._lethargy=new l),this._emitter=new o,this._event={y:0,x:0,deltaX:0,deltaY:0},this.touchStartX=null,this.touchStartY=null,this.bodyTouchAction=null,void 0!==this.options.passive&&(this.listenerOptions={passive:this.options.passive})}_.prototype._notify=function(e){if(!window.blockScroll){var t=this._event,r=(this.el.clientHeight||this.el.offsetHeight)-window.innerHeight;t.x+=t.deltaX,t.y+t.deltaY>0?t.y=0:-(t.y+t.deltaY)>=2*r?t.y=2*-r:t.y+=t.deltaY,this._emitter.emit(d,{x:t.x,y:t.y,deltaX:t.deltaX,deltaY:t.deltaY,originalEvent:e})}},_.prototype._onWheel=function(e){if(!window.blockScroll){var t=this.options;if(!this._lethargy||!1!==this._lethargy.check(e)){var r=this._event;r.deltaX=e.wheelDeltaX||-1*e.deltaX,r.deltaY=e.wheelDeltaY||-1*e.deltaY,c.isFirefox&&1==e.deltaMode&&(r.deltaX*=t.firefoxMultiplier,r.deltaY*=t.firefoxMultiplier),r.deltaX*=t.mouseMultiplier,r.deltaY*=t.mouseMultiplier,this._notify(e)}}},_.prototype._onMouseWheel=function(e){if(!(window.blockScroll||this.options.limitInertia&&!1===this._lethargy.check(e))){var t=this._event;t.deltaX=e.wheelDeltaX?e.wheelDeltaX:0,t.deltaY=e.wheelDeltaY?e.wheelDeltaY:e.wheelDelta,this._notify(e)}},_.prototype._onTouchStart=function(e){var t=e.targetTouches?e.targetTouches[0]:e;this.touchStartX=t.pageX,this.touchStartY=t.pageY},_.prototype._onTouchMove=function(e){if(!window.blockScroll){var t=this.options;t.preventTouch&&e.target.classList.contains(t.unpreventTouchClass);var r=this._event,n=e.targetTouches?e.targetTouches[0]:e;r.deltaX=(n.pageX-this.touchStartX)*t.touchMultiplier,r.deltaY=(n.pageY-this.touchStartY)*t.touchMultiplier,this.touchStartX=n.pageX,this.touchStartY=n.pageY,this._notify(e)}},_.prototype._onKeyDown=function(e){if(!window.blockScroll){var t=this._event;t.deltaX=t.deltaY=0;var r=window.innerHeight-40;switch(e.keyCode){case f:case m:t.deltaY=this.options.keyStep;break;case v:case y:t.deltaY=-this.options.keyStep;break;case x&&e.shiftKey:t.deltaY=r;break;case x:t.deltaY=-r;break;default:return}this._notify(e)}},_.prototype._bind=function(){c.hasWheelEvent&&this.el.addEventListener("wheel",this._onWheel,this.listenerOptions),c.hasMouseWheelEvent&&this.el.addEventListener("mousewheel",this._onMouseWheel,this.listenerOptions),c.hasTouch&&(this.el.addEventListener("touchstart",this._onTouchStart,this.listenerOptions),this.el.addEventListener("touchmove",this._onTouchMove,this.listenerOptions)),c.hasPointer&&c.hasTouchWin&&(this.bodyTouchAction=document.body.style.msTouchAction,document.body.style.msTouchAction="none",this.el.addEventListener("MSPointerDown",this._onTouchStart,!0),this.el.addEventListener("MSPointerMove",this._onTouchMove,!0))},_.prototype._unbind=function(){c.hasWheelEvent&&this.el.removeEventListener("wheel",this._onWheel),c.hasMouseWheelEvent&&this.el.removeEventListener("mousewheel",this._onMouseWheel),c.hasTouch&&(this.el.removeEventListener("touchstart",this._onTouchStart),this.el.removeEventListener("touchmove",this._onTouchMove)),c.hasPointer&&c.hasTouchWin&&(document.body.style.msTouchAction=this.bodyTouchAction,this.el.removeEventListener("MSPointerDown",this._onTouchStart,!0),this.el.removeEventListener("MSPointerMove",this._onTouchMove,!0)),c.hasKeyDown&&this.options.useKeyboard&&document.removeEventListener("keydown",this._onKeyDown)},_.prototype.on=function(e,t){this._emitter.on(d,e,t);var r=this._emitter.e;r&&r[d]&&1===r[d].length&&this._bind()},_.prototype.off=function(e,t){this._emitter.off(d,e,t);var r=this._emitter.e;(!r[d]||r[d].length<=0)&&this._unbind()},_.prototype.reset=function(){var e=this._event;e.x=0,e.y=0},_.prototype.destroy=function(){this._emitter.off(),this._unbind()}},198:function(e,t,r){"use strict";var n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function c(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,source){for(var t,r,h=c(e),s=1;s<arguments.length;s++){for(var d in t=Object(arguments[s]))o.call(t,d)&&(h[d]=t[d]);if(n){r=n(t);for(var i=0;i<r.length;i++)l.call(t,r[i])&&(h[r[i]]=t[r[i]])}}return h}},199:function(e,t){function r(){}r.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function o(){n.off(e,o),t.apply(r,arguments)}return o._=t,this.on(e,o,r)},emit:function(e){for(var data=[].slice.call(arguments,1),t=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=t.length;i<r;i++)t[i].fn.apply(t[i].ctx,data);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],o=[];if(n&&t)for(var i=0,l=n.length;i<l;i++)n[i].fn!==t&&n[i].fn._!==t&&o.push(n[i]);return o.length?r[e]=o:delete r[e],this}},e.exports=r},200:function(e,t,r){(function(){(null!==t?t:this).Lethargy=function(){function e(e,t,r,n){this.stability=null!=e?Math.abs(e):8,this.sensitivity=null!=t?1+Math.abs(t):100,this.tolerance=null!=r?1+Math.abs(r):1.1,this.delay=null!=n?n:150,this.lastUpDeltas=function(){var i,e,t;for(t=[],i=1,e=2*this.stability;1<=e?i<=e:i>=e;1<=e?i++:i--)t.push(null);return t}.call(this),this.lastDownDeltas=function(){var i,e,t;for(t=[],i=1,e=2*this.stability;1<=e?i<=e:i>=e;1<=e?i++:i--)t.push(null);return t}.call(this),this.deltasTimestamp=function(){var i,e,t;for(t=[],i=1,e=2*this.stability;1<=e?i<=e:i>=e;1<=e?i++:i--)t.push(null);return t}.call(this)}return e.prototype.check=function(e){var t;return null!=(e=e.originalEvent||e).wheelDelta?t=e.wheelDelta:null!=e.deltaY?t=-40*e.deltaY:null==e.detail&&0!==e.detail||(t=-40*e.detail),this.deltasTimestamp.push(Date.now()),this.deltasTimestamp.shift(),t>0?(this.lastUpDeltas.push(t),this.lastUpDeltas.shift(),this.isInertia(1)):(this.lastDownDeltas.push(t),this.lastDownDeltas.shift(),this.isInertia(-1))},e.prototype.isInertia=function(e){var t,r,n,o,l,c,h;return null===(t=-1===e?this.lastDownDeltas:this.lastUpDeltas)[0]?e:!(this.deltasTimestamp[2*this.stability-2]+this.delay>Date.now()&&t[0]===t[2*this.stability-1])&&(n=t.slice(0,this.stability),r=t.slice(this.stability,2*this.stability),h=n.reduce((function(e,s){return e+s})),l=r.reduce((function(e,s){return e+s})),c=h/n.length,o=l/r.length,Math.abs(c)<Math.abs(o*this.tolerance)&&this.sensitivity<Math.abs(o)&&e)},e.prototype.showLastUpDeltas=function(){return this.lastUpDeltas},e.prototype.showLastDownDeltas=function(){return this.lastDownDeltas},e}()}).call(this)},201:function(e,t,r){"use strict";e.exports={hasWheelEvent:"onwheel"in document,hasMouseWheelEvent:"onmousewheel"in document,hasTouch:"ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,hasTouchWin:navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,hasPointer:!!window.navigator.msPointerEnabled,hasKeyDown:"onkeydown"in document,isFirefox:navigator.userAgent.indexOf("Firefox")>-1}},202:function(e,t,r){"use strict";e.exports=function(source){return JSON.parse(JSON.stringify(source))}},203:function(e,t,r){"use strict";var n=Object.prototype.toString,o=Object.prototype.hasOwnProperty;function l(e,t){return function(){return e.apply(t,arguments)}}e.exports=function(object){if(!object)return console.warn("bindAll requires at least one argument.");var e=Array.prototype.slice.call(arguments,1);if(0===e.length)for(var t in object)o.call(object,t)&&"function"==typeof object[t]&&"[object Function]"==n.call(object[t])&&e.push(t);for(var i=0;i<e.length;i++){var r=e[i];object[r]=l(object[r],object)}}}}]);